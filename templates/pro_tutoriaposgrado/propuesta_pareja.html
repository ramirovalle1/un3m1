{% extends 'base.html' %}
{% load sga_extras %}
{% block atras %}/pro_tutoriaposgrado?per={{ perid|encrypt }}{% endblock %}
{% block heading %}
    <script type="text/javascript">
        $(function () {

            actualizar_observacion = function () {
                modalobservaciones = $("#observaciones");
                var obs = $(this).attr("obs");
                var id = $(this).attr("did");
                modalobservaciones.find("#contenido_observacion").attr({"value": obs, "ids": id});
                $("#error").html("");
                modalobservaciones.modal("show");
            };
            $("#btn-guardarobservacion").click(function () {
                contenidoobservacion = $("#contenido_observacion");
                var observacion = contenidoobservacion.attr("value");
                var id = contenidoobservacion.attr("ids");
                $("#observaciones").modal("hide");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/pro_tutoriaposgrado",
                    data: {'action': 'editobs', 'id': id, 'observacion': observacion},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#obs_" + id).attr({"obs": observacion.toUpperCase()});
                            $("#id_" + id).html(observacion.toUpperCase());
                        } else {
                            $("#error").html("<label hidden class='alert alert-error' >Error al guardar la observacion, intente de nuevo</label>");
                            $("#observaciones").modal("show");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        $("#error").html("<label hidden class='alert alert-error' >Error al guardar la observacion, intente de nuevo</label>");
                        $("#observaciones").modal("show");
                    },
                    dataType: "json"
                });
            });
            $(".btn-cerrar").click(function () {
                $("#observaciones").modal("hide");
            });
            $(".btn-observacion").click(actualizar_observacion);

            var tabcontratos = localStorage.getItem('tabcontratos');
            if (!tabcontratos) {
                tabcontratos = "#1";
                localStorage.setItem("tabcontratos", tabcontratos);
            }

            $('.tabs').each(function () {
                if ($(this).attr('href') == tabcontratos) {
                    $(this).trigger('click');
                }
            }).click(function () {
                localStorage.setItem("tabcontratos", $(this).attr('href'));
            });
        });
    </script>
    <script>
        function formModalDetalle(id, text, action) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody').html(data.data);
                        $('#itemspaneldetalle .paneltitle').html(text);
                        $("#itemspaneldetalle").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"

            });
        }

        function formModal(id, camposecundario, text, action) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                    'perid': camposecundario,
                    'pareja': true,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(text);
                        $("#itemspanel").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"

            });
        }

        function formModalAddTutoriaPorEtapa(id, periodo, programa_etapa_id, text, action) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                    'perid': periodo,
                    'programa_etapa_id': programa_etapa_id,
                    'pareja': true,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(text);
                        $("#itemspanel").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"

            });
        }


    </script>
    <script src="/static/adicionalesjs/formquestionb4.js?0.24"></script>
{% endblock %}
{% block canvas %}
    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <form class="form-horizontal form-modal" autocomplete="off" method="post" enctype="multipart/form-data"
                  action="{{ request.path }}">
                <div class="modal-content">

                    <div class="modal-header">
                        <h4><b class="paneltitle">FORMULARIO MODAL</b></h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        </button>
                    </div>
                    <div class="modal-body">

                        {% csrf_token %}
                        <div class="row panelbody">
                        </div>

                    </div>
                    <div class="modal-footer" id="footermodal">
                        <button type="submit" id="submit" class="btn btn-success"><i class="fa fa-check-circle"></i>
                            Guardar
                        </button>
                        <button type="button" class="btn btn-default" data-bs-dismiss="modal"><i
                                class="fa fa-times"></i>
                            Cerrar
                        </button>
                    </div>

                </div>
            </form>
        </div>
    </div>
    <div class="modal fade static" id="itemspaneldetalle" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><b class="paneltitle">FORMULARIO MODAL</b></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row panelbody">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal"><i class="fa fa-times"></i>
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title }}</h3>
                <h6>Registro de tutorias, revisión del trabajo de titulación.</h6>
            </div>
        </div>
    </div>

    <div class="row">
        <div class='col-lg-12'>
            {% if not bandera %}
                <div class="alert alert-warning">
                    <a href="javascript:;" class="close" data-bs-dismiss="alert">×</a>
                    <h4 class="alert-heading">Aviso importante.</h4>
                    Fechas cerradas para revisión de tutorías, en caso de necesitar más tiempo favor comunicarse con el
                    coordinador de maestría. (convocatoria: {{ grupo.convocatoria.id }})
                </div>
            {% endif %}
        </div>
    </div>

    <div class="container">
        <div class="row">

            <div class="card mb-4">
                <div class="row">
                    <div class="w-100 mt-4">
                        <div class="d-flex justify-content-between">

                            <div class="headtitle">
                                <h3 class="texto-blue">Tutorias</h3>
                                <h6>Registro de tutoria.</h6>
                            </div>
                            <div>

                                <a href="javascript:;" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight"
                                   class='btn btn-default'><span class="fa fa-info-circle dropdown-item-icon"></span>
                                    <t class="hidden-phone hidden-tablet visible-desktop">Más información</t>
                                </a>
                                {#                            <!-- button -->#}
                                {#                            {% if bandera %}#}
                                {#                                <a onclick="formModal('{{ grupo.id|encrypt }}','{{ perid|encrypt }}','ADICIONAR NUEVA TUTORÍA','addtutoriapareja')"#}
                                {#                                   href="javascript:;"#}
                                {#                                   class='btn btn-primary'><span class="fa fa-plus "></span>#}
                                {#                                    <t class="hidden-phone hidden-tablet visible-desktop">Adicionar</t>#}
                                {#                                </a>#}
                                {#                                {% if grupo.estado_propuesta.estado == 1 or grupo.estado_propuesta.estado == 3%}#}
                                {#                                    <a class="btn btn-default bloqueo_pantalla" href="/pro_tutoriaposgrado?action=revisartrabajofinaltitulacionpareja&id={{ grupo.id }}"><span#}
                                {#                                        class="fa fa-book "> </span> Revisión trabajo final</a>#}
                                {#                                {% else %}#}
                                {#                                {% endif %}#}
                                {##}
                                {##}
                                {##}
                                {#                            {% endif %}#}

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="row-fluid">
                        <div class="container">
                            <h4 class="accordion-header">
                                {% if grupo.tema_correcto %}
                                    TEMA: {{ grupo.tema_correcto }}
                                {% else %}

                                    <div class="alert alert-info">
                                        <a href="javascript:;" class="close" data-bs-dismiss="alert">×</a>
                                        <h4 class="alert-heading">NO HA REGISTRADO EL TEMA FINAL</h4>
                                        Favor ingresar el tema definido por usted y el maestrante, el cual será el tema
                                        final de la propuesta de titulación.
                                    </div>

                                {% endif %}
                            </h4>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row mt-4 pb-5">

                        <!-- Card -->
                        {% for programa_etapa in configuracion_programa_etapa %}
                            <!-- card -->
                            <div class=" shadow-none rounded-3   me-4 align-top mb-4 task-card">
                                <!-- card body -->
                                <div class="card-body p-3">
                                    <!-- task list -->
                                    <div class="task-list">
                                        <!-- content -->
                                        <div class="d-flex justify-content-between  align-items-center mb-3">
                                            <div>
                                                <!-- heading -->
                                                <h4 class="mb-0"> {{ programa_etapa.etapatutoria }}</h4>

                                            </div>
                                            <div class="d-flex align-items-center">
                                                {% if bandera %}
                                                    <!-- dropdown -->
                                                    <div class="dropdown dropstart">

                                                         <a onclick="formModalAddTutoriaPorEtapa('{{ grupo.id|encrypt }}','{{ perid|encrypt }}','{{ programa_etapa.id|encrypt }}','ADICIONAR NUEVA TUTORÍA','addtutoriaporetapa')"
                                                                   href="javascript:;"
                                                                   class='btn btn-default'><span
                                                                        class="fa fa-plus  dropdown-item-icon"></span>
                                                                    <t class="hidden-phone hidden-tablet visible-desktop">
                                                                        Adicionar
                                                                    </t>
                                                                </a>
                                                    </div>
                                                {% else %}
                                                     <span class="fa fa-info-circle tu " title="fechas de registro de tutorias cerradas."></span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="accordion"
                                             id="configuracion_programa_etapa_{{ programa_etapa.etapatutoria.id }}">
                                            <div class="accordion-item">

                                                <div class="accordion-header"

                                                     id="panelsStayOpen-headingOne_{{ programa_etapa.etapatutoria.id }}">

                                                    <button class="accordion-button" type="button"
                                                            data-bs-toggle="collapse"
                                                            data-bs-target="#panelsStayOpen-collapseOne_{{ programa_etapa.etapatutoria.id }}"
                                                            aria-expanded="true"
                                                            aria-controls="panelsStayOpen-collapseOne">
                                                        {% if  programa_etapa.etapatutoria.id  == 8  %}
                                                                Revisión del trabajo final de titulación etapa: {{ programa_etapa.etapatutoria }}
                                                        {% else %}
                                                             Tutorias y revisión de avances realizadas en la
                                                            etapa: {{ programa_etapa.etapatutoria }}
                                                        {% endif %}


                                                    </button>

                                                </div>
                                                <div id="panelsStayOpen-collapseOne_{{ programa_etapa.etapatutoria.id }}"
                                                     class="accordion-collapse collapse show"
                                                     aria-labelledby="panelsStayOpen-headingOne_{{ programa_etapa.etapatutoria.id }}">
                                                    <div class="accordion-body">
                                                        {% for tutoria in detalles %}
                                                            {% if  tutoria.programaetapatutoria.etapatutoria_id == programa_etapa.etapatutoria_id %}
                                                                <table class="table table-bordered table-striped mb-5">
                                                                <tbody>
                                                                <div class=" mb-5">
                                                                    <tr class="bg-light  mb-5">
                                                                        <td>
                                                                            <div class="d-flex justify-content-between  align-items-center ">
                                                                                <div>
                                                                                    <!-- heading -->
                                                                                    <h4 class="mb-0 ">

                                                                                        {{ tutoria.observacion }} :
                                                                                        {{ tutoria.fecharegistro | date:"d-m-Y"  }}
                                                                                        de {{ tutoria.horainicio }}
                                                                                        a {{ tutoria.horafin }}
                                                                                    </h4>
                                                                                </div>
                                                                                <div class="d-flex align-items-center">
                                                                                    <div class="dropdown dropstart">
                                                                                        <a href="javascript:void(0);"
                                                                                           class="btn-icon btn btn-ghost btn-sm rounded-circle"
                                                                                           data-bs-toggle="dropdown"
                                                                                           data-offset="-140"
                                                                                           aria-haspopup="true"
                                                                                           aria-expanded="false"><i
                                                                                                class="fa fa-ellipsis-v"></i></a>
                                                                                        <ul class="dropdown-menu pull-right  "
                                                                                            x-placement="right-start">
                                                                                            <li class="dropdown-item">
                                                                                                <a onclick="formModalDetalle('{{ tutoria.id }}','Detalle de tutoría','detalletutoriaposgrado')"
                                                                                                   href="javascript:;"><i
                                                                                                        class="fa fa-eye dropdown-item-icon"></i>
                                                                                                    Ver</a>
                                                                                            </li>
                                                                                            {% if bandera %}
                                                                                                <li class="dropdown-item">
                                                                                                    <a onclick="formModal('{{ tutoria.id|encrypt }}','{{ perid|encrypt }}','Editar tutoría','edittutoria')"
                                                                                                       href="javascript:;"><i
                                                                                                            class="fa fa-edit dropdown-item-icon"></i>
                                                                                                        Editar</a>
                                                                                                </li>
                                                                                                {% if not tutoria.en_uso %}
                                                                                                    <li class="dropdown-item">
                                                                                                        <a href="javascript:void(0);"
                                                                                                           onclick="eliminarajax('{{ tutoria.id }}', '{{ tutoria }}', 'delete')"><i
                                                                                                                class="fa fa-remove dropdown-item-icon"> </i>
                                                                                                            Eliminar</a>
                                                                                                    </li>
                                                                                                {% endif %}
                                                                                            {% endif %}
                                                                                        </ul>
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>
                                                                            <div class="table-responsive overflow-y-hidden">
                                                                                {% if tutoria.programaetapatutoria.etapatutoria.id  == 8 %}
                                                                                    {% with documento_tutoria_titulacion=tutoria.programaetapatutoria.mecanismotitulacionposgrado|args:grupo.convocatoria.id|call:'get_documentos_tutoria_configurado' %}
                                                                                        {% if documento_tutoria_titulacion %}
                                                                                             <table class="table mb-0 text-nowrap mb-5">
                                                                                                <thead class="table-active">
                                                                                                <tr>
                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        N°
                                                                                                    </th>
                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        Fecha
                                                                                                    </th>
                                                                                                    {% for foo in  documento_tutoria_titulacion %}
                                                                                                        <th scope="col"
                                                                                                            class=" border-top-0">
                                                                                                            {{ foo.get_tipo_display | title2 }}
                                                                                                        </th>
                                                                                                    {% endfor %}

                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        Correcciones
                                                                                                    </th>
                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        %
                                                                                                    </th>
                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        Observaciones
                                                                                                    </th>
                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        Estado
                                                                                                    </th>
                                                                                                    <th scope="col"
                                                                                                        class=" border-top-0">
                                                                                                        Acciones
                                                                                                    </th>
                                                                                                </tr>
                                                                                                </thead>
                                                                                                <tbody>
                                                                                                {% for revision in tutoria.obtener_revisiones_tutoria %}
                                                                                                    <tr>
                                                                                                        <td class="align-middle">
                                                                                                            <div class="d-flex align-items-center">{{ forloop.counter }}</div>
                                                                                                        </td>
                                                                                                        <td class="align-middle">
                                                                                                            <div class="d-flex align-items-center">

                                                                                                                {% if revision.fecharevision %}
                                                                                                                    {{ revision.fecharevision | date:"d-m-Y" }}
                                                                                                                {% else %}
                                                                                                                    <span class="badge bg-danger">Sin revisar</span>
                                                                                                                {% endif %}
                                                                                                            </div>
                                                                                                        </td>
                                                                                                        <small>Link de la revista: <a class="link-dark-info" target="_blank" href="{{ revision.linkrevista }}">{{ revision.linkrevista }}</a></small>

                                                                                                        {% for foo in  documento_tutoria_titulacion %}
                                                                                                            {% if foo.tipo == 7 %}
                                                                                                                <td class="align-middle">
                                                                                                                    <div class="d-flex align-items-center">
                                                                                                                        {% if revision.get_borrador_articulo %}
                                                                                                                            <a href="{{ revision.get_borrador_articulo.archivo.url }}"
                                                                                                                               target="_blank"><i
                                                                                                                                    class="fa fa-arrow-down"></i>
                                                                                                                                Descargar</a>
                                                                                                                        {% endif %}

                                                                                                                    </div>
                                                                                                                </td>
                                                                                                            {% endif %}
                                                                                                            {% if foo.tipo == 8 %}

                                                                                                                <td class="align-middle">
                                                                                                                    <div class="d-flex align-items-center">
                                                                                                                        {% if revision.get_carta_de_aceptacion %}
                                                                                                                            <a href="{{ revision.get_carta_de_aceptacion.archivo.url }}"
                                                                                                                               target="_blank"><i
                                                                                                                                    class="fa fa-arrow-down"></i>
                                                                                                                                Descargar</a>{% endif %}

                                                                                                                    </div>
                                                                                                                </td>

                                                                                                            {% endif %}

                                                                                                            {% if foo.tipo == 9 %}

                                                                                                                <td class="align-middle">
                                                                                                                    <div class="d-flex align-items-center">
                                                                                                                        {% if revision.get_acta_de_acompanamieno %}
                                                                                                                            {% if revision.get_acta_de_acompanamieno.archivo %}
                                                                                                                                <a href="{{ revision.get_acta_de_acompanamieno.archivo.url }}"
                                                                                                                                   target="_blank"><i
                                                                                                                                        class="fa fa-arrow-down"></i>
                                                                                                                                    Descargar</a>
                                                                                                                            {% endif %}{% endif %}
                                                                                                                    </div>
                                                                                                                </td>

                                                                                                            {% endif %}


                                                                                                        {% endfor %}

                                                                                                        <td class="align-middle">
                                                                                                            <div class="d-flex align-items-center">
                                                                                                                {% if revision.get_correccion %}
                                                                                                                    {% if revision.get_correccion.archivo %}
                                                                                                                        <a href="{{ revision.get_correccion.archivo.url }}"
                                                                                                                           target="_blank"><i
                                                                                                                                class="fa fa-arrow-down"></i>
                                                                                                                            Descargar</a>
                                                                                                                    {% endif %}{% endif %}
                                                                                                            </div>
                                                                                                        </td>
                                                                                                        <td class="align-middle">
                                                                                                            {% if not revision.porcentajeurkund == None %}
                                                                                                                {{ revision.porcentajeurkund }}
                                                                                                                %
                                                                                                            {% endif %}
                                                                                                        </td>
                                                                                                        <td class="align-middle">
                                                                                                            <p class="text-wrap">
                                                                                                                {{ revision.observacion }}
                                                                                                            </p>
                                                                                                        </td>

                                                                                                        <td class="align-middle"><span
                                                                                                                class="label{% if  revision.estado == 4 %} label-warning {% elif revision.estado == 3 %} label-important {% elif revision.estado == 2 %} label-success {% else %} label-info {% endif %}">{{ revision.get_estado_display }}</span>
                                                                                                        </td>

                                                                                                        <td class="align-middle">
                                                                                                            <div class="d-flex align-items-center">
                                                                                                                {% if revision.estado == 1 %}
                                                                                                                    <a onclick="formModal('{{ revision.id |encrypt }}','{{ perid |encrypt }}','Revisar documento final de titulación','calificarurkundtitulacionfinalposgrado')"
                                                                                                                       href="javascript:;"
                                                                                                                       class="btn btn-success btn-mini tu "
                                                                                                                       title="Revisar documento final de titulación"><i
                                                                                                                            class="fa fa-check"></i></a>
                                                                                                                {% else %}
                                                                                                                    <a href="javascript:;"
                                                                                                                       onclick="formModal('{{ revision.id|encrypt }}','{{ perid|encrypt }}','Revisar trabajo de titulación','editarurkundtitulacionfinalposgrado')"
                                                                                                                       class="btn btn-info btn-mini tu"
                                                                                                                       title="Editar"><i
                                                                                                                            class="fa fa-edit"></i></a>
                                                                                                                {% endif %}

                                                                                                            </div>


                                                                                                        </td>
                                                                                                    </tr>
                                                                                                {% empty %}
                                                                                                    <tr>
                                                                                                        <td colspan="10"
                                                                                                            class="text-center">
                                                                                                            NO
                                                                                                            EXISTEN
                                                                                                            REGISTROS
                                                                                                            DE
                                                                                                            TRABAJO
                                                                                                            FINAL DE
                                                                                                            TITULACIÓN

                                                                                                        </td>
                                                                                                    </tr>
                                                                                                {% endfor %}

                                                                                                </tbody>
                                                                                            </table>
                                                                                        {% else %}
                                                                                             <table class="table mb-0 text-nowrap mb-5">
                                                                                    <thead class="table-active">
                                                                                    <tr>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            N°
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Fecha
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Propuesta
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Versión Antiplagio
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Revisión Antiplagio
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Correcciones
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            %
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Observaciones
                                                                                        </th>
                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Estado
                                                                                        </th>

                                                                                        <th scope="col"
                                                                                            class=" border-top-0">
                                                                                            Acciones
                                                                                        </th>

                                                                                    </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                    {% for revision in tutoria.obtener_revisiones_tutoria %}
                                                                                        <tr>
                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">{{ forloop.counter }}</div>
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">

                                                                                                    {% if revision.fecharevision %}
                                                                                                        {{ revision.fecharevision | date:"d-m-Y"  }}
                                                                                                    {% else %}
                                                                                                        <span class="badge bg-danger">Sin revisar</span>
                                                                                                    {% endif %}
                                                                                                </div>
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">
                                                                                                    {% if revision.get_propuesta %}
                                                                                                        <a href="{{ revision.get_propuesta.archivo.url }}"
                                                                                                           target="_blank"><i
                                                                                                                class="fa fa-arrow-down"></i>
                                                                                                            Descargar</a>{% endif %}

                                                                                                </div>
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">
                                                                                                    {% if revision.get_extracto %}
                                                                                                        <a href="{{ revision.get_extracto.archivo.url }}"
                                                                                                           target="_blank"><i
                                                                                                                class="fa fa-arrow-down"></i>
                                                                                                            Descargar</a>{% endif %}

                                                                                                </div>
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">
                                                                                                    {% if revision.get_urkund %}
                                                                                                        {% if revision.get_urkund.archivo %}
                                                                                                            <a href="{{ revision.get_urkund.archivo.url }}"
                                                                                                               target="_blank"><i
                                                                                                                    class="fa fa-arrow-down"></i>
                                                                                                                Descargar</a>
                                                                                                        {% endif %}{% endif %}
                                                                                                </div>
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">
                                                                                                    {% if revision.get_correccion %}
                                                                                                        {% if revision.get_correccion.archivo %}
                                                                                                            <a href="{{ revision.get_correccion.archivo.url }}"
                                                                                                               target="_blank"><i
                                                                                                                    class="fa fa-arrow-down"></i>
                                                                                                                Descargar</a>
                                                                                                        {% endif %}{% endif %}
                                                                                                </div>
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                {% if not revision.porcentajeurkund == None %}
                                                                                                    {{ revision.porcentajeurkund }}
                                                                                                    %
                                                                                                {% endif %}
                                                                                            </td>
                                                                                            <td class="align-middle">
                                                                                                <p class="text-wrap">
                                                                                                    {{ revision.observacion }}
                                                                                                </p>
                                                                                            </td>

                                                                                            <td class="align-middle"><span
                                                                                                    class="label{% if  revision.estado == 4 %} label-warning {% elif revision.estado == 3 %} label-important {% elif revision.estado == 2 %} label-success {% else %} label-info {% endif %}">{{ revision.get_estado_display }}</span>
                                                                                            </td>

                                                                                            <td class="align-middle">
                                                                                                <div class="d-flex align-items-center">
                                                                                                    {% if revision.estado == 1 %}
                                                                                                        <a onclick="formModal('{{ revision.id |encrypt }}','{{ perid |encrypt }}','Revisar avance de tutoria','calificarurkundtitulacionfinalposgrado')"
                                                                                                           href="javascript:;"
                                                                                                           class="btn btn-success btn-mini tu "
                                                                                                           title="Revisar documento final de titulación"><i
                                                                                                                class="fa fa-check"></i></a>
                                                                                                    {% else %}
                                                                                                        <a href="javascript:;"
                                                                                                           onclick="formModal('{{ revision.id|encrypt }}','{{ perid|encrypt }}','Revisar trabajo de titulación','editarurkundtitulacionfinalposgrado')"
                                                                                                           class="btn btn-info btn-mini tu"
                                                                                                           title="Editar"><i
                                                                                                                class="fa fa-edit"></i></a>
                                                                                                    {% endif %}

                                                                                                </div>


                                                                                            </td>
                                                                                        </tr>
                                                                                        {% empty %}
                                                                                        <tr>
                                                                                            <td colspan="10"
                                                                                                class="text-center">
                                                                                                NO
                                                                                                EXISTEN REGISTROS DE
                                                                                                TRABAJO FINAL DE
                                                                                                TITULACIÓN

                                                                                            </td>
                                                                                        </tr>
                                                                                    {% endfor %}

                                                                                    </tbody>
                                                                                </table>
                                                                                        {% endif %}
                                                                                    {% endwith %}

                                                                                {% else %}
                                                                                    <table class="table mb-0 text-nowrap mb-5">
                                                                                        <thead class="table-active">
                                                                                        <tr>
                                                                                            <th scope="col"
                                                                                                class=" border-top-0">
                                                                                                N°
                                                                                            </th>
                                                                                            <th scope="col"
                                                                                                class=" border-top-0">
                                                                                                Revisión
                                                                                            </th>
                                                                                            <th scope="col"
                                                                                                class=" border-top-0">
                                                                                                Avance
                                                                                                tutoria
                                                                                            </th>
                                                                                            <th scope="col"
                                                                                                class=" border-top-0">
                                                                                                Correcciones
                                                                                            </th>
                                                                                            <th scope="col"
                                                                                                class=" border-top-0">
                                                                                                Observaciones
                                                                                            </th>
                                                                                            <th scope="col"
                                                                                                class=" border-top-0">
                                                                                                Acciones
                                                                                            </th>

                                                                                        </tr>
                                                                                        </thead>
                                                                                        <tbody>
                                                                                        {% for revision in tutoria.obtener_revisiones_tutoria %}
                                                                                            <tr>
                                                                                                <td class="align-middle">
                                                                                                    <div class="d-flex align-items-center">{{ forloop.counter }}</div>
                                                                                                </td>
                                                                                                <td class="align-middle">
                                                                                                    <div class="d-flex align-items-center">

                                                                                                        {% if revision.fecharevision %}
                                                                                                            {{ revision.fecharevision |date:"d-m-Y"}}
                                                                                                        {% else %}
                                                                                                            <span class="badge bg-danger">Sin revisar</span>
                                                                                                        {% endif %}
                                                                                                    </div>
                                                                                                </td>
                                                                                                <td class="align-middle">
                                                                                                    <div class="d-flex align-items-center">
                                                                                                        {% if revision.get_tutoria_avance %}
                                                                                                            <a href="{{ revision.get_tutoria_avance.archivo.url }}"
                                                                                                               target="_blank"><i
                                                                                                                    class="fa fa-arrow-down"></i>
                                                                                                                Descargar</a>{% endif %}

                                                                                                    </div>
                                                                                                </td>


                                                                                                <td class="align-middle">
                                                                                                    <div class="d-flex align-items-center">
                                                                                                        {% if revision.get_correccion %}
                                                                                                            {% if revision.get_correccion.archivo %}
                                                                                                                <a href="{{ revision.get_correccion.archivo.url }}"
                                                                                                                   target="_blank"><i
                                                                                                                        class="fa fa-arrow-down"></i>
                                                                                                                    Descargar</a>
                                                                                                            {% endif %}{% endif %}
                                                                                                    </div>
                                                                                                </td>

                                                                                                <td class="align-middle">


                                                                                                    <p class="text-wrap">
                                                                                                        {{ revision.observacion }}
                                                                                                    </p>


                                                                                                </td>

                                                                                                <td class="align-middle">
                                                                                                    <div class="d-flex align-items-center">
                                                                                                        {% if revision.estado == 1 %}
                                                                                                            <a onclick="formModal('{{ revision.id |encrypt }}','','Revisar avance de tutoria','revisararchivoavancetutoria')"
                                                                                                               href="javascript:;"
                                                                                                               class="btn btn-success btn-mini tu "
                                                                                                               title="Revisar avance"><i
                                                                                                                    class="fa fa-check"></i></a>
                                                                                                        {% else %}
                                                                                                            <a href="javascript:;"
                                                                                                               class="btn btn-info btn-mini tu "
                                                                                                               title="Editar"><i
                                                                                                                    class="fa fa-edit"></i></a>
                                                                                                        {% endif %}

                                                                                                    </div>


                                                                                                </td>
                                                                                            </tr>
                                                                                            {% empty %}
                                                                                            <tr>
                                                                                                <td colspan="7"
                                                                                                    class="text-center">
                                                                                                    NO
                                                                                                    EXISTEN REGISTROS DE
                                                                                                    AVANCES
                                                                                                    DE
                                                                                                    TUTORIA
                                                                                                </td>
                                                                                            </tr>
                                                                                        {% endfor %}

                                                                                        </tbody>
                                                                                    </table>
                                                                                {% endif %}

                                                                            </div>


                                                                        </td>
                                                                    </tr>
                                                                </div>
                                                            {% endif %}
                                                        </table>
                                                        {% endfor %}
                                                        </tbody>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                </div>
                            </div>
                        {% endfor %}

                    </div>

                </div>


            </div>

        </div>
    </div>




    <!-- offcanvas -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" style="width: 600px;">

        <div class="offcanvas-body" data-simplebar>
            <div class="offcanvas-header px-2 pt-0">
                <h3 class="offcanvas-title" id="offcanvasExampleLabel">Más Información</h3>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
            </div>

            <!-- card body -->
            <div class="container">
                <!-- form -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- Card -->
                        <div class="card mb-4">
                            <!-- Card body -->
                            <div class="card-body">
                                <h5 class="mb-0">CRONOGRAMA DE REGISTRO DE DOCUMENTOS DE TRABAJO DE TITULACIÓN</h5>
                                <div class="d-flex justify-content-between border-bottom py-2 mt-3">
                                    <span>Nº. revisión</span>
                                    <span class="text-dark">1</span>
                                </div>
                                <div class="d-flex justify-content-between border-bottom py-2">
                                    <span>Fecha inicio</span>
                                    <span>{{ cronograma.fechainiciotutoria|date:"d-m-Y" }} </span>
                                </div>
                                <div class="d-flex justify-content-between pt-2">
                                    <span>Fecha fin</span>
                                    <span class="text-dark"> {{ cronograma.fechafintutoria|date:"d-m-Y" }} </span>
                                </div>
                            </div>
                        </div>
                        <!-- Card -->
                        {% for foo in  grupo.obtener_parejas %}
                            <div class="card mb-4">
                                <!-- Card body -->
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="position-relative">
                                            {% if foo.matricula.inscripcion.persona.foto.foto %}
                                                <img class="rounded-circle avatar-xl mb-3"
                                                     src="https://sga.unemi.edu.ec{{ foo.matricula.inscripcion.persona.foto.foto.url }}"
                                                     alt="">
                                            {% else %}
                                                {% if foo.matricula.inscripcion.persona.sexo_id == 1 %}
                                                    <img class="rounded-circle avatar-xl mb-3"
                                                         src="/static/images/iconos/mujer.png" alt="">
                                                {% else %}
                                                    <img class="rounded-circle avatar-xl mb-3"
                                                         src="/static/images/iconos/hombre.png" alt="">
                                                {% endif %}
                                            {% endif %}

                                            <a href="#" class="position-absolute mt-10 ms-n5">
                                                <span class="status bg-success"></span>
                                            </a>
                                        </div>
                                        <h4 class="mb-0"><i
                                                class="fa fa-user"></i> {{ foo.matricula.inscripcion.persona.nombre_completo_inverso }}
                                        </h4>
                                        <p class="mb-0">
                                            <i class="fa fa-address-card"></i>
                                            CI: {{ foo.matricula.inscripcion.persona.cedula }}
                                        </p>
                                        <p class="mb-0">
                                            <i class="fa fa-envelope"></i> {{ foo.matricula.inscripcion.persona.emailinst }}
                                        </p>
                                        <p class="mb-0">
                                            <i class="fa fa-envelope"></i> {{ foo.matricula.inscripcion.carrera }}
                                        </p>


                                    </div>

                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <hr>
                    <div class="col-md-8"></div>
                    <!-- button -->
                    <div class="text-end">
                        <button type="button" class="btn btn-outline-primary ms-2 text-end"
                                data-bs-dismiss="offcanvas" aria-label="Close">Cerrar
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

{% endblock %}

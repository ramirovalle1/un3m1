{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript">
        var turnos_ids = []
        var materias_terminadas = []
        const actionDeletePlanificacion = (id, persona, asignatura) =>{
            var question = `Al realizar esta acción es irreversible. <br>¿Está seguro de eliminar la asignatura ${asignatura} de la persona ${persona}?`;
            Confirm.question(question, function () {
                bloqueointerface();
                let aData = {"action": "deleteAlumnoPlanificacion", 'id': id}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();
                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: 'Se elimino correctamente el registro',
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });
        }
        $(function() {
            $('select').select2();
            $(".deleteSedeExamen").click(function (){
                const text = $(this).attr('text');
                const idr = $(this).attr('idr');
                let question = `Al eliminar el registro no podra volver a recuperar los datos. <br>¿Está seguro de eliminar <span class="label label-info">${text}</span>?`;
                Confirm.ajax({
                    "model": "MatriculaSedeExamen",
                    'id': idr,
                    "permission": "",
                    "app_label": "inno"
                }, function () {
                    Confirm.question(question, function () {
                        bloqueointerface();
                        var aData = {"action": "deletesedeexamen", 'id': idr}
                        $.ajax({
                            type: "POST",
                            url: "/inscripciones",
                            data: aData,
                            success: function (data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();

                                    Swal.fire({
                                        title: `NOTIFICACIÓN`,
                                        text: data.mensaje,
                                        type: 'success',
                                        icon: 'success',
                                        showCancelButton: false,
                                        allowOutsideClick: false,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: 'Aceptar',
                                        cancelButtonText: 'Cancelar'
                                    }).then((result) => {
                                        if (result.value) {
                                            location.reload();
                                        }
                                    }).catch(error => {
                                        NotificationJG.error(error);
                                        $.unblockUI();
                                    });
                                } else {
                                    NotificationJG.error(data.mensaje);
                                    $.unblockUI();
                                }

                            },
                            error: function () {
                                $.unblockUI();
                                NotificationJG.error("Error al enviar los datos.");
                            },
                            dataType: "json",
                        });
                    }, function () {
                        NotificationJG.info("Enhorabuena el registro esta salvado.!");
                        var h = $(window).height() - 350;
                        $('#modalConfirmAjax').modal({
                            backdrop: 'static',
                            keyboard: false,
                            width: "60%",
                            height: h
                        }).modal('show');
                    });

                }, function () {
                    NotificationJG.info("Enhorabuena el registro esta salvado.!");
                    $.unblockUI();
                });
            });

            $(".actionHorarioExamen").click(function (){
                const id = $(this).attr('idm');
                const visiblehorarioexamen = $(this).attr('visiblehorarioexamen');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: {
                        "action": "actionHorarioExamen",
                        "visiblehorarioexamen": visiblehorarioexamen,
                        'id': id,
                    },
                    success: function (data) {
                        if (data.result == 'ok') {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: data.mensaje,
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        } else {
                            NotificationJG.error(data.mensaje);
                            $.unblockUI();
                        }

                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });


            });

            $(".actionResetExamen").click(function (){
                const id = $(this).attr('idm');
                let question = `Al restablecer el proceso no podra volver a recuperar los datos. <br>¿Está seguro de restablecer</span>?`;
                Confirm.question(question, function () {
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: `{{ request.path }}`,
                        data: {
                            "action": "actionResetExamen",
                            'id': id,
                        },
                        success: function (data) {
                            if (data.result == 'ok') {
                                $.unblockUI();

                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: data.mensaje,
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        location.reload();
                                    }
                                }).catch(error => {
                                    NotificationJG.error(error);
                                    $.unblockUI();
                                });
                            } else {
                                NotificationJG.error(data.mensaje);
                                $.unblockUI();
                            }

                        },
                        error: function () {
                            $.unblockUI();
                            NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json",
                    });
                }, function () {
                    NotificationJG.info("Enhorabuena el registro esta salvado.!");
                    $("#modalArchivosExamen").modal('hide');
                });




            });

            $("#addsede").click(function (){
                $('#action').val('addsedeexamen')
                $("#modalAddSede").modal({backdrop: 'static'}).modal('show').on('hidden.bs.modal', function (e) {
                $('#id_sede option[value=""]').prop('selected', true);
                $('#id_detallemodeloevaluativo option[value=""]').prop('selected', true);
                });
            });
            $(".editar_sede").click(function (){
                let element = $(this)
                $('#action').val('editsedeexamen')
                $("#id_sede").val(element.attr('sede'));
                $("#id_plan").val(element.attr('idplan'));
                $("#id_detallemodeloevaluativo").val(element.attr('detalle'));
                $("#modalAddSede").modal({backdrop: 'static'}).modal('show');
            });
            $(".actionOpenArchivoExamen").click(function (){
                $("#modalArchivosExamen").modal({backdrop: 'static'}).modal('show');
            });

            $(".actionClose", $("#modalArchivosExamen")).click(function () {
                $("#modalArchivosExamen").modal('hide');
            });

            $(".movesede").click(function (){
                let element = $(this)
                let sede = element.attr('sedeid');
                let modelo = element.attr('modelo');
                let modelotext = element.attr('modelotext');
                let matriculasede = element.attr('idr');
                $('#detmodelo').empty().append(new Option(modelotext, modelo, true, true)).trigger('change');
                $('#matriculasedeid').val(matriculasede);
                $('#sedesmoveselect').empty().append(new Option('------------------------', 0, true, true)).trigger('change');
                {% for s in  sedes %}
                    $('#sedesmoveselect').append(new Option('{{ s.0 }}', {{ s.1 }}, true, false)).trigger('change');
                {% endfor %}

                $("#modalMoveSede").modal({backdrop: 'static'}).modal('show').on('hidden.bs.modal', function (e) {
                });
            });
            $("#sedesmoveselect").change(function (){
                let element = $(this)
                if (element.val() === 0 || element.val() === '0'){
                    $('#sedesmovedate').empty();
                    $('.sedesmoveturn').empty();
                    $('.sedesmovecourse').empty();
                    return false
                }
                bloqueointerface();
                let sede = element.val();
                var aData = {"action": 'loaddatesede', 'sede': sede}
                $.ajax({
                    type: "GET",
                    url: "/inscripciones",
                    data: aData,
                    success: function (data) {
                        if (data.result === 'ok') {
                            $.unblockUI();
                            {%  for mat in matricula.materias %}
                                $('#sedesmovedate_{{ mat.id }}').empty().append(new Option('------------------------', 0, true, true)).trigger('change');
                                $.each(data.fechas, function (index, value){
                                    $('#sedesmovedate_{{ mat.id }}').append(new Option(value[1], value[0], true, false)).trigger('change');
                                })
                                $('#sedesmovedate_{{ mat.id }}').prop('disabled', false);
                                $('#sedesmoveturn_{{ mat.id }}').empty().trigger('change');
                                $('#sedesmovecourse_{{ mat.id }}').empty().trigger('change');
                            {% endfor %}
                        } else {
                            NotificationJG.error(data.mensaje);
                            $.unblockUI();
                        }

                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            });
            $(".sedesmovedate").change(function (){
                let element = $(this)
                 let matid = element.attr('idmat');
                if (element.val() === 0 || element.val() === '0' || element.length === 0 || element.val() === null){
                    $('#sedesmoveturn_'+matid).empty().trigger('change');
                    $('#sedesmovecourse_'+matid).empty().trigger('change');
                    return false
                }
                bloqueointerface();
                let date = element.val();
                var aData = {"action": 'loadturnsede', 'fecha': date, 'turnosselect': JSON.stringify(turnos_ids)}
                $.ajax({
                    type: "GET",
                    url: "/inscripciones",
                    data: aData,
                    success: function (data) {
                        if (data.result === 'ok') {
                            $.unblockUI();
                            $('#sedesmoveturn_'+matid).empty().append(new Option('------------------------', 0, true, true)).trigger('change');
                            $.each(data.turnos, function (index, value){
                                $('#sedesmoveturn_'+matid).append(new Option(value[1] + ' - ' +value[2], value[0], true, false)).trigger('change');
                            });
                            $('#sedesmovecourse_'+matid).empty().trigger('change');
                        } else {
                            NotificationJG.error(data.mensaje);
                            $.unblockUI();
                        }

                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            });
            $(".sedesmoveturn").change(function (){
                let element = $(this)
                let turn = element.val();
                let matid = element.attr('idmat');
                if (turn === 0 || turn === '0' || element.length === 0 || turn === null) {
                    $('#sedesmovecourse_'+matid).empty().trigger('change');
                    return false;
                }
                bloqueointerface();
                let eSede = $('#sedesmoveselect').val()
                console.log(eSede);
                if (parseInt(eSede) !== 11){
                    if ($.inArray(turn, turnos_ids) !== -1){
                        $.unblockUI();
                        NotificationJG.error('El turno ya fue seleccionado en otra materia');
                        $('#sedesmoveturn_'+matid).val(null).trigger('change');
                        turnos_ids = []
                        $('.sedesmoveturn').each(function() {
                        var selectedOption = $(this).val();
                        if (selectedOption!== null){
                            turnos_ids.push(selectedOption);
                        }
                    });
                         $('#sedesmovedate_'+matid).trigger('change');
                        return false;
                    }
                }
                var aData = {"action": 'loadcoursesede', 'turno': turn}
                $.ajax({
                    type: "GET",
                    url: "/inscripciones",
                    data: aData,
                    success: function (data) {
                        if (data.result === 'ok') {
                            $.unblockUI();
                            $('#sedesmovecourse_'+matid).empty().append(new Option('------------------------', 0, true, true)).trigger('change');
                            $.each(data.aulas, function (index, value){
                                console.log(parseInt(value[2]) > 0);
                                let opcion = new Option(value[1], value[0], parseInt(value[2]) > 0, false);
                                opcion.disabled = parseInt(value[2]) <= 0;
                                $('#sedesmovecourse_'+matid).append(opcion).trigger('change');
                            })
                        } else {
                            NotificationJG.error(data.mensaje);
                            $.unblockUI();
                        }

                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
                turnos_ids = []
                $('.sedesmoveturn').each(function() {
                    var selectedOption = $(this).val();
                    if (selectedOption!== null){
                        turnos_ids.push(selectedOption);
                    }
                });
                console.log(turnos_ids);
            });
            $(".saveaula").click(function (){
                let element = $(this)
                let aulaid = element.val()
                let matid = element.attr('idmat');
                let fecha =  $('#sedesmovedate_'+matid).val();
                let turno = $("#sedesmoveturn_"+matid).val();
                let aula = $('#sedesmovecourse_'+matid).val();
                if (fecha === 0 || fecha === '0' || fecha == null || turno === 0 || turno === '0' || turno == null || aula === 0 || aula === '0' || aula == null){
                    NotificationJG.error('Complete los campos de fecha, hora y aula para la materia seleccionada!');
                    return false;
                }
                var aData = {"action": 'savemoveaula', 'aula': aula, 'matid': matid, 'modelo': $('#detmodelo').val()}
                Swal.fire({
                    title: "¿Está seguro?",
                    text: "Está por guardar esta asignatura en una nueva fecha/hora/aula, Una vez guardado no prodrá modificarlo",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Si, estoy seguro!"
                }).then((result) => {
                    if (result.value) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/inscripciones",
                            data: aData,
                            success: function (data) {
                                $.unblockUI();
                                if (data.result === 'ok') {
                                   $('#sedesmovedate_' + matid).prop('disabled', true);
                                   $("#sedesmoveturn_" + matid).prop('disabled', true);
                                   $('#sedesmovecourse_'+matid).prop('disabled', true);
                                   $('#saveaula_'+matid).addClass("deshabilitado");
                                   $('#clear_'+matid).addClass("deshabilitado");
                                   $('#sedesmoveselect'+matid).prop('disabled', true);
                                   $('#chek_'+ matid).html('<i class="fa fa-check text-success"></i>')
                                   NotificationJG.success('Asignatura actualizada');
                                   materias_terminadas.push(matid);
                                   $('#sedesmoveselect').prop('disabled', true);
                                   $('#modalMoveSede').modal({backdrop: 'static', keyboard: false})
                                } else {
                                    NotificationJG.error(data.mensaje);
                                }

                            },
                            error: function () {
                                $.unblockUI();
                                NotificationJG.error("Error al enviar los datos.");
                            },
                            dataType: "json",
                        });
                    }
                    else {
                        NotificationJG.info("Acción anulada");
                    }
                });
            });
            $(".clear").click(function (){
                let element = $(this)
                let matid = element.attr('idmat');
                $('#sedesmovecourse_'+matid).empty().trigger('change');
                $('#sedesmoveturn_'+matid).empty().trigger('change');
                $('#sedesmovedate_'+matid).val(0).trigger('change');
            });
            $("#save").click(function (){
                bloqueointerface();
                let sede = $("#id_sede").val();
                let action = $("#action").val();
                let modelo = $("#id_detallemodeloevaluativo").val();
                let matsede =  $("#id_plan").val();
                var aData = {"action": action, 'sede_id': sede, 'modelo':modelo, 'id': {{ matricula.id }}, 'matsede': matsede}
                $.ajax({
                    type: "POST",
                    url: "/inscripciones",
                    data: aData,
                    success: function (data) {
                        if (data.result === 'ok') {
                            $.unblockUI();
                            $("#modalAddSede").modal('hide');
                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: data.mensaje,
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        } else {
                            NotificationJG.error(data.mensaje);
                            $.unblockUI();
                        }

                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            });

            $('.closemodalmove').on('click', function (event) {
                let elemento = $(this)
                if (materias_terminadas.length <=0) {
                    $('#modalMoveSede').modal('hide');
                } else {
                    elemento.addClass("deshabilitado");
                    NotificationJG.error('Ya no puede cancelar ya que tiene materias modificadas, solo puede guardar los cambios');
                }
            });
            $('#savemove').on('click', function (event) {
                let matriculasede = $('#matriculasedeid').val()
                let sede_id = $('#sedesmoveselect').val()
                let modelo_id = $('#detmodelo').val()
                let mensaje = 'Está a punto de guardar los cambios'
                if (materias_terminadas.length === 0) {
                    NotificationJG.error('Debe mover al menos una materia')
                    return false;
                }
                if (materias_terminadas.length < {{ matricula.materias.count }}) {
                    mensaje = "¡Aún tiene materias sin mover!, ¿Desea guardar sin completar las materias?"
                }
                Swal.fire({
                        title: "¿Está seguro?",
                        text: mensaje,
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonText: "Si, estoy seguro!"
                    }).then((result) => {
                        if (result.value){
                            saveall(sede_id, modelo_id, matriculasede)
                        }
                        });
            });

        });

        function saveall(sede_id, modelo_id, matsede){
            bloqueointerface();
            var aData = {
                "action": 'editsedeexamen',
                'sede_id': sede_id,
                'modelo': modelo_id,
                'id': {{ matricula.id }},
                'matsede': matsede
            }
            $.ajax({
                type: "POST",
                url: "/inscripciones",
                data: aData,
                success: function (data) {
                    if (data.result === 'ok') {
                        $.unblockUI();
                        NotificationJG.success('Cambio de sede guardado correctamente');
                        $('#modalMoveSede').modal('hide');
                        window.location.reload();
                    } else {
                        NotificationJG.error(data.mensaje);
                        $.unblockUI();
                    }

                },
                error: function () {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });
        }
    </script>
    <style>
        .deshabilitado {
            background-color: gray!important; /* Cambia el color del texto a gris */
            border-color: gray!important; /* Cambia el color del texto a gris */
            pointer-events: none; /* Deshabilita la interacción del enlace */
            text-decoration: none; /* Elimina la subrayado del enlace */
        }
    </style>
{% endblock %}
{% block atras %}/inscripciones?id={{ inscripcion.id }}{% endblock %}
{% block canvas %}
     <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title }}</h3>
                <h6>Administración de sedes y exámenes</h6>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-3 col-md-12">
            <div class="card mb-4">
                <div class="card-body border-6 rounded-3">
                    <div class="text-center">
                        {% if inscripcion.persona.foto.foto %}
                        <img style="border: 1px solid #ddd;padding: 4px; height: 150px"
                             class="profile-user-img img-fluid rounded-circle"
                             src="https://sga.unemi.edu.ec{{ inscripcion.persona.foto.foto.url }}" alt="User profile picture">
                        {% else %}
                        {% if inscripcion.persona.sexo_id == 1 %}
                        <img class="profile-user-img img-fluid img-circle"
                             src="/static/images/iconos/mujer.png" alt="User profile picture">
                        {% else %}
                        <img class="profile-user-img img-fluid img-circle"
                             src="/static/images/iconos/hombre.png" alt="User profile picture">
                        {% endif %}
                        {% endif %}
                    </div>
                    <div class="text-center">
                    </div>
                    <h4 class="profile-username text-center">{{ inscripcion.persona.nombre_completo_minus }}</h4>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <b>Cédula</b>
                            <p class="float-right">{{ inscripcion.persona.cedula }}</p>
                        </li>
                        <li class="list-group-item">
                            <b>Carrera</b>
                            <p class="float-right">{{ inscripcion.carrera.nombre }}</p>
                        </li>
                        <li class="list-group-item">
                            <b>Malla</b>
                            <p class="float-right">{{ inscripcion.malla_inscripcion.malla }}</p>
                        </li>
                        <li class="list-group-item">
                            {% if inscripcion.itinerario %}
                                <h4 class="text--warning">Itinerario {{ inscripcion.itinerario }}</h4>
                            {% else %}
                                <h4 class="text-info"><b>Sin itinerario en la inscripción</b></h4>
                            {% endif %}
                        </li>


                    </ul>
                </div>
            </div>
        </div>
        <div class="col-lg-9 col-md-12">
            <div class="row">
                <div class="col-lg-12 pb-2" style="display: flex; justify-content: flex-end;">
                    <div class="btn-group" role="group">
                        <div class="row">
                            <div class="col p-0" role="group">
                                <button id="btnGroupDrop2" type="button" class="btn btn-default w-100 dropdown-toggle"
                                        data-bs-toggle="dropdown" aria-expanded="false"><i class="fa fa-cog"></i>
                                    Acciones <i class="fa fa-angle-down" aria-hidden="true"></i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop2" style="">
                                    <li><a href="javascript:;" id="addsede"
                                           class="dropdown-item"><i
                                            class="fa fa-plus dropdown-item-icon" aria-hidden="true"></i>Adicionar registro</a>
                                    </li>
                                    <li><a href="javascript:;"
                                           class="dropdown-item actionHorarioExamen" visiblehorarioexamen="mostrar" idm="{{ matricula.id }}"><i
                                            class="fa fa-check dropdown-item-icon" aria-hidden="true"></i>Mostrar horario de examen</a>
                                    </li>
                                    <li><a href="javascript:;"
                                           class="dropdown-item actionHorarioExamen" visiblehorarioexamen="ocultar" idm="{{ matricula.id }}"><i
                                            class="fa fa-times dropdown-item-icon" aria-hidden="true"></i>Ocultar horario de examen</a>
                                    </li>
                                    <li><a href="javascript:;"
                                           class="dropdown-item actionOpenArchivoExamen"><i
                                            class="fa fa-file dropdown-item-icon" aria-hidden="true"></i>Ver archivos</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card mb-4">
                <div class="card-body border-6 rounded-3">
                     <table class='table table-striped table_primary'>
                <thead>
                <tr>
                    <th style="vertical-align: middle; text-align: center; width: 10%">Examen</th>
                    <th style="vertical-align: middle; text-align: center; width: 10%">Sede</th>
                    <th style="vertical-align: middle; text-align: center; width: 75%">Horario</th>
                    <th style="vertical-align: middle; text-align: center; width: 5%"><i class="fa fa-cogs"></i></th>
                </tr>
                </thead>
                <tbody>
                {%  for eMatriculaSedeExamen in eMatriculaSedeExamenes %}
                    <tr>
                        <td style="vertical-align: middle; text-align: center;">{{ eMatriculaSedeExamen.detallemodeloevaluativo.nombre }}<br>
                        {{ eMatriculaSedeExamen.detallemodeloevaluativo.alternativa }}</td>
                        <td style="vertical-align: middle; text-align: center; width: 20%">{{ eMatriculaSedeExamen.sede.nombre }}</td>
                        <td style="vertical-align: middle; text-align: center; width: 50%">
                            <table class='table table-bordered' >
                                <thead>
                                <tr>
                                    <th style="vertical-align: middle; text-align: center; width: 35%">Asignatura</th>
                                    <th style="vertical-align: middle; text-align: center; width: 10%">Fecha</th>
                                    <th style="vertical-align: middle; text-align: center; width: 15%">Hora inicio/fin</th>
                                    <th style="vertical-align: middle; text-align: center; width: 15%">Aula</th>
                                    <th style="vertical-align: middle; text-align: center; width: 5%"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {%  for mate in matricula.materias %}
                                    {% with planficacionvirtualexamen=mate|args:eMatriculaSedeExamen.detallemodeloevaluativo_id|call:'planficacionvirtualexamen'%}
                                        <tr>
                                            <td style="vertical-align: middle; text-align: left;">
                                                {{ mate.materia.asignatura.nombre }}</td>
                                            <td style="vertical-align: middle; text-align: center;">
                                                {% if planficacionvirtualexamen %}
                                                    {% for pla in planficacionvirtualexamen %}
                                                        {% if pla.aulaplanificacion.turnoplanificacion %}
                                                            {{ pla.aulaplanificacion.turnoplanificacion.fechaplanificacion.fecha|date:"d-m-Y" }}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </td>
                                            <td style="vertical-align: middle; text-align: center;">
                                                {% if planficacionvirtualexamen %}
                                                    {% for pla in planficacionvirtualexamen %}
                                                        {{ pla.aulaplanificacion.turnoplanificacion.horainicio }} / {{ pla.aulaplanificacion.turnoplanificacion.horafin }}
                                                    {% endfor %}
                                                {% endif %}
                                            </td>

                                            <td style="vertical-align: middle; text-align: center;">
                                                {% if planficacionvirtualexamen %}
                                                    {% for pla in planficacionvirtualexamen %}
                                                        {% if pla.aulaplanificacion.aula %}
                                                            {{ pla.aulaplanificacion.aula }}
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </td>
                                            <td style="vertical-align: middle; text-align: center;">
                                                {% if perms.inno.puede_eliminar_materiaasignadaplanificacion_examenvirtual %}
                                                    {% if planficacionvirtualexamen %}
                                                        {% for pla in planficacionvirtualexamen %}
                                                            <button class="btn btn-mini btn-danger" onclick="actionDeletePlanificacion({{ pla.id }}, '{{ mate.matricula.inscripcion.persona }}', '{{ mate.materia.asignatura.nombre }}')"><i class="fa fa-trash"></i></button>
                                                        {% endfor %}
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                        </tr>
                                     {% endwith %}
                                {% endfor %}
                                </tbody>
                            </table>
                        </td>
{#                        <td style="vertical-align: middle; text-align: center; width: 10%">#}
{#                            {% if eMatriculaSedeExamen.puede_editar %}#}
{#                                <a href="/inscripciones?action=editsedeexamen&id={{ eMatriculaSedeExamen.id }}&ret={{ ret }}" class="btn btn-warning"><span class="fa fa-edit "></span></a>#}
{#                            {% endif %}#}
{#                            {% if eMatriculaSedeExamen.puede_eliminar %}#}
{#                                <a href="javascript:;" class="btn btn-danger deleteSedeExamen" idr="{{ eMatriculaSedeExamen.id }}" text="{{ eMatriculaSedeExamen }}"><span class="fa fa-eraser"></span></a>#}
{#                            {% endif %}#}
{#                        </td>#}
                        <td data-title="Acciones" class="text-center align-middle w-3">
                            <div class="dropbottom">
                                <button class="btn-icon btn btn-ghost btn-sm rounded-circle dropdown-toggle"
                                        type="button" data-bs-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                </button>
                                <ul class="dropdown-menu" x-placement="right-start" style="">
                                    <li><a class="dropdown-item editar_sede"
                                           href="javascript:;" idplan="{{ eMatriculaSedeExamen.id }}" detalle="{{ eMatriculaSedeExamen.detallemodeloevaluativo_id }}" sede="{{ eMatriculaSedeExamen.sede_id }}"><i
                                            class="fa fa-edit dropdown-item-icon"
                                            aria-hidden="true"></i> Editar </a></li>
                                    <li>
                                        <a href="javascript:void(0);"
                                           class="dropdown-item deleteSedeExamen" idr="{{ eMatriculaSedeExamen.id }}"
                                           text="{{ eMatriculaSedeExamen }}"><i class="fa fa-trash dropdown-item-icon"
                                                aria-hidden="true"></i> Eliminar</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" sedeid="{{ eMatriculaSedeExamen.sede_id }}"
                                           modelotext="{{  eMatriculaSedeExamen.detallemodeloevaluativo }}"
                                           modelo="{{ eMatriculaSedeExamen.detallemodeloevaluativo_id }}"
                                           class="dropdown-item movesede" idr="{{ eMatriculaSedeExamen.id }}"
                                           text="{{ eMatriculaSedeExamen }}"><i
                                                    class="fa fa-refresh dropdown-item-icon"
                                                    aria-hidden="true"></i> Mover de sede</a>
                                    </li>
                                </ul>
                            </div>

                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" style="text-align: center; vertical-align: middle">NO EXISTEN REGISTRO EN BASE</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" tabindex="-1" style="display: none;" id="modalArchivosExamen">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Archivos del proceso</h5>
                </div>
                <div class="modal-body">
                        <table class="table table-striped table_primary">
                            <thead>
                            <tr>
                                <th>Documento</th>
                                <th style="text-align: center">Archivo</th>
                            </tr>
                            </thead>
                            <tbody>
                            {%  for eMatriculaSedeExamen in eMatriculaSedeExamenes %}
                                <!--<tr>
                                    <td colspan="3" scope="row">{{ eMatriculaSedeExamen.detallemodeloevaluativo.nombre }}</td>
                                </tr>-->
                                <tr>
                                    <th scope="row">Documento de identidad</th>
                                    <td style="text-align: center">
                                        {% if eMatriculaSedeExamen.archivoidentidad %}
                                            <a class="btn btn-primary"  href="{{ eMatriculaSedeExamen.archivoidentidad.url }}" target="_blank"> <i class="fa fa-download"></i> Documento</a>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td scope="row">Foto de perfil</td>
                                    <td style="text-align: center">
                                        {% if eMatriculaSedeExamen.archivofoto %}
                                            <a class="fancybox" rel="group" href="{{ eMatriculaSedeExamen.archivofoto.url }}" title="Imagen">
                                                <!--<img src="{{ eMatriculaSedeExamen.archivofoto.url }}" onerror="this.onerror=null;this.src='/static/images/image.png'" width="60px" height="60px">-->
                                                Ver imagen
                                            </a>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">
                                        Documento de terminos y condiciones
                                        {% if eMatriculaSedeExamen.aceptotermino %}
                                            <br>
                                            <span class="text-muted">Acepto el {{ eMatriculaSedeExamen.fechaaceptotermino|date:"d-m-Y H:i"|default_if_none:"" }}</span>
                                        {% endif %}
                                    </th>
                                    <td style="text-align: center">
                                        {% if eMatriculaSedeExamen.urltermino %}
                                            <a class="btn btn-primary"  href="{{ eMatriculaSedeExamen.urltermino }}" target="_blank"> <i class="fa fa-download"></i> Acuerdo</a>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr scope="row">
                                    <td colspan="2" style="text-align: right"><button class="btn btn-warning actionResetExamen" idm="{{ eMatriculaSedeExamen.id }}"> <i class="fa fa-eraser"></i> Reiniciar proceso</button> </td>
                                </tr>
                                </tbody>
                            {% endfor %}
                        </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default actionClose" data-bs-dismiss="modal"><i class="fa fa-times"></i> Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" tabindex="-1" style="display: none;" id="modalAddSede">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content" style="border-radius: 17px!important;">
                <div class="modal-header" style="border-bottom: none">
                    <h4 class="paneltitle"><i class="fa fa-outdent"></i> <b>Sede de exámenes</b></h4>
                    <button type="button" class="btn-close btn-cerrar-modal fs-5 cerrar" data-toggle="modal"
                            data-bs-dismiss="modal" aria-label="Close">X
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="action" id="action" value="addsede">
                    <input type="hidden" name="id_plan" id="id_plan" value="0">
                    {{ form.as_p }}
                </div>
                <div class="row modal-footer px-0 border-0 py-3">
                        <div class="col-12 text-end">
                            <button type="button" id="save" class="btn btn-orange fs-5 px-5"><i
                                    class="fa fa-check-circle" aria-hidden="true"></i> Guardar
                            </button>
                            <a href="javascript:void(0)" class="btn btn-cian-secondary fs-5 px-5"
                               data-bs-dismiss="modal"> <i class="fa fa-close" aria-hidden="true"></i> Cancelar</a>
                        </div>
                    </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" tabindex="-1" style="display: none;" id="modalMoveSede">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
            <div class="modal-content" style="border-radius: 17px!important;">
                <div class="modal-header" style="border-bottom: none">
                    <h4 class="paneltitle"><i class="fa fa-refresh"></i> <b>Mover de sede</b></h4>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <input type="hidden" id="matriculasedeid">
                                <label for="detmodelo">Modelo</label>
                                <select name="detmodelo" id="detmodelo" style="width: 100%" readonly="readonly" disabled="disabled">
                                </select>
                            </div>
                            <div class="col-sm-6">
                                <label for="sedesmoveselect">Seleccione una sede</label>
                                <select name="sedesmoveselect" id="sedesmoveselect"  style="width: 100%"></select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <table class='table table-striped table_primary' >
                                <thead>
                                <tr>
                                    <th style="vertical-align: middle; text-align: center; width: 30%">Asignatura</th>
                                    <th style="vertical-align: middle; text-align: center; width: 10%">Fecha</th>
                                    <th style="vertical-align: middle; text-align: center; width: 15%">Hora inicio/fin</th>
                                    <th style="vertical-align: middle; text-align: center; width: 15%">Aula</th>
                                    <th style="vertical-align: middle; text-align: center; width: 10%"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {%  for mate in matricula.materias %}
                                    <tr>
                                            <td style="vertical-align: middle; text-align: left;">
                                                {{ mate.materia.asignatura.nombre }} <b id="chek_{{ mate.id }}"></b></td>
                                            <td style="vertical-align: middle; text-align: center;">
                                                <select name="sedesmovedate_{{ mate.id }}" id="sedesmovedate_{{ mate.id }}" idmat="{{ mate.id }}"  class="sedesmovedate" style="width: 100%;" disabled></select>
                                            </td>
                                            <td style="vertical-align: middle; text-align: center;">
                                               <select name="sedesmoveturn_{{ mate.id }}" id="sedesmoveturn_{{ mate.id }}" idmat="{{ mate.id }}"  class="sedesmoveturn"   style="width: 100%"></select></td>
                                            <td style="vertical-align: middle; text-align: center;">
                                                <select name="sedesmovecourse_{{ mate.id }}" id="sedesmovecourse_{{ mate.id }}"  idmat="{{ mate.id }}"  class="sedesmovecourse"  style="width: 100%"></select>
                                            </td>
                                            <td style="vertical-align: middle; text-align: center;">
                                                <a href="javascript:void(0)" style="width: 40px; height: 30px; border-radius: 10px;"
                                                   class="btn btn-warning saveaula" idmat="{{ mate.id }}" id="saveaula_{{ mate.id }}">
                                                    <i class="fa fa-save" aria-hidden="true"></i> </a>
                                                <a href="javascript:void(0)" style="width: 40px; height: 30px; border-radius: 10px;"
                                                   class="btn btn-cian-opacity clear" idmat="{{ mate.id }}" id="clear_{{ mate.id }}">
                                                    <i class="fas fa-broom"></i> </a>

                                            </td>
                                        </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer mb-3">
                    <div class="container-fluid">
                        <div class="col-12 text-end">
                            <button type="button" id="savemove" class="btn btn-orange fs-5 px-5"><i
                                    class="fa fa-check-circle" aria-hidden="true"></i> Guardar
                            </button>
                            <a href="javascript:void(0)" class="btn btn-cian-secondary fs-5 px-5 closemodalmove">
                                <i class="fa fa-close" aria-hidden="true"></i> Cancelar</a>
                        </div>
                    </div>
                    </div>
            </div>
        </div>
    </div>
{% endblock %}

{% extends "basebs.html" %}
{% load staticfiles %}
{% load sga_extras %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <script src="/static/js/moment/moment.min.js" type="text/javascript"></script>
    <script src="/static/js/moment/moment-with-locales.min.js" type="text/javascript"></script>
    <script src="/static/js/moment/moment-timezone.min.js" type="text/javascript"></script>
    <link href='/static/boxicons-2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <style>
        .modal-header {
            padding: 9px 15px;
            border-bottom: 1px solid #ddd;
            background-color: #eaf5e2;
            color: #3f572c;
            border-radius: 6px 6px 0 0;
        }
        .btn-flotante {
            font-size: 16px; /* Cambiar el tamaño de la tipografia */
            text-transform: uppercase; /* Texto en mayusculas */
            font-weight: bold; /* Fuente en negrita o bold */
            color: #ffffff; /* Color del texto */
            border-radius: 15px; /* Borde del boton */
            letter-spacing: 2px; /* Espacio entre letras */
            background-color: #51a351; /* Color de fondo */
            padding: 18px 30px; /* Relleno del boton */
            position: fixed;
            bottom: 52px;
            right: 10px;
            transition: all 300ms ease 0ms;
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
            z-index: 99;
        }
        .btn-flotante:hover {
            /*background-color: #2c2fa5;*/
            box-shadow: 0px 15px 20px rgba(0, 0, 0, 0.3);
            color: #ffffff;
            transform: translateY(-10px);
        }
        @media only screen and (max-width: 600px) {
            .btn-flotante {
                font-size: 14px;
                padding: 12px 20px;
                bottom: 52px;
                right: 10px;
            }
        }

        .thumbnail {
            /*max-height: 350px !important;
            min-height: 150px !important;*/
            height: 100% !important;
            width: 100%;
            text-align: center;
            padding: 15px;
            border-radius: 15px !important;
        }

        .thumbnail:hover{
            box-shadow: 0px 15px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(-10px);
            cursor: pointer;
        }

        .thumbnail > .thumbnail-subject {
            font-size: 13px;
            font-weight: bold;
            height: 4rem;
            text-align: center;
            overflow: hidden;
            display: block;
            text-overflow: ellipsis;
            width: 100%;
        }
        .thumbnail > .thumbnail-level {
            font-size: 12px;
            /*font-family: "Droid Serif", "DejaVu Serif", "STIX", serif;*/
            font-weight: bold;
        }

        .thumbnail > .thumbnail-eje {
            font-size: 11px;
            /*font-family: "Droid Serif", "DejaVu Serif", "STIX", serif;*/
        }

        .thumbnail > table {
            height: 50px;
            margin-top: 20px;
        }

        .thumbnail > .thumbnail-actions {
            height: 50px;
        }

        @media only screen and (max-width: 600px) {
            .thumbnail {
                /*max-height: 300px !important;
                min-height: 150px !important;*/
                height: 100% !important;
                text-align: center;
                padding: 15px;
                border-radius: 15px !important;
            }
        }

        .search {
            max-width: 300px;
            margin: 0 auto;
            position: relative;
            float: right;
            /*padding-top: 10px;*/
        }
        .search input {
            width: 300px;
            padding: 10px;
            border: 1px solid #cecece;
            border-radius: 3px;
        }
        .search i {
            position: absolute;
            cursor: pointer;
            right: 10px;
            top: 15px;
        }

        /* Customize the label (the container) */
        .cb_container {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 22px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Hide the browser's default checkbox */
        .cb_container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* Create a custom checkbox */
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 25px;
            width: 25px;
            /*background-color: #7FDBFF;*/
            border: 1px solid #1a252f !important;
        }

        /* On mouse-over, add a grey background color */
        .cb_container:hover input ~ .checkmark {
            background-color: #aaa;

        }

        /* When the checkbox is checked, add a blue background */
        .cb_container input:checked ~ .checkmark {
            background-color: #2196F3;
        }

        /* Create the checkmark/indicator (hidden when not checked) */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the checkmark when checked */
        .cb_container input:checked ~ .checkmark:after {
            display: block;
        }

        /* Style the checkmark/indicator */
        .cb_container .checkmark:after {
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }

    </style>
    <script>

        $(function (){
            $('.predecesores').popover({
                placement : 'left',
                html : true,
                trigger : 'hover', //<--- you need a trigger other than manual
                delay: {
                    show: "500",
                    hide: "100"
                }
            });

            $('.predecesores').on('shown.bs.popover', function() {
                setTimeout(function() {
                    $('.predecesores').popover('hide');
                }, 1000);
            });


        });


    </script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h3>{{ title }}</h3>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div class='span8'>
                <div class="media">
                    <a class="pull-left hidden-phone" href="javascript:;">
                        {% if persona.foto %}
                            <img src="{{ persona.foto.foto.url }}" onerror="this.onerror=null;this.src='/static/images/image.png'" class="media-object img-circle" width="140" height="140">
                        {% else %}
                            <img src="/static/images/iconos/{% if persona.sexo.id == 2 %}hombre.png{% else %}mujer.png{% endif %}" onerror="this.onerror=null;this.src='/static/images/image.png'" class="media-object img-circle" width="140" height="140">
                        {% endif %}
                    </a>
                    <div class="media-body" style="color: #1C3247  !important; padding-left: 20px;">
                        <h3 class="media-heading">{{ persona }} ({{ inscripcion.id }})</h3>
                        <p><b><i class="fa fa-envelope"></i> Email Inst.:</b> {{ persona.emailinst }} &nbsp;&nbsp; <b><i class="fa fa-envelope"></i> Email:</b> {{ persona.email }} &nbsp;&nbsp; <b><i class="fa fa-phone"></i> Telf.:</b> {{ persona.telefono }}</p>
                        <p><b><i class="fa fa-map-marker"></i> Ciudad:</b> {{ persona.canton.nombre }} &nbsp;&nbsp; <b><i class="fa fa-map-marker"></i> Dirección:</b> {{ persona.direccion_corta }}</p>
                        <p><b><i class="fa fa-graduation-cap"></i> Carrera:</b> {{ inscripcion.carrera }} &nbsp;&nbsp; <b><i class="fa fa-cubes"></i> Malla:</b> {{ inscripcionmalla.malla }}</p>
                        <p><b><i class="fa fa-calendar-o"></i> Periodo:</b> {{ periodomatricula.periodo }} &nbsp; <b><i class="fa fa-check-circle"></i> Nivel malla:</b> {{ minivel.nombre }} (Actual)</p>
                        <p><b><i class="fa fa-group"></i> Grupo Socioeconómico:</b> <span class="label label-info smaller">{{ fichasocioeconomicainec }}</span> &nbsp; <span v-show="itinerario>0"><b><i class="fa fa-gear"></i> Itinerario:</b> <label class="label label-info smaller">ITINERARIO ${itinerario}</label></span></p>
                    </div>
                </div>
                {% if va_ultima_matricula %}
                    <div class="alert alert-danger">
                        <h4 class="alert-heading">AVISO</h4>
                        Sólo puede seleccionar materias en las que se va a matricular por {% if va_ultima_matricula == 3 %}Tercera{% elif va_ultima_matricula == 4 %}Cuarta{% elif va_ultima_matricula == 5 %}Quinta{% else %}{{ va_ultima_matricula }}{% endif %} vez.
                    </div>
                {% endif %}
            </div>

            <div class='span4' style="text-align: right">
                <!--<a href="javascript:;" nhref="/alu_addmatematri?action=calcular&id={{ matricula.id }}" class='btn btn-success btn-large confirmacionmodal'><span class="fa fa-money" ></span> RECALCULAR</a>-->
                <a class="btn btn-danger btn-large" style="width: 100% !important;" v-if="puede_quitar && matricula && !matricula.tiene_token" v-on:click="deleteMatricula()"><i class="fa fa-trash"></i> ELIMINAR MATRICULA </a>
                <a class="btn btn-large btn-warning" v-if="puede_quitar && matricula && matricula.tiene_token" v-on:click="openConfirmarEliminarMatricula()"><i class='fa fa-clock-o'></i> INGRESAR CÓDIGO DE CONFIRMACIÓN</a>
                <a class="btn btn-large btn-success" v-if="puede_quitar && matricula && matricula.puede_reenviar_token" v-on:click="reenviarDeleteMatricula()"><i class='fa fa-send-o'></i> REENVIAR (${matricula.contador_reenviar_email_token}/6)</a>
                <div v-if="valida_materias_maxima && materiasasignadas.length >= num_materias_maxima" style="margin-top: 5px">
                    <div class="alert alert-error" style="text-align: left !important;">
                        <p>{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, ha llegado al máximo de materias seleccionadas por matrícula.</p>
                    </div>
                </div>
                <div v-if="matricula && matricula.valor_pagados > 0" style="margin-top: 5px">
                    <div class="alert alert-success" style="text-align: center !important;">
                        <h4>Tiene rubros pagados: $ ${matricula.valor_pagados_str}</h4>
                    </div>
                </div>
                <div v-if="matricula && matricula.valor_pendiente > 0" style="margin-top: 5px">
                    <div class="alert alert-error" style="text-align: center !important;">
                        <h4>Tiene rubros pendientes: $ ${matricula.valor_pendiente_str}</h4>
                    </div>
                </div>
                <div v-if="matricula && (matricula.valor_pendiente > 0 || matricula.valor_pagados > 0)" style="margin-top: 5px">
                    <a href="javascript:;" class='btn btn-warning btn-large' style="width: 100% !important;" v-on:click="viewRubros()"><span class="fa fa-table" ></span> Detalle de los valores generados en la matriculación</a>
                </div>
            </div>
        </div>
    </div>

    <div class='row-fluid'>
        <div class='span12'>
            <div id="no-more-tables" style="">
                <table class='table table-bordered table-striped'>
                    <thead>
                    <tr>
                        <th style="width: 40%; text-align: center; vertical-align: middle;">Asignatura</th>
                        <th style="width: 7%; text-align: center; vertical-align: middle;">Asignada</th>
                        <th style="width: 8%; text-align: center; vertical-align: middle;">Inicio</th>
                        <th style="width: 8%; text-align: center; vertical-align: middle;">Fin</th>
                        <th style="width: 7%; text-align: center; vertical-align: middle;">Cr&eacute;ditos</th>
                        <th style="width: 7%; text-align: center; vertical-align: middle;">Horas</th>
                        <th style="width: 5%; text-align: center; vertical-align: middle;">Nota</th>
                        <th style="width: 7%; text-align: center; vertical-align: middle;">Asistencia</th>
                        <th style="width: 15%; text-align: center; vertical-align: middle;"> </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="ma in materiasasignadas" :key="ma.id">
                        <td style="vertical-align: middle">
                            ${ma.materia.nombre_completo}<br>
                            <label class="label label-warning smaller" v-if="ma.itinerario > 0">ITINERARIO ${ma.itinerario}</label>
                            <span class='label label-warning tu' v-if="ma.retirado" title="Se retiro de la materia">RETIRADO</span>
                            <span class='label label-success' v-if="ma.convalidada || ma.homologada">HOMOLOGADA</span>
                            <span class='label label-inverse smaller error' v-if="ma.materia.nivel_id === nivel_id">${ma.materia.nivelmateria}</span> <br>
                            <span class='label label-inverse' v-if="!ma.existe_en_malla">NO CONSTA EN MALLA</span>
                            <span class='label label-info tu' v-if="ma.valida_pararecord" title="Pasa al record">VALIDA</span>
                            <span class='label label-important tu' v-else title="No pasa al record">NO VALIDA</span>
                            <span class='label label-success' v-if="ma.aprobada">${ma.estado_verbose}</span>
                            <span class='label label-info' v-else >${ma.estado_verbose}</span>
                            <span class='label label-warning tu' v-if="ma.evaluar" title="Autorizado a evaluar">AE</span>
                            <span class='label label-warning tu' v-if="ma.evaluada" title="Realizo evaluacion">EVALU&Oacute;</span>
                            <span class='label label-important tu' v-if="!ma.pertenece_malla" title="Esta materia no pertenece a su malla">FUERA DE MALLA</span>
                            <span class='label label-important' v-if="ma.materia.cerrado">CERRADA ${ma.fechacierre}</span>
                            <span class='label label-info tu' title="Grupo practica" v-if="ma.practica && ma.practica.paralelo">${ma.practica.paralelo}</span>
                            <span class='label label-important tu' v-if="ma.sinasistencia" title="Sin asistencia">SIN ASIST.</span>
                            <label class="label label-warning smaller" v-if="ma.totalrecordasignatura >= 2"> ${ma.totalrecordasignatura + 1} MAT.</label>
                        </td>
                        <td data-title='Fecha Asignación' style="text-align: center; vertical-align: middle">${ma.fechaasignacion}</td>
                        <td data-title='Fecha Inicio' style="text-align: center; vertical-align: middle">${ma.materia.inicio}</td>
                        <td data-title='Fecha Fin' style="text-align: center; vertical-align: middle">${ma.materia.fin}</td>
                        <td data-title='Créditos' style="text-align: center; vertical-align: middle"><span v-if="!ma.convalidada && !ma.homologada">${ma.materia.creditos}</span></td>
                        <td data-title='Horas' style="text-align: center; vertical-align: middle"><span v-if="!ma.convalidada && !ma.homologada">${ma.materia.horas}</span></td>
                        <td data-title='Nota Final' style="text-align: center; vertical-align: middle"><span v-if="!ma.convalidada && !ma.homologada">${ma.notafinal}</span></td>
                        <td data-title='Asistencia Final' style="text-align: center; vertical-align: middle"><span v-if="!ma.convalidada && !ma.homologada">${ma.asistenciafinal}%</span></td>
                        <td style="text-align: center; vertical-align: middle">
                            <div class="thumbnail-actions" v-if="matricula && !matricula.tiene_token">
                                <!--<a class="btn btn-large btn-info" v-if="am.estado === 3 && am.cantidad_predecesoras === 0" v-on:click="openAsignatura(am)">HORARIO</a>-->
                                <a class="btn btn-large btn-danger" v-if="ma.puede_quitar && !ma.tiene_token" v-on:click="removeAsignatura(ma)"><i class='fa fa-remove'></i> REMOVER</a>
                                <a class="btn btn-large btn-warning" v-if="ma.puede_quitar && ma.tiene_token" v-on:click="openConfirmarRemoveAsignatura(ma)"><i class='fa fa-clock-o'></i> INGRESAR CÓDIGO</a>
                                <a class="btn btn-large btn-success" v-if="ma.puede_quitar && ma.puede_reenviar_token" v-on:click="reenviarRemoveAsignatura(ma)"><i class='fa fa-send-o'></i> REENVIAR (${ma.contador_reenviar_email_token}/6)</a>
                            </div>
                            <div v-else-if="matricula && matricula.tiene_token">
                                <label class="label label-warning">Pendiente de eliminar matrícula</label>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot class="hidden-phone">
                    <tr>
                        <td colspan="4"></td>
                        <td style="text-align: center;"><b>${matricula.totalcreditos}</b></td>
                        <td style="text-align: center;"><b>${matricula.totalhoras}</b></td>
                        <td style="text-align: center;"><b>${matricula.promedionotas}</b></td>
                        <td style="text-align: center;"><b>${matricula.promedioasistencias}%</b></td>
                        <td></td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <div class="row-fluid" v-if="puede_agregar">
        <div class='span12'>
            <h3>Materias de malla (pendientes y reprobadas)</h3>
        </div>
    </div>

    <div class='row-fluid' style="border: 1px solid #ddd; background:#FFFFFF !important;  border-radius: 15px !important;">
        <div class="span12">
            <div class="row-fluid" style="">
                <div class="span12" style="background: #f0f0f0 !important; border-radius: 10px 10px 0 0 !important; border-bottom: 1px solid #ddd; padding: 15px 20px;">
                    <h4>Filtrar asignaturas</h4>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span8" style="padding: 15px 20px 15px 20px;">
                    <table style="background:#FFFFFF !important; ">
                        <tr>
                            <td style="width: 15%"><h4>Por estado:</h4></td>
                            <td style="width: 90%">
                                <a href="javascript:;" class="btn actionSearchLevel" value="pendiente" data-toggle="tab">PENDIENTES</a>
                                <a href="javascript:;" class="btn actionSearchLevel" value="reprobada" data-toggle="tab">REPROBADAS</a></td>
                        </tr>
                        <tr>
                            <td style="padding-top: 10px;"><h4>Por nivel:</h4></td>
                            <td style="padding-top: 10px;">
                                {% for nivelmalla in nivelesmalla %}
                                    <a href="javascript:;" class="btn actionSearchLevel" value="{{ nivelmalla.nombre }}" data-toggle="tab">{{ nivelmalla.nombre }}</a>
                                {% endfor %}
                            </td>
                        </tr>
                        {% if tiene_itinerarios %}
                            <tr>
                                <td style="padding-top: 10px;"><h4>Por itinerario:</h4></td>
                                <td style="padding-top: 10px;">
                                    {% for itinerario in lista_itinerarios %}
                                        <a href="javascript:;" class="btn actionSearchLevel" value="Itinerario {{ itinerario }}" data-toggle="tab">ITINERARIO {{ itinerario }}</a>
                                    {% endfor %}
                                </td>
                            </tr>
                        {% endif %}
                    </table>
                </div>
                <div class="span4" style="padding: 20px;">
                    <div class="search">
                        <input type="text" id="searchSubjects" placeholder="Buscar ...">
                        <i class="fa fa-search"></i>
                        <a href="javascript:;" class="btn btn-danger actionSearchLevel actionSearchLevelAll" style="width: 100% !important; margin-top: 5px; background: #da4f49 !important;" value="all">LIMPIAR BUSQUEDA</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div v-if="puede_agregar && asignaturasmalla.length > 0" v-for="nmo in niveles_malla_ofertadas" style="width: 100%; height: max-content; display: inline-block" :key="nmo.id">
        <h4 class="hr_nivel_malla" v-bind:nivelmallaid="nmo.id" style="width:100%; text-align:left; border-bottom: 1px solid #198754; line-height:0.1em; margin:10px 0 20px;"><span style="padding:0 10px; background: #198754; padding: 5px 10px; color: #FFFFFF; border-radius: 5px">${nmo.nombre}</span></h4>
        <ul class="thumbnails" id="listSubjects" style="vertical-align: middle !important;">
            <li class="span3 valueYesSearch" v-for="am in asignaturasmalla" :key="am.id" v-bind:nivel_malla_id="am.nivelmalla_id" v-if="am.puede_ver_horario && nmo.id == am.nivelmalla_id">
                <div class="thumbnail">
                    <div class="thumbnail-subject">${am.asignatura}</div>
                    <div class="thumbnail-level">${am.nivelmalla}</div>
                    <div class="thumbnail-eje">${am.ejeformativo}</div>
                    <div v-if="am.estado === 1">
                        <span class="label label-success">APROBADA</span> <span v-if="am.itinerario > 0"> / <label class="label label-info">${am.itinerario_verbose}</label></span>
                    </div>
                    <div v-if="am.estado === 2">
                        <span class="label label-important">REPROBADA</span> <span v-if="am.itinerario > 0"> / <label class="label label-info">${am.itinerario_verbose}</label></span> <span v-if="am.totalrecordasignatura > 1"> / <label class="label label-warning">${am.totalrecordasignatura} MAT.</label></span>
                    </div>
                    <div v-if="am.estado === 3">
                        <span class="label label-warning">PENDIENTE</span> <span v-if="am.itinerario > 0"> / <label class="label label-info">${am.itinerario_verbose}</label></span> <span v-if="am.totalrecordasignatura > 1"> / <label class="label label-warning">${am.totalrecordasignatura} MAT.</label></span>
                    </div>
                    <div v-if="am.estado === 0">
                        <span class="label label-info">NO APLICA</span>
                    </div>
                    <div id="no-more-tables" style="margin-top: 5px">
                        <table class='table table-bordered table-striped'>
                            <thead>
                            <tr>
                                <th style="text-align: center">Cdts.</th>
                                <th style="text-align: center">Hrs.</th>
                                <th style="text-align: center">Precds.</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td data-title='Créditos' style="text-align: center;">${am.creditos}</td>
                                <td data-title='Horas' style="text-align: center;">${am.horas}</td>
                                <td data-title='Precedencias' style="text-align: center;">
                                    <a href="javascript:;" class="smaller predecesores btn btn-min" data-placement="left" rel="popover" v-bind:data-content="am.predecesoras" v-on:click="infoPredecesora(am.predecesoras, am.cantidad_predecesoras)"> ${am.cantidad_predecesoras}</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="thumbnail-actions">
                        <!--<a class="btn btn-large btn-info" v-if="am.estado === 3 && am.cantidad_predecesoras === 0" v-on:click="openAsignatura(am)">HORARIO</a>-->
                        <a class="btn btn-large btn-info" v-bind:itinerario="`itinerario_`+am.itinerario" v-bind:id="`btn_aplicar_`+am.id" :key="`aplicar_`+am.id" v-if="matricula && !matricula.tiene_token && am.puede_ver_horario == 1" v-on:click="openAsignatura(am)"><i class='bx bx-arrow-to-top'></i> ASIGNAR</a>
                        <!--<a class="btn btn-large btn-danger" style="display: none" v-bind:id="`btn_remover_`+am.id" :key="`remover_`+am.id" v-if="am.puede_ver_horario == 1" v-on:click="removeAsignatura(am)"><i class='bx bxs-no-entry'></i> REMOVER</a>-->
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <!--<div v-for="nmo in niveles_malla_ofertadas">
        <hr style="border: 1px solid #0ae489">
    </div>-->


    <div v-else-if="puede_agregar && asignaturasmalla.length == 0" class="alert alert-info">NO HAY ASIGNATURAS PENDIENTES O REPROBADAS</div>

    <div class="modal fade static" id="modalAsignatura">
        <div class="modal-header">
            <h4 class="paneltitle"><span>HORARIOS DE CLASES DE </span> << ${ asignatura.asignatura } [${ asignatura.nivelmalla }] >></h4>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-warning" v-if="!asignatura.materias || asignatura.materias.length === 0">
                <h4 class="alert-heading">Importante!</h4>
                <p class="alert-body">
                    MATERIA NO ESTÁ ABIERTA,CONTACTAR A SU DIRECTOR/A DE CARRERA
                </p>
            </div>
            <table class="table table-bordered table-striped" cellpadding="0" cellspacing="0" v-else>
                <thead>
                <tr>
                    <th style="text-align: center; vertical-align: middle; width: 30%">Coordinación / Carrera / Paralelo</th>
                    <th style="text-align: center; vertical-align: middle; width: 30%" v-if="ver_horario_materia">Horario</th>
                    <th style="text-align: center; vertical-align: middle; width: 8%" v-if="ver_cupo_materia">Cupo</th>
                    <th style="text-align: center; vertical-align: middle; width: 8%" v-if="ver_cupo_materia">Disponible</th>
                    <th style="text-align: center; vertical-align: middle; width: 8%">Sección</th>
                    <th style="text-align: center; vertical-align: middle; width: 6%">Inicio</th>
                    <th style="text-align: center; vertical-align: middle; width: 6%">Fin</th>
                    <th style="text-align: center; vertical-align: middle; width: 10%"></th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="m in asignatura.materias" :key="m.id">
                    <td style="text-align: left; vertical-align: middle">
                        ${ m.coordinacion }<br>
                        ${ m.carrera } <br>
                        ${ m.paralelo } /
                        <span v-if="m.tipomateria === 1">
                                <label class="label label-info">${m.tipomateria_display}</label> /
                            </span>
                        <span v-else-if="m.tipomateria === 2">
                                <label class="label label-inverse">${m.tipomateria_display}</label> /
                            </span>
                        <span v-if="m.teoriapractica === 1">
                                <label class="label label-warning">TP</label> /
                            </span>
                        <span v-if="m.teoriapractica === 0">
                                <label class="label label-warning">T</label>
                            </span>
                    </td>
                    <td v-if="ver_horario_materia">
                        <ul>
                            <li v-for="h in m.horarios_verbose"><i class="fa fa-calendar-o"></i> ${ h }</li>
                        </ul>
                    </td>
                    <td v-if="ver_cupo_materia" style="text-align: center; vertical-align: middle">${m.cupos}</td>
                    <td v-if="ver_cupo_materia" style="text-align: center; vertical-align: middle">${m.disponibles}</td>
                    <td style="text-align: center; vertical-align: middle">${m.session}</td>
                    <td style="text-align: center; vertical-align: middle">${m.inicio}</td>
                    <td style="text-align: center; vertical-align: middle">${m.fin}</td>
                    <td style="text-align: center; vertical-align: middle">
                        <div v-if="m.puede_agregar">
                            <div v-if="valida_horario_materia">
                                <div v-if="m.horarios.length > 0">
                                    <div v-if="valida_cupo_materia">
                                        <div v-if="m.cupos > 0 && m.disponibles <= m.cupos">
                                            <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubject(m)">SELECCIONAR</a>
                                        </div>
                                    </div>
                                    <div v-else>
                                        <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubject(m)">SELECCIONAR</a>
                                    </div>
                                </div>
                            </div>
                            <div v-else-if="valida_cupo_materia">
                                <div v-if="m.cupos > 0 && m.disponibles <= m.cupos">
                                    <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubject(m)">SELECCIONAR</a>
                                </div>
                            </div>
                            <div v-else>
                                <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubject(m)">SELECCIONAR</a>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn action-close">CERRAR</a>
        </div>
    </div>

    <div class="modal fade static" id="modalPractica">
        <div class="modal-header">
            <h4 class="paneltitle"><span>HORARIOS DE PRÁCTICAS DE </span> << ${ asignatura.asignatura } [${ asignatura.nivelmalla }] >></h4>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-info" v-if="!materia.mispracticas || materia.mispracticas.length === 0">
                <h4 class="alert-heading">Importante!</h4>
                <p class="alert-body">
                    NO EXISTEN PRACTICAS PROGRAMADAS
                </p>
            </div>
            <table class="table table-bordered table-striped" cellpadding="0" cellspacing="0" v-else>
                <thead>
                <tr>
                    <th v-if="ver_horario_materia" style="text-align: center; vertical-align: middle; width: 30%">Horario</th>
                    <th style="text-align: center; vertical-align: middle; width: 20%">Paralelo</th>
                    <th v-if="ver_cupo_materia" style="text-align: center; vertical-align: middle; width: 8%">Cupo</th>
                    <th v-if="ver_cupo_materia" style="text-align: center; vertical-align: middle; width: 8%">Disponible</th>
                    <th style="text-align: center; vertical-align: middle; width: 30%"></th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="p in materia.mispracticas" :key="p.id">
                    <td v-if="ver_horario_materia" style="text-align: left; vertical-align: middle">
                        <ul>
                            <li v-for="h in p.horarios_verbose" :key="h.id"><i class="fa fa-calendar-o"></i> ${h}</li>
                        </ul>
                    </td>
                    <td style="text-align: center; vertical-align: middle">${p.paralelo}</td>
                    <td v-if="ver_cupo_materia" style="text-align: center; vertical-align: middle">${p.cupos}</td>
                    <td v-if="ver_cupo_materia" style="text-align: center; vertical-align: middle">${p.disponibles}</td>
                    <td style="text-align: center; vertical-align: middle">
                        <div v-if="valida_horario_materia">
                            <div v-if="p.horarios.length > 0">
                                <div v-if="valida_cupo_materia">
                                    <div v-if="p.cupos > 0 && p.disponibles <= p.cupos">
                                        <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubjectPractice(materia, p)">SELECCIONAR</a>
                                    </div>
                                </div>
                                <div v-else>
                                    <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubjectPractice(materia, p)">SELECCIONAR</a>
                                </div>
                            </div>

                        </div>
                        <div v-else-if="valida_cupo_materia">
                            <div v-if="p.cupos > 0 && p.disponibles <= p.cupos">
                                <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubjectPractice(materia, p)">SELECCIONAR</a>
                            </div>
                        </div>
                        <div v-else>
                            <a href="javascript:;" class="btn btn-large btn-success" v-on:click="selectSubjectPractice(materia, p)">SELECCIONAR</a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn action-close">CERRAR</a>
        </div>
    </div>

    <div class="modal fade static" id="modalValoresRubros" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span></span> Detalle de los valores generados en la matriculación</h4>
        </div>
        <div class="modal-body panelbody">

        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-info action-close"> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="modalConfirmarRetiro" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span></span>Confirmación - Retiro de asignatura</h4>
        </div>
        <div class="modal-body panelbody">
            <div style="text-align: center">
                <h3>Código de confirmación:</h3>
                <input type="text" name="code" class="" style="width: 100px" maxlength="6" />
            </div>
            <br>
            <p style="font-size: 13px; text-align: center !important;"></p>
            <div style="text-align: center"><b style="font-size: 16px;">¿Está {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %} de retirar?</b></div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-warning action-confirm"> Si, estoy {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %}</a>
            <a href="javascript:;" class="btn btn-success action-cancelar"> No, conservar asignatura</a>
            <a href="javascript:;" class="btn btn-info action-close"> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="modalConfirmarEliminar" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span></span> Confirmación - Eliminación de matrícula</h4>
        </div>
        <div class="modal-body panelbody">
            <div style="text-align: center">
                <h3>Código de confirmación:</h3>
                <input type="text" name="code" class="" style="width: 100px" maxlength="6" />
            </div>
            <br>
            <p style="font-size: 13px; text-align: center !important;"></p>
            <div style="text-align: center"><b style="font-size: 16px;">¿Está {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %} de eliminar matrícula?</b></div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-warning action-confirm"> Si, estoy {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %}</a>
            <a href="javascript:;" class="btn btn-success action-cancelar"> No, conservar matrícula</a>
            <a href="javascript:;" class="btn btn-info action-close"> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="modalCalendar" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span></span> Calendario de matriculación</h4>
        </div>
        <div class="modal-body panelbody">

        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-inverse action-close"> Cerrar</a>
        </div>
    </div>

{% endblock %}
{% block extraJs %}
    <!--https://vuejsexamples.com/a-scroll-loading-component-for-vue-js/-->
    <!--https://molvqingtai.github.io/vue-scroll-loader/demo.html-->
    <!--<script src="https://cdn.jsdelivr.net/npm/vue3-sfc-loader"></script>-->
    <!--<script src=”https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>-->
    <!-- archivos vue.js -->
    <!--<script src ="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"> </script>-->
    <!--<script src ="https://cdn.jsdelivr.net/npm/vue-resource@ 1.3.5"> </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>-->
    <script src="/static/js/vue.js"></script>
    <!--<script src="https://unpkg.com/vue-ui-preloader"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/vue-ui-preloader/dist/loader.css">-->
    <script type="text/javascript">
        //Vue.use(loader)
        //axios.defaults.headers.common['X-CSRFToken'] = csrftoken

        const loadAjax = (data, url) => new Promise((resolve, reject) => {
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                success: function(response) {
                    resolve({
                        error: false,
                        value: response
                    });
                },
                error: function() {
                    reject({
                        error: true,
                        message: "Error al enviar los datos."
                    });
                },
                dataType: "json"
            });

        });
        var data = {
            asignaturasmalla: [],
        };
        var app = new Vue({
            delimiters: ['${', '}'],
            el: '#app',
            data: {
                niveles_malla_ofertadas: [],
                asignaturasmalla: [],
                materiasasignadas: [],
                materiaasignada: {},
                itinerario_inscripcion: parseInt('{% if inscripcion.itinerario %}{{ inscripcion.itinerario }}{% else %}0{% endif %}'),
                itinerario: parseInt('{% if inscripcion.itinerario %}{{ inscripcion.itinerario }}{% else %}0{% endif %}'),
                itinerarios: [],
                matricula_id: parseInt('{{ matricula.id }}'),
                matricula: {},
                nivel_id: parseInt('{{ matricula.nivel.id }}'),
                nivelmalla_id: parseInt('{{ minivel.id }}'),
                nivelmalla_matricula: '',
                nivelmalla_matricula_id: 0,
                perdida_gratuidad: false,
                mensaje_gratuidad: '',
                asignatura: {},
                materia: {},
                materias:[],
                clases:[],
                puede_agregar: eval('{% if nivel.puede_agregar_materia_matricula and periodomatricula.puede_agregar_materia %}"true"{% else %}"false"{% endif %}') === 'true',
                puede_quitar: eval('{% if nivel.puede_quitar_materia_matricula and periodomatricula.ver_eliminar_matricula %}"true"{% else %}"false"{% endif %}') === 'true',
                seguridad_remove_materia: eval('{% if periodomatricula.seguridad_remove_materia %}"true"{% else %}"false"{% endif %}') === 'true',
                valida_gratuidad: eval('{% if periodomatricula and periodomatricula.valida_gratuidad %}"true"{% else %}"false"{% endif %}') === 'true',
                porciento_perdida_parcial_gratuidad: parseInt('{% if periodomatricula and periodomatricula.porcentaje_perdidad_parcial_gratuidad %}{{ periodomatricula.porcentaje_perdidad_parcial_gratuidad }}{% else %}0{% endif %}'),
                porciento_perdida_total_gratuidad: parseInt('{% if periodomatricula and periodomatricula.porcentaje_perdidad_total_gratuidad %}{{ periodomatricula.porcentaje_perdidad_total_gratuidad }}{% else %}0{% endif %}'),
                porcentaje_seleccionadas: 0,
                valida_materias_maxima: eval('{% if periodomatricula.valida_materias_maxima %}"true"{% else %}"false"{% endif %}') === 'true',
                num_materias_maxima: parseInt('{% if periodomatricula and periodomatricula.num_materias_maxima %}{{ periodomatricula.num_materias_maxima }}{% else %}0{% endif %}'),
                matriculacion_libre: eval('{% if matriculacion_libre %}"true"{% else %}"false"{% endif %}') === 'true',
                va_ultima_matricula: eval('{% if va_ultima_matricula %}"true"{% else %}"false"{% endif %}') === 'true',
                valida_cupo_materia: eval('{% if periodomatricula.valida_cupo_materia %}"true"{% else %}"false"{% endif %}') === 'true',
                valida_horario_materia: eval('{% if periodomatricula.valida_horario_materia %}"true"{% else %}"false"{% endif %}') === 'true',
                valida_conflicto_horario: eval('{% if periodomatricula.valida_conflicto_horario %}"true"{% else %}"false"{% endif %}') === 'true',
                valida_cuotas_rubro: eval('{% if periodomatricula.valida_cuotas_rubro %}"true"{% else %}"false"{% endif %}') === 'true',
                num_cuotas_rubro: parseInt('{% if periodomatricula and periodomatricula.num_cuotas_rubro %}{{ periodomatricula.num_cuotas_rubro }}{% else %}0{% endif %}'),
                valida_deuda: eval('{% if periodomatricula.valida_deuda %}"true"{% else %}"false"{% endif %}') === 'true',
                ver_cupo_materia: eval('{% if periodomatricula.ver_cupo_materia %}"true"{% else %}"false"{% endif %}') === 'true',
                ver_horario_materia: eval('{% if periodomatricula.ver_horario_materia %}"true"{% else %}"false"{% endif %}') === 'true',
                ver_deduda: eval('{% if periodomatricula.ver_deduda %}"true"{% else %}"false"{% endif %}') === 'true',
                cobro: 0,
                socket_status: false,
            },
            /*components:{
                loader: loader
            },*/
            created(){
                var self = this;
                /*if (self.itinerio > 0){
                    self.itinerio_show = true
                }
                else {
                    self.itinerio_show = false
                }*/
            },
            mounted: function (){
                var self = this;
                moment.tz.add('America/Guayaquil|QMT -05 -04|5e 50 40|0121|-1yVSK 2uILK rz0|27e5');
                /*self.$nextTick(() => {
                    self.sw = new Switchery(this.$refs.cb)
                });*/

                {% if tiene_itinerarios %}
                    {% for itinerario in lista_itinerarios %}
                        self.itinerarios.push(parseInt("{{itinerario}}"));
                    {% endfor %}
                {% endif %}
                self.loading();
                self.loadInitial();
                self.search();
                self.actionSearchLevel();
                $(".actionSearchLevelAll").trigger('click');
                self.$modalAsignatura = $("#modalAsignatura");
                self.$modalPractica = $("#modalPractica");
                self.$modalValoresRubros = $("#modalValoresRubros");
                self.$modalConfirmarRetiro = $("#modalConfirmarRetiro");
                self.$modalConfirmarEliminar = $("#modalConfirmarEliminar");
                $('.action-close', self.$modalAsignatura).click(function(){
                    self.closeAsignatura();
                });
                $('.action-close', self.$modalPractica).click(function(){
                    self.closePractica();
                });
                $('.action-close', self.$modalValoresRubros).click(function(){
                    self.closeValoresRubros();
                });
                $('.action-close', self.$modalConfirmarRetiro).click(function(){
                    self.closeConfirmarRetiro();
                });

                $('.action-confirm', self.$modalConfirmarRetiro).click(function(){
                    self.confirmarRemoveAsignatura();
                });

                $('.action-cancelar', self.$modalConfirmarRetiro).click(function(){
                    self.cancelarRemoveAsignatura();
                });

                $('.action-confirm', self.$modalConfirmarEliminar).click(function(){
                    self.confirmarEliminarMatricula();
                });

                $('.action-cancelar', self.$modalConfirmarEliminar).click(function(){
                    self.cancelarEliminarMatricula();
                });

                $('.action-close', self.$modalConfirmarEliminar).click(function(){
                    self.closeConfirmarEliminar();
                });


                /*$('.action-view-detail-rubros').click(function (){
                    self.viewRubros();
                });*/
            },
            methods: {
                loading: function (){
                    if (!$(".blockUI").length){
                        $.blockUI({message: $('#throbber'), css: { 'border': '1px solid', 'border-radius' : '10px', 'left': '46%', 'width':'140px', 'height': '140px',  'padding': '15px',  '-webkit-border-radius': '10px', '-moz-border-radius': '10px', opacity: .6, color: '#000' }});
                    }
                },
                loadInitial: function() {
                    var self = this;
                    self.loading();
                    $.ajax({
                        type: "POST",
                        url: "/alu_addremove_matricula/pregrado/demo",
                        data: {
                            'action': 'loadInitialData',
                            'matricula_id': self.matricula_id
                        },
                        success: function(response) {
                            if (response.result == 'ok') {
                                //self.asignaturasmalla = response.aData;
                                self.materiasasignadas = response.aMaterias
                                self.matricula = response.aMatricula
                                self.asignaturasmalla = response.aAsignaturasMalla
                                self.itinerario = response.aInscripcion.itinerario
                                self.itinerario_inscripcion = response.aInscripcion.itinerario
                                self.puede_quitar = response.aMatricula.puede_quitar
                                self.puede_agregar = response.aMatricula.puede_agregar
                                self.changeItinerario();
                                self.materias = [];
                                response.aMaterias.forEach(function (ma, index) {
                                    self.materias.push({
                                        "id": ma.materia.id,
                                        "asignatura_id": ma.materia.asignatura_id,
                                        "itinerario": ma.itinerario,
                                        "nivelmalla_id": ma.materia.nivelmalla_id,
                                        "paralelo_id": ma.materia.paralelo_id,
                                        "practica": ma.materia.practica,
                                        "horarios": ma.materia.horarios,
                                    });

                                });
                                response.aAsignaturasMalla.forEach(function (am, index) {
                                    if (am.puede_ver_horario){
                                        let isExit = false;
                                        for (let i in self.niveles_malla_ofertadas){
                                            if (self.niveles_malla_ofertadas[i]['id'] == am.nivelmalla_id){
                                                isExit = true;
                                                return false;
                                            }
                                        }
                                        if (!isExit){
                                            self.niveles_malla_ofertadas.push({
                                                "id": am.nivelmalla_id,
                                                "nombre": am.nivelmalla,
                                            });
                                        }

                                    }
                                });


                                if (self.socket_status){
                                    Swal.fire({
                                        toast: true,
                                        position: 'top-end',
                                        type: 'success',
                                        title: `Existe conexión en tiempo real`,
                                        showConfirmButton: false,
                                        timer: 6000
                                    })
                                }
                                $.unblockUI();
                            } else {
                                //NotificationJG.error(response.mensaje);
                                $.unblockUI();
                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: response.mensaje,
                                    type: 'error',
                                    icon: 'error',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        self.loading();
                                        window.location.href = "/";
                                    }else{
                                        self.loading();
                                        window.location.href = "/";
                                    }
                                }).catch(error => {
                                    self.loading();
                                    window.location.href = "/";
                                });
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: "Error al enviar los datos.",
                                type: 'error',
                                icon: 'error',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    self.loading();
                                    window.location.href = "/";
                                }else{
                                    self.loading();
                                    window.location.href = "/";
                                }
                            }).catch(error => {
                                self.loading();
                                window.location.href = "/";
                            });
                            //NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json"
                    });
                },
                infoPredecesora: function (predecesoras, cantidad){
                    var self = this;
                    Swal.fire({
                        toast: false,
                        position: 'center',
                        icon:"info",
                        type: 'info',
                        title: 'Precedencias',
                        text: (cantidad > 0) ? predecesoras : 'No registra ninguna precedencia',
                        showConfirmButton: false,
                        timer: 6000
                    });
                },
                actionSearchLevel: function (){
                    $(".actionSearchLevel").click(function (){
                        var value = $(this).attr('value');
                        let levels = [];
                        $(".actionSearchLevel").removeClass('btn-inverse');
                        $(this).addClass('btn-inverse');
                        $('#listSubjects li').each(function(){
                            if (value.toLowerCase() == 'all')
                            {
                                $("#searchSubjects").val('');
                                $(this).show().addClass('valueYesSearch');
                                //$('.hr_nivel_malla').show();
                            }
                            else
                            {
                                if(converToAscii($(this).text().toLowerCase()).indexOf(converToAscii(value.toLowerCase())) === -1)
                                {
                                    $(this).hide().removeClass('valueYesSearch');
                                }
                                else{
                                    $(this).show().addClass('valueYesSearch');
                                    levels.push($(".thumbnail-level", $(this)).html());
                                }

                            }
                        });
                        if (value.toLowerCase() == 'all')
                        {
                            $('.hr_nivel_malla').show();
                        }else{
                            $('.hr_nivel_malla').each(function(){
                                if (levels.indexOf(converToAscii($(this).text().toLowerCase())) === -1){
                                    $(this).hide();
                                }
                                else{
                                    $(this).show();

                                }
                            });
                        }

                    });
                },
                search: function (){
                    $("#searchSubjects").keyup(function(){
                        var _this = this;
                        var clase = $('.search i');
                        if($(_this).val() != ''){
                            $(clase).attr('class', 'fa fa-times');
                        }else{
                            $(clase).attr('class', 'fa fa-search');
                        }
                        if($(clase).hasClass('fa fa-times')){
                            $(clase).click(function(){
                                $(_this).val('');
                                $('.valueYesSearch').show();
                                $(clase).attr('class', 'fa fa-search');
                            });
                        }
                        let levels = [];
                        $('.valueYesSearch').each(function(){
                            if(converToAscii($(this).text().toLowerCase()).indexOf(converToAscii($(_this).val().toLowerCase())) === -1){
                                $(this).hide();
                            }
                            else{
                                $(this).show();
                                //levels.push($(this).attr('nivel_malla_id'));
                                levels.push($(".thumbnail-level", $(this)).html());
                            }
                        });

                        $('.hr_nivel_malla').each(function(){
                            if (levels.indexOf(converToAscii($(this).text().toLowerCase())) === -1){
                                $(this).hide();
                            }
                            else{
                                $(this).show();

                            }
                        });

                    });
                },
                closeAsignatura: function (){
                    var self = this;
                    self.asignatura = {};
                    self.$modalAsignatura.modal('hide');
                },
                openAsignatura: function (asignatura){
                    var self = this;
                    self.loading();
                    console.log(asignatura);
                    if (self.valida_materias_maxima && self.materiasasignadas.length >= self.num_materias_maxima){
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon:"error",
                            type: 'error',
                            title: 'Número de materias',
                            text: `Ha superado la cantidad (${self.num_materias_maxima}) asignaturas permitidas a seleccionar`,
                            showConfirmButton: false,
                            timer: 6000
                        });
                        $.unblockUI();
                        return true;
                    }

                    if (self.materias.length == 0 || self.va_ultima_matricula){
                        self.asignatura = asignatura;
                    }else{
                        if (asignatura.itinerario == 0)
                        {
                            var paralelo_id = 0;
                            self.materias.forEach(function(materia, index) {
                                if (materia.nivelmalla_id == asignatura.nivelmalla_id){
                                    paralelo_id = materia.paralelo_id
                                    return false;
                                }
                            });

                            if (paralelo_id > 0){
                                var aux_asignatura = {};
                                $.each( asignatura, function( key, value ) {
                                    if (key != 'materias')
                                    {
                                        aux_asignatura[key] = value
                                    }
                                });
                                var materias = []
                                asignatura.materias.forEach(function(materia, index) {
                                    if (paralelo_id == materia.paralelo_id){
                                        materias.push(materia)
                                    }
                                });
                                aux_asignatura['materias'] = materias
                                self.asignatura = aux_asignatura;
                            }else{
                                self.asignatura = asignatura;
                            }
                        }else {
                            self.asignatura = asignatura;
                        }

                    }

                    let fnModal = function (){
                        if (self.asignatura.materias.length >= 1 && self.asignatura.materias.length <=3){
                            self.$modalAsignatura.modal({backdrop:'static', width: '70%'}).modal('show');
                        }
                        else if (self.asignatura.materias.length > 3){
                            self.$modalAsignatura.modal({backdrop:'static', width: '70%', height: $(window).height()-250}).modal('show');
                        }else{
                            self.$modalAsignatura.modal({backdrop:'static', width: '50%'}).modal('show');
                        }
                        $.unblockUI();
                    }
                    if (self.valida_cupo_materia){
                        loadAjax({'action': 'loadCupoMateria', 'asignatura': JSON.stringify(self.asignatura)}, '/alu_addremove_matricula/pregrado/demo')
                            .then(response => {
                                if (response.value.result == 'ok'){
                                    self.asignatura = response.value.asignatura
                                    fnModal();
                                    $.unblockUI();
                                }else{
                                    $.unblockUI();
                                    NotificationJG.error(response.value.mensaje);
                                }
                            })
                            .catch(error => {
                                $.unblockUI();
                                NotificationJG.error(error.message);
                            });
                    }else{
                        if (fnModal){
                            fnModal();
                        }else {
                            NotificationJG.error("Ocurrio un error al cargar los datos");
                            $.unblockUI();
                        }
                    }

                },
                closePractica: function (){
                    var self = this;
                    //self.asignatura = {};
                    self.materia = {};
                    self.$modalPractica.modal('hide');
                },
                openPractica: function (materia){
                    var self = this;
                    self.loading();
                    self.materia = materia;

                    let fnModal = function (){
                        if (self.materia.length >= 1 && self.materia.length <= 3){
                            self.$modalPractica.modal({backdrop:'static', width: '70%'}).modal('show');
                        }
                        else if (self.materia.length > 3){
                            self.$modalPractica.modal({backdrop:'static', width: '70%', height: $(window).height()-250}).modal('show');
                        }else{
                            self.$modalPractica.modal({backdrop:'static', width: '50%'}).modal('show');
                        }
                        $.unblockUI();
                    }
                    if (self.valida_cupo_materia){

                        loadAjax({
                            'action': 'loadCupoPractica',
                            'materia': JSON.stringify(self.materia)
                        }, '/alu_addremove_matricula/pregrado/demo')
                            .then(response => {
                                if (response.value.result == 'ok'){
                                    self.materia = response.value.materia
                                    fnModal();
                                    $.unblockUI();
                                }else{
                                    $.unblockUI();
                                    NotificationJG.error(response.value.mensaje);
                                }
                            })
                            .catch(error => {
                                $.unblockUI();
                                NotificationJG.error(error.message);
                            });
                    }else{
                        if (fnModal){
                            fnModal();
                        }else {
                            NotificationJG.error("Ocurrio un error al cargar los datos");
                            $.unblockUI();
                        }
                    }

                },
                selectSubject: function (materia){
                    var self = this;
                    self.loading();
                    let fnSelect = function ()
                    {
                        if (materia.teoriapractica == 0)
                        {
                            self.loading();
                            let materia_aux = {
                                "id": materia.id,
                                "asignatura_id": self.asignatura.id,
                                "itinerario": self.asignatura.itinerario,
                                "nivelmalla_id": materia.nivelmalla_id,
                                "paralelo_id": materia.paralelo_id,
                                "practica": {},
                                "horarios": materia.horarios,
                            }

                            let aMaterias = self.materias
                            aMaterias.push(materia_aux)

                            loadAjax({
                                'action': 'setMateria',
                                'idm': self.matricula_id,
                                'materia': JSON.stringify(materia_aux),
                                'materias': JSON.stringify(aMaterias)
                            }, '/alu_addremove_matricula/pregrado/demo')
                                .then(response => {
                                    self.loading();
                                    if (response.value.result == 'ok')
                                    {
                                        self.closeAsignatura();
                                        $.unblockUI();
                                        Swal.fire({
                                            title: `NOTIFICACIÓN`,
                                            text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la materia ha sido guardada correctamente`,
                                            type: 'success',
                                            icon: 'success',
                                            showCancelButton: false,
                                            allowOutsideClick: false,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'Aceptar',
                                            cancelButtonText: 'Cancelar'
                                        }).then((result) => {
                                            if (result.value) {
                                                self.loadInitial();
                                            }else{
                                                self.loadInitial();
                                            }
                                        }).catch(error => {
                                            Swal.fire({
                                                toast: false,
                                                position: 'center',
                                                icon: 'error',
                                                type: 'error',
                                                title: 'Notificación',
                                                text: error.message,
                                                showConfirmButton: false,
                                                timer: 6000
                                            });
                                        });
                                    }
                                    else
                                    {
                                        self.closeAsignatura();
                                        $.unblockUI();
                                        Swal.fire({
                                            toast: false,
                                            position: 'center',
                                            icon: 'error',
                                            type: 'error',
                                            title: 'Notificación',
                                            text: response.value.mensaje,
                                            showConfirmButton: false,
                                            timer: 6000
                                        });
                                    }

                                })
                                .catch(error => {
                                    self.closeAsignatura();
                                    $.unblockUI();
                                    Swal.fire({
                                        toast: false,
                                        position: 'center',
                                        icon: 'error',
                                        type: 'error',
                                        title: 'Notificación',
                                        text: error.message,
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                });

                            //$.unblockUI();
                        }
                        else
                        {
                            self.openPractica(materia);
                        }
                    }

                    if (self.valida_conflicto_horario && self.materias.length > 0)
                    {
                        self.loading();
                        if (self.materias.length > 0) {
                            let materia_aux = {
                                "id": materia.id,
                                "asignatura_id": self.asignatura.id,
                                "itinerario": self.asignatura.itinerario,
                                "nivelmalla_id": materia.nivelmalla_id,
                                "paralelo_id": materia.paralelo_id,
                                "practica": {},
                                "horarios": materia.horarios,
                            }
                            loadAjax({
                                'action': 'validConflictoHorario',
                                'materias': JSON.stringify(self.materias),
                                'materia': JSON.stringify(materia_aux)
                            }, '/alu_addremove_matricula/pregrado/demo')
                                .then(response => {
                                    if (response.value.result == 'ok') {
                                        $.unblockUI();
                                        console.log(response.value.conflicto);
                                        if (response.value.conflicto){
                                            Swal.fire({
                                                toast: true,
                                                position: 'top-end',
                                                type: 'warning',
                                                title: response.value.mensaje,
                                                showConfirmButton: false,
                                                timer: 6000
                                            });
                                        }else{
                                            if (materia.teoriapractica == 0){
                                                Swal.fire({
                                                    title: `NOTIFICACIÓN`,
                                                    text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, ¿Está {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %} de adicionar la materia?`,
                                                    type: 'warning',
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    allowOutsideClick: false,
                                                    confirmButtonColor: '#3085d6',
                                                    cancelButtonColor: '#d33',
                                                    confirmButtonText: 'Si, estoy {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %}',
                                                    cancelButtonText: 'No, cancelar'
                                                }).then((result) => {
                                                    if (result.value) {
                                                        self.loading();
                                                        fnSelect();
                                                    }else{
                                                        $.unblockUI();
                                                    }
                                                }).catch(error => {
                                                    Swal.fire({
                                                        toast: false,
                                                        position: 'center',
                                                        icon: 'error',
                                                        type: 'error',
                                                        title: 'Notificación',
                                                        text: error.message,
                                                        showConfirmButton: false,
                                                        timer: 6000
                                                    });
                                                });
                                            }
                                            else{
                                                fnSelect();
                                            }

                                        }

                                    } else {
                                        $.unblockUI();
                                        NotificationJG.error(response.value.mensaje);
                                    }
                                })
                                .catch(error => {
                                    $.unblockUI();
                                    NotificationJG.error(error.message);
                                });
                        }else {
                            if (fnSelect){
                                fnSelect();
                            }else {
                                NotificationJG.error("Ocurrio un error al cargar los datos");
                                $.unblockUI();
                            }
                        }
                    }
                    else
                    {
                        if (fnSelect){
                            fnSelect();
                        }else {
                            NotificationJG.error("Ocurrio un error al cargar los datos");
                            $.unblockUI();
                        }
                    }

                },
                selectSubjectPractice: function (materia, practica){
                    //console.log(practica);
                    var self = this;
                    self.loading();
                    let fnSelect = function ()
                    {
                        let materia_aux = {
                            "id": materia.id,
                            "asignatura_id": self.asignatura.id,
                            "itinerario": self.asignatura.itinerario,
                            "nivelmalla_id": materia.nivelmalla_id,
                            "paralelo_id": materia.paralelo_id,
                            "practica": practica,
                            "horarios": materia.horarios,
                        }
                        let aMaterias = self.materias
                        aMaterias.push(materia_aux)

                        loadAjax({
                            'action': 'setMateria',
                            'idm': self.matricula_id,
                            'materia': JSON.stringify(materia_aux),
                            'materias': JSON.stringify(aMaterias)
                        }, '/alu_addremove_matricula/pregrado/demo')
                            .then(response => {
                                $.unblockUI();
                                if (response.value.result == 'ok')
                                {
                                    self.closePractica();
                                    self.closeAsignatura();
                                    $.unblockUI();
                                    Swal.fire({
                                        title: `NOTIFICACIÓN`,
                                        text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la materia ha sido guardada correctamente`,
                                        type: 'success',
                                        icon: 'success',
                                        showCancelButton: false,
                                        allowOutsideClick: false,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: 'Aceptar',
                                        cancelButtonText: 'Cancelar'
                                    }).then((result) => {
                                        if (result.value) {
                                            self.loadInitial();
                                        }else{
                                            self.loadInitial();
                                        }
                                    }).catch(error => {
                                        Swal.fire({
                                            toast: false,
                                            position: 'center',
                                            icon: 'error',
                                            type: 'error',
                                            title: 'Notificación',
                                            text: error.message,
                                            showConfirmButton: false,
                                            timer: 6000
                                        });
                                    });
                                } else {
                                    self.closePractica();
                                    self.closeAsignatura();
                                    $.unblockUI();
                                    Swal.fire({
                                        toast: false,
                                        position: 'center',
                                        icon: 'error',
                                        type: 'error',
                                        title: 'Notificación',
                                        text: response.value.mensaje,
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                }

                            })
                            .catch(error => {
                                $.unblockUI();
                                Swal.fire({
                                    toast: false,
                                    position: 'center',
                                    icon: 'error',
                                    type: 'error',
                                    title: 'Notificación',
                                    text: error.message,
                                    showConfirmButton: false,
                                    timer: 6000
                                });
                            });
                        //$.unblockUI();


                    }
                    if (self.valida_conflicto_horario && self.materias.length > 0){
                        if (self.materias.length > 0) {
                            let materia_aux = {
                                "id": materia.id,
                                "asignatura_id": self.asignatura.id,
                                "itinerario": self.asignatura.itinerario,
                                "nivelmalla_id": materia.nivelmalla_id,
                                "paralelo_id": materia.paralelo_id,
                                "practica": practica,
                                "horarios": materia.horarios,
                            }
                            loadAjax({
                                'action': 'validConflictoHorario',
                                'materias': JSON.stringify(self.materias),
                                'materia': JSON.stringify(materia_aux)
                            }, '/alu_addremove_matricula/pregrado/demo')
                                .then(response => {
                                    if (response.value.result == 'ok')
                                    {
                                        if (response.value.conflicto){
                                            Swal.fire({
                                                toast: true,
                                                position: 'top-end',
                                                type: 'warning',
                                                title: response.value.mensaje,
                                                showConfirmButton: false,
                                                timer: 6000
                                            })
                                        }else{
                                            Swal.fire({
                                                title: `NOTIFICACIÓN`,
                                                text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, ¿Está {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %} de adicionar la materia?`,
                                                type: 'warning',
                                                icon: 'warning',
                                                showCancelButton: true,
                                                allowOutsideClick: false,
                                                confirmButtonColor: '#3085d6',
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Si, estoy {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %}',
                                                cancelButtonText: 'No, cancelar'
                                            }).then((result) => {
                                                if (result.value) {
                                                    self.loading();
                                                    fnSelect();
                                                }else{
                                                    $.unblockUI();
                                                }
                                            }).catch(error => {
                                                Swal.fire({
                                                    toast: false,
                                                    position: 'center',
                                                    icon: 'error',
                                                    type: 'error',
                                                    title: 'Notificación',
                                                    text: error.message,
                                                    showConfirmButton: false,
                                                    timer: 6000
                                                });
                                            });
                                        }
                                        $.unblockUI();
                                    }
                                    else
                                    {
                                        $.unblockUI();
                                        NotificationJG.error(response.value.mensaje);
                                    }
                                })
                                .catch(error => {
                                    $.unblockUI();
                                    NotificationJG.error(error.message);
                                });
                        }else {
                            if (fnSelect){
                                fnSelect();
                            }else {
                                NotificationJG.error("Ocurrio un error al cargar los datos");
                                $.unblockUI();
                            }
                        }
                    }else{
                        if (fnSelect){
                            fnSelect();
                        }else {
                            NotificationJG.error("Ocurrio un error al cargar los datos");
                            $.unblockUI();
                        }
                    }


                },
                changeItinerario: function (){
                    var self = this;
                    if (self.itinerario_inscripcion > 0){
                        self.itinerarios.forEach(function(iti, index) {
                            if (iti != self.itinerario_inscripcion){
                                $("[itinerario='itinerario_"+iti+"']").hide();
                            }
                        });
                        self.itinerario = self.itinerario_inscripcion;
                    }else{
                        let utilizaItinerario = false
                        let itinerario = 0;
                        self.materias.forEach(function(materia, index) {
                            if (materia.itinerario > 0){
                                self.itinerario = materia.itinerario;
                                utilizaItinerario = true;
                                return false;
                            }
                        });
                        if (utilizaItinerario){
                            self.itinerarios.forEach(function(iti, index) {
                                if (iti != self.itinerario){
                                    $("[itinerario='itinerario_"+iti+"']").hide();
                                }
                            });
                        }else {
                            self.itinerario = 0;
                            self.itinerarios.forEach(function(iti, index) {
                                $("[itinerario='itinerario_"+iti+"']").show();
                            });
                        }

                    }
                },
                removeAsignatura: function (materiaasignada){
                    var self = this;
                    //self.loading();
                    Swal.fire({
                        title: `NOTIFICACIÓN`,
                        text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, está {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %} de remover/quitar la materia.`,
                        type: 'warning',
                        icon: 'warning',
                        showCancelButton: true,
                        allowOutsideClick: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: `Si, estoy {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %}`,
                        cancelButtonText: 'No, cancelar'
                    }).then((result) => {
                        if (result.value) {
                            self.loading();
                            if (self.seguridad_remove_materia)
                            {
                                loadAjax({
                                    'action': 'generateRetiroMateria',
                                    'idma': materiaasignada.id,
                                }, '/alu_addremove_matricula/pregrado/demo')
                                    .then(response => {

                                        if (response.value.result == 'ok')
                                        {
                                            let lista_emails_envio = [];
                                            {% for le in persona.lista_emails_envio %}
                                                lista_emails_envio.push('{{ le }}');
                                            {% endfor %}
                                            $.unblockUI();
                                            Swal.fire({
                                                title: `NOTIFICACIÓN`,
                                                text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que se ha enviado un correo electrónico (${lista_emails_envio.join(", ")}) para continuar con el proceso de retiro.`,
                                                type: 'success',
                                                icon: 'success',
                                                showCancelButton: false,
                                                allowOutsideClick: false,
                                                confirmButtonColor: '#3085d6',
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Aceptar',
                                                cancelButtonText: 'Cancelar'
                                            }).then((result) => {
                                                if (result.value) {
                                                    self.loadInitial();
                                                }else{
                                                    self.loadInitial();
                                                }
                                            }).catch(error => {
                                                Swal.fire({
                                                    toast: false,
                                                    position: 'center',
                                                    icon: 'error',
                                                    type: 'error',
                                                    title: 'Notificación',
                                                    text: error.message,
                                                    showConfirmButton: false,
                                                    timer: 6000
                                                });
                                            });

                                        }
                                        else
                                        {
                                            $.unblockUI();
                                            NotificationJG.error(response.value.mensaje);
                                        }
                                    })
                                    .catch(error => {
                                        $.unblockUI();
                                        NotificationJG.error(error.message);
                                    });
                            }
                            else
                            {
                                loadAjax({
                                    'action': 'deleteMateria',
                                    'idma': materiaasignada.id,
                                    'utilizaSeguridad': self.seguridad_remove_materia,
                                }, '/alu_addremove_matricula/pregrado/demo')
                                    .then(response => {

                                        if (response.value.result == 'ok')
                                        {
                                            $.unblockUI();
                                            Swal.fire({
                                                title: `NOTIFICACIÓN`,
                                                text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la materia ha sido removido/quitado correctamente.`,
                                                type: 'success',
                                                icon: 'success',
                                                showCancelButton: false,
                                                allowOutsideClick: false,
                                                confirmButtonColor: '#3085d6',
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Aceptar',
                                                cancelButtonText: 'Cancelar'
                                            }).then((result) => {
                                                if (result.value) {
                                                    self.loadInitial();
                                                }else{
                                                    self.loadInitial();
                                                }
                                            }).catch(error => {
                                                Swal.fire({
                                                    toast: false,
                                                    position: 'center',
                                                    icon: 'error',
                                                    type: 'error',
                                                    title: 'Notificación',
                                                    text: error.message,
                                                    showConfirmButton: false,
                                                    timer: 6000
                                                });
                                            });

                                        }
                                        else
                                        {
                                            $.unblockUI();
                                            NotificationJG.error(response.value.mensaje);
                                        }
                                    })
                                    .catch(error => {
                                        $.unblockUI();
                                        NotificationJG.error(error.message);
                                    });
                            }
                        }else{
                            NotificationJG.info("Enhorabuena el registro esta salvado.!");
                            //self.loadInitial();
                        }
                    }).catch(error => {
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon: 'error',
                            type: 'error',
                            title: 'Notificación',
                            text: error.message,
                            showConfirmButton: false,
                            timer: 6000
                        });
                    });

                },
                cancelarRemoveAsignatura: function(){
                    var self = this;
                    self.loading();
                    loadAjax({
                        'action': 'cancelarRetiroMateria',
                        'idma': self.materiaasignada.id,
                    }, '/alu_addremove_matricula/pregrado/demo')
                        .then(response => {
                            if (response.value.result == 'ok')
                            {
                                $.unblockUI();
                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la materia se mantiene en su matricula.`,
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        self.closeConfirmarRetiro();
                                        self.loadInitial();
                                    }else{
                                        self.closeConfirmarRetiro();
                                        self.loadInitial();
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        toast: false,
                                        position: 'center',
                                        icon: 'error',
                                        type: 'error',
                                        title: 'Notificación',
                                        text: error.message,
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                });

                            }
                            else
                            {
                                $.unblockUI();
                                NotificationJG.error(response.value.mensaje);
                            }
                        })
                        .catch(error => {
                            $.unblockUI();
                            NotificationJG.error(error.message);
                        });


                },
                confirmarRemoveAsignatura: function(){
                    var self = this;
                    let code = $("[name='code']", self.$modalConfirmarRetiro).val();
                    if (code === ''){
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: 'error',
                            type: 'error',
                            title: 'Favor ingrese el código de confirmación',
                            showConfirmButton: false,
                            timer: 3500
                        });
                        $("[name='code']", self.$modalConfirmarRetiro).focus();
                        return false;
                    }

                    self.loading();
                    loadAjax({
                        'action': 'deleteMateria',
                        'idma': self.materiaasignada.id,
                        'utilizaSeguridad': self.seguridad_remove_materia,
                        'code': code,
                    }, '/alu_addremove_matricula/pregrado/demo')
                        .then(response => {
                            if (response.value.result == 'ok')
                            {
                                $.unblockUI();
                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la materia ha sido removido/quitado correctamente.`,
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        self.closeConfirmarRetiro();
                                        self.loadInitial();
                                    }else{
                                        self.closeConfirmarRetiro();
                                        self.loadInitial();
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        toast: false,
                                        position: 'center',
                                        icon: 'error',
                                        type: 'error',
                                        title: 'Notificación',
                                        text: error.message,
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                });
                            }
                            else
                            {
                                $.unblockUI();
                                NotificationJG.error(response.value.mensaje);
                            }
                        })
                        .catch(error => {
                            $.unblockUI();
                            NotificationJG.error(error.message);
                        });

                },
                openConfirmarRemoveAsignatura: function(materiaasignada){
                    var self = this;
                    self.loading();
                    $("[name='code']", self.$modalConfirmarRetiro).val('');
                    let msg = `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, al confirmar usted estaría quitando/removiendo la asignatura <b>${materiaasignada.materia.nombre_completo}</b> de su matrícula.`
                    $(".modal-body p", self.$modalConfirmarRetiro).html(msg);
                    self.materiaasignada = materiaasignada;
                    self.$modalConfirmarRetiro.modal({backdrop:'static', width: '40%'}).modal('show');
                    $.unblockUI();
                },
                closeValoresRubros: function (){
                    var self = this;
                    self.$modalValoresRubros.modal('hide');
                },
                viewRubros: function (){
                    var self = this;
                    self.loading();
                    $.ajax({
                        type: "POST",
                        url: "/alu_materias",
                        data: {
                            'action': 'detalle_matricula',
                            'idmatricula': self.matricula_id,
                        },
                        success: function(response) {
                            if (response.result == 'ok') {
                                $.unblockUI();
                                $(".modal-body", self.$modalValoresRubros).html(response.html);
                                var h = $(window).height() - 350;
                                self.$modalValoresRubros.modal({backdrop:'static', width: '70%', height: h}).modal('show');
                            } else {
                                NotificationJG.error(response.mensaje);
                                $.unblockUI();
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json"
                    });
                },
                closeConfirmarRetiro: function (){
                    var self = this;
                    self.materiaasignada = {}
                    self.$modalConfirmarRetiro.modal('hide');
                },
                reenviarRemoveAsignatura: function(materiaasignada){
                    var self = this;
                    if (materiaasignada.contador_reenviar_email_token >= 6){
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: "error",
                            title: "Número de reenvio de correos electrónicos.",
                            showConfirmButton: false,
                            timer: 3500
                        });
                        return false;
                    }

                    let lista_emails_envio = [];
                    {% for le in persona.lista_emails_envio %}
                        lista_emails_envio.push('{{ le }}');
                    {% endfor %}
                    Swal.fire({
                        title: `NOTIFICACIÓN`,
                        text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se procedera a reenviar código de confirmación a las siguientes direcciones electrónicas ${lista_emails_envio.join(", ")} para el retiro de la materia (${materiaasignada.materia.nombre_completo}).`,
                        type: 'warning',
                        icon: 'warning',
                        showCancelButton: true,
                        allowOutsideClick: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Si, reenviar',
                        cancelButtonText: 'No, cancelar'
                    }).then((result) => {
                        if (result.value) {
                            self.loading();
                            loadAjax({
                                'action': 'reenviarRetiroMateria',
                                'idma': materiaasignada.id,
                            }, '/alu_addremove_matricula/pregrado/demo')
                                .then(response => {
                                    if (response.value.result == 'ok')
                                    {
                                        $.unblockUI();
                                        Swal.fire({
                                            title: `NOTIFICACIÓN`,
                                            text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que se ha reenviado el correo electrónico correctamente.`,
                                            type: 'success',
                                            icon: 'success',
                                            showCancelButton: false,
                                            allowOutsideClick: false,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'Aceptar',
                                            cancelButtonText: 'Cancelar'
                                        }).then((result) => {
                                            if (result.value) {
                                                //self.loadInitial();
                                                self.loading();
                                                self.materiasasignadas.forEach(function (ma, index) {
                                                    if (ma.id == materiaasignada.id){
                                                        self.materiasasignadas[index].contador_reenviar_email_token = response.value.contador
                                                        self.materiasasignadas[index].puede_reenviar_token = response.value.contador >= 6 ? false : true
                                                    }
                                                });
                                                $.unblockUI();
                                            }
                                        }).catch(error => {
                                            Swal.fire({
                                                toast: false,
                                                position: 'center',
                                                icon: 'error',
                                                type: 'error',
                                                title: 'Notificación',
                                                text: error.message,
                                                showConfirmButton: false,
                                                timer: 6000
                                            });
                                        });
                                    }
                                    else
                                    {
                                        $.unblockUI();
                                        NotificationJG.error(response.value.mensaje);
                                    }
                                })
                                .catch(error => {
                                    $.unblockUI();
                                    NotificationJG.error(error.message);
                                });
                        }
                        else{
                            NotificationJG.info("Enhorabuena no se ha reenviado correo electrónico!")
                        }
                    }).catch(error => {
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon: 'error',
                            type: 'error',
                            title: 'Notificación',
                            text: error.message,
                            showConfirmButton: false,
                            timer: 6000
                        });
                    });
                },
                deleteMatricula: function(){
                    var self = this;
                    //self.loading();
                    Swal.fire({
                        title: `NOTIFICACIÓN`,
                        text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, al realizar esta acción usted estará liberando cupo. ¿Está {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %} de eliminar la matrícula.?`,
                        type: 'warning',
                        icon: 'warning',
                        showCancelButton: true,
                        allowOutsideClick: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: `Si, estoy {% if persona.sexo.id == 1 %}segura{% else %}seguro{% endif %}`,
                        cancelButtonText: 'No, cancelar'
                    }).then((result) => {
                        if (result.value) {
                            self.loading();
                            if (self.seguridad_remove_materia)
                            {
                                loadAjax({
                                    'action': 'generateCodeEliminarMatricula',
                                    'idm': self.matricula_id,
                                }, '/alu_addremove_matricula/pregrado/demo')
                                    .then(response => {

                                        if (response.value.result == 'ok')
                                        {
                                            let lista_emails_envio = [];
                                            {% for le in persona.lista_emails_envio %}
                                                lista_emails_envio.push('{{ le }}');
                                            {% endfor %}
                                            $.unblockUI();
                                            Swal.fire({
                                                title: `NOTIFICACIÓN`,
                                                text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que se ha enviado un correo electrónico (${lista_emails_envio.join(", ")}) para continuar con el proceso de eliminar matrícula`,
                                                type: 'success',
                                                icon: 'success',
                                                showCancelButton: false,
                                                allowOutsideClick: false,
                                                confirmButtonColor: '#3085d6',
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Aceptar',
                                                cancelButtonText: 'Cancelar'
                                            }).then((result) => {
                                                if (result.value) {
                                                    self.loadInitial();
                                                }else{
                                                    self.loadInitial();
                                                }
                                            }).catch(error => {
                                                Swal.fire({
                                                    toast: false,
                                                    position: 'center',
                                                    icon: 'error',
                                                    type: 'error',
                                                    title: 'Notificación',
                                                    text: error.message,
                                                    showConfirmButton: false,
                                                    timer: 6000
                                                });
                                            });

                                        }
                                        else
                                        {
                                            $.unblockUI();
                                            NotificationJG.error(response.value.mensaje);
                                        }
                                    })
                                    .catch(error => {
                                        $.unblockUI();
                                        NotificationJG.error(error.message);
                                    });

                            }
                            else
                            {
                                loadAjax({
                                    'action': 'deleteMatricula',
                                    'idm': self.matricula_id,
                                    'utilizaSeguridad': self.seguridad_remove_materia,
                                }, '/alu_addremove_matricula/pregrado/demo')
                                    .then(response => {
                                        if (response.value.result == 'ok')
                                        {
                                            $.unblockUI();
                                            Swal.fire({
                                                title: `NOTIFICACIÓN`,
                                                text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la matricula ha sido eliminada correctamente.`,
                                                type: 'success',
                                                icon: 'success',
                                                showCancelButton: false,
                                                allowOutsideClick: false,
                                                confirmButtonColor: '#3085d6',
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Aceptar',
                                                cancelButtonText: 'Cancelar'
                                            }).then((result) => {
                                                if (result.value) {
                                                    location.href = "/";
                                                }else{
                                                    location.href = "/";
                                                }
                                            }).catch(error => {
                                                Swal.fire({
                                                    toast: false,
                                                    position: 'center',
                                                    icon: 'error',
                                                    type: 'error',
                                                    title: 'Notificación',
                                                    text: error.message,
                                                    showConfirmButton: false,
                                                    timer: 6000
                                                });
                                            });

                                        }
                                        else
                                        {
                                            $.unblockUI();
                                            NotificationJG.error(response.value.mensaje);
                                        }
                                    })
                                    .catch(error => {
                                        $.unblockUI();
                                        NotificationJG.error(error.message);
                                    });
                            }
                        }else{
                            NotificationJG.info("Enhorabuena el registro esta salvado.!");
                            //self.loadInitial();
                        }
                    }).catch(error => {
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon: 'error',
                            type: 'error',
                            title: 'Notificación',
                            text: error.message,
                            showConfirmButton: false,
                            timer: 6000
                        });
                    });

                },
                reenviarDeleteMatricula: function(){
                    var self = this;
                    if (self.matricula.contador_reenviar_email_token >= 6){
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: "error",
                            title: "Número de reenvio de correos electrónicos.",
                            showConfirmButton: false,
                            timer: 3500
                        });
                        return false;
                    }
                    let lista_emails_envio = [];
                    {% for le in persona.lista_emails_envio %}
                        lista_emails_envio.push('{{ le }}');
                    {% endfor %}
                    Swal.fire({
                        title: `NOTIFICACIÓN`,
                        text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se procedera a reenviar código de confirmación a las siguientes direcciones electrónicas ${lista_emails_envio.join(", ")} para la eliminación de la matricula.`,
                        type: 'warning',
                        icon: 'warning',
                        showCancelButton: true,
                        allowOutsideClick: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Si, reenviar',
                        cancelButtonText: 'No, cancelar'
                    }).then((result) => {
                        if (result.value) {
                            self.loading();
                            loadAjax({
                                'action': 'reenviarEliminarMatricula',
                                'idm': self.matricula_id,
                            }, '/alu_addremove_matricula/pregrado/demo')
                                .then(response => {
                                    if (response.value.result == 'ok')
                                    {
                                        $.unblockUI();
                                        Swal.fire({
                                            title: `NOTIFICACIÓN`,
                                            text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que se ha reenviado el correo electrónico correctamente.`,
                                            type: 'success',
                                            icon: 'success',
                                            showCancelButton: false,
                                            allowOutsideClick: false,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'Aceptar',
                                            cancelButtonText: 'Cancelar'
                                        }).then((result) => {
                                            if (result.value) {
                                                //self.loadInitial();
                                                self.loading();
                                                self.matricula.contador_reenviar_email_token = response.value.contador
                                                self.matricula.puede_reenviar_token = response.value.contador >= 6 ? false : true
                                                $.unblockUI();
                                            }
                                        }).catch(error => {
                                            Swal.fire({
                                                toast: false,
                                                position: 'center',
                                                icon: 'error',
                                                type: 'error',
                                                title: 'Notificación',
                                                text: error.message,
                                                showConfirmButton: false,
                                                timer: 6000
                                            });
                                        });
                                    }
                                    else
                                    {
                                        $.unblockUI();
                                        NotificationJG.error(response.value.mensaje);
                                    }
                                })
                                .catch(error => {
                                    $.unblockUI();
                                    NotificationJG.error(error.message);
                                });
                        }
                        else{
                            NotificationJG.info("Enhorabuena no se ha reenviado correo electrónico!")
                        }
                    }).catch(error => {
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon: 'error',
                            type: 'error',
                            title: 'Notificación',
                            text: error.message,
                            showConfirmButton: false,
                            timer: 6000
                        });
                    });
                },
                openConfirmarEliminarMatricula: function(){
                    var self = this;
                    self.loading();
                    $("[name='code']", self.$modalConfirmarEliminar).val('');
                    let msg = `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, al confirmar usted estaría eliminando su matrícula.`
                    $(".modal-body p", self.$modalConfirmarEliminar).html(msg);
                    self.$modalConfirmarEliminar.modal({backdrop:'static', width: '40%'}).modal('show');
                    $.unblockUI();
                },
                cancelarEliminarMatricula: function(){
                    var self = this;
                    self.loading();
                    loadAjax({
                        'action': 'cancelarEliminarMatricula',
                        'idm': self.matricula_id,
                    }, '/alu_addremove_matricula/pregrado/demo')
                        .then(response => {
                            if (response.value.result == 'ok')
                            {
                                $.unblockUI();
                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la matrícula se mantiene.`,
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        self.closeConfirmarEliminar();
                                        self.loadInitial();
                                    }else{
                                        self.closeConfirmarEliminar();
                                        self.loadInitial();
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        toast: false,
                                        position: 'center',
                                        icon: 'error',
                                        type: 'error',
                                        title: 'Notificación',
                                        text: error.message,
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                });

                            }
                            else
                            {
                                $.unblockUI();
                                NotificationJG.error(response.value.mensaje);
                            }
                        })
                        .catch(error => {
                            $.unblockUI();
                            NotificationJG.error(error.message);
                        });


                },
                confirmarEliminarMatricula: function(){
                    var self = this;
                    let code = $("[name='code']", self.$modalConfirmarEliminar).val();
                    if (code === ''){
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: 'error',
                            type: 'error',
                            title: 'Favor ingrese el código de confirmación',
                            showConfirmButton: false,
                            timer: 3500
                        });
                        $("[name='code']", self.$modalConfirmarEliminar).focus();
                        return false;
                    }

                    self.loading();
                    loadAjax({
                        'action': 'deleteMatricula',
                        'idm': self.matricula_id,
                        'utilizaSeguridad': self.seguridad_remove_materia,
                        'code': code,
                    }, '/alu_addremove_matricula/pregrado/demo')
                        .then(response => {
                            if (response.value.result == 'ok')
                            {
                                $.unblockUI();
                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: `{% if persona.sexo.id == 1 %}Estimada{% else %}Estimado{% endif %} {{ persona }}, se informa que la matricula ha sido eliminada.`,
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        self.loading();
                                        location.href = "/"
                                        //self.closeConfirmarRetiro();
                                        //self.loadInitial();
                                    }else{
                                        self.loading();
                                        location.href = "/"
                                        //self.closeConfirmarRetiro();
                                        //self.loadInitial();
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        toast: false,
                                        position: 'center',
                                        icon: 'error',
                                        type: 'error',
                                        title: 'Notificación',
                                        text: error.message,
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                });
                            }
                            else
                            {
                                $.unblockUI();
                                NotificationJG.error(response.value.mensaje);
                            }
                        })
                        .catch(error => {
                            $.unblockUI();
                            NotificationJG.error(error.message);
                        });

                },
                closeConfirmarEliminar: function (){
                    var self = this;
                    self.$modalConfirmarEliminar.modal('hide');
                },
            }
        });
    </script>
{% endblock %}




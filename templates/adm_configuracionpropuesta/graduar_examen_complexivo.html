{% extends  "ajaxformbs.html" %}
{% load sga_extras %}
{% block extraheading %}
    <link href="/static/widget_ppp.css" rel="stylesheet"/>
    <script>
        const pk_tema = [];
        const pk_temacerrargraduar = [];
        idsString = '';

        function irArriba() {
            //console.log("arrr")
            $('.ir-arriba').click(function () {
                $('body,html').animate({scrollTop: '0px'}, 1000);
            });
            $(window).scroll(function () {
                if ($(this).scrollTop() > 0) {
                    $('.ir-arriba').slideDown(600);
                } else {
                    $('.ir-arriba').slideUp(600);
                }
            });
            $('.ir-abajo').click(function () {
                $('body,html').animate({scrollTop: '1000px'}, 1000);
            });
        }

        $(document).ready(function () {
            // Desmarcar todos los checkboxes con la clase .seleccionindividual
            $('.seleccionindividual').prop('checked', false);
            $('.seleccionindividualcerrargraduar').prop('checked', false);
            irArriba();
            $(".fancybox").fancybox();
            $(".gallerypdf").fancybox({
                openEffect: 'elastic',
                closeEffect: 'elastic',
                autoSize: true,
                type: 'iframe',
                iframe: {
                    preload: false // fixes issue with iframe and IE
                }
            });
        });

        $(function () {
            busqueda = function () {
                var term = $("#searchinput").val().trim().toUpperCase();
                if (term.length > 0) {
                    location.href = "/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{configuracion.id}}&s=" + term;
                }
                return false;
            };

            const add_array_selected = (pk) => {
                if (!pk_tema.includes(pk)) {
                    pk_tema.push(pk)
                }
            }
            const del_array_selected = (pk) => {
                var indice = pk_tema.indexOf(pk);
                if (pk_tema.includes(pk)) {
                    if (indice !== -1) {
                        pk_tema.splice(indice, 1);
                    }
                }
            }
            const add_array_selectedcerrargraduar = (pk) => {
                if (!pk_temacerrargraduar.includes(pk)) {
                    pk_temacerrargraduar.push(pk)
                }
            }
            const del_array_selectedcerrargraduar = (pk) => {
                var indice = pk_temacerrargraduar.indexOf(pk);
                if (pk_temacerrargraduar.includes(pk)) {
                    if (indice !== -1) {
                        pk_temacerrargraduar.splice(indice, 1);
                    }
                }
            }

            $("#search").click(function () {
                busqueda();
            });

            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });

            $(".calificaractaycerrarposgrado").click(function () {
                var idtematitulacion = $(this).attr('idtematitulacion');
                var nommaestrante = $(this).attr('nommaestrante');
                var notamaestrante = $(this).attr('notamaestrante');
                smoke.confirm("¿Está seguro de calificar y cerrar acta " + nommaestrante + " con la nota de: " + notamaestrante + " ?", function (e) {
                    if (e) {
                        bloqueointerface();
                        var id = idtematitulacion;
                        $.ajax({
                            type: "POST",
                            url: "/adm_configuracionpropuesta",
                            data: {'action': 'calificaractaycerrarposgradocomplexivo', 'id': id},
                            error: function () {
                                $.unblockUI();
                                smoke.alert("Error al obtener los datos.");
                            },
                            success: function (data) {
                                if (data.result == "ok") {
                                    location.reload();
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            }
                        });
                    }
                }, {
                    ok: "SI, CALIFICAR Y CERRAR ACTA",
                    cancel: "NO,CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            });

            $('#id_seleccionmasivo').click(function (e) {
                if (!this.disabled) {
                    if (this.checked) {
                        $('.seleccionindividual:not([disabled])').prop('checked', true).each(function () {
                            add_array_selected(this.attributes.id_tema.value);
                        });
                    } else {
                        $('.seleccionindividual:not([disabled])').prop('checked', false).each(function () {
                            del_array_selected(this.attributes.id_tema.value);
                        });
                    }
                }

            });
            $('#id_seleccionmasivocerrargraduar').click(function (e) {
                if (!this.disabled) {
                    if (this.checked) {
                        $('.seleccionindividualcerrargraduar:not([disabled])').prop('checked', true).each(function () {
                            add_array_selectedcerrargraduar(this.attributes.id_tema.value);
                        });
                    } else {
                        $('.seleccionindividualcerrargraduar:not([disabled])').prop('checked', false).each(function () {
                            del_array_selectedcerrargraduar(this.attributes.id_tema.value);
                        });
                    }
                }

            });

            $('.seleccionindividual').change(function () {
                let pk = this.attributes.id_tema.value
                if (this.checked) {
                    add_array_selected(pk)
                } else {
                    del_array_selected(pk)
                }
            });

            $('.seleccionindividualcerrargraduar').change(function () {
                let pk = this.attributes.id_tema.value
                if (this.checked) {
                    add_array_selectedcerrargraduar(pk)
                } else {
                    del_array_selectedcerrargraduar(pk)
                }
            });


        });
    </script>
    <script type="text/javascript">


        function actaaprobacionexamencomplexivo(idinscripcion) {
            openwindow('POST', '/adm_configuracionpropuesta', {
                action: 'pdfactaaprobacionexamencomplexivo',
                id: idinscripcion,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }, '_blank');
        }

        const generar_acta_grado = (pk) => {
            Swal.fire({
                html: `<strong>¿Está seguro de generar el Acta de Grado?</strong>
                <br>
                <p style="font-size: .8rem">En caso de que ya exista un archivo generado, <strong>será reemplazado.</strong></p>`,
                type: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    actagradoposgradocomplexivoactualizapagina(pk)
                }
            });
        }

        function cantidad_actas_seleccionadas(id, text) {
            $.get('/adm_configuracionpropuesta', {'action': 'verificar_cantidad_actas_seleccionadas', 'id': id}, function (data) {
                $.unblockUI();
                if (data.result == "ok") {
                    generar_acta_grado_masivo(id, data.cantidad);
                } else {
                   alertaDanger(data.mensaje);
                }
            })
        }

        const generar_acta_grado_masivo = (pk, cantidad) => {
            Swal.fire({
                html: `<strong>¿Está seguro de generar las Actas de Grado en masivo?</strong>
                        <p style="font-size: .8rem">Se generará un total de <strong>${cantidad}</strong> Actas de Grado.</p>`,
                type: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    actagradoposgradocomplexivoactualizapaginamasivo(pk)
                }
            });
        }

        function actagradoposgradocomplexivoactualizapaginamasivo(id) {
            console.log("bloqueointerface");
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/adm_configuracionpropuesta",
                data: {'action': 'pdfactagradoposgradocomplexivomasivo', 'id': id},
                error: function () {
                    $.unblockUI();
                    alertaDanger("Error al obtener los datos.");
                },
                success: function (data) {
                    if (data.result === "ok") {
                        $.unblockUI();
                        alertaSuccess("Recibirá una notificación en el SGA cuando el proceso de generación de Actas de Grado masivo finalice.");
                    } else {
                        $.unblockUI();
                        alertaDanger(data.mensaje);
                    }
                }
            });
        }

        function actagradoposgradocomplexivo(idinscripcion) {
            openwindow('POST', '/adm_configuracionpropuesta', {
                action: 'pdfactagradoposgradocomplexivo',
                id: idinscripcion,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }, '_blank');
        }

        function actagradoposgradocomplexivoactualizapagina(id) {
            console.log("bloqueointerface");
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/adm_configuracionpropuesta",
                data: {'action': 'pdfactagradoposgradocomplexivo', 'id': id},
                error: function () {
                    $.unblockUI();
                    alertaDanger("Error al obtener los datos.");
                },
                success: function (data) {
                    if (data.result === "ok") {
                        window.open(data.url, '_blank');
                        location.reload();
                        window.addEventListener('load', function () {
                             $.unblockUI();
                        });
                    } else {
                        $.unblockUI();
                        alertaDanger(data.mensaje);
                    }
                }
            });
        }

        function formModal(id, text, action) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(text);
                        $("#itemspanel").modal({backdrop: 'static', width: '1000'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        const cerrar_acta_and_graduar_masivo = (id) => {
            Swal.fire({
                title: `¿Esta seguro de cerrar todas las actas y graduar de forma masiva?`,
                text: "Recuerde se procesaran las actas: 1.- firmadas por coordinador  2.- tengan sus debidas notas  3.- Acta se encuentre no cerrada",
                type: 'info',
                icon: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si',
                cancelButtonText: 'No, Cancelar'
            }).then((result) => {
                if (result.value) {
                    var aData = {"action": "cerrar_acta_y_graduar_masivo", "id": id}
                    $.ajax({
                        type: "POST",
                        url: `{{ request.path }}`,
                        data: aData,
                        success: function (data) {
                            if (data.result) {
                                $.unblockUI();
                                NotificationJG.success("Se cerraron las actas y se graduaron correctamente.");
                            } else {
                                NotificationJG.error(data.message);
                                $.unblockUI();
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json",
                    });
                    // Establece un retraso de 5 segundos (5000 milisegundos) y luego muestra un alert.
                    setTimeout(function () {
                        location.reload();
                    }, 5000);


                }
            }).catch(error => {
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    type: 'error',
                    title: 'Ocurrio un error inesperado',
                    showConfirmButton: false,
                    timer: 6000
                });
            });
        }

        const importar_numero_acta = (id) => {
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': 'importar_numero_acta',
                    'id': id,
                },
                success: function (data) {
                    if (data.result === true) {
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html('Importar número de acta masiva');
                        $("#itemspanel").modal({backdrop: 'static', width: '1000'}).modal('show');
                    } else {
                        alertaDanger(data.mensaje);
                    }
                },
                error: function () {
                    alertaDanger("Error de conexión.");
                },
                dataType: "json"
            });
        }


        const cerrar_y_graduar_acta_masivo_seleccion = (id) => {

            if (pk_temacerrargraduar.length > 0) {
                idsString = pk_temacerrargraduar.join(',');  // Convertir la lista de IDs en un string separado por comas
            } else {
                idsString = ''
            }
            if (idsString.length > 0) {
                $.ajax({
                    type: "GET",
                    url: `{{ request.path }}`,
                    data: {
                        'action': 'cerrar_actas_y_graduar_masivo_seleccionados',
                        'id': id,
                        'ids_tema': idsString,
                    },
                    success: function (data) {
                        if (data.result === true) {
                            $('.panelbody').html(data.data);
                            $('#itemspanel .paneltitle').html('Cerrar actas y graduar masivo');
                            $("#itemspanel").modal({backdrop: 'static', width: '1000'}).modal('show');
                        } else {
                            alertaDanger(data.mensaje);
                        }
                    },
                    error: function () {
                        alertaDanger("Error de conexión.");
                    },
                    dataType: "json"
                });
            } else {
                mensajeWarning("Seleccione al menos un registro para cerrar acta y graduar")
            }
        }


        const firma_masiva = (id) => {
            if (pk_tema.length > 0) {
                idsString = pk_tema.join(',');  // Convertir la lista de IDs en un string separado por comas
            } else {
                idsString = ''
            }
            if (idsString.length > 0) {
                $.ajax({
                    type: "GET",
                    url: `{{ request.path }}`,
                    data: {
                        'action': 'firma_masiva_complexivo_posgrado',
                        'id': id,
                        'ids_tema': idsString,
                    },
                    success: function (data) {
                        if (data.result === true) {
                            $('.panelbody').html(data.data);
                            $('#itemspanel .paneltitle').html('Firma masiva complexivo posgrado');
                            $("#itemspanel").modal({backdrop: 'static', width: '1000'}).modal('show');
                        } else {
                            alertaDanger(data.mensaje);
                        }
                    },
                    error: function () {
                        alertaDanger("Error de conexión.");
                    },
                    dataType: "json"
                });
            } else {
                mensajeWarning("Seleccione al menos un registro para firmar")
            }
        }
        const acta_grado_masiva = (id) => {
            Swal.fire({
                title: "Descarga masiva actas de grado de complexivo",
                type: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonText: 'Descargar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    openwindow('GET', '{{ request.path }}', {
                        action: 'acta_grado_masiva_complexivo_posgrado',
                        id: id,
                    }, '_blank');
                    $.unblockUI();
                }
            })

        }

        const descargar_actas_aprobacion_masiva = (pk) => {
            Swal.fire({
                title: "Descarga masiva actas de calificación de complexivo",
                type: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonText: 'Descargar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    openwindow('GET', '{{ request.path }}', {
                        action: 'descargar_actas_aprobacion_masiva',
                        id: pk,
                    }, '_blank');
                    $.unblockUI();
                }
            })
        }

        function actagradoposgrado(idinscripcion) {
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/firmardocumentosposgrado",
                data: {'action': 'get_actagradoposgradocomplexivo', 'id': idinscripcion},
                error: function () {
                    $.unblockUI();
                    alertaDanger("Error al obtener los datos.");
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === "ok") {
                        window.open(data.url, '_blank');
                    } else {
                        alertaDanger(data.mensaje);
                    }
                }
            });
        }


    </script>
    <script src="/static/adicionalesjs/formquestion.js?0.24"></script>
{% endblock %}
{% block atras %}/adm_configuracionpropuesta{% endblock %}
{% block canvas %}

    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-header">
            <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>
        </div>
        <div class="modal-body">
            <form class="form-horizontal form-modal" autocomplete="off" method="post"
                  enctype="multipart/form-data" action="{{ request.path }}">
                {% csrf_token %}
                <div class="row-fluid panelbody">
                </div>
            </form>
        </div>
    </div>

    <div class='row-fluid'>
        <div class='span12' style="text-align: right">

        </div>
    </div>
    <div class="row-fluid"><h4>{{ title |upper }}</h4></div>
    <div class='row-fluid'>
        <div class="span12">
            <div class="alert alert-info" style="text-align: justify">

                <h4 class="alert-heading"> CONVOCATORIA({{ configuracion.id }}) - {{ configuracion.periodo }}</h4>
                <p><i class="fa fa-book" aria-hidden="true"></i> {{ configuracion.carrera }}</p>

            </div>
        </div>
    </div>

    <div class="row-fluid">

        <div class="span6">
            <div class="btn-group">
                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="javascript:;">
                    <i class="fa fa-file-excel-o" aria-hidden="true"></i> Reportes <span
                        class="caret"></span></a>
                <ul class="dropdown-menu pull-left">
                    <li>
                        <a class="tu" id="cant_tut_docentes" target="_blank"
                           href="/adm_configuracionpropuesta?action=reporteFirmaActaSustentacionComplexivo&id={{ configuracion.id }}">
                            Firmas de acta
                            aprobación complexivo </a>
                        <a class="tu" onclick="descargar_actas_aprobacion_masiva({{ configuracion.id }})"
                           href="javascript:;">Descargar actas
                            aprobación masivas </a>
                    </li>

                </ul>
            </div>

            <div class="btn-group">
                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="javascript:;"> <i
                        class="fa fa-cogs" aria-hidden="true"></i> Acciones masivas<span class="caret"></span></a>
                <ul class="dropdown-menu pull-left">

                    <li><a class="tu" onclick="firma_masiva({{ configuracion.id }})" href="javascript:;">Firma masivas
                        de actas complexivo</a></li>
                    <li>
                        {% if  firmado == 3 %}
                            <a class="tu" onclick="importar_numero_acta({{ configuracion.id }})" href="javascript:;">Importar
                                número de actas de grado</a>
                        {% endif %}
                        {% if existen_actas_sin_cerrar %}
                            {% if  firmado == 3 %}
                                <a class="tu" onclick="cerrar_acta_and_graduar_masivo({{ configuracion.id }})"
                                   href="javascript:;">Cerrar actas y graduar todos </a>
                            {% endif %}
                        {% endif %}
                        {% if existen_actas_sin_cerrar %}
                            {% if  firmado == 3 %}
                                <a class="tu" onclick="cerrar_y_graduar_acta_masivo_seleccion({{ configuracion.id }})"
                                   href="javascript:;">Cerrar actas y graduar seleccionados </a>
                            {% endif %}
                        {% endif %}
                        <a class="tu" onclick="acta_grado_masiva({{ configuracion.id }})" href="javascript:;">Descargar
                            actas de grado masivo </a>

                    </li>
                    <li><a class="tu" onclick="cantidad_actas_seleccionadas({{ configuracion.id }})" href="javascript:;">Generar actas de grado masivo</a></li>
                    <li>

                </ul>
            </div>


            <div class="btn-group">
                <form class="form-search" onsubmit="return busqueda()">
                    <input class='searchinput' placeholder="BUSCAR POR CÉDULA / APELLIDOS" type='text' id='searchinput'
                           value='{{ search }}' autocomplete="off"/>
                    <a href="javascript:;" id='search' class='btn btn-info'><i class="fa fa-search "></i> Buscar</a>
                    {% if search or ids %}
                        <a href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}"
                           id='allresults' class='btn btn-info'><i
                                class="fa fa-refresh "></i> Todos</a>
                    {% endif %}
                </form>
            </div>


        </div>
    </div>

    </div>
    <div class='row-fluid'>
        <div class='span12'>
            <table class='table table-bordered table-striped'>
                <thead>
                <tr>
                    <th style="width: 20px" class="border-0 text-center">
                        <table>
                            <thead>
                            <tr>
                                <th>Firmar acta masivo <br> <input type="checkbox" id="id_seleccionmasivo"></th>
                                <th>Cerrar y graduar masivo <br> <input type="checkbox"
                                                                        id="id_seleccionmasivocerrargraduar"></th>
                            </tr>
                            </thead>
                        </table>
                    </th>
                    <th style="width: 250px;text-align: left;">Maestrante</th>
                    <th style="width: 250px;text-align: center;">Tema</th>
                    <th style="width: 350px;text-align: center;">Variables</th>
                    <th style="width: 80px">Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for tema in temas_examen_complexivo %}
                    <tr>

                        <td class="text-center">
                            <table class="text-center">
                                <tr>

                                    <th class="align-items-center"> Firma masiva <br> <input type="checkbox" id_tema="{{ tema.0.id }}"
                                               class="seleccionindividual " {% if firmado == 3 %}
                                        {% if tema.0.estado_acta_firma == 1 or tema.0.estado_acta_firma == 3 or tema.0.estado_acta_firma == 4 %}
                                               disabled{% endif %}  {% endif %} {% if firmado == 4 %}
                                        {% if tema.0.estado_acta_firma == 1 or tema.0.estado_acta_firma == 2 or tema.0.estado_acta_firma == 4 %}
                                               disabled{% endif %}  {% endif %} ></th>
                                </tr>

                            </table>

                            <table class="text-center">
                                <tr>
                                    <th class="align-items-center"> Cerrar y graduar <br><input type="checkbox" id_tema="{{ tema.0.id }}"
                                               class="seleccionindividualcerrargraduar"
                                            {% if firmado == 3 %}
                                                 {% if tema.0.estado_acta_firma == 1 or tema.0.estado_acta_firma == 3 %} disabled{% endif %}
                                            {% endif %}
                                            {% if firmado == 4 %}
                                                {% if tema.0.estado_acta_firma == 1 or tema.0.estado_acta_firma == 2 %} disabled{% endif %}
                                            {% endif %} {% if tema.0.actacerrada%} disabled{% endif %}
                                    >

                                    </th>
                                </tr>
                            </table>


                        </td>
                        <td>
                            <li class="list-group-item list-group-item-success"
                                style="padding: 1px 2px;text-align: justify;background-color: #f1f1f1;">
                                {% if persona.usuario.is_superuser %}{{ tema.0.matricula.inscripcion.id }}{% endif %}
                                <i class="fa fa-graduation-cap"></i>
                                {{ tema.0.matricula.inscripcion.persona.titulacion_solo3nivelparapogrado.titulo.abreviatura|default_if_none:'' }}
                                {{ tema.0.matricula.inscripcion.persona.nombre_completo_inverso }} <br>
                                CI: {{ tema.0.matricula.inscripcion.persona.cedula }}<br>

                            </li>
                            <ul style="text-align: justify;font-size: 9px;margin: 0 0 0px 0px;">

                                <table class="table table-bordered">
                                    <tbody>
                                    <tr>
                                        <th>
                                            <li class=""><strong>Nota exámen: </strong>{{ tema.1 |floatformat:"2" }} pts
                                            </li>
                                        </th>
                                        {% if tema.2 %}
                                            <th>
                                                <li class=""><strong>Nota ensayo: </strong>{{ tema.2 |floatformat:"2" }}
                                                    pts
                                                </li>
                                            </th>
                                            <th>
                                                <li class="list-group-item list-group-item-success"
                                                    style="padding: 2px 4px;">
                                                    <strong>Nota final: </strong>
                                                    {{ tema.1|add:tema.2 |floatformat:"2" }} pts
                                                </li>
                                            </th>
                                        {% else %}
                                            <th>
                                                <li class="list-group-item list-group-item-success"
                                                    style="padding: 2px 4px;">
                                                    <strong>Nota final: </strong>
                                                    {{ tema.1| floatformat:"2" }} pts
                                                </li>
                                            </th>
                                        {% endif %}
                                    </tr>

                                    </tbody>
                                </table>

                                {% with tieneapro=tema.0|call:'tiene_aprobaciones' estadoaprobacion=tema.0|call:'estado_aprobacion' %}
                                    <table class="table table-bordered">
                                        <tbody>
                                        <tr>
                                            <th>
                                                {% if tieneapro %}
                                                    {% if estadoaprobacion %}
                                                        {% if estadoaprobacion.estado == 2 %}
                                                            <li class="list-group-item list-group-item-success"
                                                                style="padding: 1px 2px;text-align: center;background-color: #dff0d8;">
                                                                <strong>{{ estadoaprobacion.get_estado_display }}</strong>
                                                            </li>
                                                        {% else %}
                                                            {% if estadoaprobacion.estado == 3 %}
                                                                <li class="list-group-item list-group-item-success"
                                                                    style="padding: 1px 2px;text-align: left;background-color: #f2dede;">
                                                                    <strong>{{ estadoaprobacion.get_estado_display }}</strong>
                                                                </li>
                                                            {% else %}
                                                                <span class="label label-warning">{{ estadoaprobacion.get_estado_display }}</span>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                {% endif %}
                                            </th>
                                            <th>
                                                {% if tema.0.matricula.inscripcion.graduado %}
                                                    <li class="list-group-item"
                                                        style="padding: 1px 2px;text-align: center;background-color: #dff0d8;">
                                                        <strong>GRADUADO</strong></li>
                                                {% else %}
                                                    <li class="list-group-item"
                                                        style="padding: 1px 2px;text-align: left;background-color: #f2dede;">
                                                        <strong>NO GRADUADO</strong></li>
                                                {% endif %}
                                            </th>
                                            <th>
                                                {% if tema.0.estado_acta_firma == 1 %}
                                                    <li class="list-group-item btn-secondary"
                                                        style="padding: 1px 2px;text-align: left;background-color: rgba(152,186,220,0.31);">
                                                        <strong>{{ tema.0.get_estado_acta_firma_display }}</strong>
                                                    </li>
                                                {% endif %}

                                                {% if tema.0.estado_acta_firma == 2 %}
                                                    <li class="list-group-item btn-secondary"
                                                        style="padding: 1px 2px;text-align: left;background-color: rgba(152,186,220,0.31);">
                                                        <strong>{{ tema.0.get_estado_acta_firma_display }}</strong></li>

                                                {% endif %}

                                                {% if tema.0.estado_acta_firma == 3 %}
                                                    <li class="list-group-item btn-secondary"
                                                        style="padding: 1px 2px;text-align: left;background-color: rgba(152,186,220,0.31);">
                                                        <strong>{{ tema.0.get_estado_acta_firma_display }}</strong></li>

                                                {% endif %}

                                                {% if tema.0.estado_acta_firma == 4 %}

                                                    {% if  tema.0.estado_acta_firma == 4 %}
                                                        <li class="list-group-item btn-secondary"
                                                            style="padding: 1px 2px;text-align: left;background-color: #dff0d8;">
                                                            <strong>{{ tema.0.get_estado_acta_firma_display }}</strong>
                                                        </li>
                                                    {% else %}
                                                        <li class="list-group-item btn-secondary"
                                                            style="padding: 1px 2px;text-align: left;background-color: rgba(152,186,220,0.31);">
                                                            <strong>{{ tema.0.get_estado_acta_firma_display }}</strong>
                                                        </li>
                                                    {% endif %}


                                                {% endif %}


                                            </th>
                                            <th>
                                                {% if tema.0.actaaprobacionexamen %}
                                                    <a href="{{ tema.0.actaaprobacionexamen.url }}" target="_blank"
                                                       title="Acta de aprobación firmada"
                                                       class=" btn btn-primary btn-mini"><i class="fa fa-download"
                                                                                            aria-hidden="true"></i></a>
                                                    </th>
                                                {% endif %}
                                        </tr>
                                        </tbody>
                                    </table>

                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th>
                                                {% if tema.0.get_numero_acta_graduado %}
                                                    <li class="list-group-item list-group-item-success"
                                                        style="padding: 1px 2px;text-align: center;background-color: #dff0d8;">
                                                        N° Acta:
                                                        <strong>{{ tema.0.get_numero_acta_graduado }}</strong></li>
                                                {% endif %}
                                            </th>

                                        </tr>
                                        </thead>
                                    </table>
                                {% endwith %}
                            </ul>
                        </td>
                        <td style="text-align: justify;font-size: 10px;">
                            <li class="list-group-item list-group-item-success"
                                style="padding: 1px 2px;text-align: justify;">
                                {% if persona.usuario.is_superuser %}
                                    idTema:{{ tema.0.id }}{% endif %} {{ tema.0.propuestatema }}
                            </li>
                            <li class="list-group-item list-group-item-success"
                                style="padding: 1px 2px;text-align: justify;">
                                <strong>MECANISMO:</strong> {{ tema.0.mecanismotitulacionposgrado.get_mecanismo_posgrado }}
                            </li>
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>
                                        {% if tema.0.califico %}
                                            <li class="list-group-item list-group-item-success"
                                                style="padding: 1px 2px;text-align: center;background-color: #dff0d8;">
                                                <strong>ACTA CALIFICADA</strong></li>
                                        {% else %}
                                            <li class="list-group-item list-group-item-success"
                                                style="padding: 1px 2px;text-align: left;background-color: #f2dede;">
                                                <strong>ACTA NO CALIFICADA</strong></li>
                                        {% endif %}
                                    </th>
                                    <th>
                                        {% if tema.0.actacerrada %}
                                            <li class="list-group-item list-group-item-success"
                                                style="padding: 1px 2px;text-align: center;background-color: #dff0d8;">
                                                <strong>ACTA CERRADA</strong></li>
                                        {% else %}
                                            <li class="list-group-item list-group-item-success"
                                                style="padding: 1px 2px;text-align: left;background-color: #f2dede;">
                                                <strong>ACTA NO CERRADA</strong></li>
                                        {% endif %}
                                    </th>

                                </tr>

                                </thead>
                            </table>
                            <ul style="text-align: center;font-size: 9px;margin: 0 0 0px 0px;">
                                <li class="list-group-item list-group-item-success"
                                    style="padding: 4px 6px;text-align: center;background-color: #dff0d8;"><strong>Estado</strong>
                                </li>
                                {% if tema.0.estado_firmas_acta_graduado != None %}
                                    <li class="list-group-item list-group-item-success" style="padding: 4px 6px;">
                                    {% if  tema.0.get_firmado_por %}
                                            Firmado por:<br>
                                            {% for integrante in  tema.0.get_firmado_por %}
                                                <span class="label label-info tu"#}
                                                      title="Firmado">
                                                    {{ integrante }}
                                                </span>
                                            {% endfor %}
                                            <br>
                                             <button class="btn btn-primary btn-mini"  title="Historial de archivo"
                                                    onclick="formModal('{{ tema.0.id }}','HISTORIAL FIRMA ACTA DE GRADO','historial_firma_actas_de_grado')"
                                                    href="javascript:;"><i class="fa fa-clock-o"></i>
                                            </button>
                                             <a class="btn btn-default btn-sm btn-hover gallerypdf" data-fancybox-type="iframe" href="{{ tema.0.get_documento_informe.url }}"><img src="/static/images/pdf.png" width="18" height="18" align="absmiddle"></a></a><br>
                                        {% else %}
                                            <span class="label label-info tu" title="ACTA GENERADA">
                                                    GENERADO
                                                </span>

                                            <button class="btn btn-primary btn-mini"  title="Historial de archivo"
                                                    onclick="formModal('{{ tema.0.id }}','HISTORIAL FIRMA ACTA DE GRADO','historial_firma_actas_de_grado')"
                                                    href="javascript:;"><i class="fa fa-clock-o"></i>
                                            </button>
                                            <a class="btn btn-default btn-sm btn-hover gallerypdf" data-fancybox-type="iframe" href="{{ tema.0.get_documento_informe.url }}"><img src="/static/images/pdf.png" width="18" height="18" align="absmiddle"></a></a>
                                            <br>
{#                                            <a class="btn btn-default btn-sm btn-hover"#}
{#                                                    onclick="actagradoposgrado({{ tema.0.id }})"#}
{#                                                    href="javascript:;"#}
{#                                            ><img src="/static/images/pdf.png" width="18" height="18" align="absmiddle">#}
{#                                            </a>#}
                                        {% endif %}
                                </li>
                                {% else %}
                                    <span class="label label-default tu" title="PENDIENTE">
                                        POR GENERAR
                                    </span>
                                {% endif %}
                            </ul>
                        </td>
                        <td>
                            <ul style="text-align: justify;font-size: 9px;margin: 0 0 0px 0px;">
                                <li class="list-group-item list-group-item-success"
                                    style="padding: 4px 6px;text-align: center;background-color: #dff0d8;"><strong>Variables</strong>
                                </li>
                                <li class="list-group-item list-group-item-success" style="padding: 4px 6px;">

                                    <strong>Módulo: </strong> {{ tema.0.moduloreferencia }}
                                </li>
                                <li class="list-group-item list-group-item-success"
                                    style="padding: 4px 6px;;text-align: center;background-color: #d9edf7;"><strong>Linea/Sublinea</strong>
                                </li>
                                <li class="list-group-item list-group-item-success" style="padding: 4px 6px;">
                                    <strong>Linea: </strong> {{ tema.0.sublinea.linea.nombre }}
                                    <br>
                                    <strong>SubLinea: </strong> {{ tema.0.sublinea.nombre }}
                                </li>
                            </ul>
                        </td>
                        <td style="text-align: center">
                            <div class="btn-group">
                                <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span
                                        class="caret"></span></a>
                                <ul class="dropdown-menu pull-right" style="text-align: left">

                                    {% if  perms.sga.puede_gestionar_configuraciones_titulacion_posgrado %}
                                        {% if tema.0.estado_acta_firma == 4 and not tema.0.actacerrada %}
                                            <li><a class="calificaractaycerrarposgrado"
                                                   idtematitulacion="{{ tema.0.id }}"
                                                   notamaestrante="{{ tema.1|add:tema.2 |floatformat:"2" }}"
                                                   nommaestrante="{{ tema.0.matricula.inscripcion.persona.nombre_completo_inverso }}"
                                                   href="javascript:;"><i class="fa fa-graduation-cap"></i> Cerrar Acta
                                                y graduar</a></li>
                                        {% endif %}

                                        {% if tema.0.matricula.inscripcion.graduado and tema.0.califico  and tema.0.actacerrada %}
                                            <li><a class="bloqueo_pantalla"
                                                   href="/adm_configuracionpropuesta?action=editarnumeroactacomplexivo&id={{ tema.0.id }}"><i
                                                    class="fa fa-edit"></i> Editar número acta</a></li>
                                            <li><a onclick="generar_acta_grado({{ tema.0.id }})"
                                                   href="javascript:;"><i class="fa fa-file-pdf-o"></i> Generar acta de
                                                grado </a></li>
                                        {% endif %}
                                        <li><a onclick="actaaprobacionexamencomplexivo({{ tema.0.id }})"
                                               href="javascript:;"><i class="fa fa-file-pdf-o"></i> Formato acta de
                                            aprobación</a></li>

                                    {% endif %}
                                    {% if perms.sga.puede_calificar_ensayos_titulacion_posgrado or persona.usuario.is_superuser or  perms.sga.puede_gestionar_configuraciones_titulacion_posgrado %}
                                        {% if not tema.0.estado_acta_firma == 1 and  not tema.0.actacerrada %}
                                            <li>
                                                <a onclick="formModal('{{ tema.0.id }}','FIRMAR ACTA DE APROBACIÓN','firmar_acta_de_aprobacion')"
                                                   href="javascript:;"><i class="fa fa-check"></i> Firmar acta de
                                                    aprobación</a></li>
                                        {% endif %}

                                        <li>
                                            <a onclick="formModal('{{ tema.0.id }}','HISTORIAL FIRMAR ACTA DE APROBACIÓN','historial_firmar_acta_de_aprobacion')"
                                               href="javascript:;"><i class="fa fa-expand"></i> Historial firmar acta de
                                                aprobación</a></li>
                                    {% endif %}
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class='row-fluid'>
        <div class="span12">
            {% if paging.num_pages > 20 %}
                <div class='pagination'>
                    <ul>
                        {% if paging.primera_pagina %}
                            <li>
                                <a href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}&{% if search %}s={{ search }}&{% endif %}page=1">1</a>
                            </li>
                            <li>
                                <a href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}&{% if search %}s={{ search }}&{% endif %}page={{ paging.ellipsis_izquierda }}"
                                   class="active">...</a></li>
                        {% endif %}
                        {% for pagenumber in paging.paginas %}
                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a
                                    href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a>
                            </li>
                        {% endfor %}
                        {% if paging.ultima_pagina %}
                            <li>
                                <a href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}&{% if search %}s={{ search }}&{% endif %}page={{ paging.ellipsis_derecha }}"
                                   class="active">...</a></li>
                            <li>
                                <a href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}&{% if search %}s={{ search }}&{% endif %}page={{ paging.num_pages }}">{{ paging.num_pages }}</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            {% else %}
                <div class='pagination'>
                    <ul>
                        {% for pagenumber in paging.page_range %}
                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a
                                    href="/adm_configuracionpropuesta?action=graduarExamenComplexivo&idconfiguracion={{ configuracion.id }}&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>






{% endblock %}

{% extends "ajaxformbs.html" %}
{% load sga_extras %}
{% block extraheading %}
    <script>
        $(function(){
            {#var lista_items4= [];#}
            {#var itemstimerai = 1;#}
            {#var idfuncion = {{ funcionpac.id }};#}
            {#var numerodeperiodos = {{funcionpac.programapac.numeroperiodosordinario}};#}

            {#numeroperiodos = function () {#}
            {#    var nperiodo = document.getElementById('id_periodoacademico');#}
            {#    nperiodo.insertAdjacentHTML('beforebegin', 'Máx: '+numerodeperiodos);#}
            {#    var ultimoValorValido = $("#id_periodoacademico").val();;#}
            {#    $("#id_periodoacademico").on("change", function() {#}
            {#      if ($("#id_periodoacademico option:checked").length > numerodeperiodos) {#}
            {#        $("#id_periodoacademico").val(ultimoValorValido);#}
            {#        $("#id_periodoacademico").change();#}
            {#      } else {#}
            {#        ultimoValorValido = $("#id_periodoacademico").val();#}
            {#      }#}
            {#    });#}
            {#;#}

            $("#id_objetivogeneral , #id_objetivoespecifico  ,#id_perfilingreso  ,#id_requisitoingreso  ,#id_aprobaciontrabajo, #id_perfilprofesional ,#id_requisitotitulacion ,#id_descripcionintegracioncurricular ,#id_pertinencia ,#id_objetoestudio  ,#id_metodologiaambiente ").addClass("validate[required]");

            {#adicionar_det = function(ocultar) {#}
            {#    var asignaturarai = $("#id_asignatura option:selected").text();#}
            {#    var idasignaturarai = $("#id_asignatura").val();#}
            {#    var periodoacademico = $("#id_periodoacademico option:selected").text();#}
            {#    var idperiodoacademico = $("#id_periodoacademico").val();#}
            {#    var itinerariorai = $("#id_itinerariomencion").val();#}
            {#    var unidadrai = $("#id_unidadorganizacioncurricular option:selected").text();#}
            {#    var idunidadrai = $("#id_unidadorganizacioncurricular").val();#}
            {##}
            {#    if (idasignaturarai == '' || itinerariorai == '' ||  idunidadrai == 0 ||  idperiodoacademico == '') {#}
            {#        $("#itemspanelrai .incompletorai").show();#}
            {#        return false;#}
            {#    }#}
            {#    $("#itemspanelrai").modal("hide");#}
            {#    $.ajax({#}
            {#        type: "POST",#}
            {#        url: "/adm_pac",#}
            {#        data: {'action': 'additemdetallefuncionsustantiva', 'asignatura': idasignaturarai, 'periodoacademico': idperiodoacademico.toString() , 'itinerario':itinerariorai, 'unidad':idunidadrai, 'idfuncion': idfuncion },#}
            {#        error: function() {#}
            {#            $.unblockUI();#}
            {#            smoke.alert("Error al obtener los datos.");#}
            {#        },#}
            {#        success: function(data) {#}
            {#            if (data.result == "ok") {#}
            {#                $("#itemsbodyrai").append('<tr id="filarai_'+data.codigoinformedet+'">' +#}
            {#                    '<td style="text-align: left" ><input type="hidden" class="detallerai" value="'+idasignaturarai+'"/><div class="" id="columnrai' + data.codigoinformedet + '">' + asignaturarai + '</td></div>' +#}
            {#                    '<td style="text-align: left" ><input type="hidden" class="detallerai0" value="'+idperiodoacademico+'"/><div class="" id="columnrai0' + itemstimerai + '"><span class="label label-info">'+ periodoacademico +'</span></td></div>' +#}
            {#                    '<td style="text-align: center" ><div class="detallerai1" id="columnrai1' + data.codigoinformedet + '">' + itinerariorai + '</td></div>' +#}
            {#                    '<td style="text-align: center" ><input type="hidden" class="detallerai2" value="'+idunidadrai+'"/><div class="" id="columnrai2' + data.codigoinformedet + '">' + unidadrai + '</td></div>' +#}
            {#                    '<td style="text-align: center">' +#}
            {#                    '<a href="javascript:;" class="btn btn-tini btn-danger eliminarrai tu" idrai='+data.codigoinformedet+' title="Eliminar"><i class="fa fa-remove"></i></a>' +#}
            {#                    '</td>' +#}
            {#                    '</tr>');#}
            {##}
            {#                tooltips();#}
            {#                conectar_controlesrai();#}
            {#                $.unblockUI();#}
            {#            } else {#}
            {#                $.unblockUI();#}
            {#                smoke.alert(JSON.stringify(data));#}
            {#            }#}
            {#        }#}
            {#    });#}
            {#;#}
            {##}
            {#conectar_controlesrai = function () {#}
            {#    $(".eliminarrai").unbind();#}
            {#    $(".eliminarrai").click(function () {#}
            {#        bloqueointerface();#}
            {#        $.ajax({#}
            {#            type: "POST",#}
            {#            url: "/adm_pac",#}
            {#            data: {'action': 'itemdetallefuncionsustantiva', 'id': $(this).attr('idrai') },#}
            {#            error: function () {#}
            {#                $.unblockUI();#}
            {#                smoke.alert("Error al obtener los datos.");#}
            {#            },#}
            {#            success: function (data) {#}
            {#                $.unblockUI();#}
            {#                if (data.result == "ok") {#}
            {#                    $('#leyendarai').html(data.descripcion)#}
            {#                    $('#idcodigorai').val(data.codigorai)#}
            {#                    $('#selectdeleterai').modal({'width': 800}).modal('show');#}
            {#                } else {#}
            {#                    smoke.alert(data.mensaje);#}
            {#                }#}
            {#            }#}
            {#        });#}
            {#    });#}
            {#;#}
            {##}
            {#$("#cerrarraiedit").click(function() {#}
            {#    $("#itemspanelraiedit .incompletoraiedit").hide();#}
            {#    $("#itemspanelraiedit .incompletovaloresraiedit").hide();#}
            {#    $("#itemspanelraiedit").modal("hide");#}
            {#);#}
            {##}
            {#$("#adicionarycerrarraiedit").click(function() {#}
            {#    adicionar_raiedit()#}
            {#);#}
            {##}
            {#$("#adicionarycerrarrai").click(function() {#}
            {#    adicionar_det()#}
            {#);#}
            {##}
            {#$("#itemsadicionarrai").click(function() {#}
            {#    numeroperiodos();#}
            {#    $("#id_asignatura").val(0);#}
            {#    $('#id_asignatura').change();#}
            {#    $("#id_periodoacademico").val(0);#}
            {#    $('#id_periodoacademico').change();#}
            {#    $("#id_itinerariomencion").val('');#}
            {#    $("#id_unidadorganizacioncurricular").val(0);#}
            {#    $('#id_unidadorganizacioncurricular').change();#}
            {#    $("#alertaingreso").hide();#}
            {#    $("#itemspanelrai .incompletorai").hide();#}
            {#    $("#itemspanelrai .incompletovaloresrai").hide();#}
            {#    $("#adicionarycerrarrai").show();#}
            {#    $("#guardar").hide();#}
            {#    $("#itemspanelrai").modal({backdrop:'static', width: '500px'}).modal('show');#}
            {#    return false;#}
            {#);#}
            {##}
            {#$("#cerrarrai").click(function() {#}
            {#    $("#itemspanelrai .incompletorai").hide();#}
            {#    $("#itemspanelrai .incompletovaloresrai").hide();#}
            {#    $("#itemspanelrai").modal("hide");#}
            {#);#}
            {##}
            {#$(".eliminarrai").click(function () {#}
            {#    bloqueointerface();#}
            {#    $.ajax({#}
            {#        type: "POST",#}
            {#        url: "/adm_pac",#}
            {#        data: {'action': 'itemdetallefuncionsustantiva', 'id': $(this).attr('idrai') },#}
            {#        error: function () {#}
            {#            $.unblockUI();#}
            {#            smoke.alert("Error al obtener los datos.");#}
            {#        },#}
            {#        success: function (data) {#}
            {#            $.unblockUI();#}
            {#            if (data.result == "ok") {#}
            {#                $('#leyendarai').html(data.descripcion)#}
            {#                $('#idcodigorai').val(data.codigorai)#}
            {#                $('#selectdeleterai').modal({'width': 800}).modal('show');#}
            {#            } else {#}
            {#                smoke.alert(data.mensaje);#}
            {#            }#}
            {#        }#}
            {#    });#}
            {#);#}
            {##}
            {#$("#eliminacionmodalrai_formbutton").click(function(){#}
            {#    $('#selectdeleterai').modal('hide');#}
            {#    var filarai = ''#}
            {#    filarai = 'filarai_'+ $('#idcodigorai').val()#}
            {#    $.ajax({#}
            {#        type: "POST",#}
            {#        url: "/adm_pac",#}
            {#        data: {'action': 'eliminaritemdetallefuncionsustantiva', 'idcodigodet': $('#idcodigorai').val()},#}
            {#        error: function () {#}
            {#            $.unblockUI();#}
            {#            smoke.alert("Error al obtener los datos.");#}
            {#        },#}
            {#        success: function (data) {#}
            {#            if (data.result == "ok") {#}
            {#                $('#'+filarai).remove();#}
            {#            } else {#}
            {#                smoke.alert(data.mensaje);#}
            {#            }#}
            {#            $.unblockUI();#}
            {#        }#}
            {#    });#}
            {#);#}
            {#$("#eliminacionmodalrai_cancel").click(function(){#}
            {#    $('#selectdeleterai').modal('hide');#}
            {#);#}

        });
    </script>
{% endblock %}
{% block atras %}/adm_pac?action=addpac&idprograma={{funcionpac.programapac.id|encrypt}}&idfuncion={{funcionpac.id|encrypt}}{% endblock %}
{% block titulo %}{{ title }}{% endblock %}
{% block formaction %}/adm_pac?action=addpac&idfuncion={{funcionpac.id|encrypt}}{% endblock %}
{% block formdestination %}/adm_pac?action=addpac&idprograma={{funcionpac.programapac.id|encrypt}}&idfuncion={{funcionpac.id|encrypt}}{% endblock %}
{% block formextra %}
    <input type='hidden' name='action' value='editfuncionsustantiva'/>
{#    <input type='hidden' name='preguntasrespuestaspac' id="preguntasrespuestaspac"/>#}
    <input type='hidden' name='id' value='{{ funcionpac.id|encrypt }}'/>
{% endblock %}
{% block formback %}/adm_pac?action=addpac&idprograma={{funcionpac.programapac.id|encrypt}}&idfuncion={{funcionpac.id|encrypt}}{% endblock %}
{% block moreblock %}

{% endblock %}
{#{% block formsuffix %}#}
{#    <fieldset class="control-group nomargins" style="float: left; width: 100%">#}
{#        <div class="controls">#}
{#            <table class='table table-bordered' cellpadding="0" cellspacing="0">#}
{#                <label style="padding-right: 20px">Descripción microcurricular de la carrera/programa:</label>#}
{#                <thead>#}
{#                <tr>#}
{#                    <th style="text-align: center" width="30%">Nombre de la asignatura</th>#}
{#                     <th style="text-align: center" width="30%">Periodo Académico (Nivel)</th>#}
{#                    <th style="text-align: center" width="20%">Nombre del Itinerario/Mención</th>#}
{#                    <th style="text-align: center" width="30%">Unidad de organización curricular</th>#}
{#                    <th style="text-align: center" width="10%"> <a href="javascript:;" id="itemsadicionarrai" class="btn btn-success btn-mini"><span class="fa fa-plus"></span></a></th>#}
{#                </tr>#}
{#                </thead>#}
{#                <tbody id="itemsbodyrai" class="datatable">#}
{#                {% for lisdet in detfuncionpac %}#}
{#                    <tr id="filarai_{{ lisdet.id }}">#}
{#                        <td style='text-align: left'><div id="columnrai{{ lisdet.id }}">{{ lisdet.asignatura }}</div></td>#}
{#                        <td style='text-align: left'><div id="columnrai{{ lisdet.id }}">#}
{#                            {% for opc in lisdet.periodoacademico.all %}#}
{#                                    <span class="label label-info">{{ opc }}</span>#}
{#                            {% endfor %}#}
{#                        </div>#}
{#                        </td>#}
{#                        <td style='text-align: center'><div id="columnrai1{{ lisdet.id }}">{{ lisdet.itinerariomencion }}</div></td>#}
{#                        <td style='text-align: center'><div id="columnrai2{{ lisdet.id }}">#}
{#                        {% if lisdet.unidadorganizacioncurricular == 1 %}#}
{#                            UNIDAD BÁSICA#}
{#                        {% elif lisdet.unidadorganizacioncurricular == 2 %}#}
{#                            UNIDAD PROFESIONAL#}
{#                        {% elif lisdet.unidadorganizacioncurricular == 3 %}#}
{#                            UNIDAD DE TITULACIÓN#}
{#                        {% endif %}#}
{#                        </div></td>#}
{##}
{#                        <td style='text-align: center'>#}
{#<!--                            <a href='javascript:;' class='btn btn-tini btn-info editrai tu' id="adicionarraiedit{{ lisdet.id }}" onclick="editrai({{ lisdet.id }})"  title='Editar'><i class='fa fa-edit'></i></a>-->#}
{#                            <a href='javascript:;' class='btn btn-tini btn-danger eliminarrai tu' idrai="{{ lisdet.id }}" title='Eliminar'><i class='fa fa-remove'></i></a>#}
{#                        </td>#}
{#                    </tr>#}
{#                {% endfor %}#}
{#                </tbody>#}
{#                <tfoot>#}
{#                </tfoot>#}
{#            </table>#}
{#        </div>#}
{#    </fieldset>#}
{#    <div class="modal fade static" id="selectdeleterai" style="min-height: 60px">#}
{#        <div class="modal-header">#}
{#            <h4 id="paneltitle">Eliminar detalle</h4>#}
{#        </div>#}
{#        <div class="modal-body" id="selectdeletepar-body">#}
{#            <input type='hidden' id="idcodigorai" name="idcodigorai" value=""/>#}
{#            <p style="margin-top: 10px;">Esta seguro(a) que desea eliminar: <b id="leyendarai"></b></p>#}
{#        </div>#}
{#        <div class="modal-footer">#}
{#            <p style="text-align: right; margin-bottom: 0">#}
{#                <a href="javascript:;" id="eliminacionmodalrai_formbutton" class='btn btn-danger btn-form'>Eliminar</a>#}
{#                <a href="javascript:;" id="eliminacionmodalrai_cancel" class="btn btn-info"> Cerrar</a>#}
{#            </p>#}
{#        </div>#}
{#    </div>#}

{#{% endblock %}#}
{#{% block extraalerts %}#}
{#    <div class="modal fade static" id="itemspanelrai" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h3 class="paneltitle">Adicionar descripción microcurricular de la carrera/programa</h3>#}
{#        </div>#}
{#        <div class="modal-body panelbody">#}
{#            <div class="alert alert-info incompletorai" style="display: none;">#}
{#                <i class="fa fa-info-sign"></i> Complete todos los campos para continuar#}
{#            </div>#}
{#            <div class="alert alert-danger" id="incompletovaloresrai" style="display: none;">#}
{#                <i class="fa fa-info-sign"></i> --#}
{#            </div>#}
{#            <div class="alert alert-danger" id="alertaingresorai" style="display: none;"> --</div>#}
{#            <div class="row-fluid">#}
{#                <form id="formulario2" class='form-vertical' action="" method="POST" >#}
{#                    {{ formdetalle }}#}
{#                </form>#}
{#            </div>#}
{#        </div>#}
{#        <div class="modal-footer">#}
{#            <a href="javascript:;" class="btn btn-success" id="adicionarycerrarrai"><i class="fa fa-plus"></i> Adicionar</a>#}
{#            <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarrai">Cerrar</a>#}
{#        </div>#}
{#    </div>#}
{#{% endblock %}#}

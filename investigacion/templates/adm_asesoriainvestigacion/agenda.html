{% load sga_extras %}
<style>
    .arrow-rigth {
        position: relative;
        margin-right: 70%;
        margin-left: 30%;
    }

    .arrow-rigth:before {
        content: " ";
        position: absolute;
        z-index: 2;
        left: 0;
        width: 10px;
        height: 10px;
        bottom: 14px;
        -webkit-transform: rotate(45deg);
        transform: rotate(45deg);
        border-top: 3px solid #1B5082;
        border-right: 3px solid #1B5082;
        background: transparent;
    }

    .arrow-left {
        position: relative;
        margin-right: 50%;
        margin-left: 50%;
    }

    .arrow-left:before {
        content: " ";
        position: absolute;
        z-index: 2;
        left: 0;
        width: 10px;
        height: 10px;
        bottom: 14px;
        -webkit-transform: rotate(-140deg);
        transform: rotate(-140deg);
        border-top: 3px solid #1B5082;
        border-right: 3px solid #1B5082;
        background: transparent;
    }
    .color-fondo-finalizado {
        background-color: #a9ffa3;
    }

    .color-fondo-pendiente {
        background-color: #fdff78;
    }

    .color-fondo-pendiente-2 {
        background-color: #ffc138;
    }

    .color-fondo-sin-gestionar {
        background-color: #ffc3c8;
    }

    .color-fondo-disponible {
        background-color: #a9ffa3;
    }

    .card{
        cursor: default;
    }

    .containerMenu > * {
        grid-column: col-start / span 12;
    }

    .menuPanelCard {
        list-style: none;
        margin: 0em !important;
        padding: 0px !important;
        padding-left: 10px !important;
        padding-right: 10px !important;
        display: grid;
        grid-gap: 2px;
        grid-template-columns: repeat(auto-fill, minmax(13%, 1fr));
    }

    @media only screen and (max-width: 750px) {
        .menuPanelCard {
            grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
        }
    }

    @media only screen and (max-width: 1020px) and (min-width: 751px) {
        .menuPanelCard {
            grid-template-columns: repeat(auto-fill, minmax(31%, 1fr));
        }
    }
</style>
<script type="text/javascript">
    $(function(){
        $('[data-bs-toggle="tooltip"]').tooltip();

        $('[data-bs-toggle="tooltip"]').on('click', function () {
            $(this).tooltip('hide');
        });

        $(".cambiarsemana").click(function() {
            let idgest = $(this).attr('idg');
            let idserv = $(this).attr('ids');
            let idresp = $(this).attr('idr');
            let estado = $(this).attr('est');
            let anio = $(this).attr('anio');
            let semana = $(this).attr('sem');
            let tm = $(this).attr('tm');
            let tv = $(this).attr('tv');
            cargarAgenda(idgest, idserv, idresp, estado, anio, semana, tv, tm);
        });

        $(".informacioncita").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'informacioncita', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitleinformacioncita").html(data.title);
                        $(".panelbodyinformacioncita").html(data.data);
                        $("#itemspanelinformacioncita").modal({backdrop:'static'}).modal('show');
                    } else {
                        mensajeErrorSwal("No se puede consultar", data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $(".agregarcita").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'addcita', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitleaddcita").html(data.title);
                        $(".panelbodyaddcita").html(data.data);
                        $("#itemspaneladdcita").modal({backdrop:'static'}).modal('show');
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $("#itemspaneladdcita .guardar").click(function () {
            enviarFormulario("/adm_asesoriainvestigacion", "addcita");
            return false;
        });

        $(".finalizaractividad").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'finalizaractividad', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitlefinalizaractividad").html(data.title);
                        $(".panelbodyfinalizaractividad").html(data.data);
                        $("#itemspanelfinalizaractividad").modal({backdrop:'static'}).modal('show');
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $("#itemspanelfinalizaractividad .guardar").click(function () {
            enviarFormulario("/adm_asesoriainvestigacion", "finalizaractividad");
            return false;
        });

        $(".asesoriaorigen").click(function() {
            let id = $(this).attr('id');
            let ida = $(this).attr('idase');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'asesoriaorigen', 'id': id, 'ida': ida},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitleinformacioncita").html(data.title);
                        $(".panelbodyinformacioncita").html(data.data);
                        $("#itemspanelinformacioncita").modal({backdrop:'static'}).modal('show');
                    } else {
                        mensajeErrorSwal("No se puede consultar", data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $(".cancelarcita").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'cancelarcita', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitlecancelarcita").html(data.title);
                        $(".panelbodycancelarcita").html(data.data);
                        $("#itemspanelcancelarcita").modal({backdrop:'static'}).modal('show');
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $("#itemspanelcancelarcita .guardar").click(function () {
            enviarFormulario("/adm_asesoriainvestigacion", "cancelarcita");
            return false;
        });

        $(".eliminar").click(function() {
            let id = $(this).attr('id');
            let titulo = $(this).attr('titulo');
            let url = "/adm_asesoriainvestigacion";
            let action = "delcita";
            let urlDestino = "/adm_asesoriainvestigacion";

            mensajeConfirmSwal("Eliminar Registro de Agenda", "¿Está seguro de eliminar la cita "+titulo+"?", true, url, action, id, urlDestino);
        });

        $(".finalizaractividaddia").click(function() {
            let fecha = $(this).attr('fecha');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'finalizaractividaddia', 'fecha': fecha},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitlefinalizaractividaddia").html(data.title);
                        $(".panelbodyfinalizaractividaddia").html(data.data);
                        $("#itemspanelfinalizaractividaddia").modal({backdrop:'static'}).modal('show');
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $("#itemspanelfinalizaractividaddia .guardar").click(function () {
            enviarFormulario("/adm_asesoriainvestigacion", "finalizaractividaddia");
            return false;
        });

        $(".anexoscita").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'anexoscita', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitleanexoscita").html(data.title);
                        $(".panelbodyanexoscita").html(data.data);
                        $("#itemspanelanexoscita").modal({backdrop:'static'}).modal('show');
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $("#itemspanelanexoscita .guardar").click(function () {
            enviarFormulario("/adm_asesoriainvestigacion", "subiranexos");
            return false;
        });

        $(".gestionarasesoria").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'gestionarasesoria', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        location.href = `/adm_asesoriainvestigacion?action=gestionarcita&id=${id}`;
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $(".cambioresponsable").click(function() {
            let id = $(this).attr('id');
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_asesoriainvestigacion",
                data: {'action': 'cambioresponsable', 'id': id},
                success: function(data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $(".paneltitlecambioresponsable").html(data.title);
                        $(".panelbodycambioresponsable").html(data.data);
                        $("#itemspanelcambioresponsable").modal({backdrop:'static'}).modal('show');
                    } else {
                        if(data.swalType === 'warning')
                            mensajeWarningSwal(data.titulo, data.mensaje);
                        else
                            mensajeErrorSwal(data.titulo, data.mensaje);
                    }
                },
                error: function() {
                    $.unblockUI();
                    mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                },
                dataType: "json"
            });
        });

        $("#itemspanelcambioresponsable .guardar").click(function () {
            enviarFormulario("/adm_asesoriainvestigacion", "cambioresponsable");
            return false;
        });


    });
</script>

<div class="form-row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xxl-5">
    <div class="col pe-2 pt-0">
        <div class="calendar">
            <div class="calendar__info">
                <div class="calendar__prev rounded-start" data-bs-toggle="tooltip" title="Anterior" style="height: 30px">
                    <a class="cambiarsemana" tv="{{ tipovista }}" tm="ant" idg="{{ idgest }}" ids="{{ idserv }}" idr="{{ idresp }}" est="{{ estado }}" anio="{{ anio }}" sem="{{ semana }}" style="width: 100%; height: 100%" href="javascript:;"><i class="arrow-left"></i></a>
                </div>
                <div class="calendar__month" style="height: 30px">{{ titulosemana }}</div>
                <div class="calendar__next rounded-end" data-bs-toggle="tooltip" title="Siguiente" style="height: 30px">
                    <a class="cambiarsemana" tv="{{ tipovista }}" tm="sig" idg="{{ idgest }}" ids="{{ idserv }}" idr="{{ idresp }}" est="{{ estado }}" anio="{{ anio }}" sem="{{ semana }}" style="width: 100%; height:100%" href="javascript:;"><i class="arrow-rigth"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row task-kanban-container">
    <div class="col-lg-12 p-0">
        <div class="containerMenu">
            <div class="menuPanelCard">
                <!-- DIA -->
                {% for dia in calendario %}
                    <div class="d-flex">
                        <div class="card shadow-none rounded-3 d-inline-block align-top task-card todo" style="width: 100%;">
                            <div class="card-body p-2 border-top border-6 rounded-3 border-dark-info" id="dia{{ forloop.counter }}">
                                <div class="text-center">
                                    <h5 class="mb-2">
                                        {{ dia.dia }}
                                        {% if dia.mostrarmenu == 'S' %}
                                            &nbsp;
                                            <a class="text-black" href="javascript:;" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-ellipsis-v" data-bs-toggle="tooltip" title="Acciones" aria-hidden="true"></i></a>
                                            <div class="dropdown-menu">
                                                <li class="dropdown-item"><a class="finalizaractividaddia" fecha="{{ dia.fecha|date:"Y-m-d" }}" href="javascript:;"><i class="fa fa-calendar-check-o"></i> Finalizar Actividades Gestión del día</a></li>
                                            </div>
                                        {% endif %}
                                    </h5>
                                </div>
                                <div class="task-list">
                                    <div class="task-kanban">
                                        <div id="progress" style="height: 100%;">
                                            <!-- HORARIO DEL DIA -->
                                            {% for hora in dia.detalles %}
                                                {% if hora.estado == 'NDI' %}
                                                    <!-- NO DISPONIBLE -->
                                                    <div class="card mb-1 text-center text-white bg-secondary border-secondary">
                                                        <div class="card-header bg-secondary p-2">
                                                            <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-ban" data-bs-toggle="tooltip" title="No disponible" aria-hidden="true"></i></b>
                                                        </div>
                                                        <div class="card-body pt-2">
                                                            <h6 class="card-title">&nbsp;<br>&nbsp;</h6>
                                                            <p class="card-text"><b>No<br>Disponible</b></p>
                                                            <p></p>
                                                            {% if tipovista != 'RS' %}
                                                                <p>&nbsp;</p>
                                                                <p>&nbsp;</p>
                                                            {% endif %}
                                                            <span class="btn-icon btn-sm">
                                                                <a class="fa fa-list-alt text-muted" aria-hidden="true"></a>
                                                            </span>
                                                            <p class="m-2">
                                                                &nbsp;<br>&nbsp;<br>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <!-- NO DISPONIBLE -->
                                                {% elif hora.estado == 'LIB' %}
                                                    <!-- HORA LIBRE -->
                                                    {% if hora.horacompleta == 'S' %}
                                                        <div class="card mb-1 text-center text-success border-success">
                                                            <div class="card-header p-2">
                                                                <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-calendar-o" data-bs-toggle="tooltip" title="Libre" aria-hidden="true"></i></b>
                                                            </div>
                                                            <div class="card-body pt-2">
                                                                {% if tipovista == 'CI' %}
                                                                    <p class="card-text">{{ hora.gestion|title }}</p>
                                                                {% endif %}
                                                                <h6 class="card-title">{{ hora.servicio|safe }}</h6>
                                                                <p class="card-text"><b>{{ hora.solicitante|safe }}</b></p>
                                                                {% if tipovista == 'CI' or tipovista == 'RG' %}
                                                                    <h6 class="card-title">{{ hora.responsable|truncatechars:30|title }}</h6>
                                                                {% endif %}
                                                                <span class="btn-icon btn-sm">
                                                                    <a class="fa fa-list-alt text-muted" aria-hidden="true"></a>
                                                                </span>
                                                                <p class="m-1">
                                                                    <span class="badge bg-warning">Por Definir</span>
                                                                </p>
                                                                {% if tipovista != 'SL' %}
                                                                    <a href="javascript:;" class="btn btn-success agregarcita" id="{{ hora.idhorario|encrypt }}"><i class="fa fa-plus"></i> Agregar</a>
                                                                {% else %}
                                                                    <a href="javascript:;" class="btn btn-light"><i class="fa fa-plus"></i> Agregar</a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    {% else %}
                                                        <div class="card mb-1 text-center text-success border-success">
                                                            <div class="card-header p-2">
                                                                <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-calendar-o" data-bs-toggle="tooltip" title="Libre" aria-hidden="true"></i></b>
                                                            </div>
                                                            <div class="card-body pt-0">
                                                                {% if tipovista == 'CI' %}
                                                                    <p class="card-text" data-bs-toggle="tooltip" title="{{ hora.gestion }}">{{ hora.abreviaturagest|title }}</p>
                                                                {% endif %}
                                                                <h6 class="card-title mb-0" data-bs-toggle="tooltip" title="{{ hora.servicio }}">{{ hora.abreviaturaserv|safe|title }}</h6>
                                                                <span class="mt-0 mb-0" data-bs-toggle="tooltip" title="{{ hora.solicitante|safe }}"><b>{{ hora.solicitante|truncatechars:15|title }}</b></span>
                                                                {% if tipovista == 'CI' or tipovista == 'RG' %}
                                                                    <h6 class="card-title" data-bs-toggle="tooltip" title="{{ hora.responsable }}">{{ hora.responsable|truncatechars:10|title }}</h6>
                                                                {% endif %}
                                                                {% if tipovista != 'SL' %}
                                                                    <a href="javascript:;" class="btn btn-success agregarcita" id="{{ hora.idhorario|encrypt }}"><i class="fa fa-plus"></i> Agregar</a>
                                                                {% else %}
                                                                    <a href="javascript:;" class="btn btn-light"><i class="fa fa-plus"></i> Agregar</a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    <!-- HORA LIBRE -->
                                                {% elif hora.estado == 'PEN' %}
                                                    <!-- HORA AGENDADA Y PENDIENTE -->
                                                    {% if hora.horacompleta == 'S' %}
                                                        <div class="card mb-1 text-center {% if hora.fechapasada == 'N' %}border-warning color-fondo-pendiente{% if hora.tipo == 2 %}-2{% endif %}{% else %}border-danger color-fondo-sin-gestionar{% endif %}">
                                                            <div class="card-header {% if hora.fechapasada == 'N' %}color-fondo-pendiente{% if hora.tipo == 2 %}-2{% endif %}{% else %}color-fondo-sin-gestionar{% endif %} p-2">
                                                                <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-hourglass-2" data-bs-toggle="tooltip" title="Pendiente" aria-hidden="true"></i></b>
                                                            </div>
                                                            <div class="card-body pt-2">
                                                                {% if tipovista == 'CI' %}
                                                                    <p class="card-text">{{ hora.gestion|title }}</p>
                                                                {% endif %}
                                                                <h6 class="card-title">{{ hora.servicio|title|safe }}</h6>
                                                                <p class="card-text">{{ hora.solicitante|truncatechars:30|title }}</p>
                                                                {% if tipovista == 'CI' or tipovista == 'RG' %}
                                                                    <h6 class="card-title">{{ hora.responsable|truncatechars:30|title }}</h6>
                                                                {% endif %}
                                                                <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Mostrar Información">
                                                                    <a href="javascript:;" class="fa fa-list-alt informacioncita" id="{{ hora.id|encrypt }}" aria-hidden="true"></a>
                                                                </span>
                                                                {% if hora.asesoriaorigen %}
                                                                    <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Mostrar Asesoría Origen">
                                                                        <a href="javascript:;" class="fa fa-tags asesoriaorigen" id="{{ hora.id|encrypt }}" idase="{{ hora.asesoriaorigen.id|encrypt }}" aria-hidden="true"></a>
                                                                    </span>
                                                                {% endif %}
                                                                <p class="m-1">
                                                                    <span class="badge bg-primary">{{ hora.modalidad|title }}</span>
                                                                </p>
                                                                {% with puedegestionar=hora.cita|args:persona|call:"puede_gestionar" puedeiniciar=hora.cita|args:persona|call:"puede_iniciar_reunion" puedereagendar=hora.cita|args:persona|call:"puede_reagendar" puedederivar=hora.cita|args:persona|call:"puede_derivar" puedeeliminar=hora.cita|args:persona|call:"puede_eliminar" puedecancelar=hora.cita|args:persona|call:"puede_cancelar" %}
                                                                    {% if tipovista != 'SL' %}
                                                                        {% if puedegestionar or puedeiniciar or puedereagendar or puedederivar or puedeeliminar or puedecancelar %}
                                                                            <div class="btn-group">
                                                                                <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user-cog"></i> Gestionar <i class="fa fa-angle-down"></i></button>
                                                                                <div class="dropdown-menu">
                                                                                    {% if puedegestionar %}
                                                                                        {% if hora.mostrarmodalgest == 'N' %}
                                                                                            <li class="dropdown-item"><a class="gestionarasesoria" id="{{ hora.id|encrypt }}" href="javascript:;"><i class="fa fa-group"></i>&nbsp;Gestionar Cita</a></li>
                                                                                        {% else %}
                                                                                            <li class="dropdown-item"><a class="finalizaractividad" id="{{ hora.id|encrypt }}" href="javascript:;"><i class="fa fa-check-circle"></i> Finalizar</a></li>
                                                                                        {% endif %}
                                                                                    {% endif %}
                                                                                    {% if puedeiniciar %}
                                                                                        {% if hora.urlservirtual %}
                                                                                            <a class="dropdown-item" href="{{ hora.urlservirtual }}" target="_blank"><i class="fa fa-chalkboard"></i>&nbsp;Iniciar Reunión</a>
                                                                                        {% else %}
                                                                                            <a class="dropdown-item disabled" href="javascript:;"><i class="fa fa-chalkboard"></i>&nbsp;Iniciar Reunión</a>
                                                                                        {% endif %}
                                                                                    {% endif %}
                                                                                    {% if puedereagendar %}
                                                                                        <a class="dropdown-item reporteparticipante" href="/adm_asesoriainvestigacion?action=reagendarcita&id={{ hora.id|encrypt }}"><i class="fa fa-calendar"></i>&nbsp;Reagendar Cita</a>
                                                                                    {% endif %}
                                                                                    {% if puedederivar %}
                                                                                        <a class="dropdown-item reporteparticipante" href="/adm_asesoriainvestigacion?action=derivarcita&id={{ hora.id|encrypt }}"><i class="fa fa-share-alt"></i>&nbsp;Derivar Cita</a>
                                                                                    {% endif %}
                                                                                    {% if puedecancelar %}
                                                                                        <li class="dropdown-item"><a class="cancelarcita" id="{{ hora.id|encrypt }}" href="javascript:;"><i class="fa fa-ban"></i> Cancelar</a></li>
                                                                                    {% endif %}
                                                                                    {% if puedeeliminar %}
                                                                                        <div class="dropdown-divider"></div>
                                                                                        <li class="dropdown-item"><a class="eliminar" id="{{ hora.id|encrypt }}" titulo=" para el servicio <b>{{ hora.servicio }}</b> solicitado por <b>{{ hora.solicitante }}</b> para el <b>{{ hora.cita.fecha|date:"d-m-Y" }}</b> eh horario de <b>{{ hora.horaini }} - {{ hora.horafin }}</b>" href="javascript:;"><i class="fa fa-remove"></i> Eliminar</a></li>
                                                                                    {% endif %}
                                                                                </div>
                                                                            </div>
                                                                        {% else %}
                                                                            <a href="javascript:;" class="btn btn-light"><i class="fa fa-user-cog"></i> Gestionar <i class="fa fa-angle-down"></i></a>
                                                                        {% endif %}
                                                                    {% else %}
                                                                        <a href="javascript:;" class="btn btn-light"><i class="fa fa-user-cog"></i> Gestionar <i class="fa fa-angle-down"></i></a>
                                                                    {% endif %}
                                                                {% endwith %}
                                                            </div>
                                                        </div>
                                                    {% else %}
                                                        <div class="card mb-1 text-center {% if hora.fechapasada == 'N' %}border-warning color-fondo-pendiente{% if hora.tipo == 2 %}-2{% endif %}{% else %}border-danger color-fondo-sin-gestionar{% endif %}">
                                                            <div class="card-header {% if hora.fechapasada == 'N' %}color-fondo-pendiente{% if hora.tipo == 2 %}-2{% endif %}{% else %}color-fondo-sin-gestionar{% endif %} p-2">
                                                                <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-hourglass-2" data-bs-toggle="tooltip" title="Pendiente" aria-hidden="true"></i></b>
                                                            </div>
                                                            <div class="card-body pt-0">
                                                                {% if tipovista == 'CI' %}
                                                                    <p class="card-text" data-bs-toggle="tooltip" title="{{ hora.gestion }}">{{ hora.abreviaturagest|title }}</p>
                                                                {% endif %}
                                                                <h6 class="card-title mb-0" data-bs-toggle="tooltip" title="{{ hora.servicio }}">{{ hora.abreviaturaserv|title }}</h6>
                                                                <span class="mt-0 mb-0" data-bs-toggle="tooltip" title="{{ hora.solicitante|safe }}">{{ hora.solicitante|truncatechars:15|title }}</span>
                                                                {% if tipovista == 'CI' or tipovista == 'RG' %}
                                                                    <h6 class="card-title" data-bs-toggle="tooltip" title="{{ hora.responsable }}">{{ hora.responsable|truncatechars:10|title }}</h6>
                                                                {% endif %}
                                                                {% with puedegestionar=hora.cita|args:persona|call:"puede_gestionar" puedeiniciar=hora.cita|args:persona|call:"puede_iniciar_reunion" puedereagendar=hora.cita|args:persona|call:"puede_reagendar" puedederivar=hora.cita|args:persona|call:"puede_derivar" puedeeliminar=hora.cita|args:persona|call:"puede_eliminar" puedecancelar=hora.cita|args:persona|call:"puede_cancelar" %}
                                                                    {% if tipovista != 'SL' %}
                                                                        {% if puedegestionar or puedeiniciar or puedereagendar or puedederivar or puedeeliminar or puedecancelar %}
                                                                            <div class="btn-group">
                                                                                <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user-cog"></i> Gestionar <i class="fa fa-angle-down"></i></button>
                                                                                <div class="dropdown-menu">
                                                                                    {% if puedegestionar %}
                                                                                        {% if hora.mostrarmodalgest == 'N' %}
                                                                                            <li class="dropdown-item"><a class="gestionarasesoria" id="{{ hora.id|encrypt }}" href="javascript:;"><i class="fa fa-group"></i>&nbsp;Gestionar Cita</a></li>
                                                                                        {% else %}
                                                                                            <li class="dropdown-item"><a class="finalizaractividad" id="{{ hora.id|encrypt }}" href="javascript:;"><i class="fa fa-check-circle"></i> Finalizar</a></li>
                                                                                        {% endif %}
                                                                                    {% endif %}
                                                                                    {% if puedeiniciar %}
                                                                                        {% if hora.urlservirtual %}
                                                                                            <a class="dropdown-item" href="{{ hora.urlservirtual }}" target="_blank"><i class="fa fa-chalkboard"></i>&nbsp;Iniciar Reunión</a>
                                                                                        {% else %}
                                                                                            <a class="dropdown-item disabled" href="javascript:;"><i class="fa fa-chalkboard"></i>&nbsp;Iniciar Reunión</a>
                                                                                        {% endif %}
                                                                                    {% endif %}
                                                                                    {% if puedereagendar %}
                                                                                        <a class="dropdown-item reporteparticipante" href="/adm_asesoriainvestigacion?action=reagendarcita&id={{ hora.id|encrypt }}"><i class="fa fa-calendar"></i>&nbsp;Reagendar Cita</a>
                                                                                    {% endif %}
                                                                                    {% if puedederivar %}
                                                                                        <a class="dropdown-item reporteparticipante" href="/adm_asesoriainvestigacion?action=derivarcita&id={{ hora.id|encrypt }}"><i class="fa fa-share-alt"></i>&nbsp;Derivar Cita</a>
                                                                                    {% endif %}
                                                                                    {% if puedecancelar %}
                                                                                        <li class="dropdown-item"><a class="cancelarcita" id="{{ hora.id|encrypt }}" href="javascript:;"><i class="fa fa-share-alt"></i> Cancelar</a></li>
                                                                                    {% endif %}
                                                                                    {% if puedeeliminar %}
                                                                                        <div class="dropdown-divider"></div>
                                                                                        <li class="dropdown-item"><a class="eliminar" id="{{ hora.id|encrypt }}" titulo=" para el servicio <b>{{ hora.servicio }}</b> solicitado por <b>{{ hora.solicitante }}</b> para el <b>{{ hora.cita.fecha|date:"d-m-Y" }}</b> eh horario de <b>{{ hora.horaini }} - {{ hora.horafin }}</b>" href="javascript:;"><i class="fa fa-remove"></i> Eliminar</a></li>
                                                                                    {% endif %}
                                                                                </div>
                                                                            </div>
                                                                        {% else %}
                                                                            <a href="javascript:;" class="btn btn-light"><i class="fa fa-user-cog"></i> Gestionar <i class="fa fa-angle-down"></i></a>
                                                                        {% endif %}
                                                                    {% else %}
                                                                        <a href="javascript:;" class="btn btn-light"><i class="fa fa-user-cog"></i> Gestionar <i class="fa fa-angle-down"></i></a>
                                                                    {% endif %}
                                                                {% endwith %}
{#                                                                {% if hora.puedegestionar == 'S' %}#}
{#                                                                    {% if hora.mostrarmodalgest == 'N' %}#}
{#                                                                        <a href="/adm_asesoriainvestigacion?action=gestionarcita&id={{ hora.id|encrypt }}" class="btn btn-success"><i class="fa fa-user-cog"></i> Gestionar</a>#}
{#                                                                    {% else %}#}
{#                                                                        <a href="javascript:;" class="btn btn-success finalizaractividad" id="{{ hora.id|encrypt }}"><i class="fa fa-check-circle"></i> Finalizar</a>#}
{#                                                                    {% endif %}#}
{#                                                                {% else %}#}
{#                                                                    <a href="javascript:;" class="btn btn-light"><i class="fa fa-user-cog"></i> Gestionar</a>#}
{#                                                                {% endif %}#}
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    <!-- HORA AGENDADA Y PENDIENTE -->
                                                {% else %}
                                                    <!-- HORA FINALIZADA -->
                                                    {% if hora.horacompleta == 'S' %}
                                                        <div class="card mb-1 text-center border-info color-fondo-finalizado">
                                                            <div class="card-header color-fondo-finalizado p-2">
                                                                <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-check-circle" data-bs-toggle="tooltip" title="Finalizado" aria-hidden="true"></i></b>
                                                            </div>
                                                            <div class="card-body pt-2">
                                                                {% if tipovista == 'CI' %}
                                                                    <p class="card-text">{{ hora.gestion|title2 }}</p>
                                                                {% endif %}
                                                                <h6 class="card-title">{{ hora.servicio|title2 }}</h6>
                                                                <p class="card-text">{{ hora.solicitante|truncatechars:30|title }}</p>
                                                                {% if tipovista == 'CI' or tipovista == 'RG' %}
                                                                    <h6 class="card-title">{{ hora.responsable|truncatechars:30|title }}</h6>
                                                                {% endif %}
                                                                <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Mostrar Información">
                                                                    <a href="javascript:;" class="fa fa-list-alt informacioncita" id="{{ hora.id|encrypt }}" aria-hidden="true"></a>
                                                                </span>

                                                                {% if hora.tipo == 1 %}
                                                                    <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Anexos Cita">
                                                                        <a href="javascript:;" class="fa fa-cloud-upload anexoscita" id="{{ hora.id|encrypt }}" aria-hidden="true"></a>
                                                                    </span>
                                                                    {% if tipovista == 'RG' %}
                                                                        <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Cambiar de Responsable">
                                                                            <a href="javascript:;" class="fa fa-users cambioresponsable" id="{{ hora.id|encrypt }}" aria-hidden="true"></a>
                                                                        </span>
                                                                    {% endif %}
                                                                {% endif %}

                                                                {% if hora.asesoriaorigen %}
                                                                    <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Mostrar Asesoría Origen">
                                                                        <a href="javascript:;" class="fa fa-tags asesoriaorigen" id="{{ hora.id|encrypt }}" idase="{{ hora.asesoriaorigen.id|encrypt }}" aria-hidden="true"></a>
                                                                    </span>
                                                                {% endif %}
                                                                <p class="m-1">
                                                                    <span class="badge bg-primary">{{ hora.modalidad|title2 }}</span>
                                                                </p>
                                                                <p class="m-1">
                                                                    <span class="badge bg-{% if hora.asistio == 'S' %}success{% else %}danger{% endif %} m-1">{{ hora.textoasis }}</span>
                                                                </p>
                                                            </div>
                                                        </div>
                                                    {% else %}
                                                        <div class="card mb-1 text-center border-info color-fondo-finalizado">
                                                            <div class="card-header color-fondo-finalizado p-2">
                                                                <b><i class="fa fa-clock" data-bs-toggle="tooltip" title="Horario" aria-hidden="true"></i> {{ hora.horaini }} - {{ hora.horafin }} <i class="fa fa-check-circle" data-bs-toggle="tooltip" title="Finalizado" aria-hidden="true"></i></b>
                                                            </div>
                                                            <div class="card-body pt-1 pb-2">
                                                                {% if tipovista == 'CI' %}
                                                                    <p class="card-text" data-bs-toggle="tooltip" title="{{ hora.gestion }}">{{ hora.abreviaturagest|title }}</p>
                                                                {% endif %}
                                                                <h6 class="card-title mb-0" data-bs-toggle="tooltip" title="{{ hora.servicio }}">{{ hora.abreviaturaserv|title }}</h6>
                                                                <span class="mt-0 mb-0" data-bs-toggle="tooltip" title="{{ hora.solicitante }}">{{ hora.solicitante|truncatechars:15|title }}</span>
                                                                {% if tipovista == 'CI' or tipovista == 'RG' %}
                                                                    <h6 class="card-title" data-bs-toggle="tooltip" title="{{ hora.responsable }}">{{ hora.responsable|truncatechars:10|title }}</h6>
                                                                {% endif %}
                                                                <span class="btn-icon btn btn-ghost btn-sm rounded-circle mt-0 mb-0" data-bs-toggle="tooltip" title="Mostrar Información">
                                                                    <a href="javascript:;" class="fa fa-list-alt informacioncita" id="{{ hora.id|encrypt }}" aria-hidden="true"></a>
                                                                </span>
                                                                {% if hora.asesoriaorigen %}
                                                                    <span class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="tooltip" title="Mostrar Asesoría Origen">
                                                                        <a href="javascript:;" class="fa fa-tags asesoriaorigen" id="{{ hora.id|encrypt }}" idase="{{ hora.asesoriaorigen.id|encrypt }}" aria-hidden="true"></a>
                                                                    </span>
                                                                {% endif %}
                                                                <span class="badge bg-primary m-0" data-bs-toggle="tooltip" title="{{ hora.modalidad }}">{{ hora.abreviaturamod|title }}</span>
                                                                <span class="badge bg-{% if hora.asistio == 'S' %}success{% else %}danger{% endif %} m-0" data-bs-toggle="tooltip" title="{{ hora.textoasis }}">{{ hora.abreviaturaasis|title }}</span>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    <!-- HORA FINALIZADA -->
                                                {% endif %}
                                            {% endfor %}
                                            <!-- HORARIO DEL DIA -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                <!-- DIA -->
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspanelinformacioncita" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fa fa-list-alt"></i>&nbsp;<span class="paneltitleinformacioncita">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body panelbodyinformacioncita">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspaneladdcita" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fa fa-plus"></i>&nbsp;<span class="paneltitleaddcita">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body panelbodyaddcita">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-success guardar"> Guardar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspanelfinalizaractividad" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fa fa-check-circle"></i>&nbsp;<span class="paneltitlefinalizaractividad">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body panelbodyfinalizaractividad">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-success guardar"> Guardar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspanelfinalizaractividaddia" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fa fa-calendar-check-o"></i>&nbsp;<span class="paneltitlefinalizaractividaddia">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body panelbodyfinalizaractividaddia">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-success guardar"> Guardar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspanelcancelarcita" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fa fa-ban"></i>&nbsp;<span class="paneltitlecancelarcita">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body panelbodycancelarcita">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-success guardar"> Guardar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspanelanexoscita" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fa fa-cloud-upload"></i>&nbsp;<span class="paneltitleanexoscita">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body panelbodyanexoscita">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-success guardar"> Guardar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade static"  id="itemspanelcambioresponsable" style="display: none;">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content border-radius-modal">
            <div class="modal-header" style="padding-bottom: .7rem !important">
                <h4 class="mb-0"><i class="fa fa-users"></i>&nbsp;<span class="paneltitlecambioresponsable">Mostrar Recorrido de la Convocatoria</span></h4>
                <button type="button" class="btn-close btn-cerrar-modal fs-5" data-bs-dismiss="modal" aria-label="Close">X</button>
            </div>
            <div class="modal-body panelbodycambioresponsable">

            </div>
            <div class="modal-footer" id="footermodal">
                <button type="button" class="btn btn-orange fs-5 guardar"><i class="fa fa-check-circle" aria-hidden="true"></i> Guardar</button>
                <button type="button" class="btn btn-cian-secondary fs-5" data-bs-dismiss="modal"><i class="fa fa-close" aria-hidden="true"></i> Cancelar</button>
            </div>
        </div>
    </div>
</div>

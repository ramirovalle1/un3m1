{% extends "basebs.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
    <script type="text/javascript" src="/static/js/jquery.fancybox.pack.js?v=1.0.0"></script>
    <link rel="stylesheet" href="/static/css/jquery.fancybox.css?v=1.0.0" type="text/css" media="screen" />
    <script type="text/javascript" src='/static/js/select2.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=1.0.0"/>
    <style type="text/css">
        .stop-scrolling {
            height: 100%;
            overflow: hidden;
        }
        .tab-content {
            overflow: inherit;
        }
        .table tbody td {
            vertical-align: middle !important;
        }
        .table thead th {
            text-align: center !important;
            vertical-align: middle !important;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function() {
            $(".fancybox").fancybox();
        });
        $(function() {
            $("select").select2({minimumResultsForSearch: 20, width: 'resolve' });
            /*$("#id_bloque").select2({minimumResultsForSearch: 2 });
            $("#id_estado").select2({minimumResultsForSearch: 2 });
            $("#id_tecnico").select2({minimumResultsForSearch: 2 });*/
            ItemsDisplay = function (item) {
                if (item.name){
                    return $('<span>' + item.name+ '</span>');
                }else{
                    //return '---------';
                }
            };
            $("#id_tecnico").select2({
                    //placeholder: "---------",
                allowClear: true,
                    ajax: {
                    url: function (params) {
                        return "/reportes?action=data&model=HdDetalle_Grupo&p=1&s=10&q=" + params.term;
                    },
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term,
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {
                        // parse the results into the format expected by Select2
                        // since we are using custom formatting functions we do not need to
                        // alter the remote JSON data, except to indicate that infinite
                        // scrolling can be used
                        params.page = params.page || 1;

                        return {
                            results: data.results,
                            pagination: {
                                more: (params.page * 30) < data.total_count
                            }
                        };
                    },
                    cache: true
                }
                    ,
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 1,
                templateResult: ItemsDisplay, // omitted for brevity, see the source of this page
                templateSelection: ItemsDisplay
            });

            $("#id_bloquepdf").select2({minimumResultsForSearch: 2 });
            $("#id_estadopdf").select2({minimumResultsForSearch: 2 });
            $("#id_tecnicopdf").select2({minimumResultsForSearch: 2 });
            ItemsDisplay = function (item) {
                if (item.name){
                    return $('<span>' + item.name+ '</span>');
                }else{
                   // return '---------';
                }
            };
            $("#id_tecnicopdf").select2( {
                    //placeholder: "---------",
                allowClear: true,
                    ajax: {
                    url: function (params) {
                        return "/reportes?action=data&model=HdDetalle_Grupo&p=1&s=10&q=" + params.term;
                    },
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term,
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {
                        // parse the results into the format expected by Select2
                        // since we are using custom formatting functions we do not need to
                        // alter the remote JSON data, except to indicate that infinite
                        // scrolling can be used
                        params.page = params.page || 1;

                        return {
                            results: data.results,
                            pagination: {
                                more: (params.page * 30) < data.total_count
                            }
                        };
                    },
                    cache: true
                }
                    ,
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 1,
                templateResult: ItemsDisplay, // omitted for brevity, see the source of this page
                templateSelection: ItemsDisplay
            });

             $("#checktodosexc").on( 'change', function() {
                //cod = $("#id_tipoincidente").val();
                if( $("#checktodosexc").is(':checked')) {
                    $("#id_tecnico").attr('disabled','disabled'); $('input[name=checktodosexc]').val(1);
                }
                else {
                     $("#id_tecnico").removeAttr('disabled');$('input[name=checktodosexc]').val(0);  //alert($(this).val());
                }
              });
               $("#checktodospdf").on( 'change', function() {
                //cod = $("#id_tipoincidente").val();
                if( $("#checktodospdf").is(':checked')) {
                    $("#id_tecnicopdf").attr('disabled','disabled'); $('input[name=checktodospdf]').val(1);
                }
                else {
                     $("#id_tecnicopdf").removeAttr('disabled');$('input[name=checktodospdf]').val(0);  //alert($(this).val());
                }
              });

            $("#id_fecha_inicio, #id_fecha_fin, #id_fecha_iniciopartes, #id_fecha_finpartes, #id_fecha_inicioencuesta, #id_fecha_finencuesta, #id_fecha_inicioencuestaexcel, #id_fecha_finencuestaexcel").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fecha_de").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fecha_hasta").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fecha_deh").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fecha_hastah").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
             $("#id_fecha_dehpdf").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fecha_hastahpdf").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            var tabhelpdeskadmin = localStorage.getItem('tabhelpdeskadmin');
            if (!tabhelpdeskadmin){
                tabhelpdeskadmin = "#1";
                localStorage.setItem("tabhelpdeskadmin", tabhelpdeskadmin);
            }

            $('.tabs').each(function(){
                if ($(this).attr('href') == tabhelpdeskadmin){
                    $(this).trigger('click');
                }
            }).click(function(){
                localStorage.setItem("tabhelpdeskadmin", $(this).attr('href'));
            });

            $("#itemspanel .btn-cerrar").click(function() {
                $("#itemspanel").modal("hide");
                return false;
            });
            $(".cerrar_detalle").click(function() {
                $("#itemspanel").modal("hide");
            });

            busqueda = function(){
                var term = $("#searchinput").val().trim().toUpperCase();
                var id_estado = $('#estado_list').val();
                var idg = $("#idgrupo").val();
                var tipo_equipo = $("#equipo_codigo").val();
                bloqueointerface();
                if (term.length>0){
                    if (parseInt(id_estado)>0){
                        if (parseInt(idg)>0) {
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado + "&idg=" + idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado + "&idg=" + idg;
                            }
                        }else{
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado;
                            }
                        }
                    }else{
                        if (parseInt(idg)>0) {
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term + "&idg=" + idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&idg=" + idg;
                            }
                        }else{
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term;
                            }
                        }
                    }
                }else{
                    if (parseInt(id_estado)>0){
                        if (parseInt(idg)>0) {
                            location.href = "/adm_hdincidente?id_estado=" + id_estado + "&idg=" + idg;
                        }else{
                            location.href = "/adm_hdincidente?id_estado=" + id_estado;
                        }
                    }else{
                        if (parseInt(idg)>0) {
                            location.href = "/adm_hdincidente?&idg="+ idg;
                        }else{
                            location.href = "/adm_hdincidente";
                        }
                    }
                }
            };

            $("#search").click(function() {
                busqueda();
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    busqueda();
                }
            });
            $("#estado_list").change(function () {
                var id_estado = $(this).val();
                var term = $("#searchinput").val().trim().toUpperCase();
                var idg = $("#idgrupo").val();
                var tipo_equipo = $("#equipo_codigo").val();
                bloqueointerface();
                if (parseInt(id_estado)>0){
                    if (parseInt(idg)>0) {
                        if (term.length > 0) {
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado + "&idg=" + idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado + "&idg=" + idg;
                            }
                        } else {
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?id_estado=" + id_estado + "&idg=" + idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?id_estado=" + id_estado + "&idg=" + idg;
                            }
                        }
                    }else{
                        if (term.length > 0) {
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado;
                            }
                        } else {
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?id_estado=" + id_estado+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?id_estado=" + id_estado;
                            }
                        }
                    }
                }else{
                    if (parseInt(idg)>0) {
                        if (term.length > 0) {
                            location.href = "/adm_hdincidente?s=" + term + "&idg=" + idg;
                        } else {
                            location.href = "/adm_hdincidente?idg=" + idg;
                        }
                    }else{
                        if (term.length > 0) {
                            location.href = "/adm_hdincidente?s=" + term;
                        } else {
                            location.href = "/adm_hdincidente";
                        }
                    }
                }
            });
            $("#idgrupo").change(function () {
                var idg = $(this).val();
                var id_estado = $("#estado_list").val();
                var term = $("#searchinput").val().trim().toUpperCase();
                var tipo_equipo = $("#equipo_codigo").val();
                bloqueointerface();
                if (parseInt(idg)>0){
                    if (parseInt(id_estado)>0){
                        if (term.length>0){
                            if (parseInt(tipo_equipo)>0){
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado+"&idg="+idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado+"&idg="+idg;
                            }
                        }else{
                            location.href = "/adm_hdincidente?id_estado=" + id_estado+"&idg="+idg;
                        }
                    }else{
                        if (term.length>0){
                            if (parseInt(tipo_equipo)>0) {
                                location.href = "/adm_hdincidente?s=" + term + "&idg=" + idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?s=" + term + "&idg=" + idg;
                            }
                        }else{
                            location.href = "/adm_hdincidente?idg="+idg;
                        }
                    }
                }else{
                    if (parseInt(tipo_equipo)>0) {
                        location.href = "/adm_hdincidente?tipo_equipo="+tipo_equipo;
                    }else{
                        location.href = "/adm_hdincidente";
                    }
                }
            });
            $("#equipo_codigo").change(function () {
                var tipo_equipo = $(this).val();
                var idg = $("#idgrupo").val();
                var id_estado = $("#estado_list").val();
                var term = $("#searchinput").val().trim().toUpperCase();
                bloqueointerface();
                if (parseInt(tipo_equipo)>0){
                    if (parseInt(idg)>0){
                        if (parseInt(id_estado)>0){
                            if (term.length>0){
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado+"&idg="+idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?id_estado=" + id_estado+"&idg="+idg+"&tipo_equipo="+tipo_equipo;
                            }
                        }else{
                            if (term.length>0){
                                location.href = "/adm_hdincidente?s=" + term + "&idg="+idg+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?idg="+idg+"&tipo_equipo="+tipo_equipo;
                            }
                        }
                    }else{
                        if (parseInt(id_estado)>0){
                            if (term.length>0){
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado+"&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?id_estado=" + id_estado+"&tipo_equipo="+tipo_equipo;
                            }
                        }else{
                            if (term.length>0){
                                location.href = "/adm_hdincidente?s=" + term + "&tipo_equipo="+tipo_equipo;
                            }else{
                                location.href = "/adm_hdincidente?tipo_equipo="+tipo_equipo;
                            }
                        }
                    }
                }else{
                    if (parseInt(idg)>0) {
                        if (parseInt(id_estado) > 0) {
                            if (term.length > 0) {
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado + "&idg=" + idg + "&idg=" + idg;
                            } else {
                                location.href = "/adm_hdincidente?id_estado=" + id_estado + "&idg=" + idg;
                            }
                        } else {
                            if (term.length > 0) {
                                location.href = "/adm_hdincidente?s=" + term + "&idg=" + idg;
                            } else {
                                location.href = "/adm_hdincidente?idg=" + idg + "&idg=" + idg;
                            }
                        }
                    }else{
                        if (parseInt(id_estado) > 0) {
                            if (term.length > 0) {
                                location.href = "/adm_hdincidente?s=" + term + "&id_estado=" + id_estado;
                            } else {
                                location.href = "/adm_hdincidente?id_estado=" + id_estado;
                            }
                        } else {
                            if (term.length > 0) {
                                location.href = "/adm_hdincidente?s=" + term;
                            } else {
                                location.href = "/adm_hdincidente";
                            }
                        }
                    }
                }
            });

            $(".tl").tooltip({position:"center up"});

            $("#cerrar_excel").click(function () {
                document.getElementById('id_fecha_de').value='';
                document.getElementById('id_fecha_hasta').value='';
                $('#itemspanelreportegeneral_excel').modal('hide');
            });
            $(".generar_reporte_general_excel").click(function () {
                $(".panelbody").html();
                $("#itemspanelreportegeneral_excel").modal({backdrop:'static', width: '450px'}).modal('show');

            });
            $("#generar_excel").click(function () {
                var fechade = $("#id_fecha_de").val();
                var fechahasta = $("#id_fecha_hasta").val();
                location.href = "/adm_hdincidente?action=reportegeneral_excel&de="+fechade+"&hasta="+fechahasta;
                document.getElementById('id_fecha_de').value='';
                document.getElementById('id_fecha_hasta').value='';
                $('#itemspanelreportegeneral_excel').modal('hide');
            });


            $("#cerrar_excelh").click(function () {
                document.getElementById('id_fecha_deh').value='';
                document.getElementById('id_fecha_hastah').value='';
                $('#itemspanelreportegeneral_excelh').modal('hide');
            });
            $(".generar_reporte_general_excelh").click(function () {
                $(".panelbody").html();
                $("#itemspanelreportegeneral_excelh").modal({backdrop:'static', width: '700px'}).modal('show');

            });
            $("#generar_excelh").click(function () {
                var fechade = $("#id_fecha_deh").val();
                var fechahasta = $("#id_fecha_hastah").val();
                var tecnico = $("#id_tecnico").val();
                var bloque = $("#id_bloque").val();
                var estado = $("#id_estado").val();
                var checktodos = $("#checktodosexc").val();

                location.href = "/adm_hdincidente?action=reportegeneral_excelcompleto&de="+fechade+"&hasta="+fechahasta+"&tecnico="+tecnico+"&bloque="+bloque+"&estado="+estado+"&checktodos="+checktodos;
                document.getElementById('id_fecha_de').value='';
                document.getElementById('id_fecha_hasta').value='';
                $('#itemspanelreportegeneral_excelh').modal('hide');
            });


             $("#cerrar_excelhpdf").click(function () {

                document.getElementById('id_fecha_dehpdf').value='';
                document.getElementById('id_fecha_hastahpdf').value='';
                $('#itemspanelreportegeneral_excelhpdf').modal('hide');
            });
            $(".generar_reporte_general_excelhpdf").click(function () {
                $(".panelbody").html();
                $("#itemspanelreportegeneral_excelhpdf").modal({backdrop:'static', width: '700px'}).modal('show');

            });
            $("#generar_excelhpdf").click(function () {
                var fechade = $("#id_fecha_dehpdf").val();
                var fechahasta = $("#id_fecha_hastahpdf").val();
                var tecnico = $("#id_tecnicopdf").val();
                var bloque = $("#id_bloquepdf").val();
                var estado = $("#id_estadopdf").val();
                var checktodos = $("#checktodospdf").val();

                location.href = "/adm_hdincidente?action=ordenpdf&de="+fechade+"&hasta="+fechahasta+"&tecnico="+tecnico+"&bloque="+bloque+"&estado="+estado+"&checktodos="+checktodos;
                document.getElementById('id_fecha_de').value='';
                document.getElementById('id_fecha_hasta').value='';
                $('#itemspanelreportegeneral_excelh').modal('hide');
            });




            $(".informeincidente").click(function () {
                $("#itemspanel3").modal({backdrop:'static', width: '290'}).modal('show');
            });

            $("#itemspanel_cerrar_3").click(function () {
                $("#itemspanel3").modal('hide');
                $(".invalidofechas").hide();
            });

            $("#itemspanel_adicionar_3").click(function () {
                $(".invalidofechas").hide();
                var ini = $("#id_fecha_inicio").val();
                var fin = $("#id_fecha_fin").val();
                if (ini && fin && ini<=fin){
                    $("#itemspanel3").modal('hide');
                    openwindow('POST' ,'/adm_hdincidente', {action: 'informeincidente', 'ini':ini, 'fin':fin, 'g':1},'_blank');
                }
                else{
                    $(".invalidofechas").show();
                }
            });
            $(".informeencuestaexcel").click(function () {
                $("#itemspanelencuestaexcel").modal({backdrop:'static', width: '290'}).modal('show');
            });
            $("#itemspanel_cerrar_encuestaexcel").click(function () {
                $("#itemspanelencuestaexcel").modal('hide');
                $(".invalidoencuestaexcel").hide();
            });
            $("#generar_excelencuesta").click(function () {
                var fechade = $("#id_fecha_inicioencuestaexcel").val();
                var fechahasta = $("#id_fecha_finencuestaexcel").val();
                location.href = "/adm_hdincidente?action=excellistaencuesta&ini="+fechade+"&fin="+fechahasta;
                document.getElementById('id_fecha_inicioencuestaexcel').value='';
                document.getElementById('id_fecha_finencuestaexcel').value='';
                $('#itemspanelencuestaexcel').modal('hide');
            });


            $(".informeencuesta").click(function () {
                $("#itemspanelencuesta").modal({backdrop:'static', width: '290'}).modal('show');
            });
            $("#itemspanel_cerrar_encuesta").click(function () {
                $("#itemspanelencuesta").modal('hide');
                $(".invalidoencuesta").hide();
            });
            $("#itemspanel_adicionar_encuesta").click(function () {
                $(".invalidoencuesta").hide();
                var ini = $("#id_fecha_inicioencuesta").val();
                var fin = $("#id_fecha_finencuesta").val();
                if (ini && fin && ini<=fin){
                    $("#itemspanelencuesta").modal('hide');
                    openwindow('POST' ,'/adm_hdincidente', {action: 'pdflistaencuesta', 'ini':ini, 'fin':fin, 'g':1},'_blank');
                }
                else{
                    $(".invalidoencuesta").show();
                }
            });
            $(".informeincidentepartes").click(function () {
                $("#itemspanelpartes").modal({backdrop:'static', width: '290'}).modal('show');
            });
            $("#itemspanel_cerrar_partes").click(function () {
                $("#itemspanelpartes").modal('hide');
                $(".invalidopartes").hide();
            });
            $("#itemspanel_adicionar_partes").click(function () {
                $(".invalidopartes").hide();
                var ini = $("#id_fecha_iniciopartes").val();
                var fin = $("#id_fecha_finpartes").val();
                if (ini && fin && ini<=fin){
                    $("#itemspanelpartes").modal('hide');
                    openwindow('POST' ,'/adm_hdincidente', {action: 'pdflistapartes', 'ini':ini, 'fin':fin, 'g':1},'_blank');
                }
                else{
                    $(".invalidopartes").show();
                }
            });
            $(".mostrardetalle").click(function() {
                $("#aprobarcerrar").css('display', 'none');
                var id = $(this).attr('idd');
                bloqueointerface();
                $.post("/adm_hdincidente", {'action': 'modaldetalle', 'id': id}, function(data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        $(".panelbody").html(data.data);
                        $("#itemspanel").modal({backdrop:'static', width: '1200px', height:'510px'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                }, 'json');
            });


            $(".seleccionaractivo").click(function () {
                var id = $(this).attr('id');
                $('#guardar').attr('id',$(this).attr('id'));
                $("#itemspanelseleccionaractivo").modal({backdrop:'static', width: '500px', height:'100px'}).modal('show');
            });
            ItemsDisplay = function (item) {
                if (item.name){
                    return $('<span>' + item.name+ '</span>');
                }else{
                    return '---------';
                }
            };

            $("#id_activo_select2").select2({
                placeholder: "-------------------------------------------",
                allowClear: true,
                ajax: {
                    url: function (params) {
                        {#                        return "/reportes?action=data&model=ActivoFijo&p=1&s=10&q=" + params.term;#}
                        return "/adm_hdincidente?action=buscaractivo&q=" + params.term+"&idt="+0;
                    },
                    dataType: 'json',
                    delay: 400,
                    data: function (params) {
                        return {
                            q: params.term,
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {
                        // parse the results into the format expected by Select2
                        // since we are using custom formatting functions we do not need to
                        // alter the remote JSON data, except to indicate that infinite
                        // scrolling can be used
                        params.page = params.page || 1;

                        return {
                            results: data.results,
                            pagination: {
                                more: (params.page * 30) < data.total_count
                            }
                        };
                    },
                    cache: true
                },
                escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                minimumInputLength: 1,
                templateResult: ItemsDisplay, // omitted for brevity, see the source of this page
                templateSelection: ItemsDisplay // omitted for brevity, see the source of this page
            }).on("select2:select", function (evt) {
                $("#id_activo").attr({"value":(evt.params.data.id)});
            });
            $("#itemspanelseleccionaractivo .btn-cerrar").click(function () {
                $("#itemspanelseleccionaractivo").modal("hide");
            });
            $("#itemspanelseleccionaractivo #guardar").click(function () {
                var ida = $("#id_activo").val();
                var id = $(this).attr('id');
                if (parseInt(ida)>0){
                    bloqueointerface();
                    $.post("/adm_hdincidente", {'action': 'seleccionaractivo', 'id': id, 'ida':ida}, function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#incidetesincodigo_"+id).empty();
                            $("#itemspanelseleccionaractivo").modal("hide");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }, 'json');
                }else{
                    smoke.alert('Debe seleccionar un activo');
                }
            });
            $(".generarot").click(function () {
                var id = $(this).attr('idr');
                openwindow('POST' ,'/adm_hdincidente', {action: 'generarot', 'id':id},'_blank');
            });
            $(".imprimirincidente").click(function () {
                var id = $(this).attr('idr');
                openwindow('POST' ,'/adm_hdincidente', {action: 'imprimirincidente', 'id':id},'_blank');
            });

            $(".detalleactivo").click(function() {
                var id = $(this).attr("cid");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_hdincidente",
                    data: {'action':'detalle_activo', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result=='ok'){
                            $("#detalleactivomodal_body").html(data.html);
                            $("#detalleactivomodal").modal({"backdrop":"static", "width": "1000px"}).modal("show");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
                return false;
            });

            $("#detalleactivomodal_aceptar").click(function(){
                $("#detalleactivomodal").modal("hide");
            });

            $("#detailOrdenPedidoModal_cerrar").click(function(){
                $("#detailOrdenPedidoModal").modal("hide");
                return false;
            });

            $(".detalleOrdenPedido").click(function() {
                var id = $(this).attr("op_id");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_hdincidente",
                    data: {'action':'LoadDetailOrdenPedido', 'id':id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result=='ok'){
                            $("#num_doc").html(data.numero);
                            $("#detailOrdenPedidoModal_contenido").html(data.data);
                            $("#detailOrdenPedidoModal").modal({"backdrop":"static", "width": "1000px"}).modal("show");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

        });
    </script>
{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h3>{{ title }}</h3>
            <h5>{{ administrador }} {{ cargo }}</h5>
        </div>
    </div>
    <div class="row-fluid">
        <div class='span12'>
            <div class="tabbable">
                <ul class="nav nav-tabs">
                    <li><a class="tabs active" href="#1" data-toggle="tab"><i class="fa fa-list"></i> INCIDENTES <label style="width: 30px;height: 20px; text-align: center; padding-top: 2px;"  title="Abiertos" class="btn btn-default">{{ cantincidente }} </label></a></li>
                    <li><a class="tabs" href="#5" data-toggle="tab"><i class="fa fa-cogs"></i> ADMINISTRADOR</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane" id="1">
                        <div class='row-fluid'>
                            <div class='span2'>
                                <a href="/adm_hdincidente?action=add" class='btn btn-success bloqueo_pantalla'><span class="fa fa-plus " ></span> Adicionar</a>
                                <div class="btn-group ">
                                    <a class="btn dropdown-toggle btn-default" data-toggle="dropdown" href="#"><i class="fa fa-file-pdf-o "></i> Reporte <span class="caret"></span></a>
                                    <ul class="dropdown-menu">
<!--                                        <li><a href="javascript:;" class='generar_reporte_general_excelh'><i class="fa fa-file-excel-o "></i> Ordenes de Trabajo</a></li>-->
<!--                                        <li><a href="javascript:;" class='generar_reporte_general_excelhpdf'><i class="fa fa-file-pdf-o "></i> Ordenes de Trabajo</a></li>-->
                                        <li><a href="javascript:;" class='generar_reporte_general_excel'><i class="fa fa-file-excel-o "></i> General</a></li>
                                        <li><a href="javascript:;" class='informeincidente'><span class="fa fa-print"></span> Informe de incidentes</a></li>
                                        <li><a href="javascript:;" class='informeincidentepartes'><span class="fa fa-print"></span> Informe de piezas y partes</a></li>
                                        <li><a href="javascript:;" class='informeencuesta'><span class="fa fa-print"></span> Informe de encuestas</a></li>
                                        <li><a href="javascript:;" class='informeencuestaexcel'><span class="fa fa-file-excel-o"></span> Descargar resultados encuestas</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class='span2'>
                                <form class="form-search">
                                    <select id="idgrupo" style="max-width: 185px; min-width: 85px; width: 185px;">
                                        <option value="0">TODOS LOS GRUPOS</option>
                                        {% for item in grupos %}
                                            <option {% if item.0 == idgrupo %}selected{% endif %} value="{{ item.0 }}">{{ item.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </form>
                            </div>
                            <div class='span2'>
                                <form class="form-search">
                                    <select id="estado_list" style="max-width: 185px; min-width: 85px; width: 185px;">
                                        <option value="0">TODOS LOS ESTADOS</option>
                                        {% for estado in estados %}
                                            <option {% if estado.id == estadoid %}selected{% endif %} value="{{ estado.id }}">{{ estado.nombre }}</option>
                                        {% endfor %}
                                    </select>
                                </form>
                            </div>
                            <div class='span2' >
                                <form class="form-search">
                                    <select id="equipo_codigo" style="max-width: 185px; min-width: 85px; width: 185px;">
                                        <option value="0">TODOS</option>
                                        <option {% if selecttipoeq == 1 %}selected{% endif %} value="1">SIN CÓDIGO</option>
                                        <option {% if selecttipoeq == 2 %}selected{% endif %} value="2">CÓDIGO EXTERNO</option>
                                        <option {% if selecttipoeq == 3 %}selected{% endif %} value="3">ORDEN DE TRABAJO</option>
                                        <option {% if selecttipoeq == 4 %}selected{% endif %} value="4">SIN ORDEN DE TRABAJO</option>
                                    </select>
                                </form>
                            </div>
                            <div class="span4" style="text-align: right">
                                <form class="form-search">
                                    <input class='searchinput' type='text' id='searchinput' value='{{ search }}' autocomplete="off" style="width: 63%" />
                                    <a href="javascript:;" id='search' class='btn btn-info'><span class="fa fa-search "></span> Buscar</a>
                                    {% if search or ids or estadoid%}
                                        <a href="/adm_hdincidente" id='allresults' class='btn btn-info bloqueo_pantalla'><span class="fa fa-refresh "></span> Todos</a>
                                    {% endif %}
                                </form>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class='span12'>
                                <table class='table table-bordered'>
                                    <thead>
                                        <tr>
                                            <td colspan="12"><h3>Incidentes</h3>
                                        </tr>
                                        <tr>
                                            <th style="width: 30px; text-align: center;">Codigo</th>
                                            <th style="width: 90px">Fecha</th>
                                            <th style="width: 200px; text-align: left;">Asunto</th>
                                            <th style="width: 200px">Nombre Solicitante</th>
                                            <th style="width: 100px">Ubicación/Ubicación</th>
                                            <th style="width: 80px; text-align: center">Grupo</th>
                                            <th style="width: 80px; text-align: center">Agente</th>
                                            <th style="width: 50px; text-align: center;">Turno</th>
                                            <th style="width: 50px; text-align: center;">Estado</th>
                                            <th style="width: 60px; text-align: center;">Prioridad</th>
                                            <th style="width: 20px">Archivo</th>
                                            <th style="width: 80px; text-align: center">tiempo de resolución</th>
                                            <th style="width: 60px">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for incidente in incidentescab %}
                                         <tr    {% if not incidente.ultimo_registro %}
                                                        bgcolor= "#A1DBF5"
                                                    {% elif not incidente.ultimo_registro.agente %}
                                                       bgcolor= "#A1DBF5"
                                                    {% elif not incidente.ultimo_registro.estadoasignacion == 1 %}
                                                        bgcolor= "#A1DBF5"
                                                    {% endif %} >

                                            <td style="text-align: center;">{{ incidente.id }} </td>
                                            <td>{{ incidente.fechareporte|date:"d-m-Y" }}<br> {{ incidente.horareporte }}</td>
                                            <td>{{ incidente.asunto }}<br>
                                                {% if not incidente.esta_abierto %}
                                                    <span class="label label-warning"><b>Cant. Revisiones: </b>{{ incidente.cantidad_detalle_incidente }}</span>
                                                {% endif %}
                                                {% if incidente.revisionequiposincodigo %}
                                                    <span class="label label-important" id="incidetesincodigo_{{ incidente.id }}">Equipo sin código</span>
                                                {% endif %}
                                                {% if incidente.revisionequipoexterno %}
                                                    <span class="label label-info"><b>Equipo externo</b></span>
                                                {% endif %}
                                                {%  if incidente.tipoincidente.id == 3 and incidente.ordentrabajo %}
                                                    <br><span class="label label-info"><b>Orden Trabajo:. </b> {{ incidente.ordentrabajo }}</span>
                                                {%  endif %}
                                            </td>
                                            <td>{{ incidente.persona }}</td>
                                            <td>{% if incidente.departamento %}{{ incidente.departamento }}{% else %}{{ incidente.ubicacion.bloque }} - {{ incidente.ubicacion.ubicacion }}{% endif %}</td>
                                            <td style="text-align: center">
                                                {% if incidente.tipoincidente %}
                                                    {{ incidente.tipoincidente }}
                                                {% endif %}
                                                {%  if incidente.activo %}
                                                    <a class="btn btn-info btn-mini detalleactivo tu" title="Detalle de Activo" href='javascript:;' cid="{{ incidente.activo.id }}"> <i class='fa fa-list'></i> </a>

                                                {% endif %}
                                            </td>
                                            <td style="text-align: center">
                                                {% if incidente.ultimo_registro %}
                                                    {% if incidente.ultimo_registro.agente and incidente.ultimo_registro.estadoasignacion == 1 %}
                                                        {{ incidente.ultimo_registro.agente.persona.usuario }}
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center">
                                                {% if incidente.esta_abierto %}
                                                    <label class="label label-warning">Total: {{ incidente.cantidad_pendientes }} </label><br>
                                                    <label class="label label-darkgreen">Turno: {{ incidente.turno }}</label>
                                                {% elif  incidente.esta_pendiente  %}
                                                    <label class="label label-warning">Total: {{ incidente.cantidad_pendientes }} </label><br>
                                                    <label class="label label-darkgreen">Turno: {{ incidente.turno }}</label>
                                                {% elif  incidente.esta_cerrado  %}
                                                    <label class="label label-danger"> Cerrado </label>
                                                {% elif  incidente.esta_resulto  %}
                                                    <label class="label label-success"> Terminado </label>
                                                {% elif  incidente.esta_aprobado  %}
                                                    <label class="label label-important"> Aprobado </label>
                                                {% elif  incidente.esta_rechazado  %}
                                                    <label class="label label-important"> Rechazado </label>
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center;">
                                                {% if incidente.esta_abierto %}
                                                    <a title="{{ incidente.estado  }}" class="fancybox tu" rel="group"><img src="{{ incidente.estado.imagen.url }}"></a>
                                                {% elif  incidente.esta_pendiente  %}
                                                    <a title="{{ incidente.estado  }}" class="fancybox tu" rel="group"><img src="{{ incidente.estado.imagen.url }}"></a>
                                                {% elif  incidente.esta_cerrado  %}
                                                    <a title="{{ incidente.estado  }}" class="fancybox tu" rel="group"><img src="{{ incidente.estado.imagen.url }}"></a>
                                                {% elif  incidente.esta_resulto  %}
                                                    <a title="{{ incidente.estado  }}" class="fancybox tu" rel="group"><img src="{{ incidente.estado.imagen.url }}"></a>
                                                {% elif  incidente.esta_rechazado  %}
                                                    <a title="{{ incidente.estado  }}" class="fancybox tu" rel="group"><img style="width: 30px" src="{{ incidente.estado.imagen.url }}"></a>
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center">
                                                {% if incidente.detallesubcategoria.prioridad %}
                                                    {% if incidente.detallesubcategoria.prioridad.prioridad.imagen %}
                                                        <a title="{{ incidente.detallesubcategoria.prioridad.prioridad.nombre }}" href="{{ incidente.detallesubcategoria.prioridad.prioridad.imagen.url }}" class="fancybox tu" rel="group"><img src="{{ incidente.detallesubcategoria.prioridad.prioridad.imagen.url }}"></a>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center;">{% if incidente.archivo  %}<a href='{{  incidente.download_link }}'  title="Descargar Archivo" class='btn btn-info btn-mini'><i class='fa fa-arrow-down '></i></a>{% endif %}</td>

                                            <td style="text-align: center;">
                                                {% if incidente.detallesubcategoria %}
                                                    {% if incidente.tiene_prioridad %}
                                                        {% if incidente.detallesubcategoria.prioridad.modificar %}
                                                            {{ incidente.detallesubcategoria.prioridad.horamax }}:{{ incidente.detallesubcategoria.prioridad.minutomax }}:{{ incidente.detallesubcategoria.prioridad.segundomax }}
                                                        {% else %}
                                                            {{ incidente.detallesubcategoria.prioridad.prioridad.horamax }}:{{ incidente.detallesubcategoria.prioridad.prioridad.minutomax }}:{{ incidente.detallesubcategoria.prioridad.prioridad.segundomax }}
                                                        {% endif %}
                                                        &nbsp;horas
                                                    {% else %}
                                                        <label class="label label-important">No asignado</label>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center;">
                                                <div class="btn-group">
                                                    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span class="caret"></span></a>
                                                    <ul class="dropdown-menu pull-right list-group" style="text-align: left;">
                                                        {% with migrupo=incidente|args:persona_id|call:'es_mi_grupo' miagente=incidente|args:persona_id|call:'es_mi_agente' %}
                                                            {% if migrupo and miagente %}
                                                                {% if incidente.estado.id != 5 %}
                                                                <li><a href='/adm_hdincidente?action=resolverincidente&id={{ incidente.id }}' class="bloqueo_pantalla"><i class="fa fa-edit" ></i> Resolver Incidente</a></li>
                                                                <li><a href='/adm_hdincidente?action=reasignaragente&id={{ incidente.id }}' class="bloqueo_pantalla"><i class="fa fa-user" ></i> Reasingar Agente</a></li>
                                                                <li><a href="/adm_hdincidente?action=escalarincidente&id={{ incidente.id }}" class="bloqueo_pantalla"><i class="fa fa-times fa-fw fa fa-group"></i>Escalar a Grupo</a></li>
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endwith %}
                                                        {% if incidente.estado.id != 3 %}
                                                            {% if incidente.estado.id != 5 %}
                                                                <li><a href='/adm_hdincidente?action=edit&id={{ incidente.id }}' class="bloqueo_pantalla"><i class="fa fa-edit" ></i> Editar</a></li>
                                                            {% endif %}
                                                        {% endif %}
                                                        {% if incidente.revisionequiposincodigo %}
                                                            <li><a class="seleccionaractivo" id="{{ incidente.id }}"><i class="fa fa-laptop" ></i> Seleccionar activo</a></li>
                                                        {% endif %}
                                                        {% if incidente.estado.id != 3 %}
                                                            {% if incidente.estado.id != 5 %}
                                                               <li><a class="eliminacionmodal" href="javascript:;" nhref="/adm_hdincidente?action=delincidente&id={{ incidente.id }}"><i class="fa fa-trash"></i> Eliminar</a></li>
                                                            {% endif %}
                                                        {% endif %}
                                                        <li><a href="javascript:;" class="mostrardetalle tu" idd="{{ incidente.id }}"><i class="fa fa-list" ></i> Detalle</a></li>
                                                        {% if incidente.esta_abierto %}
                                                            {% if reporte_0 %}
                                                                {#                                                                <li><a href="javascript:;" tipos="{{ reporte_0.tiporeporte }}" nhref="/reportes?action=run&n={{ reporte_0.nombre }}&idincidente={{ incidente.id }}" class="reportedirecto"><span class="fa fa-list-alt"></span> Incidente</a> </li>#}
                                                            {% endif %}
                                                        {% endif %}
                                                        {% with migrupo=incidente|args:persona_id|call:'es_mi_grupo' miagente=incidente|args:persona_id|call:'es_mi_agente' %}
                                                            {% if not migrupo or not miagente %}
                                                                {% if incidente.tipoincidente.id == 3 %}
                                                                    <li><a href='/adm_hdincidente?action=resolverincidente&id={{ incidente.id }}' class="bloqueo_pantalla"><i class="fa fa-edit" ></i> Resolver Incidente</a></li>
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endwith %}

                                                        {% if incidente.tipoincidente.id == 3 %}
                                                            {% if not incidente.tiene_ordenpedido %}
                                                                {% if not incidete.ordentrabajo.codigoorden %}
                                                                    {% if incidente.esta_abierto or incidente.esta_pendiente %}
                                                                        <li><a href="/adm_hdincidente?action=addodenpedido&id={{ incidente.id }}"><span class="fa fa-plus" ></span> Generar OP</a></li>
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% else %}
                                                                <li class="dropdown-submenu pull-left"><a href="javascript:;"><i class="fa fa-folder-open"></i> Ordenes de Pedidos</a>
                                                                    <ul class="dropdown-menu">
                                                                        {% if incidente.esta_abierto or incidente.esta_pendiente %}
                                                                            <li><a href="/adm_hdincidente?action=addodenpedido&id={{ incidente.id }}"><span class="fa fa-plus" ></span> Nueva OP</a></li>
                                                                        {% endif %}
                                                                        {% for ordenpedido in incidente.mis_ordenpedidos %}
                                                                            <li><a href="javascript:;" class="detalleOrdenPedido" op_id="{{ ordenpedido.id }}"><span class='fa fa-list'></span> {{ ordenpedido.codigodocumento }}</a></li>
                                                                        {% endfor %}
                                                                    </ul>
                                                            {% endif %}
                                                            {% if incidente.estado.id != 3 %}
                                                                <li><a href="javascript:;" class="tu generarot" idr="{{ incidente.id }}" ><i class="fa fa-file-pdf-o "></i> Generar OT </a></li>
                                                            {% endif %}
                                                            {% if incidente.estado.id == 3 %}
                                                                <li><a href="javascript:;" class="tu imprimirincidente" idr="{{ incidente.id }}" ><i class="fa fa-file-pdf-o "></i> Imprimir OT</a></li>
                                                            {% endif %}
                                                        {% endif %}

                                                    </ul>
                                                </div>
                                            </td>
                                        </tr>
                                    {% empty %}
                                        <tr>
                                            <td colspan="12">NO EXISTEN INCIDENTES REGISTRADOS</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class='row-fluid'>
                            <div class="span12">
                                {% if paging.num_pages > 20 %}
                                    <div class='pagination'>
                                        <ul>
                                            {% if paging.primera_pagina %}
                                                <li><a href="/adm_hdincidente?page=1{% if estadoid %}&id_estado={{ estadoid }}{% endif %}{% if search %}&s={{ search }}{% endif %}{% if idgrupo %}&idg={{ idgrupo }}{% endif %}{% if selecttipoeq %}&tipo_equipo={{ selecttipoeq }}{% endif %}">1</a></li>
                                                <li><a href="/adm_hdincidente?page={{ paging.ellipsis_izquierda }}{% if estadoid %}&id_estado={{ estadoid }}{% endif %}{% if search %}&s={{ search }}{% endif %}{% if idgrupo %}&idg={{ idgrupo }}{% endif %}{% if selecttipoeq %}&tipo_equipo={{ selecttipoeq }}{% endif %}" class="active">...</a></li>
                                            {% endif %}
                                            {% for pagenumber in paging.paginas %}
                                                <li {%  if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_hdincidente?page={{ pagenumber }}{% if estadoid %}&id_estado={{ estadoid }}{% endif %}{% if search %}&s={{ search }}{% endif %}{% if idgrupo %}&idg={{ idgrupo }}{% endif %}{% if selecttipoeq %}&tipo_equipo={{ selecttipoeq }}{% endif %}">{{ pagenumber }}</a></li>
                                            {% endfor %}
                                            {% if paging.ultima_pagina %}
                                                <li><a href="/adm_hdincidente?page={{ paging.ellipsis_derecha }}{% if estadoid %}&id_estado={{ estadoid }}{% endif %}{% if search %}&s={{ search }}{% endif %}{% if idgrupo %}&idg={{ idgrupo }}{% endif %}{% if selecttipoeq %}&tipo_equipo={{ selecttipoeq }}{% endif %}" class="active">...</a></li>
                                                <li><a href="/adm_hdincidente?page={{ paging.num_pages }}{% if estadoid %}&id_estado={{ estadoid }}{% endif %}{% if search %}&s={{ search }}{% endif %}{% if idgrupo %}&idg={{ idgrupo }}{% endif %}{% if selecttipoeq %}&tipo_equipo={{ selecttipoeq }}{% endif %}">{{ paging.num_pages }}</a></li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                {% else %}
                                    <div class='pagination'>
                                        <ul>
                                            {% for pagenumber in paging.page_range %}
                                                <li {%  if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_hdincidente?page={{ pagenumber }}{% if search %}&s={{ search }}{% endif %}{% if estadoid %}&id_estado={{ estadoid }}{% endif %}{% if idgrupo %}&idg={{ idgrupo }}{% endif %}{% if selecttipoeq %}&tipo_equipo={{ selecttipoeq }}{% endif %}">{{ pagenumber }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="5">
                        <div class="row-fluid">
                            <h3 class="title span12"><span>Gestión de Usuario</span></h3>
                            <ul class="span10" style="padding-top: 20px;">
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=viewtreegrupo" style="color: #3e5771;">
                                        <span style="font-size: 60px; " class="fa fa-group"></span>
                                    </a><br>
                                    <span style="text-align: center;">Grupos</span>
                                </div>
                                <!--<div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=viewdirector" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-user"></span>
                                    </a><br>
                                    <span style="text-align: center;">Director</span>
                                </div>-->
                            </ul>
                        </div>
                        <div class="row-fluid">
                            <h3 class="title span12"><span>Administración</span></h3>
                            <ul class="span10" style="padding-top: 20px;">
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=urgencia" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-hourglass-start"></span>
                                    </a><br>
                                    <span style="text-align: center;">Urgencia</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=impacto" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-stack-overflow"></span>
                                    </a><br>
                                    <span style="text-align: center;">Impacto</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=prioridad" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-clock-o"></span>
                                    </a><br>
                                    <span style="text-align: center;">Prioridad</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=unionimpactourgenciaprioridad" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-object-group"></span>
                                    </a><br>
                                    <span style="text-align: center;">Tabla de Prioridad</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=estado" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-tags"></span>
                                    </a><br>
                                    <span style="text-align: center;">Estados</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=categoria" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-share-alt"></span>
                                    </a><br>
                                    <span style="text-align: center;">Categorias</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=medioreporte" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-external-link"></span>
                                    </a><br>
                                    <span style="text-align: center;">Medio de Reporte</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=viewproceso" style="color: #3e5771;">
                                        <span style="text-align: center;font-size: 60px;" class="fa fa-spinner"></span>
                                    </a><br>
                                    <span style="text-align: center;">Proceso de Incidente</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=bloque_ubicacion" style="color: #3e5771;">
                                        <span style="text-align: center; font-size: 60px;" class="fa fa-cubes"></span>
                                    </a><br>
                                    <div style="text-align: center;">Bloques</div>
                                </div>

                            </ul>
                            <ul class="span10" style="padding-top: 20px;">
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=listadocausas" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-list"></span>
                                    </a><br>
                                    <span style="text-align: center;">Causas de Incidentes</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=piezapartes" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-cogs"></span>
                                    </a><br>
                                    <span style="text-align: center;">Piezas y Partes</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=solicitudespiezapartes" style="color: #3e5771;">
                                        <span style="font-size: 60px;" class="fa fa-cogs"></span>
                                    </a><br>
                                    <span style="text-align: center;">Solicitudes Piezas y Partes</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=tipoincidente" style="color: #3e5771;">
                                        <span style="text-align: center; font-size: 60px;" class="fa fa-sitemap"></span>
                                    </a><br>
                                    <span style="text-align: center;">Tipo de incidente</span>
                                </div>

                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=bodega" style="color: #3e5771;">
                                        <span style="text-align: center; font-size: 60px;" class="fa fa-archive"></span>
                                    </a><br>
                                    <span style="text-align: center;">Existencia Bodega</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=listaordentrabajo" style="color: #3e5771;">
                                        <span style="text-align: center; font-size: 60px;" class="fa fa-ambulance"></span>
                                    </a><br>
                                    <span style="text-align: center;">Orden Trabajo</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=viewtreematerial" style="color: #3e5771;">
                                        <span style="text-align: center; font-size: 60px;" class="fa fa-list"></span>
                                    </a><br>
                                    <span style="text-align: center;">Materiales</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=viewtreeunidadmedida" style="color: #3e5771;">
                                        <span style="text-align: center; font-size: 60px;" class="fa fa-cubes"></span>
                                    </a><br>
                                    <span style="text-align: center;">Unidad de Medidas</span>
                                </div>
                                <div style="width:100px; text-align: center; float: left; margin: 15px 5px 5px 5px">
                                    <a href="/adm_hdincidente?action=viewtreedepartarment" style="color: #3e5771;">
                                        <span style="font-size: 60px; " class="fa fa-building"></span>
                                    </a><br>
                                    <span style="text-align: center;">Departamentos</span>
                                </div>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitled">Detalle de Incidente</h3>
            <span class="btn btn-mini btn-default pull-right  cerrar_detalle" style="margin-top: -25px"><i class="fa fa-close" style="color: red"></i></span>
        </div>
        <div class="modal-body panelbody">

        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="modal fade static" id="itemspanelreportegeneral_excel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle"><span class="fa fa-file-excel-o"></span> Reporte general en excel </h3>
        </div>
        <div class="modal-body panelbody">

            <div class='span2'>
                <span>De: </span><input type="text" class="selectorfecha" value="" id="id_fecha_de" style="width: 120px" >
            </div>
            <div class='span2'>
                <span>Hasta: </span><input type="text" class="selectorfecha" value="" id="id_fecha_hasta" style="width: 120px" >
            </div><br>

        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_excel"><i class="fa fa-file-pdf-o"></i> Generar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrar_excel"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="modal fade" id="itemspanelreportegeneral_excelh" style="display: none;" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-header">
            <h3 class="paneltitle"><span class="fa fa-file-excel-o"></span> Reporte general en excel </h3>
        </div>
        <div class="modal-body panelbody">
            <div class="row">
                <div class='span3'>
                    <span>De: </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" class="selectorfecha" value="{{ fecha|date:"d-m-Y"  }}" id="id_fecha_deh" style="width: 120px" >
                </div>
                <div class='span3'>
                    <span>Hasta: </span>&nbsp;&nbsp;<input type="text" class="selectorfecha" value="{{ fecha|date:"d-m-Y"  }}" id="id_fecha_hastah" style="width: 120px" >
                </div><br><br>
            </div>
            <div class="row">
                <div class='span3'> <span>Estado: </span>
                           <select id='id_estado' style="width: 200px">
                                <option value="0">TODOS LOS ESTADOS</option>
                                {% for c in estado %}
                                    <option value='{{ c.0 }}' >{{ c.1 }}</option>
                                {% endfor %}
                           </select> <br>
                </div>
                <div class='span3'> <span>Bloque: </span>
                          <select id='id_bloque' style="width: 200px">
                                 <option value="0">TODOS LOS BLOQUES</option>
                                 {% for c in bloque %}
                                    <option value='{{ c.id }}' >{{ c.nombre }}</option>
                                {% endfor %}
                          </select>
                </div><br><br>
            </div>
            <div class="row">
                 <div class='span5'> <span>Técnico: </span>
                     <select id='id_tecnico' style="width: 400px">
                            <option value="0">TODOS LOS TÉCNICOS</option>
                            {% for c in tecnico %}
                                <option value='{{ c.id }}' >{{ c.nombre_completo_inverso }}</option>
                            {% endfor %}
                      </select>
                 </div>
                 <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="checktodosexc" value="0" name="checktodosexc"> <span>TODOS: </span>
                 </div>
                <br>
             </div>

        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_excelh"><i class="fa fa-file-pdf-o"></i> Generar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrar_excelh"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>
      <div class="modal fade" id="itemspanelreportegeneral_excelhpdf" style="display: none;" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-header">
            <h3 class="paneltitle"><span class="fa fa-file-pdf-o"></span> Reporte general en Pdf </h3>
        </div>
        <div class="modal-body panelbody">
            <div class="row">
                <div class='span3'>
                    <span>De: </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" class="selectorfecha" value="{{ fecha|date:"d-m-Y"  }}" id="id_fecha_dehpdf" style="width: 120px" >
                </div>
                <div class='span3'>
                    <span>Hasta: </span>&nbsp;&nbsp;<input type="text" class="selectorfecha" value="{{ fecha|date:"d-m-Y"  }}" id="id_fecha_hastahpdf" style="width: 120px" >
                </div><br><br>
            </div>
            <div class="row">
                <div class='span3'> <span>Estado: </span>
                           <select id='id_estadopdf' style="width: 200px">
                               <option value="0">TODOS LOS ESTADOS</option>
                                {% for c in estado %}
                                    <option value='{{ c.0 }}' >{{ c.1 }}</option>
                                {% endfor %}
                           </select> <br>
                </div>
                <div class='span3'> <span>Bloque: </span>
                          <select id='id_bloquepdf' style="width: 200px">
                                <option value="0">TODOS LOS BLOQUES</option>
                                 {% for c in bloque %}
                                    <option value='{{ c.id }}' >{{ c.nombre }}</option>
                                {% endfor %}
                          </select>
                </div><br><br>
            </div>
            <div class="row">
                 <div class='span5'> <span>Técnico: </span>
                     <select id='id_tecnicopdf' style="width: 400px">
                            <option value="0">TODOS LOS TÉCNICOS</option>
                            {% for c in tecnico %}
                                <option value='{{ c.id }}' >{{ c.nombre_completo_inverso }}</option>
                            {% endfor %}
                      </select>
                 </div>
                 <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="checktodospdf" value="0" name="checktodospdf"> <span>TODOS: </span>
                 </div>
                <br>
             </div>

        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_excelhpdf"><i class="fa fa-file-pdf-o"></i> Generar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrar_excelhpdf"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel3" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle">Informe de incidentes</h4>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-danger invalidofechas" style="display: none">
                <i class="fa fa-info-sign"></i> Seleccione un rango de fechas valida para continuar...!!!
            </div>
            <div style="text-align: center;">
                <input placeholder="Fecha desde" type="text" value="{{ fechainicio }}" name="fini" id="id_fecha_inicio" style="width: 100px">
                <input placeholder="Fecha hasta" type="text" value="{{ fechafin }}" name="ffin" id="id_fecha_fin" style="width: 100px"><br><br>
            </div>
        </div>
        <div class="modal-footer" style="text-align: center">
            <a href="javascript:;" class="btn btn-danger" id="itemspanel_adicionar_3"><i class="fa fa-plus"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel_cerrar_3"> Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="itemspanelpartes" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle">Informe de incidentes</h4>
        </div>
        <div class="modal-body panelbodypartes">
            <div class="alert alert-danger invalidopartes" style="display: none">
                <i class="fa fa-info-sign"></i> Seleccione un rango de fechas valida para continuar...!!!
            </div>
            <div style="text-align: center;">
                <input placeholder="Fecha desde" type="text" value="{{ fechainicio }}" name="fini" id="id_fecha_iniciopartes" style="width: 100px">
                <input placeholder="Fecha hasta" type="text" value="{{ fechafin }}" name="ffin" id="id_fecha_finpartes" style="width: 100px"><br><br>
            </div>
        </div>
        <div class="modal-footer" style="text-align: center">
            <a href="javascript:;" class="btn btn-danger" id="itemspanel_adicionar_partes"><i class="fa fa-plus"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel_cerrar_partes"> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelencuesta" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle">Informe de encuesta</h4>
        </div>
        <div class="modal-body panelbodyencuesta">
            <div class="alert alert-danger invalidoencuesta" style="display: none">
                <i class="fa fa-info-sign"></i> Seleccione un rango de fechas valida para continuar...!!!
            </div>
            <div style="text-align: center;">
                <input placeholder="Fecha desde" type="text" value="{{ fechainicio }}" name="fini" id="id_fecha_inicioencuesta" style="width: 100px">
                <input placeholder="Fecha hasta" type="text" value="{{ fechafin }}" name="ffin" id="id_fecha_finencuesta" style="width: 100px"><br><br>
            </div>
        </div>
        <div class="modal-footer" style="text-align: center">
            <a href="javascript:;" class="btn btn-danger" id="itemspanel_adicionar_encuesta"><i class="fa fa-plus"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel_cerrar_encuesta"> Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="itemspanelencuestaexcel" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle">Informe de encuesta</h4>
        </div>
        <div class="modal-body panelbodyencuestaexcel">
            <div class="alert alert-danger invalidoencuestaexcel" style="display: none">
                <i class="fa fa-info-sign"></i> Seleccione un rango de fechas valida para continuar...!!!
            </div>
            <div style="text-align: center;">
                <input placeholder="Fecha desde" type="text" value="{{ fechainicio }}" name="fini" id="id_fecha_inicioencuestaexcel" style="width: 100px">
                <input placeholder="Fecha hasta" type="text" value="{{ fechafin }}" name="ffin" id="id_fecha_finencuestaexcel" style="width: 100px"><br><br>
            </div>
        </div>
        <div class="modal-footer" style="text-align: center">
            <a href="javascript:;" class="btn btn-danger" id="generar_excelencuesta"><i class="fa fa-plus"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel_cerrar_encuestaexcel"> Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="itemspanelseleccionaractivo" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitled">Seleccionar activo</h3>
        </div>
        <div class="modal-body panelbody">
            <form id="form2" class="form-horizontal form-modal" style="width: 100%; margin-bottom: 0">
                {% for field in form2 %}
                    <fieldset id="fieldset_{{ field.name }}" class="control-group nomargins" style="min-height:35px; float: left; width: 100%" >
                        <div class="control-label label-text" {% if field.field.widget.attrs.labelwidth %}labelwidth="{{ field.field.widget.attrs.labelwidth }}"{% endif %} style="display: table;height: 30px;">
                            <div style="display: table-cell; vertical-align: middle; line-height: 11px">
                                <label for="id_{{ field.name }}" style="padding-right: 20px">{{ field.label }}</label>
                            </div>
                        </div>
                        <div class="control" style="float: left; width: 100%">
                            {% if field.field.widget.attrs.select2search %}
                                <select id="id_{{ field.name }}_select2" {% if field.field.widget.attrs.disabled %}disabled=""{% endif %} style="width: 100%" >
                                    <option value="0" selected="selected">---------</option>
                                </select>
                                <input type='hidden' name="{{ field.name }}" id="id_{{ field.name }}" value="{{ field.value }}" hidden="hidden" {% if field.field.widget.attrs.descripcion %}descripcion="{{ field.field.widget.attrs.descripcion }}"{% endif %} class="select2hidden">
                            {% else %}
                                {{ field }}
                            {% endif %}
                            <p class="help-text" style="font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
            </form>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <a href="javascript:;" class="btn btn-success" id="guardar"><i class="fa fa-save"></i> Guardar</a>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="modal fade static" id="detalleactivomodal" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Detalles de activo</h3>
        </div>
        <div class="modal-body" id="detalleactivomodal_body"></div>
        <div class="modal-footer">
            <div style="float: right">
                <a href="javascript:;" id="detalleactivomodal_aceptar" class="btn btn-info btn-aceptar"> Aceptar</a>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="detailOrdenPedidoModal" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Orden de Pedido Nro. <span id="num_doc"></span> </h3>
        </div>
        <div class="modal-body">
            <div id="detailOrdenPedidoModal_contenido" style="max-height: 400px; overflow: auto">

            </div>
        </div>
        <div class="modal-footer">
            <div style="float: right">
                <a href="javascript:;" id="detailOrdenPedidoModal_cerrar" class="btn btn-info btn-aceptar"> Aceptar</a>
            </div>
        </div>
    </div>
{% endblock %}
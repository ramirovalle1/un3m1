{% extends "basebs.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <script>
        $(function() {
            $("select").select2({minimumResultsForSearch: 5 });

            $("#id_fecha_desde, #id_fecha_hasta, #id_fecha_desde_rv, #id_fecha_hasta_rv").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });

            $("#id_fecha_desde, #id_fecha_hasta, #id_fecha_desde_rv, #id_fecha_hasta_rv").blur(function () {
                fechavalida($(this));
            });

            $("#id_estadodocumento").change(function() {
                busqueda();
            });

            $("#search").click(function() {
                busqueda();
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    $("#search").trigger("click");
                }
            });

            busqueda = function () {
                location.href = "/adm_refinanciamientoposgrado?s="+$("#searchinput").val().toUpperCase()+"&estadodocumento="+$("#id_estadodocumento").val();
            };

            $(".mostrarrecorrido").click(function() {
                var id = $(this).attr('ids');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'mostrarrecorrido', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyrecorrido").html(data.data);
                            $("#itemspanelrecorrido").modal({backdrop:'static', width: '700px', height: '500px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelrecorrido .btn-cerrar").click(function() {
                $("#itemspanelrecorrido").modal("hide");
                {#return false;#}
            });

            $("#cerrar, #cerrar2").click(function () {
                $('#itemspanelvalidarsolicitud').modal('hide');
            });

            $(".validarsolicitud").click(function () {
                var ids=$(this).attr('ids');
                var estadodoc=$("#id_estadodocumento").val();
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'validarjustificativo', 'ids': ids ,'estadodocumento': estadodoc},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyvalidarsolicitud").html(data.data);
                            $(".paneltitlevalidarsolicitud").html(data.title);
                            $("#itemspanelvalidarsolicitud").modal({backdrop:'static', width: '800px', height: '500px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });


            $(".propuestarefinaciamiento").click(function () {
                var id=$(this).attr('ids');
                elaborarpropuesta(id);
            });

            elaborarpropuesta = function (idsolicitud){
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'elaborarpropuesta', 'id': idsolicitud},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodypropuesta").html(data.data);
                            $(".paneltitlepropuesta").html(data.title);
                            $("#itemspanelpropuesta").modal({backdrop:'static', width: '100%', height: '100%'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            };

            $("#itemspanelpropuesta .guardar").click(function () {
                {#if(!validardatos())#}
                {#    return false;#}

                envioformularioreg("/adm_refinanciamientoposgrado","guardarpropuesta", false);
                return false;
            });

            $("#itemspanelpropuesta .cerrar").click(function () {
                $('#itemspanelpropuesta').modal('hide');
            });

            $("#itemspanelpropuesta .cerrar2").click(function () {
                $('#itemspanelpropuesta').modal('hide');
            });

            validardatospropuesta = function (){
                var validacion = true;
                if(parseFloat($("#valorpagar").val()) < 1){
                    smoke.alert("El valor a pagar para refinanciar debe ser mayor a 0");
                    return false;
                }

                if(parseFloat($("#totalsumacuotas").val()) < 1){
                    smoke.alert("Ingrese el detalle de cuotas a pagar");
                    return false;
                }

                $('input[name="fechacuota[]"]').each(function () {
                    if ($(this).val().trim() == '') {
                        smoke.alert("Ingrese las fechas de todas las cuotas")
                        validacion = false;
                        return false;
                    }
                    else if(!fechavalida( ($(this).val()))){
                        smoke.alert("El formato de las fechas de las cuotas debe ser AAAA-MM-DD.");
                        validacion = false;
                        return false;
                    }

                });

                if(validacion){
                    $('input[name="valorcuota[]"]').each(function () {
                        if ($(this).val().trim() == '') {
                            smoke.alert("Ingrese el valor de todas las cuotas")
                            validacion = false;
                            return false;
                        }
                        else if(parseFloat($(this).val()) == 0){
                            smoke.alert("El valor de las cuotas debe ser mayor a 0.");
                            validacion = false;
                            return false;
                        }

                    });
                }


                if(validacion) {
                    if (parseFloat($("#totalrefinanciar").val()) != parseFloat($("#totalsumacuotas").val())) {
                        smoke.alert("El Total Cuotas debe ser igual al Total a Refinanciar");
                        return false;
                    }
                }
                return validacion;
            };

            validardatoscuotaspropuesta = function (){
                var validacion = true;

                $('input[name="valorcuota[]"]').each(function () {
                    if ($(this).val().trim() == '') {
                        smoke.alert("Ingrese el valor de todas las cuotas")
                        validacion = false;
                        return false;
                    }
                    else if(parseFloat($(this).val()) == 0){
                        smoke.alert("El valor de las cuotas debe ser mayor a 0.");
                        validacion = false;
                        return false;
                    }

                });

                if(validacion) {
                    if (parseFloat($("#totalrefinanciar").val()) != parseFloat($("#totalsumacuotas").val())) {
                        smoke.alert("El Total Cuotas debe ser igual al Total a Refinanciar");
                        return false;
                    }
                }
                return validacion;
            };

            fechavalida = function (dateString){
                var regEx = /^\d{4}-\d{2}-\d{2}$/;
                if(!dateString.match(regEx)) return false;  // Invalid format
                var d = new Date(dateString);
                var dNum = d.getTime();
                if(!dNum && dNum !== 0) return false; // NaN value, Invalid date
                return d.toISOString().slice(0,10) === dateString;
            };

            envioformularioreg = function(url, action, destino){
                if(action == 'guardarpropuesta')
                    valido = validardatospropuesta();
                else if(action == 'validardocumentocompromiso')
                    valido = datosrevisiondocumentoscompletos();
                else if(action == 'editarcuotaspropuesta')
                    valido = validardatoscuotaspropuesta();

                if (valido){
                    bloqueointerface();
                    if(action == 'guardarpropuesta')
                        var formdata = new FormData($("#formulario1")[0]);
                    else if(action == 'validardocumentocompromiso')
                        var formdata = new FormData($("#formulario2")[0]);
                    else if(action == 'editarcuotaspropuesta')
                        var formdata = new FormData($("#formulario3")[0]);


                    $.ajax({
                        type: "POST",
                        action : action,
                        url: url,
                        data:  formdata,
                        success: function(data) {
                            if (data.result == 'ok') {
                                if(action == 'guardarpropuesta') {
                                    //$.unblockUI();
                                    location.href = "/adm_refinanciamientoposgrado";
                                }
                                else if(action == 'validardocumentocompromiso'){
                                    //$.unblockUI();
                                    location.href = "/adm_refinanciamientoposgrado";
                                }
                                else if(action == 'editarcuotaspropuesta'){
                                    //$.unblockUI();
                                    location.href = "/adm_refinanciamientoposgrado";
                                }

                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error al enviar los datos.");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }
            };



            $("#cerrar, #cerrar2").click(function () {
                $('#itemspanelvalidarpago').modal('hide');
            });

            $(".validarpago").click(function () {
                var ids=$(this).attr('ids');
                var estadodoc=$("#id_estadodocumento").val();
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'validarpago', 'ids': ids ,'estadodocumento': estadodoc},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyvalidarpago").html(data.data);
                            $(".paneltitlevalidarpago").html(data.title);
                            $("#itemspanelvalidarpago").modal({backdrop:'static', width: '850px', height: '530px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });



            $("#cerrar, #cerrar2").click(function () {
                $('#itemspanelvalidardocumentocompromiso').modal('hide');
            });

            $(".validardocumentocompromiso").click(function () {
                var idm=$(this).attr('idm');

                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'validardocumentocompromiso', 'idm': idm},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyvalidardocumentocompromiso").html(data.data);
                            $(".paneltitlevalidardocumentocompromiso").html(data.title);
                            $("#itemspanelvalidardocumentocompromiso").modal({backdrop:'static', width: '100%', height: '600px'}).modal('show');
                            //$("#itemspanelvalidardocumentocompromiso").modal({backdrop:'static', width: '800px', height: '500px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelvalidardocumentocompromiso .guardar2").click(function () {
                envioformularioreg("/adm_refinanciamientoposgrado","validardocumentocompromiso", false);
            });

            datosrevisiondocumentoscompletos = function (){
                var validacion = true;

                $('select[name="estadodocumento[]"]').each(function() {
                    valor = parseInt($(this).val());
                    idc = $(this).attr('id');

                    if(valor == 3){
                        obse = $("#obsereg_"+idc).val().trim();
                        if(obse == ''){
                            smoke.alert("Ingrese las observaciones para los documentos RECHAZADOS.");
                            validacion = false;
                            return false;
                        }
                    }
                    else if(valor == 0){
                        smoke.alert("Seleccione el estado para cada uno de los documentos.");
                        validacion = false;
                        return false;
                    }
                });

                if(validacion){
                    if($("#estadocompromiso").val() == '4'){
                        if($("#observacion").val().trim()=='')
                        {
                            smoke.alert("Ingrese las observaciones.");
                            validacion = false;
                            return false;
                        }
                    }
                }

                return validacion;
            };

            $(".reporte_solicitudes").click(function () {
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'verificar_solicitudes_existentes'},
                    success: function(data) {
                        if (data.result=='ok') {
                            $.unblockUI();
                            location.href = "/adm_refinanciamientoposgrado?action=listadosolicitudes";
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });
            });


            $(".mostrarpropuesta").click(function () {
                var id=$(this).attr('ids');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'mostrarpropuesta', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodymostrarpropuesta").html(data.data);
                            $(".paneltitlemostrarpropuesta").html(data.title);
                            $("#itemspanelmostrarpropuesta").modal({backdrop:'static', width: '800px', height: '600px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelmostrarpropuesta .cerrar").click(function () {
                $('#itemspanelmostrarpropuesta').modal('hide');
            });

            $("#itemspanelmostrarpropuesta .cerrar2").click(function () {
                $('#itemspanelmostrarpropuesta').modal('hide');
            });


            $(".editarpropuesta").click(function () {
                var id=$(this).attr('ids');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'editarcuotaspropuesta', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyeditarpropuesta").html(data.data);
                            $(".paneltitleeditarpropuesta").html(data.title);
                            $("#itemspaneleditarpropuesta").modal({backdrop:'static', width: '800px', height: '600px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#itemspaneleditarpropuesta .guardar").click(function () {
                envioformularioreg("/adm_refinanciamientoposgrado","editarcuotaspropuesta", false);
                return false;
            });

            $("#itemspaneleditarpropuesta .cerrar").click(function () {
                $('#itemspaneleditarpropuesta').modal('hide');
            });

            $("#itemspaneleditarpropuesta .cerrar2").click(function () {
                $('#itemspaneleditarpropuesta').modal('hide');
            });



            $(".reporte_solicitudes_validadas").click(function () {
                $(".panelbodysolicitudvalidada").html();
                $("#titulomodalrv").html('Reporte Solicitudes Devolución Validadas');
                $("#itemspanelsolicitudvalidada").modal({backdrop:'static', width: '520px'}).modal('show');
            });

            $("#generar_reporte").click(function () {
                var fechadesde = $("#id_fecha_desde_rv").val();
                var fechahasta = $("#id_fecha_hasta_rv").val();

                bloqueointerface();

                $.ajax({
                    type: "POST",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'desde': fechadesde,
                           'hasta': fechahasta,
                           'action': 'verificar_solicitudes_validadas_reporte'},
                    success: function(data) {
                        if (data.result=='ok') {
                            $.unblockUI();
                            location.href = "/adm_refinanciamientoposgrado?action=solicitudesvalidadas&desde="+fechadesde+"&hasta="+fechahasta;
                            $('#itemspanelsolicitudvalidada').modal('hide');
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });
            });

            $("#cerrar_reporte").click(function () {
                $('#itemspanelsolicitudvalidada').modal('hide');
            });


            $(".reporte_solicitudes_rechazadas").click(function () {
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'verificar_solicitudes_rechazadas'},
                    success: function(data) {
                        if (data.result=='ok') {
                            $.unblockUI();
                            location.href = "/adm_refinanciamientoposgrado?action=solicitudesrechazadas";
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });
            });

            $(".reporte_solicitudes_pendiente_revisar").click(function () {
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'action': 'verificar_solicitudes_pendientes_revisar'},
                    success: function(data) {
                        if (data.result=='ok') {
                            $.unblockUI();
                            location.href = "/adm_refinanciamientoposgrado?action=solicitudespendientesrevisar";
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });
            });




            $(".generar_archivo_csv").click(function () {
                $(".panelbodyarchivobeneficiario").html();
                $("#titulomodal").html('Generar Archivo Cuentas Beneficiarios');
                $("#itemspanelarchivobeneficiario").modal({backdrop:'static', width: '520px'}).modal('show');
            });

            $("#generar_archivo").click(function () {
                var fechadesde = $("#id_fecha_desde").val();
                var fechahasta = $("#id_fecha_hasta").val();

                bloqueointerface();

                $.ajax({
                    type: "POST",
                    url: "/adm_refinanciamientoposgrado",
                    data: {'desde': fechadesde,
                           'hasta': fechahasta,
                           'action': 'verificar_cuentas_validadas'},
                    success: function(data) {
                        if (data.result=='ok') {
                            $.unblockUI();
                            location.href = "/adm_refinanciamientoposgrado?action=generarbeneficiarioscsv&desde="+fechadesde+"&hasta="+fechahasta;
                            $('#itemspanelarchivobeneficiario').modal('hide');
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });
            });

            $("#cerrar_archivo").click(function () {
                $('#itemspanelarchivobeneficiario').modal('hide');
            });




        });
    </script>
{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4>
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>

{#            <div class="btn-group">#}
{#                <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="javascript:;">Procesos <span class="caret"></span></a>#}
{#                <ul class="dropdown-menu pull-left">#}
{#                    <li class="dropdown-submenu">#}
{#                        <a href="#"><i class="fa fa-money"></i> Actualización Estado Pagado</a>#}
{#                        <ul class="dropdown-menu pull-left">#}
{#                            <li><a href="javascript:;" class="actualizar_estado_pagado"><i class="fa fa-check-square-o"></i> Actualizar Estado Pagado</a></li>#}
{#                            <li><a href="javascript:;" class="notificar_pagado_email"><i class="fa fa-envelope"></i> Notificar pagado por e-mail</a></li>#}
{#                        </ul>#}
{#                    </li>#}
{#                    <li class="dropdown-submenu">#}
{#                        <a href="#"><i class="fa fa-handshake-o"></i> Actualización Estado Acreditado</a>#}
{#                        <ul class="dropdown-menu pull-left">#}
{#                            <li><a href="javascript:;" class="actualizar_estado_acreditado"><i class="fa fa-check-square-o"></i> Actualizar Estado Acreditado</a></li>#}
{#                            <li><a href="javascript:;" class="notificar_acreditado_email"><i class="fa fa-envelope"></i> Notificar acreditado por e-mail</a></li>#}
{#                        </ul>#}
{#                    </li>#}
{##}
{#                </ul>#}
{#            </div>#}
            {% if not esconsultaepunemi %}
                <div class="btn-group">
                    <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="javascript:;">Reportes <span class="caret"></span></a>
                    <ul class="dropdown-menu pull-left">
                        <li><a href="javascript:;" class="reporte_solicitudes"><i class="fa fa-table"></i> Solicitudes de Refinanciamiento</a></li>
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>

    <div class='row-fluid'>
        <div class="span6">
            <table class="table table-bordered" style="padding: 0px; margin: 0px">
                <tr>
                    <td style="margin: 2px; padding: 4px;">Total Solicitudes: <span class="badge badge-inverse tu" title="Total Solicitudes"><strong>{{ totalsolicitudes }}</strong></span></td>
{#                    <td style="margin: 2px; padding: 4px;">T.Validadas: <span class="badge badge-success tu" title="Total Solicitudes Validadas"><strong>{{ totalaprobadas }}</strong></span></td>#}
{#                    <td style="margin: 2px; padding: 4px;">T.Rechazadas: <span class="badge badge-important tu" title="Total Solicitudes Rechazadas"><strong>{{ totalrechazadas }}</strong></span></td>#}
{#                    <td style="margin: 2px; padding: 4px;">T.En Revisión: <span class="badge badge-warning tu" title="Total Solicitudes en revisión"><strong>{{ totalrevision }}</strong></span></td>#}
{#                    <td style="margin: 2px; padding: 4px;">T. Por Revisar: <span class="badge badge-info tu" title="Total Solicitudes Pendientes de revisar"><strong>{{ totalpendiente }}</strong></span></td>#}
                </tr>
            </table>
        </div>
        <div class="span2">
            <strong>Estado:</strong>
            <select id="id_estadodocumento" style="width: 150px">
                {% if not esconsultaepunemi %}
                    <option value="0" selected="selected">TODOS</option>
                {% endif %}
                {% for estado in estados %}
                    <option value="{{ estado.valor }}" {% if estadodocumento == estado.valor %}selected="selected"{% endif %}>{{ estado.descripcion }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="span4" style="text-align: right">
            <form class="form-search">
                <input class='searchinput' type='text' id='searchinput' value='{{ search }}' autocomplete="off"/>
                <a href="javascript:;" id='search' class='btn btn-info'><span class="fa fa-search "></span> Buscar</a>
                {% if search or ids %}
                    <a href="/adm_refinanciamientoposgrado" id='allresults' class='btn btn-info'><span class="fa fa-refresh "></span> Todos</a>
                {% endif %}
            </form>
        </div>
    </div>
    <div id="no-more-tables"><!-- inicio no more tables-->
        <div class="row-fluid">
            <div class='span12'>
                <table class='table table-bordered' cellpadding="0" cellspacing="0">
                    <thead>
                    <tr>
                        <th style="width: 5%; text-align: center">N° Solicitud</th>
                        <th style="width: 10%; text-align: center">Fecha</th>
                        <th style="width: 20%; text-align: center">Nombres/Identificación</th>
                        <th style="width: 5%; text-align: center">E-mails, Telefónos</th>
                        <th style="width: 20%; text-align: center">Programa/Cohorte</th>
                        <th style="width: 40%; text-align: center">Motivo Refinanciamiento</th>
                        <th style="width: 5%; text-align: center">Total Pendiente</th>
                        <th style="width: 5%; text-align: center">Pago Requerido</th>
                        <th style="width: 5%; text-align: center">Total Refinanciar</th>
                        <th style="width: 5%; text-align: center">Estado</th>
                        <th style="width: 5%; text-align: center">Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for solicitud in solicitudes %}
                        <tr>
                            <td style="text-align: center"><span class="label label-success">{{ solicitud.id|stringformat:"05d" }}</span> </td>
                            <td style="text-align: center" data-title="Fecha Solicitud:">
                                <span class="label label-info tu" title="Fecha de Solicitud">{{ solicitud.fecha_creacion|date:"Y-m-d" }}</span><br>
                            </td>
                            <td style="text-align: left;" data-title="Nombres/Identificación:">
                                {{ solicitud.persona.nombre_completo_inverso }}<br>
                                <span class="label label-warning">{{ solicitud.persona.identificacion }}</span>
                                {% if solicitud.matricula.bloqueomatricula %}
                                    <span class="label label-important">MATRICULA BLOQUEADA</span>
                                {% endif %}
                            </td>
                            <td data-title="E-mails, Teléfonos:">
                                {% for email in solicitud.persona.lista_emails %}
                                    <a href="mailto:{{ email }}">{{ email }}</a>{% if not forloop.last %}, {% endif %}
                                {% endfor %}<br>
                                {%  for telefono in solicitud.persona.lista_telefonos %}
                                    {{ telefono }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </td>
                            <td style="text-align: justify" data-title="Programa/Cohorte">
                                {{ solicitud.matricula.inscripcion.carrera.nombre }}<br>
                                {{ solicitud.matricula.nivel.periodo.nombre }}
                            </td>
                            <td style="text-align: justify" data-title="Motivo">
                                {% if solicitud.motivo != 5 %}
                                    {{ solicitud.get_motivo_display }}
                                {% else %}
                                    {{ solicitud.otromotivo }}
                                {% endif %}
                            </td>
                            <td style="text-align: center" data-title="Total Pendiente:">
                                <span class="label label-warning tu" title="Total Pendiente antes de refinanciamiento">$ {{ solicitud.pendiente|floatformat:2|intcomma }}</span>
                            </td>
                            <td style="text-align: center" data-title="Pago Requerido:" >
                                {% if solicitud.pagorequerido %}
                                    <span class="label label-info">$ {{ solicitud.pagorequerido|floatformat:2|intcomma }}</span>
                                {% endif %}
                            </td>
                            <td style="text-align: center" data-title="Total Refinanciar:">
                                {% if solicitud.montorefinanciar %}
                                    <span class="label label-success">$ {{ solicitud.montorefinanciar|floatformat:2|intcomma }}</span>
                                {% endif %}
                            </td>
                            <td style="text-align: center" data-title="Estado:">
                                <span class="{{ solicitud.estado.clase }} tu" title="{{ solicitud.estado.observacion }}">{{ solicitud.estado.descripcion }}</span>
                            </td>
                            <td>
                                <div class="btn-group">
                                    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones <span class="caret"></span></a>
                                    <ul class="dropdown-menu pull-right">
                                        <li><a class="mostrarrecorrido" ids="{{ solicitud.id|encrypt }}" href="javascript:;"><i class="fa fa-list-ol"></i> Mostrar Recorrido</a></li>

                                        {% if solicitud.estado.valor == 1 or solicitud.estado.valor == 4 or solicitud.estado.valor == 5 or solicitud.estado.valor == 6 %}
                                            {% if not solicitud.rubrosgenerados %}
                                                <li><a class="validarsolicitud" ids="{{ solicitud.id|encrypt }}" href="javascript:;"><i class="fa fa-check-square-o"></i> Revisar y Validar Justificativo</a></li>
                                            {% endif %}
                                        {% endif %}

                                        {% if solicitud.puedeanular %}
                                            <li><a class="eliminacionmodal" href="javascript:;" nhref="/adm_refinanciamientoposgrado?action=anularsolicitud&id={{ solicitud.id|encrypt }}"><span class="fa fa-remove"></span> Anular Proceso</a></li>
                                        {% endif %}

                                        {% if solicitud.estado.valor == 2 and not solicitud.rubrosgenerados %}
                                            <li><a class="propuestarefinaciamiento" ids="{{ solicitud.id|encrypt }}" href="javascript:;"><i class="fa fa-edit"></i> Propuesta de Refinanciamiento</a></li>
                                        {% endif %}

                                        {% if solicitud.montorefinanciar %}
                                            <li><a class="mostrarpropuesta" ids="{{ solicitud.id|encrypt }}" href="javascript:;"><i class="fa fa-table"></i> Mostrar Propuesta</a></li>
                                        {% endif %}

                                        {% if solicitud.estado.valor == 14 %}
                                            <li><a class="editarpropuesta" ids="{{ solicitud.id|encrypt }}" href="javascript:;"><i class="fa fa-edit"></i> Editar Cuotas de Propuesta</a></li>
                                        {% endif %}

                                        {% if solicitud.matricula.tiene_cargado_documentos_compromiso_pago_refinanciamiento %}
                                            {% if solicitud.estado.valor != 20 %}
                                                <li><a class="validardocumentocompromiso" idm="{{ solicitud.matricula.id|encrypt }}" href="javascript:;"><i class="fa fa-check-square-o"></i> Legalizar Refinanciamiento Maestría</a></li>
                                            {% else %}
                                                <li><a class="validardocumentocompromiso" idm="{{ solicitud.matricula.id|encrypt }}" href="javascript:;"><i class="fa fa-search"></i> Mostrar Refinanciamiento Maestría</a></li>
                                            {% endif %}
                                        {% endif %}
                                    </ul>

                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="12" style="text-align: center">
                                NO EXISTEN SOLICITUDES DE REFINANCIAMIENTO REGISTRADAS
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class='row-fluid'>
        {% if paging.num_pages > 20 %}
            <div class='pagination'>
                <ul>
                    {% if paging.primera_pagina %}
                        <li><a href="/adm_refinanciamientoposgrado?page=1{% if estadodocumento %}&estadodocumento={{ estadodocumento }}{% endif %}">1</a></li>
                        <li><a href="/adm_refinanciamientoposgrado?page={{ paging.ellipsis_izquierda }}{% if estadodocumento %}&estadodocumento={{ estadodocumento}}{% endif %}" class="active">...</a></li>
                    {% endif %}
                    {% for pagenumber in paging.paginas %}
                        <li {%  if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_refinanciamientoposgrado?page={{ pagenumber }}{% if tipoid %}&t={{ tipoid }}{% endif%}{% if estadodocumento %}&estadodocumento={{ estadodocumento}}{% endif %}">{{ pagenumber }}</a></li>
                    {% endfor %}
                    {% if paging.ultima_pagina %}
                        <li><a href="/adm_refinanciamientoposgrado?page={{ paging.ellipsis_derecha }}{% if estadodocumento %}&estadodocumento={{ estadodocumento}}{% endif %}" class="active">...</a></li>
                        <li><a href="/adm_refinanciamientoposgrado?page={{ paging.num_pages }}{% if estadodocumento %}&estadodocumento={{ estadodocumento }}{% endif %}">{{ paging.num_pages }}</a></li>
                    {% endif %}
                </ul>
            </div>
        {% else %}
            <div class='pagination'>
                <ul>
                    {% for pagenumber in paging.page_range %}
                        <li {%  if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_refinanciamientoposgrado?{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}{% if tipoid %}&t={{ tipoid }}{% endif %}{% if estadodocumento %}&estadodocumento={{ estadodocumento }}{% endif %}">{{ pagenumber }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>

    <div class="modal fade static" data-keyboard="false" id="itemspanelrecorrido" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitlerecorrido">Mostrar Recorrido de la Solicitud</h4>
        </div>
        <div class="modal-body panelbodyrecorrido">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>



    <div class="modal fade static" data-keyboard="false" id="itemspanelvalidarsolicitud" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlevalidarsolicitud">Revisar y Validar Justificativo</h4></td>
                    <td><a href="javascript:;" id="cerrar2" title="Cerrar" class="btn btn-danger btn-mini pull-right"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyvalidarsolicitud">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success" id="guardar"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger" id="cerrar"> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static" data-keyboard="false" id="itemspanelpropuesta" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlepropuesta">Revisar y Validar Contrato de Beca</h4></td>
                    <td><a href="javascript:;" title="Cerrar" class="btn btn-danger btn-mini pull-right cerrar2"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodypropuesta">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success guardar"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger cerrar"> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static" data-keyboard="false" id="itemspanelvalidarpago" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlevalidarpago">Revisar y Validar Justificativo</h4></td>
                    <td><a href="javascript:;" id="cerrar2" title="Cerrar" class="btn btn-danger btn-mini pull-right"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyvalidarpago">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success" id="guardarvalidapago"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger" id="cerrar"> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" data-keyboard="false" id="itemspanelvalidardocumentocompromiso" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlevalidardocumentocompromiso">Revisar y Validar Justificativo</h4></td>
                    <td><a href="javascript:;" id="cerrar2" title="Cerrar" class="btn btn-danger btn-mini pull-right"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyvalidardocumentocompromiso">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success guardar2" id="guardar2"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger" id="cerrar"> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static"  data-keyboard="false" id="itemspanelmostrarpropuesta" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlemostrarpropuesta">Revisar y Validar Contrato de Beca</h4></td>
                    <td><a href="javascript:;" title="Cerrar" class="btn btn-danger btn-mini pull-right cerrar2"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodymostrarpropuesta">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-danger cerrar"> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static"  data-keyboard="false" id="itemspaneleditarpropuesta" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitleeditarpropuesta">Revisar y Validar Contrato de Beca</h4></td>
                    <td><a href="javascript:;" title="Cerrar" class="btn btn-danger btn-mini pull-right cerrar2"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyeditarpropuesta">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success guardar"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger cerrar"> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static" id="itemspanelarchivobeneficiario" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span class="fa fa-file-excel-o"></span> <span id="titulomodal"></span></h4>
        </div>
        <div class="modal-body panelbodyarchivobeneficiario">
            <div class="span1"><span style="text-align: right; display: block; width: 90px">Validada Desde:</span></div>
            <div class='span1'>
                <input type="text" class="selectorfecha" value="{{ fechaactual }}" id="id_fecha_desde" style="width: 100px;">
            </div>
            <div class="span1"><span style="text-align: right; display: block; width: 90px">Validada Hasta:</span></div>
            <div class='span1'>
                <input type="text" class="selectorfecha" value="{{ fechaactual }}" id="id_fecha_hasta" style="width: 100px; ">
            </div>
            <br><br>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_archivo"><i class="fa fa-print"></i> Generar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-danger" id="cerrar_archivo"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelsolicitudvalidada" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span class="fa fa-file-excel-o"></span> <span id="titulomodalrv"></span></h4>
        </div>
        <div class="modal-body panelbodysolicitudvalidada">
            <div class="span1"><span style="text-align: right; display: block; width: 90px">Validada Desde:</span></div>
            <div class='span1'>
                <input type="text" class="selectorfecha" value="{{ fechaactual }}" id="id_fecha_desde_rv" style="width: 100px;">
            </div>
            <div class="span1"><span style="text-align: right; display: block; width: 90px">Validada Hasta:</span></div>
            <div class='span1'>
                <input type="text" class="selectorfecha" value="{{ fechaactual }}" id="id_fecha_hasta_rv" style="width: 100px; ">
            </div>
            <br><br>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_reporte"><i class="fa fa-print"></i> Generar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-danger" id="cerrar_reporte"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

{% endblock %}


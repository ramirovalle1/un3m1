{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src='/static/js/select2.js?v=2.0.0'></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=2.0.0"/>
    <script type="text/javascript">
        $(function () {
            $(".replicargrupotodos").click(function () {
                var codigogruporeplica = $(this).attr("codigrupo");
                $("#itemspanelreplicatodos").modal({backdrop: 'static', width: '400px'}).modal('show');
                $("#codigogruporeplicatodos").val(codigogruporeplica);
            });
            $("#adicionarreplicatodos").click(function () {
                var codigogruporeplica = $("#codigogruporeplicatodos").val();
                $("#itemspanelreplicatodos").modal("hide");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_complexivotematica",
                    data: {'action': 'adicionarreplicatodos', 'codigogruporeplica': codigogruporeplica},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            location.reload();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });
            $("#cerrarreplicatodos").click(function () {
                $("#itemspanelreplicatodos .incompletotemas").hide();
                $("#itemspanelreplicatodos .incompletovalotemas").hide();
                $("#itemspanelreplicatodos").modal("hide");
            });
            $(".replicargrupo").click(function () {
                var codigogruporeplica = $(this).attr("codigrupo");
                var codparticipantereplica = $(this).attr("codparticipante");
                $("#itemspanelreplica").modal({backdrop: 'static', width: '400px'}).modal('show');
                $("#codparticipantereplica").val(codparticipantereplica);
                $("#codigogruporeplica").val(codigogruporeplica);
            });
            $("#adicionarreplica").click(function () {
                var codparticipantereplica = $("#codparticipantereplica").val();
                var codigogruporeplica = $("#codigogruporeplica").val();
                $("#itemspanelreplica").modal("hide");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_complexivotematica",
                    data: {
                        'action': 'adicionarreplica',
                        'codigogruporeplica': codigogruporeplica,
                        'codparticipantereplica': codparticipantereplica
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            location.reload();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });
            $("#cerrarreplica").click(function () {
                $("#itemspanelreplica .incompletotemas").hide();
                $("#itemspanelreplica .incompletovalotemas").hide();
                $("#itemspanelreplica").modal("hide");
            });
            {#$("#fechacta").datepicker({format: "yyyy-mm-dd"}).on('changeDate', function (ev) {#}
            {#    $(this).datepicker('hide');#}
            {# });#}
            $(".editfechaacta").click(function () {
                var codparticipante = $(this).attr("codparticipante");
                var codfecha = $(this).attr("codfecha");
                $("#itemspanelfecha").modal({backdrop: 'static', width: '400px'}).modal('show');
                $("#fechacta").val(codfecha);
                $("#codparticipante").val(codparticipante);

            });
            $("#adicionarfechacerrar").click(function () {
                var codparticipante = $("#codparticipante").val();
                var fechacta = $("#fechacta").val();
                $("#itemspanelfecha").modal("hide");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_complexivotematica",
                    data: {'action': 'editfechaacta', 'fechacta': fechacta, 'codparticipante': codparticipante},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            location.reload();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });
            $("#cerrarfecha").click(function () {
                $("#itemspanelfecha .incompletotemas").hide();
                $("#itemspanelfecha .incompletovalotemas").hide();
                $("#itemspanelfecha").modal("hide");
            });
            $(".activasubirarchivofinal").click(function () {
                var idgru = $(this).attr("idgru");
                bloqueointerface();
                $.post("/adm_complexivotematica", {
                    'action': 'cambiaestadosubirarchivofinal',
                    "id_grupo": idgru
                }, function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        location.reload();
                    }
                }, "json");
            });

            $(".activasubirpropuesta").click(function () {
                var idgru = $(this).attr("idgru");
                bloqueointerface();
                $.post("/adm_complexivotematica", {
                    'action': 'cambiaestadopropuesta',
                    "id_grupo": idgru
                }, function (data) {
                    if (data.result == 'ok') {
                        location.reload();
                    }
                }, "json");
            });
            $(".activaactivaractas").click(function () {
                var idinte = $(this).attr("idinte");
                bloqueointerface();
                $.post("/adm_complexivotematica", {
                    'action': 'cambiaestadocerraracta',
                    "idinte": idinte
                }, function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        location.reload();
                    }
                }, "json");
            });
            $("#id_observacion").addClass("validate[required]");
            $(".detail").click(function () {
                var id = $(this).attr("idg");
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_complexivotematica",
                    data: {'action': 'detailgrupo', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#deletemodal").html(data.data);
                            $(".btn-cerrar").bind('click', function () {
                                $("#deletemodal").modal('hide');
                            });
                            $("#deletemodal").modal({backdrop: 'static', width: '450px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $(".detallecalificacion").click(function () {
                var id = $(this).attr("idpar");
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_complexivotematica",
                    data: {'action': 'detallecalificaciontribunal', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#deletemodal").html(data.data);
                            $(".btn-cerrar").bind('click', function () {
                                $("#deletemodal").modal('hide');
                            });
                            $("#deletemodal").modal({backdrop: 'static', width: '900px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $(".detalleproceso").click(function () {
                var id = $(this).attr("idpar");
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_complexivotematica",
                    data: {'action': 'detalleproceso', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#modaldetalleproceso").html(data.data);
                            $(".btn-cerrar").bind('click', function () {
                                $("#modaldetalleproceso").modal('hide');
                            });
                            $("#modaldetalleproceso").modal({backdrop: 'static', width: '1200px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            {% if perms.sga.puede_editar_cupotematica %}
                var maxintegrante = 0;
                eliminar = function () {
                    var op = $(this).attr('op');
                    var id = $("#deletemodal #id").val();
                    if (op === 't') {
                        var lista = [];
                        $(".integrantes").each(function () {
                            if ($(this).prop('checked')) {
                                lista.push($(this).attr('id'));
                            }
                        });
                        if (lista.length > 0) {
                            bloqueointerface();
                            $.ajax({
                                type: 'POST',
                                url: '/adm_complexivotematica',
                                data: {'action': 'deleteintegrante', 'lista': JSON.stringify(lista), 'id': id},
                                success: function (data) {
                                    $.unblockUI();
                                    $("#deletemodal").modal('hide');
                                    href = location.reload();
                                },
                                error: function () {
                                    $.unblockUI();
                                    smoke.alert("Error de conexión.");
                                },
                                dataType: "json"
                            });
                        } else {
                            $("#deletemodal").modal('hide');
                        }
                    } else {
                        $("#deletemodal").modal('hide');
                    }
                };

                $(".eliminar").on('click', function () {
                    var id = $(this).attr("idg");
                    bloqueointerface();
                    $.ajax({
                        type: "GET",
                        url: "/adm_complexivotematica",
                        data: {'action': 'delparticipante', 'id': id},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $("#deletemodal").html(data.data);
                                $(".btn-rechazar, .btn-aprobar").bind('click.eliminar', eliminar);
                                $("#deletemodal").modal({backdrop: 'static', width: '450px'}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                });

                {#asignar participante#}
                asignar = function () {
                    var op = $(this).attr('op');
                    var action = $(this).attr('action');
                    {#var id = $("#deletemodal #id").val();#}
                    var id = $(this).attr('codigote');
                    if (op === 't') {
                        if (listaintegrantes.length > 0) {
                            bloqueointerface();
                            $.ajax({
                                type: 'POST',
                                url: '/adm_complexivotematica',
                                data: {'action': action, 'lista': JSON.stringify(listaintegrantes), 'id': id},
                                success: function (data) {
                                    {#$.unblockUI();#}
                                    $("#deletemodal").modal('hide');
                                    href = location.reload();
                                },
                                error: function () {
                                    $.unblockUI();
                                    smoke.alert("Error de conexión.");
                                },
                                dataType: "json"
                            });
                        } else {
                            $("#deletemodal").modal('hide');
                        }
                    } else {
                        $("#deletemodal").modal('hide');
                    }
                };

                $(".asignar").on('click', function () {
                    var id = $(this).attr("idg");
                    bloqueointerface();
                    $.ajax({
                        type: "GET",
                        url: "/adm_complexivotematica",
                        data: {'action': 'addparticipante', 'id': id},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $("#deletemodal").html(data.data);
                                maxintegrante = data.maxintegrante;
                                $(".asignap").bind('click.asignar', asignar);
                                $("#deletemodal").modal({backdrop: 'static', width: '650px'}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                });
                $(".addgrupo").on('click', function () {
                    var id = $(this).attr("id");
                    bloqueointerface();
                    $.ajax({
                        type: "GET",
                        url: "/adm_complexivotematica",
                        data: {'action': 'addgrupo', 'id': id},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $("#deletemodal").html(data.data);
                                maxintegrante = data.maxintegrante;
                                $(".asignap").bind('click.asignar', asignar);
                                $("#deletemodal").modal({backdrop: 'static', width: '650px'}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                });
            {% endif %}

            var request;
            listaintegrantes = [];

            actualizar_lista = function () {
                listaintegrantes = [];

                $('.integrantes').each(function () {
                    listaintegrantes.push($(this).attr('iid'));
                });
                $("#otrosintegrantes").val(listaintegrantes);

                if (listaintegrantes.length >= maxintegrante) {
                    $("#integrantes").attr('disabled', 'disabled');
                } else {
                    $("#integrantes").removeAttr('disabled');
                }
            };

            buscar_alumnoins = function (query, process) {
                if (request) {
                    request.abort();
                }

                request = $.get("/adm_complexivotematica", {
                    'action': 'busqueda',
                    'q': query,
                    's': 10,
                    'c':{{tematica.carrera.id}}
                }, function (data) {
                    var dato;
                    if (data.results) {
                        $("#integrantes").get(0).results = data.results;
                        listing = [];
                        for (var i in data.results) {
                            dato = data.results[i];
                            listing.push(dato.name);
                        }
                        process(listing);
                    }
                }, 'json');
            };
            eliminarintegrante = function () {
                var id = $(this).attr('iid');
                $('#filaintegrante_' + id).remove();
                actualizar_lista();
            };
            actualizar_lista();
            $(".eliminarparticipante").click(function () {
                var tipo = $(this).attr("idt");
                var id = $(this).attr("idr");
                $("#tipo").val(tipo);
                $("#codigo").val(id);
                $("#eliminar").modal({backdrop: 'static', width: '580px'}).modal('show');
            });

            $(".cerrarmodal").click(function () {
                $("#eliminar").modal("hide");
            });

            $(".aprobarcerrar").click(function () {
                $("#eliminar").modal('hide');
                bloqueointerface();
                var codigo = parseInt($("#codigo").val());
                var tipo = $("#tipo").val();
                var observacion = $("#id_observacion").val();
                $.ajax({
                    type: "POST",
                    url: "/adm_complexivotematica",
                    data: {"action": "eliminarparticipante", "id": codigo, "tipo": tipo, "observacion": observacion},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            smoke.alert("Se modifico participante");
                            location.href = "/adm_complexivotematica?action=vergrupos&id={{ tematica.id }}&c={{ c }}";
                        } else {
                            smoke.alert(data.mensaje, function (e) {
                                $("#eliminar").modal({backdrop: 'static', width: '580px'}).modal('show');
                            }, {
                                ok: "ok",
                                classname: "custom-class"
                            });
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.", function (e) {
                            $("#eliminar").modal({backdrop: 'static', width: '580'}).modal('show');
                        }, {
                            ok: "ok",
                            classname: "custom-class"
                        });
                    },
                    dataType: "json"
                });
            });
            tipo_formulario($("#form2"));
            $(".savelink").click(function () {
                var codgrupo = $("#id_codigogrupo").val();
                var observacion = $("#id_observacionvideo").val();
                if (observacion == '') {
                    smoke.alert("Favor ingrese enlace.");
                    return false;
                }
                bloqueointerface();
                $.post("/adm_complexivotematica", {
                    'action': 'addlinkgrupo',
                    'codgrupo': codgrupo,
                    'observacion': observacion
                }, function (data) {
                    if (data.result == 'ok') {
                        location.reload();
                    }
                }, 'json');
            });
            $(".crearlink").click(function () {
                var codigogrupo = $(this).attr('idgru');
                var nomenlace = $(this).attr('idenlace');
                $("#id_codigogrupo").val(codigogrupo);
                $("#id_observacionvideo").val(nomenlace);
                $("#modalcreavideo").modal({backdrop: 'static', width: '600px'}).modal('show');
            });
            $(".cancelalink").click(function () {
                $("#modalcreavideo").modal("hide");
            });
        });

        function formModal(id, idcarrera, text, action, footer = true) {
            bloqueointerface()
            $('#footermodal').show();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                    'idcarrera': idcarrera,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        if (footer === true) {
                            $('#footermodalmatri').hide();
                        }
                        $('.panelbodymatri').html(data.data);
                        $('#itemspanel .paneltitle').html(text.toUpperCase());
                        $("#itemspanel").modal({backdrop: 'static', width: '900px'}).modal('show');
                        $(".asignap").bind('click.asignar', asignar);
                    } else {
                        mensajeDanger(data.message);
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeDanger("Error de conexión.");
                },
                dataType: "json"
            });
        }

        $(function () {
            $("select").select2();
        });
    </script>
    {% block extrascript %}    {% endblock %}
    <script src="/static/adicionalesjs/formquestionb4.js?2.1"></script>

{% endblock %}
{% block atras %}/adm_complexivotematica?id={{ tematica.id }}&per={{ tematica.periodo_id }}
    {#        {% if c %}#}
    {#            /adm_complexivotematica?fac={{ c }}&car={{ tematica.carrera.id }}&per={{ tematica.periodo_id }}#}
    {#        {% elif s %}#}
    {#            /adm_complexivotematica?s={{ s }}&per={{ tematica.periodo_id }}#}
    {#        {% else %}#}
    {#            /adm_complexivotematica?id={{ tematica.id }}&per={{ tematica.periodo_id }}#}
    {#        {% endif %}#}
{% endblock %}
{% block canvas %}
    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3>GRUPOS PARA TRABAJO DE TITULACIÓN</h3>
                <h6>Periodo: {{ tematica.periodo.nombre }}</h6>
                <h6>Línea de investigación: {{ tematica }}</h6>
                <h6>Carrera: {{ tematica.carrera }}</h6>
                <h6> Tutor: {{ tematica.tutor }}</h6>
                <span class="label {% if tematica.tematica.vigente %}label-success{% else %}label-important{% endif %}">{% if tematica.tematica.vigente %}
                    Vigente{% else %}No Vigente{% endif %}</span>
            </div>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header border-bottom-0">
            <div class="col-lg-12 col-md-12 col-12">
                <div class="d-md-flex align-items-center">
                    {% if tematica.tiene_cupo %}
                        <a href="javascript:void(0)" onclick="formModal({{ tematica.id }},{{ tematica.carrera.id }},'Adicionar participantes','addgrupotematica', true)" class="btn btn-success"><i class="fa fa-plus"></i> Adicionar</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{#    <div class="container-fluid">#}
        <div class="card mb-4">
            <div class="card-body border-top border-6 rounded-3 border-dark-info">
                <table class='table table-bordered'>
                    <thead>
                    <tr>
                        <th style="width: 50px; text-align: center;">No</th>
                        <th style="width: 250px;">Carrera</th>
                        <th style="width: 350px;">Participantes</th>
                        <th style="width: 60px; text-align: center;">Tiene<br>Tribunal</th>
                        <th style="width: 60px; text-align: center;">Entrega trabajo final</th>
                        <th style="width: 80px; text-align: center;">Estado</th>
                        <th style="width: 90px; text-align: center;">Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for grupo in grupos %}
                        <tr>
                            <td style="text-align: center;">{{ forloop.counter }} <br>
                                <span class="label label-info"> CÓDIGO {{ grupo.id }}</span>
                            </td>
                            <td>{{ grupo.alternativa.carrera }}<br>
                                <a href="javascript:;" class="btn btn-mini btn-success crearlink tu" idgru="{{ grupo.id }}"
                                   idenlace="{{ grupo.enlacevideo|default_if_none:"" }}" title="Subir link"><i
                                        class="fa fa-edit"></i></a>
                                {% if grupo.enlacevideo %}
                                    <a href="{{ grupo.enlacevideo }}" target="_blank" class='btn btn-mini btn-info tu'
                                       title="Ver video"><i class="fa fa-video-camera"></i> </a>
                                {% else %}
                                    <a href="javascript:;" class="btn btn-mini btn-warning tu" idgru="{{ grupo.id }}"
                                       title="No hay video"><i class="fa fa-video-camera"></i></a>
                                {% endif %}
                                <a href="javascript:;" class="btn btn-mini  btn-warning tu detail" title="Detalle"
                                   idg="{{ grupo.id }}"><i class="fa fa-list"></i></a>
                                {% if not grupo.cerrado %}
                                    <a href="javascript:;" id="itemsadicionartemareplicatodos" codigrupo="{{ grupo.id }}"
                                       class="btn btn-mini btn-info replicargrupotodos"><i class="fa fa-refresh"></i>
                                    </a>
                                {% endif %}
                            </td>
                            <td style="text-align: left;">

                                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                    {% for participante in grupo.participantes %}
                                        {% with reprobo_complexivo=participante.matricula|call:"reprobo_examen_complexivo" %}
                                            <tr>
                                                <td width="85%">
                                                    {% if participante.matricula.cumplerequisitos == 2 %}
                                                        {% if participante.matriculaaptahistorico %}
                                                            {% if participante.rubrica %}
                                                                <a href="javascript:;"
                                                                   class="btn btn-mini btn-success tu detallecalificacion"
                                                                   title="Detalle calificación tribunal"
                                                                   idpar="{{ participante.id }}"><i class="fa fa-edit"></i>
                                                                    Calificación tribunal</a>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                    <a href="javascript:;"
                                                       class="btn btn-mini btn-success tu detalleproceso"
                                                       title="Detalle proceso titulación" idpar="{{ participante.id }}"><i
                                                            class="fa fa-list"></i> Detalle proceso titulación</a>
                                                    {% if participante.fechaacta %}
                                                        <a href="javascript:;" id="itemsadicionartema"
                                                           codfecha="{{ participante.fechaacta|date:"Y-m-d" }}"
                                                           class="btn btn-mini btn-success editfechaacta"
                                                           codparticipante="{{ participante.id }}"><i
                                                                class="fa fa-calendar"></i></a>
                                                    {% endif %}
                                                    {% if participante.estadotribunal != 2 and participante.matricula.estado != 10 %}
                                                        <a href="javascript:;" id="itemsadicionartemareplica"
                                                           codigrupo="{{ grupo.id }}"
                                                           class="btn btn-mini btn-info replicargrupo"
                                                           codparticipante="{{ participante.id }}"><i
                                                                class="fa fa-refresh"></i></a>
                                                    {% endif %}
                                                    <span class="label label-{% if participante.matricula.estado == 9 %}important{% elif participante.matricula.estado == 10 %}success{% else %}label-info{% endif %} tu"
                                                          title="Estado de matrícula">
                                                    {{ participante.matricula.get_estado_display }}
                                                    </span>
                                                    <br>
                                                    {% if persona.usuario.is_superuser %}
                                                        <span class="label label-info">COD:{{ participante.id }} - IDMATRI:{{ participante.matricula.id }}</span>
                                                        <br>
                                                    {% endif %}
                                                    <strong>
                                                        <span class="fa fa-id-badge"></span> {{ participante.matricula.inscripcion.persona.cedula }}
                                                        | <span class="fa fa-user"></span> {{ participante.matricula }} <br>
                                                    </strong>
                                                    {% if participante.rubrica %}
                                                        EVAL: {{ participante.rubrica_id }} - {{ participante.rubrica }}
                                                    {% else %}
                                                        EVAL: NO EVALUADO
                                                    {% endif %}
                                                    <br>
                                                    {{ participante.matricula.alternativa }}({{ participante.matricula.alternativa.id }})<br>
                                                    {% if participante.estadotribunal == 3 %}
                                                        <span class="label label-important tu"
                                                              title="ESTADO INDIVIDUAL EN GRUPO">
                                                    {{ participante.get_estadotribunal_display }}
                                                    </span>
                                                    {% endif %}
                                                    {% if participante.estadotribunal == 2 %}
                                                        <span class="label label-success tu"
                                                              title="ESTADO INDIVIDUAL EN GRUPO">
                                                     {{ participante.get_estadotribunal_display }}
                                                    </span>
                                                    {% endif %}
                                                    {% if participante.estadotribunal == 1 %}
                                                        <span class="label label-default tu"
                                                              title="ESTADO INDIVIDUAL EN GRUPO">
                                                     {{ participante.get_estadotribunal_display }}
                                                    </span>
                                                    {% endif %}
                                                    {% if participante.matriculaaptahistorico %}
                                                        <span class="label label-success tu" title="HISTÓRICO">
                                                     APTO REQUISITOS
                                                    </span>
                                                    {% else %}
                                                        <span class="label label-important tu" title="HISTÓRICO">
                                                     NO APTO REQUISITOS
                                                    </span>
                                                    {% endif %}
                                                    {% if participante.rubrica %}
                                                        {% if participante.actacerrada %}
                                                            <br><span class="label  label-success ">ACTA CERRADA</span>
                                                        {% else %}
                                                            <br><span class="label  label-important ">ACTA NO CERRADA</span>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if participante.matriculaaptahistorico %}
                                                        {% if participante.actatribunalgenerada %}
                                                            <span class="label  label-success ">ACTA N°: SUS-{{ participante.matricula.inscripcion.carrera.abrsustentacion|default_if_none:"" }}-{{ participante.numeroacta }}-{{ participante.fechaacta|date:"dmY" }}</span>
                                                        {% else %}
                                                            <span class="label  label-important ">ACTA N°: SUS-{{ participante.matricula.inscripcion.carrera.abrsustentacion|default_if_none:"" }}-{{ participante.numeroacta }}-{{ participante.fechaacta|date:"dmY" }}</span>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if perms.sga.puede_abrircerrar_actasustentacion %}
                                                        {% if participante.actatribunalgenerada %}
                                                            {% if participante.actacerrada %}<br>
                                                                <a href="javascript:;" class="activaactivaractas"
                                                                   id="idactivaracta"
                                                                   idinte="{{ participante.id|encrypt }}"><i
                                                                        class="fa fa-check"></i> Activar para abrir acta</a>
                                                            {% else %}<br>
                                                                <a href="javascript:;" class="activaactivaractas"
                                                                   id="idactivaracta"
                                                                   idinte="{{ participante.id|encrypt }}"><i
                                                                        class="fa fa-check"></i> Desactivar para abrir acta</a>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                </td>
                                                <td width="5%">
                                                    {% if reprobo_complexivo %}
                                                        <span class=" label label-important tu"
                                                              title="REPROBADO PRUEBA TEÓRICA">R</span>
                                                    {% else %}
                                                        {% if not grupo.cerrado %}
                                                            {% if participante.estado == 3 %}
                                                                <a class="btn btn-default btn-mini eliminarparticipante"
                                                                   href="javascript:;" idt="aprobar"
                                                                   idr="{{ participante.id }}" title="ACTIVAR"><i
                                                                        class="fa fa-ban"></i></a>
                                                            {% else %}
                                                                <a class="btn btn-danger btn-mini eliminarparticipante tu"
                                                                   href="javascript:;" idt="eliminar"
                                                                   idr="{{ participante.id }}" title="ELIMINAR"><i
                                                                        class="fa fa-minus"></i></a>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                </td>
                                                <td width="20%">
                                                    {% if participante.matricula.cumplerequisitos == 1 %}
                                                        <a href="/adm_complexivotematica?action=detallematricula&idm={{ participante.matricula.id }}&idtematica={{ tematica.id }}&c={{ c }}"
                                                           class="label label-warning tu" title="PENDIENTE PARA SUSTENTAR">PENDIENTE</a>
                                                    {% endif %}
                                                    {% if participante.matricula.cumplerequisitos == 2 %}
                                                        <a href="/adm_complexivotematica?action=detallematricula&idm={{ participante.matricula.id }}&idtematica={{ tematica.id }}&c={{ c }}"
                                                           class="label label-success tu"
                                                           title="APTO PARA SUSTENTAR">APTO</a>
                                                    {% endif %}
                                                    {% if participante.matricula.cumplerequisitos == 3 %}
                                                        <a href="/adm_complexivotematica?action=detallematricula&idm={{ participante.matricula.id }}&idtematica={{ tematica.id }}&c={{ c }}"
                                                           class="label label-important tu" title="NO APTO PARA SUSTENTAR">NO
                                                            APTO</a>
                                                    {% endif %}
                                            </tr>

                                        {% endwith %}
                                    {% endfor %}
                                </table>
                            </td>
                            <td style="text-align: center;">{% if grupo.tiene_tribunal %}
                                <i class="fa fa-check"></i> {% endif %}</td>
                            <td style="text-align: center;">
                                {% if grupo.subirarchivofinalgrupo %}
                                    <i class="fa fa-check" style='color:green'></i>
                                    {% if grupo.archivofinalgrupo %}
                                        <span class="label label-{% if grupo.estadoarchivofinalgrupo == 1 %}warning{% endif %}{% if grupo.estadoarchivofinalgrupo == 2 %}success{% endif %}">{{ grupo.get_estadoarchivofinalgrupo_display }}</span>
                                    {% else %}
                                        <span class="label label-warning">PENDIENTE</span>
                                    {% endif %}
                                {% endif %}
                            </td>
                            <td style="text-align: center;">
                                {% if grupo.cerrado %}
                                    <span class="label label-success">CERRADO</span>
                                {% else %}
                                    <span class="label label-info">EN CURSO</span>
                                {% endif %}
                                {% if grupo.replica %}
                                    <span class="label label-info">REPROGRAMACIÓN</span>
                                {% endif %}

                                {% if grupo.subirpropuesta %}
                                    <br>
                                    <span class="label label-default">
                                    SUBIR PROPUESTA ACTIVA<br>
                                {{ grupo.fechasubirpropuesta|date:"Y-m-d" }}
                                </span>
                                {% endif %}

                            </td>
                            <td style="text-align: center; ">
                                {% if perms.sga.puede_editar_cupotematica and grupo.activo %}
                                    <div class="dropbottom">
                                        <button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Acciones <i class="fa fa-angle-down"></i>
                                        </button>
                                        {% if grupo.tematica.tematica.vigente %}
                                            <ul class="dropdown-menu" x-placement="right-start">
                                                {% if not grupo.cerrado %}
                                                    {#                                                    {% if grupo.grupocupo.cupoasignado > 1 %}#}
                                                    <li class="dropdown-item">
                                                        {#                                                        <a href="javascript:;" idg="{{ grupo.id }}" class="asignar"><i class="fa fa-plus"></i> Añadir Participante</a>#}
                                                        <a href="javascript:void(0)" onclick="formModal({{ grupo.id }},{{ tematica.carrera.id }},'Adicionar participante','addparticipante', true)" ><i class="fa fa-plus"></i> Añadir Participante</a>
                                                    </li>
                                                    {#                                                    {% endif %}#}
                                                    <li class="dropdown-item">
                                                        <a class="bloqueo_pantalla" href="/adm_complexivotematica?action=asignartribunal&id={{ grupo.id }}{% if c %}&c={{ c }}{% endif %}"><i class="fa fa-group"></i> Tribunal Calificador</a>
                                                    </li>
                                                    {#                                                {% if grupo.grupocupo.cupoasignado > 1 %}#}
                                                    <li class="dropdown-item">
                                                        <a href="javascript:;" idg="{{ grupo.id }}" class="eliminar"><i
                                                                class="fa fa-close"></i> Eliminar Participante</a>
                                                    </li>
                                                    {#                                                {% endif %}#}
                                                {% endif %}
                                                {% if grupo.cerrado %}
                                                    {% if not grupo.hay_graduado %}
                                                        <li class="dropdown-item"><a href="javascript:;"
                                                                                     nhref="/adm_complexivotematica?action=actualizar_graduado&id={{ grupo.id }}"
                                                                                     class="confirmacionmodal"><i
                                                                class="fa fa-refresh"></i> Actualizar en graduados</a></li>
                                                    {% endif %}
                                                {% endif %}
                                                {% if not grupo.subirarchivofinalgrupo %}
                                                    <li class="dropdown-item"><a href="javascript:;" class="activasubirarchivofinal"
                                                                                 id="idarchivofinal" idgru="{{ grupo.id|encrypt }}"><i
                                                            class="fa fa-check"></i> Activar subir trabajo final</a></li>
                                                {% else %}
                                                    <li class="dropdown-item"><a href="javascript:;" class="activasubirarchivofinal"
                                                                                 id="idarchivofinal" idgru="{{ grupo.id|encrypt }}"><i
                                                            class="fa fa-close"></i> Desactivar subir trabajo final</a></li>
                                                {% endif %}
                                                {% if not grupo.cerrado %}
                                                    <li class="dropdown-item">
                                                        <a href="javascript:;" class="eliminacionmodal tu"
                                                           nhref="/adm_complexivotematica?action=deletetribunal&id={{ grupo.id }}"><i
                                                                class="fa fa-remove"></i> Eliminar Tribunal</a>
                                                    </li>
                                                    <li class="dropdown-item">
                                                        <a href="javascript:;" class="eliminacionmodal tu"
                                                           nhref="/adm_complexivotematica?action=deletegrupo&id={{ grupo.id }}"><i
                                                                class="fa fa-remove"></i> Eliminar Grupo</a>
                                                    </li>
                                                    <li class="dropdown-item">
                                                        <a href="/adm_complexivotematica?action=editartutor&id={{ grupo.id }}"><i
                                                                class="fa fa-edit"></i> Editar tutor</a>
                                                    </li>
                                                    {#                                                <li style="text-align: left;">#}
                                                    <li class="dropdown-item">
                                                        <a href="javascript:;" class="activasubirpropuesta"
                                                           idgru="{{ grupo.id|encrypt }}">
                                                            {% if grupo.subirpropuesta %}
                                                                <i class="fa fa-remove"></i> Desactivar subir propuesta
                                                            {% else %}
                                                                <i class="fa fa-check"></i> Activar subir propuesta

                                                            {% endif %}
                                                        </a>
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <span class="label label-warning">GRUPO INACTIVO</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7" style="text-align: center">NO TIENE GRUPOS ASIGNADOS</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
{#        </div>#}
    </div>

    <div class="modal fade static" id="deletemodal" style="display: none;">
    </div>

    <div class="modal fade" id="modaldetalleproceso" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Título del modal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary">Guardar cambios</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="eliminar" style="display: none;">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title paneltitlefecha">Observación de Eliminacion</h3>
                </div>
                <div class="modal-body">
                    <form id="form2" style="width: 50%; margin-bottom: 0;padding-left: 31%;">
                        <div class="row-fluid">
                            <input type='hidden' name='tipo' id='tipo' value=''/>
                            <input type='hidden' name='codigo' id='codigo' value=''/>
                            {% for field in form2 %}
                                {% if field.field.widget.attrs.separator %}
                                    <div style="width: 100%; height: 1px; float: left;"></div>
                                {% endif %}
                                <fieldset class="control-group nomargins" style="text-align: center;float: left; width:
                                        {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}">
                                    <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                                    <div class="controls" style="text-align: center">
                                        {{ field }}
                                        <p class="help-text">{{ field.help_text }} </p>
                                    </div>
                                </fieldset>
                            {% endfor %}
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success aprobarcerrar"> Guardar</a>
                    <a href="javascript:;" class="btn btn-info cerrarmodal">Cerrar</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="itemspanel"  style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><b class="paneltitle">FORMULARIO MODAL</b></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body" style="padding: 4%;">
                    <form class="form-horizontal form-modal" autocomplete="off" method="post" enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row panelbodymatri">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodalmatri">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal"><i class="fa fa-times"></i> Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="itemspanelreplica" style="display: none;">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Replicar en otro grupo</h3>
                </div>
                <div class="modal-body panelbody">
                    <div class="alert alert-info incompletotemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovalorestemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la
                        fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresotemas" style="display: none;"> NO TIENE ACTIVIDADES
                    </div>
                    <div class="row-fluid">
                        Nota: Al momento de replicar en otro grupo, toda la información del alumno se replicará y se podra
                        adicionarle otro tribunal sin perderse su información en el grupo actual.
                        <input type="hidden" id="codparticipantereplica" name="codparticipantereplica">
                        <input type="hidden" id="codigogruporeplica" name="codigogruporeplica">
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success" id="adicionarreplica"><i class="fa fa-save"></i> Replicar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarreplica">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelreplicatodos" style="display: none;">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Replicar todos los participantes en otro grupo</h3>
                </div>
                <div class="modal-body panelbody">
                    <div class="alert alert-info incompletotemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovalorestemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la
                        fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresotemas" style="display: none;"> NO TIENE ACTIVIDADES
                    </div>
                    <div class="row-fluid">
                        Nota: Al momento de replicar en otro grupo, toda la información del alumno se replicará y se podra
                        adicionarle otro tribunal sin perderse su información en el grupo actual.
                        <input type="hidden" id="codigogruporeplicatodos" name="codigogruporeplicatodos">
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success" id="adicionarreplicatodos"><i class="fa fa-save"></i>
                        Replicar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarreplicatodos">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelfecha" style="display: none;">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Editar fecha acta</h3>
                </div>
                <div class="modal-body panelbody">
                    <div class="alert alert-info incompletotemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovalorestemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la
                        fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresotemas" style="display: none;"> NO TIENE ACTIVIDADES
                    </div>
                    <div class="row-fluid">
                        <input type="date" class="selectorfecha" id="fechacta" name="fechacta">
                        <input type="hidden" id="codparticipante" name="codparticipante">
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success" id="adicionarfechacerrar"><i class="fa fa-edit"></i>
                        Actualizar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarfecha">Cerrar</a>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade static" id="modalcreavideo" style="display: none;">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Crear link</h3>
                </div>
                <div class="modal-body panelbodyforo">
                    Enlace a la grabación 1
                    <span style="color:#FF0000" ;>* Obligatorio</span>
                    <br>
                    <input type="hidden" id="id_codigogrupo" name="id_codigogrupo" value="0">
                    <textarea rows="3" name="id_observacionvideo" id="id_observacionvideo" style="width: 500px"></textarea>
                </div>
                <div class="modal-footer">
                    <table class="pull-right">
                        <tr>
                            <td><a href="javascript:;" class="btn btn-success savelink">Crear</a></td>
                            <td><a href="javascript:;" class="btn btn-default cancelalink">Cancelar</a></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
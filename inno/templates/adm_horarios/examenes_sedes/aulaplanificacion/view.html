{% extends "adm_horarios/examenes_sedes/base.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
    <script type="text/javascript" src='/static/js/select2.js?v=1.0.0'></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=1.0.0"/>
    <link type='text/css' rel='stylesheet' href="/static/datatables/1.12.1/css/dataTables.bootstrap5.min.css"/>
    <script type="text/javascript" src='/static/datatables/1.12.1/js/jquery.dataTables.min.js'></script>
    <script type="text/javascript" src='/static/datatables/1.12.1/js/dataTables.bootstrap5.min.js'></script>
    <style>
        .modal-open {
            overflow: hidden;
        }
        input[type="search"] {
            padding: 0.375rem 0.75rem;
            margin-right: 1rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            appearance: none;
            border-radius: 0.25rem;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
            width: 90% !important;
        }
    </style>
    <script type="text/javascript">
        var busqueda = function (page/*=undefined*/) {
            var term = $("#searchinput").val().trim().toUpperCase();
            page = typeof page == 'undefined' ? 1 : page;
            if (term.length > 0) {
                bloqueointerface();
                location.href = `{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&s=${term}&page=${page}`;
            } else {
                bloqueointerface();
                location.href = `{{ request.path }}??ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page=${page}`;
            }
            return false;
        };
        function disableScroll() {
            var x = window.scrollX;
            var y = window.scrollY;
            window.onscroll = function(){ window.scrollTo(x, y) };
        }

        function enableScroll() {
            window.onscroll = null;
        }
        const loadDataTable = () => {
            $('.datatable table').dataTable({
                language: {
                    url: "/static/datatables/1.12.1/plug-ins/i18n/es-ES.json?v=1.0.0"
                },
                responsive: true,
                searchDelay: 500,
                bJQueryUI: false,
                bAutoWidth: false,
                //bProcessing: true,
                bServerSide: true,
                bSort: false,
                search: {
                    return: true
                },
                fixedHeader: {
                    header: true,
                    footer: true,
                    footerOffset: $('#navMenu').outerHeight()
                },
                sPaginationType: "full_numbers",
                iDisplayLength: 25,
                //sDom: '<"datatable-header"fl><"datatable-scroll"tr><"datatable-footer"ip>',
                dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
                sAjaxSource:  `{{ request.path }}`,
                sServerMethod: "GET",
                fnServerParams: function (aoData)
                {
                    bloqueointerface();
                    const id_aula = '{{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}';
                    aoData.push(
                        {"name": "action", "value": 'listAlumnoPlanificacionDataTable'},
                        {"name": "id", "value": id_aula},
                    );
                    //console.log(aoData);
                },
                aoColumnDefs:
                    [
                        {
                            aTargets: [0],
                            width: "40%",
                            mRender: function (data, type, row)
                            {
                                var html = ``;
                                html += `<div><b>${data['type_document']}:</b> ${data['document']}</div>`;
                                html += `<div><b>Nombre completo:</b> ${data['nombre_completo']}</div>`;
                                html += `<div><b>Sexo:</b> ${data['sexo']}</div>`;
                                html += `<div><b>Teléfono:</b> ${data['telefono']}</div>`;
                                html += `<div><b>Correo personal:</b> ${data['email']}</div>`;
                                html += `<div><b>Correo institucional:</b> ${data['emailinst']}</div>`;
                                return html;
                            },
                            fnCreatedCell: function(nTd, sData, oData, iRow, iCol)
                            {
                                if(sData != 'NULL') {
                                    $(nTd).css('text-align', 'left');
                                    $(nTd).css('vertical-align', 'middle');
                                    $(nTd).css('padding', '8px');
                                }
                            }
                        },
                        {
                            aTargets: [1],
                            width: "20%",
                            fnCreatedCell: function(nTd, sData, oData, iRow, iCol)
                            {
                                if(sData != 'NULL') {
                                    $(nTd).css('text-align', 'center');
                                    $(nTd).css('vertical-align', 'middle');
                                    $(nTd).css('padding', '8px');
                                    $(nTd).attr('data-title', '#');
                                }
                            }
                        },
                        {
                            aTargets: [2],
                            width: "40%",
                            mRender: function (data, type, row)
                            {
                                //console.log(data);
                                let html = `<table class="table">
                                                <thead>
                                                    <tr>
                                                      <th scope="col">#</th>
                                                      <th scope="col"></th>
                                                      <th scope="col">Asignatura</th>
                                                      <th scope="col">Nivel</th>
                                                      <th scope="col"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>`;
                                for (var i in data) {
                                    html += `<tr>
                                            <th scope="row">${data[i]['num']}</th>
                                            <td><input type="checkbox" id="materiaasignada_id_${data[i]['id']}" name="matricula_id_${data[i]['matricula_id']}"></td>
                                            <td>${data[i]['asignatura']}</td>
                                            <td>${data[i]['nivel']}</td>
                                            <td>`;
                                    for (var j in data[i]['detallemodeloevaluativos']) {
                                        html += `<button type="button" class="btn btn-mini btn-primary" onclick="actionAsignar('${data[i]['id']}', '${data[i]['aula_id']}', '${data[i]['asignatura']}', '${data[i]['nivel']}', '${data[i]['detallemodeloevaluativos'][j]['id']}')" value="${data[i]['id']}" >${data[i]['detallemodeloevaluativos'][j]['nombre']}</button>`

                                    }
                                    html += `</td>`;
                                    html += `</tr>`;
                                }

                                html += `</tbody> </table>`;
                                return html;
                            },
                            fnCreatedCell: function(nTd, sData, oData, iRow, iCol)
                            {
                                if(sData != 'NULL') {
                                    $(nTd).css('text-align', 'center');
                                    $(nTd).css('vertical-align', 'middle');
                                    $(nTd).css('padding', '8px');
                                    $(nTd).attr('data-title', '#');
                                }
                            }
                        },

                    ]
                ,
                fnDrawCallback: function (oSettingst)
                {
                    $.unblockUI();

                }

            });
            $("#dtViewPersons_filter input").unbind(); // 'x' es el nombre de tu tabla
            $('#dtViewPersons_filter input').bind('keyup', function (e) {
                if (e.keyCode == 13) {
                    $('.datatable table').dataTable().fnFilter(this.value);
                }
            });
        }
        const actionAdd = function (ida, title){
            $("#modalAddLabelAlumnoPlanificacion", $("#modalAddAlumnoPlanificacion")).html(title);
            $("#modalAddAlumnoPlanificacion").modal({backdrop: 'static', }).modal('show');
            disableScroll();
            loadDataTable();
        };
        const actionAsignar = function (idma, ida, asignatura, nivel, iddme){
            const aData = {
                "idma": idma,
                "ida": ida,
                "iddme": iddme,
                "action": 'asignarAlumnoPlanificaciónExamen'
            }
            Swal.fire({
                title: `CONFIRMACIÓN`,
                text: `¿Está seguro/a de asignar ${asignatura} del ${nivel}`,
                type: 'warning',
                icon: 'warning',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Aceptar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: `{{ request.path }}`,
                        data: aData,
                        success: function(data) {
                            if (data.result) {
                                $.unblockUI();
                                NotificationJG.success(data.message);
                                bloqueointerface();
                                $('.datatable table').dataTable().fnDraw();
                            }
                            else{
                                NotificationJG.error(data.message);
                                $.unblockUI();
                            }

                        },
                        error: function() {
                            $.unblockUI();
                            NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json",
                    });
                }
            }).catch(error => {
                NotificationJG.error(error);
                $.unblockUI();
            });

        };

        const actionDelete = (id, permission, app, mensaje) => {
            var question = `Al eliminar el registro no podra volver a recuperar los datos. <br>¿Está seguro de eliminar el registro <span class="label label-warning">${mensaje}</span>?`;
            Confirm.ajax({"model": "MateriaAsignadaPlanificacionSedeVirtualExamen", 'id': id, "permission": permission, "app_label": app}, function () {
                Confirm.question(question, function () {
                    bloqueointerface();
                    var aData = {"action": "deleteMateriaAsignadaPlanificacion", 'id': id}
                    $.ajax({
                        type: "POST",
                        url: `{{ request.path }}`,
                        data: aData,
                        success: function(data) {
                            if (data.result) {
                                $.unblockUI();

                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: 'Se elimino correctamente el registro',
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        bloqueointerface();
                                        location.reload();
                                    }
                                }).catch(error => {
                                    NotificationJG.error(error);
                                    $.unblockUI();
                                });
                            }
                            else{
                                NotificationJG.error(data.message);
                                $.unblockUI();
                            }

                        },
                        error: function() {
                            $.unblockUI();
                            NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json",
                    });
                }, function () {
                    NotificationJG.info("Enhorabuena el registro esta salvado.!");
                    var h = $(window).height() - 350;
                    $('#modalConfirmAjax').modal({backdrop: 'static', keyboard: false, width: "60%", height: h}).modal('show');
                });

            }, function () {
                NotificationJG.info("Enhorabuena el registro esta salvado.!");
                $.unblockUI();
            });
        }

        const actionGeneratePasswordAulaPlanificacion = (id, edicion) => {
            var question = `Al realizar esta acción se creara una contraseña aleatoria. <br>¿Está seguro de crear una contraseña?`;
            Confirm.question(question, function () {
                bloqueointerface();
                var aData = {"action": "generatePasswordAulaPlanificacion", 'id': id, 'edicion': edicion}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: 'Se genero correctamente la contraseña',
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });


        }

        const actionGeneratePasswordMateriaAsignadaPlanificacion = (id, edicion, mensaje) => {
            var question = `Al realizar esta acción se creara una contraseña aleatoria. <br>¿Está seguro de crear una contraseña al/la estudiante <span class="label label-warning">${mensaje}</span>?`;
            Confirm.question(question, function () {
                bloqueointerface();
                var aData = {"action": "generatePasswordMateriaAsignadaPlanificacion", 'id': id, 'edicion': edicion}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: 'Se genero correctamente la contraseña',
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });


        }

        $(function () {
            $("select").select2();
            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });

            $("#btnSearch").click(function (){
                busqueda();

            });
            //var $table = $('.datatable table');
            $(".action-close", $("#modalAddAlumnoPlanificacion")).click(function (){
                bloqueointerface();
                //$("#modalAddAlumnoPlanificacion").modal('hide');
                //$('.datatable table').dataTable().fnDestroy();
                //enableScroll();

                location.reload();
            });

            $(".action-save", $("#modalAddAlumnoPlanificacion")).click(function (){
                bloqueointerface();
                let formdata = new FormData($("#formAulaPlanificacion", $("#modalAddAlumnoPlanificacion"))[0]);
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: formdata,
                    success: function(data) {
                        $.unblockUI();
                        if (data.result === true) {
                            $("#modalAddAlumnoPlanificacion").modal('hide');
                            Swal.fire({
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                allowEnterKey: false,
                                type: 'success',
                                customClass: {
                                    confirmButton: 'btn btn-info'
                                },
                                title: 'Exitoso',
                                text: 'Registro guardado correctamente.',
                                confirmButtonText: 'Aceptar',
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            })
                        } else {
                            Swal.fire({
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                allowEnterKey: false,
                                type: 'error',
                                customClass: {
                                    confirmButton: 'btn btn-info'
                                },
                                title: 'Ocurrio un error',
                                text: data.message,
                                confirmButtonText: 'Aceptar',
                            })
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $.unblockUI();
                        {#smoke.alert("Error de conexión.");#}
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg='Not connect: Verify Network.';
                        } else if (jqXHR.status == 404) {
                            msg='Requested page not found [404]';
                        } else if (jqXHR.status == 500) {
                            msg='Internal Server Error [500].';
                        } else if (textStatus === 'parsererror') {
                            msg='Requested JSON parse failed.';
                        } else if (textStatus === 'timeout') {
                            msg='Time out error.';
                        } else if (textStatus === 'abort') {
                            msg='Ajax request aborted.';
                        } else {
                            msg='Uncaught Error: ' + jqXHR.responseText;
                        }
                        //smoke.alert("Error al enviar los datos: " + msg);
                        NotificationJG.error("Error al enviar los datos: " + msg);
                    },
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false
                });

            });

        });
    </script>
{% endblock %}
{% block atras %}/adm_horarios/examenes_ensedes?idh={{ eTurnoPlanificacionSedeVirtualExamen.id }}{% endblock %}
{% block content %}
    <div class="card ">
        <div class="card-body">
            <ul class="breadcrumb2 px-0 mb-2">
                <li>
                    <a href="/adm_horarios/examenes_ensedes?ids={{ eSede.id }}" class="bloqueo_pantalla">{{ eSede.nombre }}</a>
                    <span class="divider">/</span>
                </li>
                <li>
                    <a href="/adm_horarios/examenes_ensedes?idf={{ eFechaPlanificacionSedeVirtualExamen.id }}" class="bloqueo_pantalla">{{ eFechaPlanificacionSedeVirtualExamen.fecha }}</a>
                    <span class="divider">/</span>
                </li>
                <li>
                    <a href="/adm_horarios/examenes_ensedes?idh={{ eTurnoPlanificacionSedeVirtualExamen.id }}" class="bloqueo_pantalla">{{ eTurnoPlanificacionSedeVirtualExamen.horainicio }} a {{ eTurnoPlanificacionSedeVirtualExamen.horafin }}</a>
                    <span class="divider">/</span>
                </li>
                <li>
                    <a href="/adm_horarios/examenes_ensedes?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}" class="bloqueo_pantalla">{{ eAulaPlanificacionSedeVirtualExamen.aula.display }}</a>
                </li>
            </ul>
            <div class="row">
                <div class="col-lg-12">
                    <div class="card mb-4">
                        <div class="card-body border-top border-6 rounded-3 border-dark-info">
                            <div class="row">
                                <div class="col-md-6 col-sm-12">
                                    <div class="mb-2">
                                        {% if perms.inno.puede_crear_planificacionexamenvirtual %}
                                            <button class="btn btn-success" onclick="actionAdd('{{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}', 'Adicionar alumno al {{ eAulaPlanificacionSedeVirtualExamen.display }}')" data-bs-toggle="modal" data-bs-target="#modalAddAlumnoPlanificacion" type="button"><i class="fa fa-plus"></i> Adicionar Alumno</button>
                                        {% endif %}
                                        {% if perms.inno.puede_editar_planificacionexamenvirtual %}
                                            {% if not eAulaPlanificacionSedeVirtualExamen.password or eAulaPlanificacionSedeVirtualExamen.password == '' %}
                                                <button class="btn btn-warning" onclick="actionGeneratePasswordAulaPlanificacion('{{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}', 'new')" type="button"><i class="fa fa-key"></i> Generar contraseña</button>
                                            {% else %}
                                                <button class="btn btn-warning" onclick="actionGeneratePasswordAulaPlanificacion('{{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}', 'edit')" type="button"><i class="fa fa-key"></i> Cambiar contraseña</button>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control" placeholder="Cedula, pasaporte o apellidos" aria-label="Buscar" aria-describedby="btnSearch" name="s" value="{{ search }}" id="searchinput">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button" id="btnSearch"><i class="fa fa-search"></i></button>
                                            {% if url_params %}
                                                <a title="Ver todo" href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}" class="btn btn-default tr bloqueo_pantalla">
                                                    <i class="fas fa-sync-alt"></i>
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% if eAulaPlanificacionSedeVirtualExamen.responsable or eAulaPlanificacionSedeVirtualExamen.password or eFechaPlanificacionSedeVirtualExamen.supervisor %}
                                <div class="row">
                                    <div class="col-md-12 col-sm-12">
                                        {% if eFechaPlanificacionSedeVirtualExamen.supervisor %}
                                            <label><b>Supervisor: </b>{{ eFechaPlanificacionSedeVirtualExamen.supervisor.nombre_completo }}</label>
                                        {% elif eAulaPlanificacionSedeVirtualExamen.supervisor %}
                                            <label><b>Supervisor: </b>{{ eAulaPlanificacionSedeVirtualExamen.supervisor.nombre_completo }}</label>
                                        {% endif %}
                                        {% if eAulaPlanificacionSedeVirtualExamen.responsable %}
                                            <label><b>Aplicador: </b>{{ eAulaPlanificacionSedeVirtualExamen.responsable.nombre_completo }}</label>
                                        {% endif %}

                                        {% if eAulaPlanificacionSedeVirtualExamen.password %}
                                            <label><b>Clave general: </b>{{ eAulaPlanificacionSedeVirtualExamen.password }}</label>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                            <div class="table-responsive">
                                <table class='table table-bordered table-striped'>
                                    <thead class="table-light">
                                    <tr>
                                        {%  if persona.usuario.is_superuser %}
                                            <th style="text-align: center; vertical-align: middle; width: 2%">ID</th>
                                        {% endif %}
                                        <th style="text-align: center; vertical-align: middle; width: 20%">Alumno</th>
                                        <th style="text-align: center; vertical-align: middle; width: 20%">Carrera</th>
                                        <th style="text-align: center; vertical-align: middle; width: 30%">Materia/Nivel/Paralelo</th>
                                        <th style="text-align: center; vertical-align: middle; width: 8%">Clave</th>
                                        <th style="text-align: center; vertical-align: middle; width: 8%">Asistencia</th>
                                        <th style="text-align: center; vertical-align: middle; width: 10%">Examen</th>
                                        <th style="text-align: center; vertical-align: middle; width: 6%"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for eMateriaAsignadaPlanificacionSedeVirtualExamen in eMateriaAsignadaPlanificacionSedeVirtualExamenes %}
                                        <tr>
                                            {%  if persona.usuario.is_superuser %}
                                                <td style="text-align: center; vertical-align: middle">
                                                    {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}
                                                </td>
                                            {% endif %}
                                            <td style="text-align: left; vertical-align: middle">
                                                <div><strong>{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.tipo_documento }}:</strong> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.documento }}</div>
                                                <div>{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo }}</div>
                                            </td>
                                            <td style="text-align: left; vertical-align: middle">
                                                {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.carrera }}
                                            </td>
                                            <td style="text-align: center;  vertical-align: middle">
                                                {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.asignatura.nombre }}<br>
                                                {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.asignaturamalla.nivelmalla.nombre }}<br>
                                                {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.paralelomateria.nombre }}
                                                {%  if  eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.bloqueomatricula %}
                                                    <br>
                                                    <span class="label label-important tu" > MATRICULA BLOQUEADA</span>
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center;  vertical-align: middle">
                                                {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.password %}
                                                    {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.password }}
                                                {% endif %}
                                                {% if perms.inno.puede_editar_planificacionexamenvirtual %}
                                                    {% if not eMateriaAsignadaPlanificacionSedeVirtualExamen.password or eMateriaAsignadaPlanificacionSedeVirtualExamen.password == '' %}
                                                        <button class="btn btn-warning btn-mini p-1" onclick="actionGeneratePasswordMateriaAsignadaPlanificacion('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}', 'new', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo }}')" type="button"><i class="fa fa-key"></i> Generar contraseña</button>
                                                    {% else %}
                                                        <button class="btn btn-warning btn-mini p-1" onclick="actionGeneratePasswordMateriaAsignadaPlanificacion('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}', 'edit', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo }}')" type="button"><i class="fa fa-key"></i> Cambiar contraseña</button>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center;  vertical-align: middle">
                                                {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.asistencia %}
                                                    <span class="badge bg-primary"><i class="fa fa-check"></i></span>
                                                    <span class="badge bg-info text-dark">{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.fecha_asistencia|date:'d-m-Y h:i a' }}</span>
                                                {% else %}
                                                    <span class="badge bg-warning text-dark" data-bs-toggle="tooltip" data-bs-placement="top" title="Tooltip on top"><i class="fa fa-close"></i></span>
                                                {% endif %}
                                            </td>
                                            <td style="text-align: center;  vertical-align: middle">
                                                {% with examen_planificado=eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia|args:eMateriaAsignadaPlanificacionSedeVirtualExamen.detallemodeloevaluativo|call:"examenplanificadosilabo" %}
                                                    {%  if persona.usuario.is_superuser %}
                                                        {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.idtestmoodle %}
                                                            <span class="badge bg-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="IDTESTMOODLE">{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.idtestmoodle }}</span>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if not examen_planificado %}
                                                        <div class="alert alert-warning m-1 p-1">
                                                            <h5 class="alert-heading">No existe planificación de examen</h5>
                                                        </div>
                                                    {% else %}
                                                        {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.asistencia %}
                                                            {% if examen_planificado %}
                                                                {% if acceso_examen %}
                                                                {#                                                                <button type="button" class="btn btn-mini btn-danger" onclick="actionHabilitarexamen('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}')"><i class="fa fa-close"></i></button>#}
                                                                    {{ examen_planificado.idtestmoodle }} - {{ examen_planificado.nombretest }}<br>
                                                                    <a href="javascript:void(0);" onclick="habilitarExamen('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}')" class="btn btn-mini {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.habilitadoexamen %}btn-success{% else %}btn-warning{% endif %}" ><i class="fa fa-list"></i></a>
                                                                {% endif %}
                                                            {% endif %}
                                                        {% else %}
                                                            <div class="alert alert-danger m-1 p-1">
                                                                <h5 class="alert-heading">Debe registrar asistencia primero</h5>
                                                            </div>
                                                        {% endif %}
                                                    {% endif %}
                                                {% endwith %}
                                            </td>
                                            <td style="text-align: center;  vertical-align: middle">
                                                <button type="button" class="btn btn-mini btn-danger" onclick="actionDelete('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}', '', 'inno', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.display }}')"><i class="fa fa-eraser"></i></button>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <td colspan="5" style="text-align: center; vertical-align: middle">NO EXISTEN REGISTROS</td>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% if eMateriaAsignadaPlanificacionSedeVirtualExamenes|length %}
                            <div class="card-footer border-top-0">
                                <nav aria-label="Page navigation example">
                                    <ul class="pagination justify-content-end">
                                        {% if paging.num_pages > 25 %}
                                            {% if paging.primera_pagina %}
                                                <li class="page-item">
                                                    <a class="page-link bloqueo_pantalla" href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page=1{{ url_params }}">1</a>
                                                </li>
                                                <li class="page-item">
                                                    <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page={{ paging.ellipsis_izquierda }}{{ url_params }}"
                                                       class="active page-link bloqueo_pantalla">...</a></li>
                                            {% endif %}
                                            {% for pagenumber in paging.paginas %}
                                                <li {% if pagenumber == page.number %}class='active page-item'
                                                    {% else %}class='page-item'{% endif %}>
                                                    <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page={{ pagenumber }}{{ url_params }}"
                                                       class="page-link bloqueo_pantalla">{{ pagenumber }}</a>
                                                </li>
                                            {% endfor %}
                                            {% if paging.ultima_pagina %}
                                                <li class="page-item">
                                                    <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page={{ paging.ellipsis_derecha }}{{ url_params }}"
                                                       class="active page-link bloqueo_pantalla">...</a></li>
                                                <li class="page-item">
                                                    <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page={{ paging.num_pages }}{{ url_params }}"
                                                       class="page-link bloqueo_pantalla">{{ paging.num_pages }}</a>
                                                </li>
                                            {% endif %}
                                        {% else %}
                                            {% for pagenumber in paging.page_range %}
                                                <li {% if pagenumber == page.number %}class='active page-item'
                                                    {% else %}class="page-item"{% endif %}>
                                                    <a class="page-link bloqueo_pantalla"
                                                       href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id }}&page={{ pagenumber }}{{ url_params }}">{{ pagenumber }}</a>
                                                </li>
                                            {% endfor %}
                                        {% endif %}
                                    </ul>
                                </nav>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalAddAlumnoPlanificacion" tabindex="-1" aria-labelledby="modalAddLabelAlumnoPlanificacion" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-xl modal-fullscreen-lg-down">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-2" id="modalAddLabelAlumnoPlanificacion">Modal title</h5>
                    <button type="button" class="btn-close action-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body m-2">
                    <div class="datatable" id="divDetailData">
                        <table id="dtViewPersons" class='table table-bordered table-striped'>
                            <thead>
                            <tr>
                                <th style="text-align: center; vertical-align: middle; width: 40%">Alumno</th>
                                <th style="text-align: center; vertical-align: middle; width: 20%">Carrera</th>
                                <th style="text-align: center; vertical-align: middle; width: 40%">Materias</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer m-2">
                    <button type="button" class="btn btn-secondary action-close" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="el-templates" style="display:none;">
        <div element="table-row-actions">
            <table>
                <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <div class="table-controls">
                            <button type="button" class="btn btn-primary">Asignar</button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}

{% block extraJs %}

{% endblock %}
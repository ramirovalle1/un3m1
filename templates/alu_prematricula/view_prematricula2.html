{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <script src="https://kit.fontawesome.com/a96c5b6f8d.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/static/js/bootstrap-filestyle.min.js?v=1.0.1"></script>
    <script src="/static/adicionalesjs/formquestion.js?0.24"></script>

    <style>
        .nav-pills > .active > a, .nav-pills > .active > a:hover {
            color: #fff;
            background-color: #1C3247 ;
        !important;
        }

        {#.pasolisto {#}
        {#    color: #fff;#}
        {#!important;#}
        {#    background-color: #27ae60;#}
        {#!important;#}
        {#}#}

        .nav-tabs > li > a, .nav-pills > li > a {
            padding-right: 57px;
        !important;
        }

        .bordestabla {
            border: .07em solid rgba(0, 0, 0, .1);
            color: #000000;
            box-shadow: 1px 1px 3px #999;
        !important;
        }
    </style>
    <link rel="stylesheet" href="/static/eventostyle.css">
    <style>

        .result-list {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 100%
        }

        .result-list:after, .result-list:before {
            content: '';
            display: table;
            clear: both
        }

        .result-list > li {
            border: 1px solid #ddd;
            background: #fff;
            overflow: hidden;
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
        }

        .result-list > li:after, .result-list > li:before {
            content: '';
            display: table;
            clear: both
        }

        .result-list > li + li {
            margin-top: 10px
        }

        .result-list > li .result-image {
            width: 240px;
            padding: 0;
            overflow: hidden;
            background: #2d353c;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat
        }


        .result-list > li .result-image a {
            display: block
        }

        .result-list > li .result-image img {
            width: 100%
        }

        .result-list > li .result-image:focus, .result-list > li .result-image:hover {
            opacity: .8
        }

        .result-list > li .result-evento {
            padding: 20px;
            position: relative;
            -webkit-box-flex: 1;
            -ms-flex: 1;
            flex: 1
        }

        .result-list > li .result-evento .title {
            margin: 0 0 5px;
            font-size: 18px;
            line-height: 22px
        }


        .result-list > li .result-evento .title a {
            color: #2d353c
        }

        .result-list > li .result-evento .location {
            color: #6f8293;
        }

        .result-list > li .result-evento .decs {
            margin-bottom: 20px;
            max-height: 32px;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 16px
        }

        .result-list > li .result-evento .btn-row {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap
        }

        .result-list > li .result-evento .btn-row:after, .result-list > li .result-evento .btn-row:before {
            content: '';
            display: table;
            clear: both
        }

        .result-list > li .result-evento .btn-row a {
            color: #2d353c;
            background: #f2f3f4;
            font-size: 14px;
            line-height: 18px;
            padding: 8px 10px;
            -webkit-border-radius: 4px;
            border-radius: 4px
        }

        .result-list > li .result-evento .btn-row a + a {
            margin-left: 5px
        }

        .result-list > li .result-evento .btn-row a:focus, .result-list > li .result-evento .btn-row a:hover {
            background: #d5dbe0
        }

        .result-list > li .result-price {
            width: 240px;
            font-size: 28px;
            text-align: center;
            background: #f2f3f4;
            color: #2d353c;
            padding: 20px;
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -ms-flex-align: center;
            align-items: center
        }


        .result-list > li .result-price small {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: #6f8293
        }

        .result-list > li .result-price .btn {
            margin-top: 30px
        }

        .row > [class^=col-].ui-sortable {
            min-height: 50px
        }

        @-webkit-keyframes rotation {
            from {
                -webkit-transform: rotate(0);
                -moz-transform: rotate(0);
                -ms-transform: rotate(0);
                -o-transform: rotate(0);
                transform: rotate(0)
            }
            to {
                -webkit-transform: rotate(359deg);
                -moz-transform: rotate(359deg);
                -ms-transform: rotate(359deg);
                -o-transform: rotate(359deg);
                transform: rotate(359deg)
            }
        }

        @-moz-keyframes rotation {
            from {
                -webkit-transform: rotate(0);
                -moz-transform: rotate(0);
                -ms-transform: rotate(0);
                -o-transform: rotate(0);
                transform: rotate(0)
            }
            to {
                -webkit-transform: rotate(359deg);
                -moz-transform: rotate(359deg);
                -ms-transform: rotate(359deg);
                -o-transform: rotate(359deg);
                transform: rotate(359deg)
            }
        }

        @-o-keyframes rotation {
            from {
                -webkit-transform: rotate(0);
                -moz-transform: rotate(0);
                -ms-transform: rotate(0);
                -o-transform: rotate(0);
                transform: rotate(0)
            }
            to {
                -webkit-transform: rotate(359deg);
                -moz-transform: rotate(359deg);
                -ms-transform: rotate(359deg);
                -o-transform: rotate(359deg);
                transform: rotate(359deg)
            }
        }

        @keyframes rotation {
            from {
                -webkit-transform: rotate(0);
                -moz-transform: rotate(0);
                -ms-transform: rotate(0);
                -o-transform: rotate(0);
                transform: rotate(0)
            }
            to {
                -webkit-transform: rotate(359deg);
                -moz-transform: rotate(359deg);
                -ms-transform: rotate(359deg);
                -o-transform: rotate(359deg);
                transform: rotate(359deg)
            }
        }

        .single_faq {
            margin-bottom: 15px;
            padding: 15px;
        }

        .faq_question::before {
            font-size: 20px;
            line-height: 35px;
        }

        .faq_question {
            padding: 8px 10px 8px 26px;
        }

        .faq_answer {
            margin-top: 0;
        }
    </style>

    <script type="text/javascript">
        var materiasseleccionadas = [];
        var asignatura = 0;
        var materiaseleccion = 0;
        var materiasmaximas = 100;
        var position = 0;
        var contador_presenciales = 0;
        var contador_virtuales = 0;
        var horas_docente = 0;
        var max_horas_docente = 20;
        var horas_totales = 0;
        var max_horas_totales = 45;
        var contadorselecionterceramatricula=0;

        $(function() {
            {% if materiasterceramatricula > 0 %}
                materiasmaximas = 3
                {% if materiasterceramatricula == 1 %}
                    contadorselecionterceramatricula = 1;
                {% elif materiasterceramatricula == 2 %}
                    contadorselecionterceramatricula = 2;
                {% else %}
                    contadorselecionterceramatricula = 3;
                {% endif %}
            {% endif %}
            {% if coordinacion == 1 %}
                max_horas_docente = 40
                max_horas_totales = 60
            {% endif %}
            {% if inscripcion.carrera.modalidad == 3 and not inscripcion.carrera.id == 133 %}
                max_horas_docente = 40
                max_horas_totales = 55
            {% endif %}

            $("select").select2({minimumResultsForSearch: 10});

            $('.materia').click(function () {
                var mat;
                var tipoeje;
                var elemento = $(this);
                position = elemento.attr("id");
                tipoeje = elemento.attr('tipomateria');

                if (materiaseleccion <= materiasmaximas &&  horas_docente <= max_horas_docente && horas_totales <= max_horas_totales){
                    if (elemento.attr('ids')){
                        elemento.removeClass('btn-danger');
                        elemento.addClass('btn-info');
                        mat = elemento.attr('ids');
                        modalidadmateria = elemento.attr('modalidadmateria');
                        elemento.removeAttr('ids');
                        elemento.html('SELECCIONAR');
                        for(var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                            if(materiasseleccionadas[i].id === mat && materiasseleccionadas[i].modalidad === modalidadmateria) {
                                materiasseleccionadas.splice(i, 1);
                            }
                        }
                        materiaseleccion = materiasseleccionadas.length;
                        $("#id_seleccionadas").html(materiaseleccion);
                        horas_docente -= parseFloat(elemento.attr('hdte'))
                        horas_totales -= parseFloat(elemento.attr('htot'))
                        $("#id_horas_contacto_docente").html(horas_docente);
                        $("#id_horas_totales").html(horas_totales);
                     }
                    else {
                        if (materiaseleccion < materiasmaximas){
                            let comperehd = horas_docente+parseFloat(elemento.attr('hdte'));
                            let compereht = horas_totales+parseFloat(elemento.attr('htot'));
                            if (comperehd <= max_horas_docente &&  compereht <=  max_horas_totales ){
                                asignatura = elemento.attr('idd');
                                horas_docente += parseFloat(elemento.attr('hdte'));
                                horas_totales += parseFloat(elemento.attr('htot'));
                                asignaturamalla = elemento.attr('idam');
                                elemento.html('REMOVER').removeClass('btn-info').addClass('btn-danger').attr('ids', asignatura);
                                vmodalidad = elemento.attr('modalidadmateria');
                                var tr = elemento.closest('tr').find('#jornadaalterna').val();
                                var item = {
                                    id: elemento.attr('ids'),
                                    modalidad: vmodalidad,
                                    idmat: elemento.attr('idmat'),
                                    turno: '0',
                                    canttercera: elemento.attr('canttercera'),
                                    nivel: elemento.attr('nivel')
                                };
                                if (tr) {
                                    item['turno'] = tr
                                }
                                materiasseleccionadas.push(item);
                                materiaseleccion = materiasseleccionadas.length;
                                $("#id_seleccionadas").html(materiaseleccion);
                                {#$("#id_horas_contacto_docente").html('0');#}
                                $('#id_horas_contacto_docente').html(horas_docente);
                                $('#id_horas_totales').html(horas_totales);
                      }
                            else{
                                 NotificationJG.error('Solo puede elegir materias que sumen hasta '+max_horas_docente+  ' horas de contacto docente o '+max_horas_totales+' horas totales a la semana');
                            }
                        }
                        else {
                        NotificationJG.error('Solo puede elegir hasta '+materiasmaximas+ ' materias');
                        }
                    }
                }
                else {
                    {#$("#confmattxt").html('<p>No puede seleccionar mas de la cantidad maxima de materias.</p>');#}
                    {#$("#alertas").modal('show');#}
                        NotificationJG.error('En caso de tener materias de tercera matricula, unicamente podrá pre-matricularse en 3 materias');
                }
            });

            $('.materiap').click(function () {
                var mat;
                var tipoeje;
                var elemento = $(this);
                position = elemento.attr("id");
                tipoeje = elemento.attr('tipomateria');
                if (materiaseleccion < materiasmaximas){
                    if (elemento.attr('ids')){
                        mat = elemento.attr('ids');
                        tipo = elemento.attr("tipo");
                        elemento.html('SELECCIONAR ' + tipo).removeClass('btn-danger').addClass('btn-info').removeAttr('ids');
                        for(var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                            if(materiasseleccionadas[i].id === mat && materiasseleccionadas[i].tipo === tipo) {
                                materiasseleccionadas.splice(i, 1);
                            }
                        }
                        materiaseleccion = materiasseleccionadas.length;
                        $("#id_seleccionadas").html(materiaseleccion);
                    } else {
                        asignatura = elemento.attr('idd');
                        asignaturamalla = elemento.attr('idam');
                        elemento.html('REMOVER').removeClass('btn-info').addClass('btn-danger').attr('ids',asignatura);
                        vtipo = elemento.attr("tipo");
                        var item = {
                            id: elemento.attr('ids'),
                            tipo: vtipo
                        };
                        materiasseleccionadas.push(item);
                        if(vtipo == 'P1'){
                            btipo='P2';
                        }else{
                            btipo='P1';
                        }
                        for(var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                            if(materiasseleccionadas[i].id === elemento.attr('ids') && materiasseleccionadas[i].tipo === btipo) {
                                materiasseleccionadas.splice(i, 1);
                                $("#" + btipo + asignatura).html('SELECCIONAR ' + btipo).removeClass('btn-danger').addClass('btn-info').removeAttr('ids');
                            }
                        }
                        materiaseleccion = materiasseleccionadas.length;
                        $("#id_seleccionadas").html(materiaseleccion);
                    }
                } else {
                    $("#confmattxt").html('<p>No puede seleccionar mas de la cantidad maxima de materias.</p>');
                    $("#alertas").modal('show');
                }
            });

            $('#btnmatricular').click(function () {
                if (materiasseleccionadas.length > 0){
                    contador = 0;
                    nivelterceramat = 0;
                    nivelmaterias = 0;
{#                    {% if materiasterceramatricula <= 3 and materiasterceramatricula > 0 %}#}
                        for (var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                            {#switch (parseInt(materiasseleccionadas[i].canttercera)) {#}
                            {#    case 3:#}
                            {#        contador += 1;#}
                            {#        let nv = materiasseleccionadas[i].nivel#}
                            {#        if(nv>nivelterceramat){#}
                            {#            nivelterceramat = parseInt(nv);#}
                            {#            }#}
                            {#        break;#}
                            {# }#}
                            if (parseInt(materiasseleccionadas[i].canttercera)>2){
                             contador += 1;
                             let nv = materiasseleccionadas[i].nivel
                                if(nv>nivelterceramat){
                                    nivelterceramat = parseInt(nv);
                                }

                            }
                            let nvg = materiasseleccionadas[i].nivel
                            if(nvg>nivelmaterias){nivelmaterias = parseInt(nvg);}
                        }
{#                    {% endif %}#}
                    contador_presenciales = 0;
                    contador_virtuales = 0;
                    for (var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                        switch (parseInt(materiasseleccionadas[i].modalidad)) {
                            case 1:
                                contador_presenciales += 1;
                                break;
                            case 2:
                                contador_virtuales += 1;
                                break;
                        }
                    }
                    if (contador === contadorselecionterceramatricula) {
                        let mensaje ='';
                        {% if inscripcion.carrera.modalidad == 1 %}
                        mensaje = '<p>Al confirmar, usted está generando la planificación de matriculación en <b>' + materiasseleccionadas.length + '</b> materia(s).</p>' +
                            '<b>Total presenciales: <span class="badge badge-success" style="vertical-align: middle">' + contador_presenciales + '</span></b>' + ' <b>Total virtuales: <span class="badge badge-info" style="vertical-align: middle">' + contador_virtuales + '</span></b>' +
                            '<p><h4>Términos y condiciones</h4></p>'+' {{ terminos|safe }}'
                        {% else %}
                            mensaje = '<p>Al confirmar, usted está generando la planificación de matriculación en <b>' + materiasseleccionadas.length + '</b> materia(s).</p>' +
                            '<p><h4>Términos y condiciones</h4></p>'+' {{ terminos|safe }}'
                        {% endif %}
                        //$("#matricular .modal-body").html("<p>Esta seguro de confirmar la prematriculacion.</p><p>Al confirmar, usted se estar&iacute;a prematriculando en <b>"+materiasseleccionadas.length+"</b> materia(s).</p>");
                        $("#matricular .modal-body").html(mensaje);
                        $("#matricular").modal('show');

                        {#$('.btn-matricular').prop('disabled', $('.acepta:checked').length);#}
                        $('input[type=checkbox]').click(function () {
                            //console.log($('.tab1_chk:checkbox:checked').length);
                            /*                        if ($('.acepta:checkbox:checked').length > 0) {
                                                        $('.btn-matricular').prop('disabled', false);
                                                    } else {
                                                        $("#matricular .modal-footer").html('<b> Por favor, acepte los terminos y condiciones </b>');
                                                        $('.btn-matricular').prop('disabled', true);
                                                    }*/
                        });

                    }
                    else if(nivelterceramat>0 && nivelmaterias>nivelterceramat){
                        NotificationJG.error('Debe seleccionar materias del mismo nivel o inferior de la(s) materia(s) de tercera matricula')
                    }
                    else {NotificationJG.error('Debe dar prioridad a las materias de tercera matricula')}

                } else {
                    $("#alertas .modal-body").html("<p>Debe seleccionar al menos 1 materia</p>");
                    $("#alertas").modal('show');
                }
            });

            $('.btn-cerrar').click(function () {
                $("#matricular").modal('hide');
                $("#alertas").modal('hide');
                $("#matricularmensajespanel").modal('hide');
            });

            $('.btn-cerrar2').click(function () {
                location.href = '/';
            });

            $('.btn-matricular').click(function(){

                if ($('#idacepta').is(':checked')) {
                    $("#matricular").modal('hide');
                    inscripcion = $("#inscripcion").attr('valor');
                    turno = $("#jornada").val();
                    bloqueointerface();
                    $.post("/alu_prematricula", {'action': 'prematricular', 'id': inscripcion, 'pid': '{{ periodoprematricula.id }}', 'turno':turno,  'materias': JSON.stringify(materiasseleccionadas)},
                        function(data) {
                        $.unblockUI();
                        if (data.result==='ok') {
                            let texto = 'Haz generado correctamente su planificación. <br>';
                            if (data.valormatriculapago>0) {
                                texto = texto + ' El valor que deberá pagar por concepto de matrícula es de $' + data.valormatriculapago;
                            }
                            Swal.fire({
                                title: texto,
                                type: 'info',
                                showCancelButton: false,
                                confirmButtonText: '<i class="fa fa-thumbs-up"></i> OK',
                                allowOutsideClick: false,
                                allowEscapeKey: false
                            }).then((result) => {
                                if (result.value) {
                                    window.location.replace('/alu_prematricula')
                                }
                            });
                        }
                        else {
                            $('.btn-matricular').prop("disabled", false);
                            Swal.fire({
                                position: 'top-end',
                                type: 'error',
                                title: data.mensaje,
                                showConfirmButton: false,
                                timer: 1500
                            })
                            {#$("#matricularmensajespanel .modal-body").html('<p>"+data.mensaje+"</p>');#}
                            {#$("#btnfinal1").removeAttr('hidden').show();#}
                        }
                    }, "json");
                }
                else
                {
                    $.unblockUI();
                    {#if (!$('#idacepta').is(':checked')) {#}
                        {#$("#mensaje").html('<b> Por favor, acepte los terminos y condiciones </b>');#}
                        $("#mensaje").fadeIn('slow');
                    {# }#}
//                    smoke.alert("Por favor, acepte los terminos y condiciones");
                }

            });

            $("#idacepta").on('change', function (){
                if ($(this).is(':checked')) {
                    $("#mensaje").fadeOut('slow');
                } else {
                    $("#mensaje").fadeIn('slow');
                }
            })

            $('.predecesores').popover({
                placement : 'left',
                html : true,
                trigger : 'hover',
                delay: {
                    show: "500",
                    hide: "100"
                }
            }).on('shown.bs.popover', function() {
                setTimeout(function() {
                    $('.predecesores').popover('hide');
                }, 1000);
            });

            var navListItems = $('ul.setup-panel li a'), allWells = $('.setup-content');

            allWells.hide();

            {#$(".tabla_asignaturas").hide();#}
            $("#jornada").change(function () {
                let jornada_seleccionada = $("#jornada").val();
                if (jornada_seleccionada !== '' && jornada_seleccionada !== '0' ) {
                    /*$.ajax({
                        type: "GET",
                        url: "/alu_prematricula",
                        data: {'jornada': jornada_seleccionada}
                    });*/
                    location.href = "/alu_prematricula?action=prematricula&jornada="+jornada_seleccionada;
                    $(".tabla_asignaturas").show();

                    //$(".tabla_asignaturas").show();
                } else {
                    location.href = "/alu_prematricula?action=prematricula"
                        $(".tabla_asignaturas").show();
                }
            });

            navListItems.click(function (e) {
                e.preventDefault();
                var $target = $($(this).attr('href')),
                    $item = $(this).closest('li');

                if (!$item.hasClass('disabled')) {
                    navListItems.closest('li').removeClass('active');
                    $item.addClass('active');
                    allWells.hide();
                    $target.show();
                }
            });

            $('ul.setup-panel li.active a').trigger('click');

            $('.activate-step-1').on('click', function (e) {
                $('ul.setup-panel li:eq(0)').removeClass('disabled');
                $('ul.setup-panel li a[href="#step-1"]').trigger('click');
                {#$(this).remove();#}
            })

{#            {% if not paso2 %}#}
{#                $('.activate-step-2').on('click', function (e) {#}
{#                    let  jornada_seleccionada = $("#jornada").val();#}
{#                    if (jornada_seleccionada > 0){#}
{#                        $.ajax({#}
{#                            type: "GET",#}
{#                            url: "/alu_prematricula",#}
{#                            data: {'jornada': jornada_seleccionada}});#}
{#                        $('ul.setup-panel li:eq(1)').removeClass('disabled');#}
{#                        $('ul.setup-panel li a[href="#step-2"]').trigger('click');#}
{#                        /*$.ajax({#}
{#                            type: "GET",#}
{#                            url: "/alu_prematricula",#}
{#                            data: {'jornada': jornada_seleccionada},#}
{#                            success: function (data) {#}
{#                                if (data.result == 'ok') {#}
{#                                    $('ul.setup-panel li:eq(1)').removeClass('disabled');#}
{#                                    $('ul.setup-panel li a[href="#step-2"]').trigger('click');#}
{#                                } else {#}
{#                                    smoke.alert(data.mensaje);#}
{#                                }#}
{#                            },#}
{#                                dataType: "json"#}
{#                        });*/#}
{#                    }else{#}
{#                        smoke.alert("SELECCIONE UNA JORNADA.")#}
{#                    }#}
                    {#$(this).remove();#}
{#                });#}
{#            {% endif %}#}

            {% if not paso2 %}
                $('.activate-step-2').on('click', function (e) {
                    $(".tabla_asignaturas").show();
                    $('ul.setup-panel li:eq(1)').removeClass('disabled');
                    $('ul.setup-panel li a[href="#step-2"]').trigger('click');
                    {#$(this).remove();#}
                })
            {% endif %}

        });

        function formModal(id, text, action) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === 'ok') {
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(text);
                        $("#itemspanel").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }
    </script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
{#            <h4><i class="fa fa-check-circle"></i> {{ title }}</h4>#}
{#            <h5><i class="fa fa-calendar-o"></i> Periodo: {{ periodo }}</h5>#}
{#            <h5 id='inscripcion' valor={{ inscripcion.id }}><i class="fa fa-user"></i> Estudiante: {{ inscripcion.persona }}</h5>#}
{#            <h5><i class="fa fa-mortar-board"></i> Carrera: {{ inscripcion.carrera }}</h5>#}
{#            <h5><i class="fa fa-project-diagram"></i> Malla: {{ malla }}</h5>#}
            <div class="page-content-inner"
                     style="background-image: url('/static/images/aok/banner-tarjeta3.png?0.1');
                         background-size: cover; border-radius: 20px; border-color: #002E45 !important; padding: 0 !important;">
                    <div class="page-content-inner uk-light pb-0">

                        <div class="profile-layout">
                            <div class="profile-layout-avature">
                                <br><br><br><br>
                                <div class="user-profile-photo">
                                    {% if persona.foto %}
                                        <img src="https://sga.unemi.edu.ec{{ persona.foto.foto.url }}" onerror="this.onerror=null;this.src='/static/images/image.png'" class="img-circle profile_info_image">
                                    {% else %}
                                        <img src="/static/images/iconos/{% if persona.sexo.id == 2 %}hombre.png{% else %}mujer.png{% endif %}" onerror="this.onerror=null;this.src='/static/images/image.png'" class="img-circle profile_info_image">
                                    {% endif %}
                                </div>

                            </div>
                            <div class="profile-layout-content" style="color: #ffffff">
                                <h1 style="text-align: center"><i class="fa fa-check-circle"></i> {{ title }}</h1><hr>
                                <h2 id='inscripcion' valor={{ inscripcion.id }} >{{ persona }}</h2>
                                <p><i class="fa fa-envelope"></i> Email Inst.: {{ persona.emailinst }} &nbsp;&nbsp; <i class="fa fa-envelope"></i> Email: {{ persona.email }}</p>
                                <p><i class="fa fa-phone"></i> Telf.: {{ persona.telefono }}</p>
                                <p><i class="fa fa-map-marker"></i> Ciudad.: {{ persona.canton.nombre }} &nbsp;&nbsp; <i class="fa fa-map-marker"></i> Dirección.: {{ persona.direccion_corta }}</p>
                                <p><i class="fa fa-calendar-o"></i> Periodo: {{ periodo }}&nbsp;&nbsp; <i class="fa fa-mortar-board"></i> Carrera: {{ inscripcion.carrera }}</p>
                                <p><i class="fa fa-project-diagram"></i> Malla: {{ malla }}</p><br>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>

    <div class='row-fluid'>
        <div class='span12'>
            <div class="row-fluid">
                {% if tienedeuda %}
                    <span class="label label-important"> ESTIMADO ESTUDIANTE LE RECORDAMOS QUE TIENE UNA DEUDA PENDIENTE DE PAGO DE $ {{ tienedeuda }}</span> <a href="javascript:;" class="btn btn-warning" onclick="formModal('{{ inscripcion.id|encrypt_alu }}', 'Detalle de Rubros pendientes de pago', 'verdeuda')"><i class="fa fa-dollar-sign"></i> Ver detalle</a><br>
                {% endif %}
            {% if materiasterceramatricula > 0 and  materiasterceramatricula <= 3 %}
            <div class="alert alert-danger">
                        <a href="javascript:;" class="close" data-dismiss="alert">×</a>
                        <h4 class="alert-heading"><i class="fa fa-warning"></i> Usted tiene materias de tercera matricula:</h4>
                        <p>Solo puede planificar hasta 3 materias, estas deben incluir las materias de tercera matricula</p>
                    </div><div class="alert alert-danger">
                        <a href="javascript:;" class="close" data-dismiss="alert">×</a>
                        <h4 class="alert-heading"><i class="fa fa-warning"></i> Usted tiene materias de tercera matricula:</h4>
                        <p>Solo puede planificar hasta 3 materias, estas deben incluir las materias de tercera matricula</p>
                    </div>
            {% endif %}

{#            <a href="javascript:;" class="btn btn-info" onclick="formModal('{{ inscripcion.id|encrypt_alu }}', 'Actualizar datos del perfil', 'actualizardatos')"><i class="fa fa-address-card"></i> Actualizar datos del perfil</a>#}
            </div>
         <h4><i class="fa fa-graduation-cap"></i> Asignaturas de mi carrera ofertadas en este periodo: </h4><br>
        <div class="row-fluid">
                <table>
                    <tbody>
                    <b><i class="fa fa-calendar-check-o"></i> Jornada:</b><br>
                    <select name="jornadas" id="jornada">
                        <option value="0">SELECCIONE JORNADA</option>
                        {% for jornada in jornadas_lista %}
                            <option {% if jornada_select == jornada.id %}selected="selected"{% endif %} value='{{ jornada.id|encrypt_alu }}'>{{ jornada.nombre }}</option>
                        {% endfor %}
                    </select>
                    </tbody>
                </table>
            </div>
{#        {% if sincupo %}#}
{#            <br><br>#}
{#            <div class="alert alert-danger">#}
{#                <a href="javascript:;" class="close" data-dismiss="alert">×</a>#}
{#                <h4 class="alert-heading"><i class="fa fa-warning"></i> Estimado estudiante ya no existe cupo en la jornada seleccionada, por favor comuníquese con su director/a de carrera. </h4>#}
{#            </div>#}
        {% if jornadas_lista.count > 0 %}
            <div class="row-fluid">
                <div style="text-align: right; float: left; width: 100%">
                    <h5 style="vertical-align: middle">
                        <i class="fa fa-check-square"></i> Seleccionadas: <span style="vertical-align: middle" class="badge badge-info" id="id_seleccionadas">0</span><br>
                        <i class="fa fa-clock-o"></i> Horas Contacto Docente: <span style="vertical-align: middle" class="badge badge-inverse" id="id_horas_contacto_docente">0</span><br>
                        <i class="fa fa-clock-o"></i> Horas Totales: <span style="vertical-align: middle" class="badge badge-inverse" id="id_horas_totales">0</span>
                        {#                        <i class="fa fa-list-ul"></i> Totales: <span style="vertical-align: middle" class="badge badge-info" id="id_materiasmaximas" val="{{ materiasmaximas }}">{{ materiasmaximas }}</span><br>#}
                    </h5>
                </div>
            </div>
            <div class='row-fluid'>
                <div class='span12'>
                    <span class="label label-info"> Mostrando {{ materiasmalla.count }} registros</span><br><br>
                    {#                    <table class='table table-bordered table-striped bordestabla uk-width-1-1 tabla_asignaturas'>#}
                    <table class='table tabla_asignaturas'>
                        <tr>
                            <th><i class="fa fa-list"></i> Asignatura</th>
                            <th style="text-align: center"><i class="fa fa-code-fork"></i> Modalidad de Impartición</th>
                            <th style="text-align: center"><i class="fa fa-sort-numeric-asc"></i> Nivel</th>
                            {#                            <th style="width: 300px; text-align: center"><i class="fa fa-tag"></i> Eje Formativo</th>#}
                            <th style="text-align: center; width: 150px"><i class="fa fa-coins"></i> Cr&eacute;ditos</th>
                            <th style="width: 200px; text-align: center;"><i class="fa fa-clock"></i> Horas</th>
                            {#                            <th style="width: 100px; text-align: center;"><i class="fa fa-clock"></i> Horas <br> contacto docente</th>#}
                            <th style="width: 100px; text-align: center;"><i class="fa fa-clock"></i> Jornada Disponible</th>
                            {% if  inscripcion.carrera.modalidad == 1 %}
                                <th style="width: 100px; text-align: center;"><i class="fa fa-clock"></i> Jornada Sugerida <a href="javascript:;" type="button" class="btn btn-default btn-mini tu"
                                                                                                                              title="Escoja la jornada que le gustaría recibir sus clases, para analizar la apertura en ese horario"><i class="fa fa-info" style="color: #0c84ff"></i></a></th>
                            {% endif %}


                            <th style="width: 120px; text-align: center;"><i class="fa fa-check"></i> Disponible</th>
                            <th style="width: 120px; text-align: center;">Estado</th>
                        </tr>
                        {% if materiasmalla %}
                            {% for materia in materiasmalla %}
                                {% with cantidadmatricula=materia|args:inscripcion|call:'cantidad_matriculas' %}
                                    <tr>
                                        <td>
                                            {{ materia.asignatura }}<br>
                                            {% if cantidadmatricula %}
                                                <b><span class="label label-important">Matricula N° {{ cantidadmatricula }}</span></b><br>
                                            {% endif %}
                                            <b><span class="badge badge-info">{{ materia.nivel.sesion.nombre }}</span></b>
                                        </td>
                                        <td style="vertical-align: middle; text-align: center">
                                            {% if inscripcion.carrera.modalidad == 3 %}
                                                <b><span class="badge badge-info"> ESTA ASIGNATURA <br> SE IMPARTIRÁ DE FORMA <br>VIRTUAL</span></b>
                                            {% else %}
                                                {% if materia.asignaturamalla.modalidad %}
                                                    <b><span class="badge badge-success"> ESTA ASIGNATURA <br> SE IMPARTIRÁ DE FORMA <br>PRESENCIAL EN INSTALACIONES DE UNEMI</span></b>
                                                {% else %}
                                                    <b><span class="badge badge-info"> ESTA ASIGNATURA <br> SE IMPARTIRÁ DE FORMA <br>VIRTUAL</span></b>
                                                {% endif %}
                                            {% endif %}

                                        </td>
                                        <td style="text-align: center;">{{ materia.asignaturamalla.nivelmalla }}</td>
                                        {#                                    <td style="text-align: center;">{{ materia.asignaturamalla.ejeformativo }}</td>#}
                                        <td style="text-align: center;">{{ materia.asignaturamalla.creditos }}</td>
                                        <td style="text-align: left;"><b>Total asignatura:</b> {{ materia.asignaturamalla.horas }} <br>
                                            <b>Semanales: </b> {{ materia.asignaturamalla.horastotal }}<br>
                                            <b>Contacto docente: </b>{{ materia.asignaturamalla.horasacdsemanal }}
                                        </td>
                                        {#                                    <td style="text-align: center;"></td>#}
                                        <td style="text-align: center;">{{ materia.nivel.sesion.nombre }}</td>
                                        {% with puedetomar=inscripcion|args:materia.asignaturamalla.asignatura|call:"puede_tomar_materia_pre_matricula" estado=inscripcion|args:materia.asignaturamalla.asignatura|call:"estado_asignatura_pre_matricula" %}
                                            {% if inscripcion.carrera.modalidad == 1 and not estado == 1 and not estado == 3  and puedetomar %}
                                                <td style="text-align: center;">
                                                    <select name="jornadaalterna" id="jornadaalterna">
                                                        {#                                               {% for j in turnos %}#}
                                                        {#                                                   <option value="{{ j.0 }}" {% if j.0 == materia.nivel.sesion.id %}selected{% endif %}>{{ j.1 }}</option>#}
                                                        {#                                               {% endfor %}#}
                                                        <option value="1" {% if 1 == materia.nivel.sesion.id %}selected{% endif %}>MATUTINA</option>
                                                        <option value="4" {% if 4 == materia.nivel.sesion.id %}selected{% endif %}>VESPERTINO</option>
                                                        <option value="5" {% if 5 == materia.nivel.sesion.id %}selected{% endif %}>NOCTURNO</option>
                                                    </select>
                                                </td>
                                            {% endif %}


                                            <td style="text-align: center;">
                                                {% if puedetomar %}
                                                    {% if not  estado == 1 %}
                                                        {#                                                    {% if inscripcion.sesion.id <= 7 %}#}
                                                        <a href="javascript:;" id="{{ materia.asignaturamalla.asignatura.id }}" idam="{{ materia.asignaturamalla.id }}" idd="{{ materia.asignaturamalla.asignatura.id }}" tipomateria="{{ materia.asignaturamalla.ejeformativo.id }}" idmat="{{ materia.pk|encrypt_alu }}" hdte="{{ materia.asignaturamalla.horasacdsemanal }}" htot="{{ materia.asignaturamalla.horastotal }}" canttercera="{{ cantidadmatricula }}"
                                                           nivel="{{ materia.asignaturamalla.nivelmalla.orden }}" modalidadmateria="{% if materia.asignaturamalla.modalidad and not inscripcion.carrera.modalidad == 3 %}1{% else %}2{% endif %}" class="btn btn-info btn-mini materia">SELECCIONAR</a>
                                                        {#                                                    {% else %}#}
                                                        {#                                                        <a href="javascript:;" id="P1{{ materia.asignaturamalla.asignatura.id }}" idam="{{ materia.asignaturamalla.id }}" idd="{{ materia.asignaturamalla.asignatura.id }}" tipomateria="{{ materia.asignaturamalla.ejeformativo.id }}" hdte = "{{ materia.asignaturamalla.horasacdsemanal }}" canttercera="{{ cantidadmatricula }}" tipo="P1" class="btn btn-info btn-mini materiap tl" title="Ver la materia en el Parcial 1">SELECCIONAR P1</a>#}
                                                        {#                                                        <p>#}
                                                        {#                                                        <a href="javascript:;" id="P2{{ materia.asignaturamalla.asignatura.id }}" idam="{{ materia.asignaturamalla.id }}" idd="{{ materia.asignaturamalla.asignatura.id }}" tipomateria="{{ materia.asignaturamalla.ejeformativo.id }}" hdte = "{{ materia.asignaturamalla.horasacdsemanal }}" canttercera="{{ cantidadmatricula }}" tipo="P2"  class="btn btn-info btn-mini materiap tl" title="Ver la materia en el Parcial 2">SELECCIONAR P2</a>#}
                                                        {#                                                    {% endif %}#}
                                                    {% endif %}
                                                {% else %}
                                                    {% if not  estado == 1 %}
                                                        {% with lista_pred=materia.asignaturamalla|args:inscripcion|call:'lista_predecesoras' %}
                                                            {% if lista_pred.count > 0 %}
                                                                <a href="javascript:;" class="smaller predecesores" data-placement="left" rel="popover" data-content="{% for precedencia in lista_pred %}{{ precedencia.predecesora.asignatura.nombre }}{% if not forloop.last %},{% endif %}{% endfor %}" data-original-title="Precedencias"> {{ lista_pred.count }} precedencia{% if lista_pred.count > 1 %}
                                                                    s{% endif %} </a>
                                                            {% endif %}
                                                        {% endwith %}
                                                        {#                                                    {% if materia.asignaturamalla.cantidad_predecesoras %}#}
                                                        {#                                                        <a href="javascript:;" class="smaller predecesores" data-placement="left" rel="popover" data-content="{% for precedencia in materia.asignaturamalla.lista_predecesoras %}{{ precedencia.predecesora.asignatura.nombre }}{% if not forloop.last %},{% endif %}{% endfor %}" data-original-title="Precedencias"> {{ materia.asignaturamalla.cantidad_predecesoras }} precedencia{% if materia.asignaturamalla.cantidad_predecesoras > 1 %}#}
                                                        {#                                                            s{% endif %} </a>#}
                                                        {#                                                    {% endif %}#}
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            {% if estado == 1 %}
                                                <td class='estado' id='1' style="text-align: center;"><span class="label label-success">APROBADA</span></td>
                                            {% elif estado == 2 %}
                                                <td class='estado' id='0' style="text-align: center;"><span class="badge badge-important">REPROBADO</span></td>
                                            {% elif estado == 3 %}
                                                <td class='estado' id='3' style="text-align: center;"><span class="badge badge-info">EN CURSO</span></td>
                                            {% else %}
                                                <td class='estado' id='0' style="text-align: center;"><span class="badge badge-warning">PENDIENTE</span></td>
                                            {% endif %}
                                        {% endwith %}
                                    </tr>
                                {% endwith %}
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="8" style="text-align: center">NO TIENE MALLA ASIGNADA</td>
                            </tr>
                        {% endif %}
                    </table>
                </div>
                <div class="row-fluid">
                    <div style="text-align: right; float: left; width: 100%">
                        {% if materiasmalla %}
                            <a href="javascript:;" class="btn btn-info btn-large" id="btnmatricular"> <i class="fa fa-save"></i> GUARDAR PLANIFICACIÓN</a>
                        {% endif %}
                    </div>
                </div>
            </div>
         {% else %}
            <br><br>
            <div class="alert alert-danger">
                <a href="javascript:;" class="close" data-dismiss="alert">×</a>
                <h4 class="alert-heading"><i class="fa fa-warning"></i> Estimado estudiante no existen asignaturas ofertadas para este proceso, por favor diríjase al módulo BALCÓN DE SERVICIOS. <a href="/alu_solicitudbalcon" class="btn btn-info"><i class="fa fa-sign-in"></i> Ir al balcón</a> </h4>
            </div>
        {% endif %}

        </div>
    </div>
{#========================================== MODALES ==========================================#}
    <div class="modal fade static" id="matricular" style="display: none;">
        <div class="totales-seleccionadas"></div>
        <div class="modal-header">
            <h4>Confirmar prematricula</h4>
        </div>
        <div class="modal-body" style="min-height: 60px;"></div>
        <div class="span3">
            <input type="checkbox" id="idacepta" name="idacepta" class="acepta"> <strong style="vertical-align: middle">He leído y acepto los términos.</strong>
            <p id="mensaje" style="display: none; color: red" >Por favor, acepte los terminos y condiciones</p>
        </div>
        <br><br><br>

        <div class="modal-footer">
            <button type="button" class="btn btn-success btn-matricular" id="btnmatricular">Confirmar</button>

{#            <a href="javascript:;" hidden="hidden" id="matricular" class="btn btn-matricular" disabled>Confirmar</a>#}
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static materiasseleccionmodal" id="materias" style="display: none;">
        <div class="modal-header">
            <h4>Materias abiertas</h4>
        </div>
        <div class="modal-body" style="overflow: scroll;">
            <div id="panelcontent">
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar cerrarpanel">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="alertas" style="display: none;">
        <div class="modal-header">
            <h4>Alertas</h4>
        </div>
        <div class="modal-body" style="height: 60px;">
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" data-keyboard="true" data-backdrop="static" id="matricularmensajespanel" >
        <div class="modal-header">
            <h4>Matriculando</h4>
        </div>
        <div class="modal-body"  style="height: 60px;">
        </div>
        <div class="modal-footer" id='btnfinal1' hidden="hidden">
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
        <div class="modal-footer" id='btnfinal2' hidden="hidden">
            <a href="javascript:;" class="btn btn-cerrar2">Aceptar</a>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle"></h3>
        </div>
        <div class="modal-body panelbody">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info" data-dismiss="modal">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>
{% endblock %}
{% extends "ajaxformbs.html" %}
{% block extraheading %}

    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="/static/js/bootstrap-filestyle.min.js?v=1.0.1"> </script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>

    <script type="text/javascript">
        $(function() {
            chequeaFormulario = function() {
                vacunas = $("#id_vacunas");
                enfermedadvisual = $("#id_enfermedadvisual");
                alergiamedicinas = $("#id_alergiamedicinas");
                alergiaambientes = $("#id_alergiaambientes");
                alergiaalimentos = $("#id_alergiaalimentos");
                enfermedades = $("#id_enfermedades");
                enfermedadvenereas = $("#id_enfermedadvenereas");
                medicinas = $("#id_medicinas");


                if (!$("#id_vacuna").is(':checked')) {
                    vacunas.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_vacuna").hide();
                } else {
                    vacunas.attr("disabled", false).addClass("validate[required]");
                    $("#add_vacuna").show();
                }

                if (!$("#id_letes").is(':checked')) {
                    enfermedadvisual.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_enfermedad_visual").hide();
                } else {
                    enfermedadvisual.attr("disabled", false).addClass("validate[required]");
                    $("#add_enfermedad_visual").show();
                }

                if (!$("#id_alergiamedicina").is(':checked')) {
                    alergiamedicinas.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_alergia_farmaco").hide();
                } else {
                    alergiamedicinas.attr("disabled", false).addClass("validate[required]");
                    $("#add_alergia_farmaco").show();
                }

                if (!$("#id_alergiaambiente").is(':checked')) {
                    alergiaambientes.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_alergia_ambiente").hide();
                } else {
                    alergiaambientes.attr("disabled", false).addClass("validate[required]");
                    $("#add_alergia_ambiente").show();
                }

                if (!$("#id_alergiaalimento").is(':checked')) {
                    alergiaalimentos.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_alergia_alimento").hide();
                } else {
                    alergiaalimentos.attr("disabled", false).addClass("validate[required]");
                    $("#add_alergia_alimento").show();
                }

                if (!$("#id_enfermedad").is(':checked')) {
                    enfermedades.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_enfermedad_general").hide();
                } else {
                    enfermedades.attr("disabled", false).addClass("validate[required]");
                    $("#add_enfermedad_general").show();
                }

                if (!$("#id_enfermedadvenerea").is(':checked')) {
                    enfermedadvenereas.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_enfermedad_venerea").hide();
                } else {
                    enfermedadvenereas.attr("disabled", false).addClass("validate[required]");
                    $("#add_enfermedad_venerea").show();
                }

                if (!$("#id_tomamedicina").is(':checked')) {
                    medicinas.attr("disabled", true).val("").trigger("change").removeClass("validate[required]");
                    $("#add_medicina").hide();
                } else {
                    medicinas.attr("disabled", false).addClass("validate[required]");
                    $("#add_medicina").show();
                }

{#                if (!$("#id_cirugias").is(':checked')) {#}
{#                    nombrecirugia.attr("disabled", true).val("");#}
{#                    fechacirugia.attr("disabled", true).val("");#}
{#                    $("#id_fechacirugia, #id_nombrecirugia").removeClass("validate[required]");#}
{#                } else {#}
{#                    fechacirugia.val("01-01-1980").attr("disabled", false);#}
{#                    nombrecirugia.attr("disabled", false);#}
{#                    $("#id_fechacirugia, #id_nombrecirugia").addClass("validate[required]");#}
{#                }#}
{##}
{#                if (!$("#id_aparato").is(':checked')) {#}
{#                    tipoaparato.attr("disabled", true).val("").removeClass("validate[required]");#}
{#                } else {#}
{#                    tipoaparato.attr("disabled", false).addClass("validate[required]");#}
{#                }#}
            };

            $("#id_vacuna").click(chequeaFormulario);
            $("#id_letes").click(chequeaFormulario);
            $("#id_alergiamedicina").click(chequeaFormulario);
            $("#id_alergiaambiente").click(chequeaFormulario);
            $("#id_alergiaalimento").click(chequeaFormulario);
            $("#id_enfermedad").click(chequeaFormulario);
            $("#id_enfermedadvenerea").click(chequeaFormulario);
            $("#id_tomamedicina").click(chequeaFormulario);

            chequeaFormulario();

            $("#id_descripcionvacuna").addClass("validate[required]");
            $("#id_descripcionenfermedad").addClass("validate[required]");
            $("#id_descripcionalergia").addClass("validate[required]");
            $("#id_descripcionmedicina").addClass("validate[required]");


            $("#id_descripcionvacuna, #id_descripcionenfermedad, #id_descripcionalergia, #id_descripcionmedicina").keypress(function(event) {
                if (event.keyCode == 13) {
                    event.preventDefault();
                }
            });


            $("#add_vacuna").click(function () {
                $("#id_descripcionvacuna").val('');
                $("#registromodalvacuna").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_enfermedad").click(function () {
                idte=$("#add_enfermedad").attr('idte');
                dte=$("#add_enfermedad").attr('dte');
                $("#tipoenfermedad").val(idte);
                $("#tituloenfermedad").html(dte);
                $("#id_descripcionenfermedad").val('');
                $("#registromodalenfermedad").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_enfermedad_visual").click(function () {
                idte=$("#add_enfermedad_visual").attr('idte');
                dte=$("#add_enfermedad_visual").attr('dte');
                $("#tipoenfermedad").val(idte);
                $("#tituloenfermedad").html(dte);
                $("#id_descripcionenfermedad").val('');
                $("#registromodalenfermedad").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_enfermedad_general").click(function () {
                idte=$("#add_enfermedad_general").attr('idte');
                dte=$("#add_enfermedad_general").attr('dte');
                $("#tipoenfermedad").val(idte);
                $("#tituloenfermedad").html(dte);
                $("#id_descripcionenfermedad").val('');
                $("#registromodalenfermedad").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_enfermedad_venerea").click(function () {
                idte=$("#add_enfermedad_venerea").attr('idte');
                dte=$("#add_enfermedad_venerea").attr('dte');
                $("#tipoenfermedad").val(idte);
                $("#tituloenfermedad").html(dte);
                $("#id_descripcionenfermedad").val('');
                $("#registromodalenfermedad").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_alergia_farmaco").click(function () {
                idte=$("#add_alergia_farmaco").attr('idte');
                dte=$("#add_alergia_farmaco").attr('dte');
                $("#tipoalergia").val(idte);
                $("#tituloalergia").html(dte);
                $("#id_descripcionalergia").val('');
                $("#registromodalalergia").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_alergia_ambiente").click(function () {
                idte=$("#add_alergia_ambiente").attr('idte');
                dte=$("#add_alergia_ambiente").attr('dte');
                $("#tipoalergia").val(idte);
                $("#tituloalergia").html(dte);
                $("#id_descripcionalergia").val('');
                $("#registromodalalergia").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $("#add_alergia_alimento").click(function () {
                idte=$("#add_alergia_alimento").attr('idte');
                dte=$("#add_alergia_alimento").attr('dte');
                $("#tipoalergia").val(idte);
                $("#tituloalergia").html(dte);
                $("#id_descripcionalergia").val('');
                $("#registromodalalergia").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });


            $("#add_medicina").click(function () {
                $("#id_descripcionmedicina").val('');
                $("#registromodalmedicina").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            cargarvacunas = function(nuevoid){
                eseleccionados = $('#id_vacunas').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_vacunas').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'vacunas'},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_vacunas').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_vacunas').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            cargarenfermedadinfantil = function(nuevoid){
                eseleccionados = $('#id_enfermedadinfancia').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_enfermedadinfancia').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'enfermedades', 'tipo': 1},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_enfermedadinfancia').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_enfermedadinfancia').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            cargarenfermedadvisual = function(nuevoid){
                eseleccionados = $('#id_enfermedadvisual').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_enfermedadvisual').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'enfermedades', 'tipo': 3},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_enfermedadvisual').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_enfermedadvisual').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            cargarenfermedadgeneral = function(nuevoid){
                eseleccionados = $('#id_enfermedades').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_enfermedades').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'enfermedades', 'tipo': 2},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_enfermedades').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_enfermedades').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            cargarenfermedadvenerea = function(nuevoid){
                eseleccionados = $('#id_enfermedadvenereas').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_enfermedadvenereas').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'enfermedades', 'tipo': 4},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_enfermedadvenereas').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_enfermedadvenereas').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }


            cargaralergiafarmaco = function(nuevoid){
                eseleccionados = $('#id_alergiamedicinas').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_alergiamedicinas').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'alergias', 'tipo': 'FARMACOS'},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_alergiamedicinas').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_alergiamedicinas').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            cargaralergiaambiente = function(nuevoid){
                eseleccionados = $('#id_alergiaambientes').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_alergiaambientes').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'alergias', 'tipo': 'MEDIO AMBIENTE'},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_alergiaambientes').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_alergiaambientes').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            cargaralergiaalimento = function(nuevoid){
                eseleccionados = $('#id_alergiaalimentos').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_alergiaalimentos').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'alergias', 'tipo': 'ALIMENTOS'},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_alergiaalimentos').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_alergiaalimentos').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }


            cargarmedicinas = function(nuevoid){
                eseleccionados = $('#id_medicinas').val();
                if(eseleccionados != null)
                    eseleccionados.push(nuevoid);
                else
                    eseleccionados = [nuevoid];

                $('#id_medicinas').empty();
                bloqueointerface();
                $.ajax({
                        type: "POST",
                        url: "api",
                        data: {'a': 'medicinas'},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                for (elemento in data.lista) {
                                    marcado='';
                                    if(eseleccionados != null){
                                        for (var i=0, len=eseleccionados.length; i < len; i++) {
                                            if(data.lista[elemento][0] == eseleccionados[i]){
                                                marcado = 'selected';
                                                break;
                                            }
                                        }
                                    }
                                    $('#id_medicinas').append('<option '+marcado+' value="' + data.lista[elemento][0] + '">' + data.lista[elemento][1] + '</option>');
                                }
                                $('#id_medicinas').trigger("change");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexion.");
                        },
                        dataType: "json"
                });
            }

            $(".cerrarvacuna").click(function() {
                $("#registromodalvacuna").modal("hide");
                return false;
            });

            $(".cerrarenfermedad").click(function() {
                $("#registromodalenfermedad").modal("hide");
                return false;
            });

            $(".cerrarmedicina").click(function() {
                $("#registromodalmedicina").modal("hide");
                return false;
            });

            $(".cerraralergia").click(function() {
                $("#registromodalalergia").modal("hide");
                return false;
            });

            $(".guardarvacuna").click(function() {
                envioformularioreg("/box_medical","agregarvacuna", false);
                return false;
            });

            $(".guardarenfermedad").click(function() {
                envioformularioreg("/box_medical","agregarenfermedad", false);
                return false;
            });

            $(".guardaralergia").click(function() {
                envioformularioreg("/box_medical","agregaralergia", false);
                return false;
            });

            $(".guardarmedicina").click(function() {
                envioformularioreg("/box_medical","agregarmedicina", false);
                return false;
            });

            envioformularioreg = function(url, action, destino){
                if(action == 'agregarvacuna')
                    var valid = $("#formulario2").validationEngine('validate');
                else if(action == 'agregarenfermedad')
                    var valid = $("#formulario3").validationEngine('validate');
                else if(action == 'agregaralergia')
                    var valid = $("#formulario4").validationEngine('validate');
                else if(action == 'agregarmedicina')
                    var valid = $("#formulario5").validationEngine('validate');

                //alert("EnvioForm");
                if (valid){
                    $('.bootstrap-timepicker-widget').css({"display": "none"});
                    bloqueointerface();
                    $('.controls input').each(function(){
                        if ($(this).attr('type')=='text'){
                            $(this).val($(this).val().trim());
                        }
                        if ($(this).attr('type')!='file'){
                            if ($(this).css('text-transform')=='uppercase'){
                                if ($(this).attr('type')!='password'){
                                    $(this).val($(this).val().toUpperCase());
                                }
                            }
                        }
                    });

                    if(action == 'agregarvacuna')
                        var formdata = new FormData($("#formulario2")[0]);
                    else if(action == 'agregarenfermedad')
                        var formdata = new FormData($("#formulario3")[0]);
                    else if(action == 'agregaralergia')
                        var formdata = new FormData($("#formulario4")[0]);
                    else if(action == 'agregarmedicina')
                        var formdata = new FormData($("#formulario5")[0]);

                    $.ajax({
                        type: "POST",
                        action : action,
                        url: url,
                        data:  formdata,
                        success: function(data) {
                            if (data.result == 'ok') {
                                if(action == 'agregarvacuna'){
                                    cargarvacunas(data.id);
                                    $("#registromodalvacuna").modal("hide");
                                    $.unblockUI();
                                }
                                else if(action == 'agregarenfermedad'){
                                    if(parseInt($("#tipoenfermedad").val())==1)
                                        cargarenfermedadinfantil(data.id);
                                    else if (parseInt($("#tipoenfermedad").val())==3)
                                        cargarenfermedadvisual(data.id);
                                    else if (parseInt($("#tipoenfermedad").val())==2)
                                        cargarenfermedadgeneral(data.id);
                                    else
                                        cargarenfermedadvenerea(data.id);

                                    $("#registromodalenfermedad").modal("hide");
                                    $.unblockUI();
                                }
                                else if(action == 'agregaralergia'){
                                    if($("#tipoalergia").val()=="FARMACOS")
                                        cargaralergiafarmaco(data.id);
                                    else if($("#tipoalergia").val()=="MEDIO AMBIENTE")
                                        cargaralergiaambiente(data.id);
                                    else
                                        cargaralergiaalimento(data.id);

                                    $("#registromodalalergia").modal("hide");
                                    $.unblockUI();
                                }
                                else if(action == 'agregarmedicina'){
                                    cargarmedicinas(data.id);
                                    $("#registromodalmedicina").modal("hide");
                                    $.unblockUI();
                                }

                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error al enviar los datos.");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                } else {
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }
            };


            //$("#add_vacuna").hide();
            tipo_formulario($("#form2"));
            tipo_formulario($("#form3"));
            tipo_formulario($("#form4"));
            tipo_formulario($("#form5"));


{#            $("#id_fechacirugia").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });#}

        });
    </script>
{% endblock %}
{% block atras %}box_medical?action=ficha&id={{ paciente.id }}{% endblock %}
{% block titulo %}{{ title }}{% endblock %}
{% block formdestination %}box_medical?action=ficha&id={{ paciente.id }}{% endblock %}
{% block formaction %}/box_medical{% endblock %}
{% block pre_form %}
    <div class="modal fade static" id="registromodalvacuna" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent;">
                <tr>
                    <td style="width: 80%"><h3 class="paneltitlearchivo">Agregar vacuna</h3></td>
                </tr>
            </table>
        </div>
        <form id="formulario2" style="width: 100%; margin-bottom: 0px;padding-left: 15px;padding-top: 10px; padding-right: 15px; padding-bottom: 0px">
            <input type='hidden' name='action' value='agregarvacuna'/>
            <div class="row-fluid">
                {% for field in form2 %}
                    {% if field.field.widget.attrs.separator %}
                        <div style="width: 100%; height: 1px; float: left;"></div>
                    {% endif %}
                    <fieldset class="control-group nomargins" style="float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}">
                        <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                        <div class="controls">
                            {{ field }}
                            <p class="help-text">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
            </div>
        </form>
        <div class="modal-footer">
            <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-success guardarvacuna"> Guardar</a></td>
            <a href="javascript:;" class="btn btn-info cerrarvacuna">Cerrar</a>
        </div>
    </div>


    <div class="modal fade static" id="registromodalenfermedad" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent;">
                <tr>
                    <td style="width: 80%"><h3 class="paneltitlearchivo">Agregar enfermedad <span id="tituloenfermedad"></span></h3></td>
                </tr>
            </table>
        </div>
        <form id="formulario3" style="width: 100%; margin-bottom: 0px;padding-left: 15px;padding-top: 10px; padding-right: 15px; padding-bottom: 0px">
            <input type='hidden' name='action' value='agregarenfermedad'/>
            <input type='hidden' name='tipoenfermedad' id='tipoenfermedad' value=''/>
            <div class="row-fluid">
                {% for field in form3 %}
                    {% if field.field.widget.attrs.separator %}
                        <div style="width: 100%; height: 1px; float: left;"></div>
                    {% endif %}
                    <fieldset class="control-group nomargins" style="float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}">
                        <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                        <div class="controls">
                            {{ field }}
                            <p class="help-text">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
            </div>
        </form>
        <div class="modal-footer">
            <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-success guardarenfermedad"> Guardar</a></td>
            <a href="javascript:;" class="btn btn-info cerrarenfermedad">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="registromodalalergia" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent;">
                <tr>
                    <td style="width: 80%"><h3 class="paneltitlearchivo">Agregar alergia a <span id="tituloalergia"></span></h3></td>
                </tr>
            </table>
        </div>
        <form id="formulario4" style="width: 100%; margin-bottom: 0px;padding-left: 15px;padding-top: 10px; padding-right: 15px; padding-bottom: 0px">
            <input type='hidden' name='action' value='agregaralergia'/>
            <input type='hidden' name='tipoalergia' id='tipoalergia' value=''/>
            <div class="row-fluid">
                {% for field in form4 %}
                    {% if field.field.widget.attrs.separator %}
                        <div style="width: 100%; height: 1px; float: left;"></div>
                    {% endif %}
                    <fieldset class="control-group nomargins" style="float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}">
                        <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                        <div class="controls">
                            {{ field }}
                            <p class="help-text">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
            </div>
        </form>
        <div class="modal-footer">
            <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-success guardaralergia"> Guardar</a></td>
            <a href="javascript:;" class="btn btn-info cerraralergia">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="registromodalmedicina" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent;">
                <tr>
                    <td style="width: 80%"><h3 class="paneltitlearchivo">Agregar medicina</h3></td>
                </tr>
            </table>
        </div>
        <form id="formulario5" style="width: 100%; margin-bottom: 0px;padding-left: 15px;padding-top: 10px; padding-right: 15px; padding-bottom: 0px">
            <input type='hidden' name='action' value='agregarmedicina'/>
            <div class="row-fluid">
                {% for field in form5 %}
                    {% if field.field.widget.attrs.separator %}
                        <div style="width: 100%; height: 1px; float: left;"></div>
                    {% endif %}
                    <fieldset class="control-group nomargins" style="float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}">
                        <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                        <div class="controls">
                            {{ field }}
                            <p class="help-text">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
            </div>
        </form>
        <div class="modal-footer">
            <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-success guardarmedicina"> Guardar</a></td>
            <a href="javascript:;" class="btn btn-info cerrarmedicina">Cerrar</a>
        </div>
    </div>

{% endblock %}
{% block formextra %}
    <input type='hidden' name='action' value='patologicop'/>
    <input type='hidden' name='id' value="{{ pex.id }}"/>
{% endblock %}
{% block formback %}box_medical?action=ficha&id={{ paciente.id }}{% endblock %}
{% block buttonname %}Guardar{% endblock %}
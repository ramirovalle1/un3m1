{% extends "basebs.html" %}
{% load humanize %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>
    <link href="/static/switchery/switchery.min.css" rel="stylesheet"/>
    <script src="/static/switchery/switchery.min.js"></script>
    <style type="text/css">
        .panel-default{
            margin-bottom: 2px;
            border: 1px solid #e5e5e5;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
        }
    </style>
    <script type="text/javascript">
        var switchery = {};
        $.fn.initSwitchery = function () {
            //Init CheckBox Style
            var searchBy = ".js-switch";
            $(this).find(searchBy).each(function (i, html) {
                debugger;
                if (!$(html).next().hasClass("switchery")) {
                    //switchery[html.getAttribute('id')] = new Switchery(html, $(html).data());
                    switchery[html.getAttribute('id')] = new Switchery(html, {size: 'small', color: '#5DADE2'});
                }
            });
        };

        $(function (){
            //$('[data-toggle="tooltip"]').tooltip();
            $("body").initSwitchery();
        });

        $(function() {
            $('[data-toggle="tooltip"]').tooltip();
            $("select").select2({minimumResultsForSearch: 5 });

            $("#observacion, #estado").addClass("validate[required]");

            let documentosvalidos = false;
            let lista_items1 = [];

            $(".documentos").on("change" , function() {
                documentosvalidos = true;
                lista_items1 = [];
                $(".documentos").each(function(){
                    let iddet = $(this).attr("iddet");
                    if($(this).is(":checked")){
                        $("#observaciondoc_"+iddet).val("");
                        $("#observaciondoc_"+iddet).prop("readOnly", true);
                        $("#observaciondoc_"+iddet).removeClass("validate[required]");
                    }else{
                        $("#observaciondoc_"+iddet).prop("readOnly", false);
                        $("#observaciondoc_"+iddet).addClass("validate[required]");

                        documentosvalidos = false;
                    }

                    lista_items1.push({'id': $(this).attr("iddet"),
                                       'valor': $(this).is(":checked")});

                });
                cargar_estados_propuesta();
            });

            agregar_validacion_observaciones_documentos = function (){
                $(".observaciondocumento").each(function(){
                    $(this).addClass("validate[required]");
                });
            };

            actualizar_lista_documentos = function(){
                lista_items1 = [];

                $(".documentos").each(function(){
                    lista_items1.push({'id': $(this).attr("iddet"),
                                       'valor': $(this).is(":checked")});
                });
            };

            cargar_estados_propuesta = function (){
                $("#estado").empty();
                $("#estado").append('<option value="">---------</option>');
                if(documentosvalidos){
                    {% if estado == 30 %}
                        $("#estado").append('<option value="8">E.I.SUPERADA</option>');
                    {% else %}
                        $("#estado").append('<option value="11">E.E.SUPERADA</option>');
                    {% endif %}
                }else {
                    {% if estado == 30 %}
                        $("#estado").append('<option value="14">P.RECHAZADA</option>');
                    {% else %}
                        $("#estado").append('<option value="27">P.RECHAZADA</option>');
                    {% endif %}
                }
                $("#estado").val('').trigger('change');
            };

            $('#estado').change(function(){
                $("#observacion").prop("readOnly", true);
                $("#observacion").val('');
                $("#observacion").removeClass("validate[required]");

                if($("#estado").val() == '27'){
                    $("#observacion").prop("readOnly", false);
                    $("#observacion").addClass("validate[required]");
                }
            });

            $(".archivos").change(function () {
                let cantidad = $(this).get(0).files.length;
                $("#bgarchivo").html(cantidad.toString());
            });

            $(".mostrarhojavida").click(function() {
                let idi = $(this).attr('idi');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_proyectoinvestigacion",
                    data: {'action': 'mostrarhojavida', 'idi': idi},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyhojavida").html(data.data);
                            $("#itemspanelhojavida").modal({backdrop:'static', width: '1100px', height: '550px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelhojavida .btn-cerrar").click(function() {
                $("#itemspanelhojavida").modal("hide");
            });

            $(".guardar").click(function () {
                envioformularioreg("/adm_proyectoinvestigacion", "verificarrequisitos", false);
                return false;
            });

            envioformularioreg = function(url, action, destino){
                $("#frmVerificar").validationEngine('attach',{ scroll: true });
                let valido = $("#frmVerificar").validationEngine('validate', { scroll: true });
                let formdata;

                if (valido){
                    bloqueointerface();

                    if(action == 'verificarrequisitos'){
                        formdata = new FormData($("#frmVerificar")[0]);
                        formdata.append("lista_items1", JSON.stringify(lista_items1));
                    }

                    $.ajax({
                        type: "POST",
                        action : action,
                        url: url,
                        data:  formdata,
                        success: function(data) {
                            if(data.result=='ok'){
                                $.unblockUI();
                                urlDestino = "/adm_proyectoinvestigacion?action=propuestas&idc={{ proyecto.convocatoria.id|encrypt }}&id={{ proyecto.id|encrypt }}";
                                mensajeSuccessSwal(data.titulo, data.mensaje, urlDestino);
                            }else{
                                $.unblockUI();
                                if(data.swalType == 'warning')
                                    mensajeWarningSwal(data.titulo, data.mensaje);
                                else
                                    mensajeErrorSwal(data.titulo, data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            mensajeErrorSwal("No se puede guardar", "Error al enviar los datos");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }
            };
            
            $(".mostrarevaluaciones").click(function() {
                let id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_proyectoinvestigacion",
                    data: {'action': 'mostrarevaluaciones', 'id': id, 'vcambios': 'SI'},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyevaluaciones").html(data.data);
                            $("#itemspanelevaluaciones").modal({backdrop:'static', width: '1000px', height: '600px'}).modal('show');
                        } else {
                            if(data.swalType == 'warning')
                                mensajeWarningSwal(data.titulo, data.mensaje);
                            else
                                mensajeErrorSwal(data.titulo, data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error de conexión");
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelevaluaciones .btn-cerrar").click(function() {
                $("#itemspanelevaluaciones").modal("hide");
            });

            $(".cancelar").click(function () {
                mensajeConfirmSwal("Cerrar pantalla sin guardar cambios", "¿Acepta cerrar la pantalla de Verificación Cambios {% if estado == 30 or estado == 42 %}Menores{% else %}Mayores{% endif %} sin haber guardado la información?", false, "/adm_proyectoinvestigacion", "", "", "/adm_proyectoinvestigacion?action=propuestas&idc={{ proyecto.convocatoria.id|encrypt }}&id={{ proyecto.id|encrypt }}");
            });

            agregar_validacion_observaciones_documentos();
            cargar_estados_propuesta();
            actualizar_lista_documentos();

            $(".documentos").trigger('change');

            {% if proyecto.estado.valor == 3 or proyecto.estado.valor == 4 %}
                $("#estado").val('{{ proyecto.estado.valor }}').trigger('change');
                $("#observacion").val('{{ proyecto.observacion }}');
            {% endif %}
        });
    </script>
{% endblock %}
{% block atras %}/adm_proyectoinvestigacion?action=propuestas&idc={{ proyecto.convocatoria.id|encrypt }}&id={{ proyecto.id|encrypt }}{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}
                <a href="javascript:;" id="{{ proyecto.id|encrypt }}" class="btn btn-info tu mostrarevaluaciones" data-toggle="tooltip" data-placement="top" data-original-title="Mostrar Evaluaciones"><i class="fa fa-table"></i> Evaluaciones Propuesta</a>
                <a target="_blank" href="/media/{{ proyecto.formulario_inscripcion_anterior.archivo }}" class="btn btn-success tu" title="Descargar Formulario Inscripción anterior"><i class="fa fa-download"></i> Formulario Anterior</a>
            </h4>
        </div>
    </div>
    <div class="alert alert-info" style="text-align: justify">
        <strong>{{ proyecto.titulo }}</strong>
    </div>
    <div class="row-fluid">
        <div class="tabbable">
            <ul class="nav nav-tabs">
                <li class="active"><a class="tabs" href="#info0" data-toggle="tab">Verificación</a></li>
                <li><a class="tabs" href="#info1" data-toggle="tab">Datos Generales</a></li>
                <li><a class="tabs" href="#info2" data-toggle="tab">Integrantes</a></li>
                <li><a class="tabs" href="#info3" data-toggle="tab">Contenido</a></li>
                <li><a class="tabs" href="#info4" data-toggle="tab">Presupuesto</a></li>
                <li><a class="tabs" href="#info5" data-toggle="tab">Cronograma</a></li>
            </ul>
            <div class="tab-content" style="overflow: inherit">
                <div class="tab-pane active" id="info0">
                    <form id="frmVerificar" style="width: 100%; margin-bottom: 0px;padding-left: 0px;padding-top: 0px; padding-right: 0px; padding-bottom: 0px">
                        <input type='hidden' name='action' value='{% if estado == 30 or estado == 42 %}verificarcambiosmenores{% else %}verificarcambiosmayores{% endif %}'/>
                        <input type='hidden' name='idproyecto' value='{{ proyecto.id|encrypt }}'/>
                        <div class="row-fluid">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th colspan="6">Verificación Investigadores</th>
                                    </tr>
                                    <tr>
                                        <th style="text-align: center">#</th>
                                        <th style="text-align: center">Rol</th>
                                        <th style="text-align: center">Identificación</th>
                                        <th style="text-align: center">Nombres y Apellidos</th>
                                        <th style="text-align: center">Acreditado</th>
                                        <th style="text-align: center">Observaciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for integrante in proyecto.integrantes_director_codirector %}
                                        <tr>
                                            <td style="text-align: right">{{ forloop.counter }}</td>
                                            <td style="text-align: center">{{ integrante.get_funcion_display }}</td>
                                            <td style="text-align: center">{{ integrante.persona.identificacion }}</td>
                                            <td style="text-align: justify">{{ integrante.persona.nombre_completo_inverso }}</td>
                                            <td style="text-align: center">
                                                {% if integrante.estadoacreditado == 2 %}<span class="label label-success">SI</span>{% else %}<span class="label label-important">NO</span>{% endif %}
                                            </td>
                                            <td style="text-align: justify">
                                                {{ integrante.observacion }}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th colspan="5">Verificación Documentos</th>
                                    </tr>
                                    <tr>
                                        <th style="width: 3%; text-align: center">#</th>
                                        <th style="width: 30%; text-align: center">Documento</th>
                                        <th style="width: 10%; text-align: center">Archivo</th>
                                        <th style="width: 15%; text-align: center">Validado</th>
                                        <th style="width: 42%; text-align: center">Observación</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="text-align: right">1<input type="hidden" name="iddocumento[]" value="1"></td>
                                        <td style="text-align: justify">Formulario Formato de inscripción de Proyecto firmado (Modificaciones {% if proyecto.estado.valor == 30 or proyecto.estado.valor == 42 %}Menores{% else %}Mayores{% endif %})</td>
                                        <td style="text-align: center">
                                            <a target="_blank" href="{{ proyecto.archivodocumentofirmado.url }}" class="btn btn-success tu" title="Descargar Formato inscripción firmado"><i class="fa fa-download"></i> Descargar</a>
                                        </td>
                                        <td style="text-align: center">
                                            <input type="checkbox" class="js-switch documentos" iddet="1" {% if proyecto.estadodocumentofirmado == 2 %}checked{% endif %} />
                                        </td>
                                        <td style="text-align: center">
                                            <input type="text" autocomplete="off" maxlength="1000" id="observaciondoc_1" name="observaciondoc[]" value="{{ proyecto.observaciondocumentofirmado }}" class="observaciondocumento" style="width: 100%; text-transform: uppercase;" {% if proyecto.estadodocumentofirmado == 2 %}readonly{% endif %}>
                                            <div class="help-text" style="font-size: xx-small; margin-bottom: 0;"> </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th colspan="4">Estado General de la propuesta</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="width: 10%;">Estado:</td>
                                        <td style="width: 30%;">
                                            <select id="estado" name="estado" style="width: 300px">
                                                <option value="" selected>---------</option>
                                            </select>
                                            <div class="help-text" style="font-size: xx-small; margin-bottom: 0;"> </div>
                                        </td>
                                        <td style="width: 10%;">Observaciones:</td>
                                        <td style="width: 50%;">
                                            <textarea style="width: 95%; resize: none; text-transform: uppercase;" cols="40" id="observacion" name="observacion" readonly rows="4"></textarea>
                                            <div class="help-text" style="font-size: xx-small; margin-bottom: 0;"> </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width: 10%;">Archivo novedad:</td>
                                        <td style="width: 90%;" colspan="3">
                                            <label class="btn btn-default"><i class="fa fa-cloud-upload" aria-hidden="true"></i> Seleccionar <span id="bgarchivo" class="badge">0</span><input type="file" style="color: transparent" class="archivos" id="archivo" name="archivo" hidden> </label>
                                            <small class="form-text text-muted">Tamaño Maximo permitido 4Mb, en formato pdf</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row-fluid">
                            <div class="row-fluid">
                                <a href="javascript:;" class="btn btn-success guardar"> Guardar</a>
                                <a href="javascript:;" class="btn btn-danger cancelar"> Cancelar</a>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="tab-pane" id="info1">
                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdatosgenerales">
                        <thead>
                            <tr>
                                <th colspan="4">Datos Generales</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="width: 15%;"><strong>Convocatoria:</strong></td>
                                <td style="width: 35%;">{{ proyecto.convocatoria.descripcion }}</td>
                                <td style="width: 15%;"><strong>Tipo:</strong></td>
                                <td style="width: 35%;">{{ proyecto.categoria2.descripcion }}</td>
                            </tr>
                            <tr>
                                <td><strong>Título:</strong></td>
                                <td colspan="3" style="text-align: justify">{{ proyecto.titulo }}</td>
                            </tr>
                            <tr>
                                <td><strong>Área Conocimiento:</strong></td>
                                <td style="text-align: justify">{{ proyecto.areaconocimiento.nombre }}</td>
                                <td><strong>Sub área Conocimiento:</strong></td>
                                <td style="text-align: justify">{{ proyecto.subareaconocimiento.nombre }}</td>
                            </tr>
                            <tr>
                                <td><strong>Sub área específica Conocimiento:</strong></td>
                                <td colspan="3" style="text-align: justify">{{ proyecto.subareaespecificaconocimiento.nombre }}</td>
                            </tr>
                            <tr>
                                <td><strong>Línea Investigación:</strong></td>
                                <td style="text-align: justify">{{ proyecto.lineainvestigacion.nombre }}</td>
                                <td><strong>Sub-Línea Investigación:</strong></td>
                                <td>
                                    {% for sublinea in proyecto.sublineainvestigacion.all %}
                                        {{ sublinea.nombre }}
                                        {% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Programa:</strong></td>
                                <td style="text-align: justify">{{ proyecto.programainvestigacion.nombre }}</td>
                                <td><strong>Área prioritaria:</strong></td>
                                <td style="text-align: justify">{{ proyecto.industriapriorizada.nombre }}</td>
                            </tr>
                            <tr>
                                <td><strong>¿Requiere convenio?:</strong></td>
                                <td colspan="3" style="text-align: justify">
                                    {% if proyecto.requiereconvenio %}SI ({{ proyecto.especificaconvenio }}){% else %}NO{% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>¿Necesita permiso del CEISH?:</strong></td>
                                <td colspan="3" style="text-align: justify">
                                    {% if proyecto.requierepermiso %}SI ({{ proyecto.especificapermiso }}){% else %}NO{% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Duración(meses):</strong></td>
                                <td style="text-align: justify">{{ proyecto.tiempomes }} meses</td>
                                <td><strong>Contempla compra de equipamiento:</strong></td>
                                <td>{{ convocatoriamonto.get_tipoequipamiento_display }}</td>
                            </tr>
                            <tr>
                                <td><strong>Monto UNEMI:</strong></td>
                                <td>$ {{ proyecto.montounemi|floatformat:2|intcomma }}</td>
                                <td><strong>Máximo a financiar por UNEMI:</strong></td>
                                <td>$ {{ convocatoriamonto.maximo|floatformat:2|intcomma }}</td>
                            </tr>
                            <tr>
                                <td><strong>Monto otra fuente:</strong></td>
                                <td>$ {{ proyecto.montootrafuente|floatformat:2|intcomma }}</td>
                                <td><strong>Monto Total:</strong></td>
                                <td>$ {{ proyecto.montototal|floatformat:2|intcomma }}</td>
                            </tr>
                        </tbody>
                    </table>
                    <br>
                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tblocalizacion">
                        <thead>
                            <tr>
                                <th colspan="4">Localización Geográfica del proyecto</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if proyecto.tipocobertura == 1 or proyecto.tipocobertura == 2 %}
                                <tr>
                                    <td style="width: 15%;"><strong>Tipo de Cobertura:</strong></td>
                                    <td colspan="3" style="width: 85%;">{{ proyecto.get_tipocobertura_display }}</td>
                                </tr>
                            {% elif proyecto.tipocobertura == 3 %}
                                <tr>
                                    <td style="width: 15%;"><strong>Tipo de Cobertura:</strong></td>
                                    <td style="width: 35%;">{{ proyecto.get_tipocobertura_display }}</td>
                                    <td style="width: 15%;"><strong>Zonas de planificación:</strong></td>
                                    <td style="width: 35%;">
                                        {% for zona in proyecto.zonas.all %}
                                            {{ zona.nombre }} ({{ zona.miembroszona }})
                                            {% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                </tr>
                            {% elif proyecto.tipocobertura == 4 %}
                                <tr>
                                    <td style="width: 15%;"><strong>Tipo de Cobertura:</strong></td>
                                    <td style="width: 35%;">{{ proyecto.get_tipocobertura_display }}</td>
                                    <td style="width: 15%;"><strong>Provincias:</strong></td>
                                    <td style="width: 35%;">
                                        {% for provincia in proyecto.provincias.all %}
                                            {{ provincia.nombre }}
                                            {% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td style="width: 15%;"><strong>Tipo de Cobertura:</strong></td>
                                    <td style="width: 35%;">{{ proyecto.get_tipocobertura_display }}</td>
                                    <td style="width: 15%;"><strong>Provincia:</strong>
                                    <td style="width: 35%; text-align: justify">{{ proyecto.provincia.nombre }}</td>
                                </tr>
                                <tr>
                                    <td style="width: 15%;"><strong>Cantones:</strong></td>
                                    <td style="width: 35%; text-align: justify">
                                        {% for canton in proyecto.canton.all %}
                                            {{ canton.nombre }}
                                            {% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td style="width: 15%;"><strong>Parroquia:</strong></td>
                                    <td style="width: 35%; text-align: justify">{{ proyecto.parroquia }}</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                    <br>
                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbinstitucion">
                        <thead>
                            <tr>
                                <th colspan="7">Instituciones Participantes</th>
                            </tr>
                            <tr>
                                <th style="width: 10%; text-align: center;">Tipo Institución</th>
                                <th style="width: 20%; text-align: center;">Grupo de Investigación</th>
                                <th style="width: 20%; text-align: center;">Representante legal</th>
                                <th style="width: 10%; text-align: center;">Identificación</th>
                                <th style="width: 10%; text-align: center;">e-mail</th>
                                <th style="width: 20%; text-align: center;">Dirección</th>
                                <th style="width: 10%; text-align: center;">Página web</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for institucion in proyecto.instituciones_proyecto %}
                                <tr>
                                    <td style="text-align: center">{{ institucion.get_tipo_display }}</td>
                                    <td style="text-align: justify">
                                        {% if institucion.tipo == 1 %}
                                            {{ proyecto.grupoinvestigacion.nombre }}
                                        {% endif %}
                                    </td>
                                    <td style="text-align: justify">{{ institucion.representante }}</td>
                                    <td style="text-align: justify">{{ institucion.cedula }}</td>
                                    <td style="text-align: justify">{{ institucion.email }}</td>
                                    <td style="text-align: justify">{{ institucion.direccion }}</td>
                                    <td style="text-align: justify">{{ institucion.paginaweb }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="info2">
                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tblocalizacion">
                        <thead>
                            <tr>
                                <th colspan="8">Integrantes del Proyecto de Investigación</th>
                            </tr>
                            <tr>
                                <th style="width: 7%; font-weight: bold; text-align: center">Rol</th>
                                <th style="width: 7%; font-weight: bold; text-align: center">Tipo</th>
                                <th style="width: 7%; font-weight: bold; text-align: center">Identificación</th>
                                <th style="width: 23%; font-weight: bold; text-align: center">Nombres y Apellidos</th>
                                <th style="width: 27%; font-weight: bold; text-align: center">Entidad</th>
                                <th style="width: 14%; font-weight: bold; text-align: center">Teléfonos/E-mail</th>
                                <th style="width: 10%; font-weight: bold; text-align: center">Investigador Acreditado</th>
                                <th style="width: 5%; font-weight: bold; text-align: center"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for integrante in proyecto.integrantes_proyecto_informe %}
                                <tr>
                                    <tr>
                                    <td style="text-align: center">{{ integrante.get_funcion_display }}</td>
                                    <td style="text-align: center">{{ integrante.get_tipo_display }}</td>
                                    <td style="text-align: center">{{ integrante.persona.identificacion }}</td>
                                    <td style="text-align: justify">
                                        {{ integrante.persona.nombre_completo_inverso }}<br>
                                        <span class="label label-{{ integrante.color_tipo_registro }}">{{ integrante.get_tiporegistro_display }}</span>
                                        {% if integrante.tiporegistro == 2 %}
                                            <span class="label label-info">{{ integrante.personareemplazo.nombre_completo }}</span>
                                        {% endif %}
                                        {% if integrante.tiporegistro != 1 %}
                                            <a target="_blank" href="{{ integrante.archivo.url }}" class="btn btn-mini btn-warning tu" data-toggle="tooltip" data-placement="top" data-original-title="Descargar Archivo"><i class="fa fa-download"></i> </a>
                                        {% endif %}
                                    </td>
                                    <td style="text-align: justify">
                                        {% if integrante.tipo != 4 %}
                                            UNIVERSIDAD ESTATAL DE MILAGRO
                                        {% else %}
                                            {{ integrante.externo.institucionlabora|upper }}
                                        {% endif %}
                                    </td>
                                    <td style="text-align: justify">
                                        {% if integrante.persona.telefono %}
                                            {{ integrante.persona.telefono }} /
                                        {% endif %}
                                        {{ integrante.persona.telefono_conv }}<br>
                                        {% if integrante.persona.email %}
                                            {{ integrante.persona.email }},
                                        {% endif %}
                                        {{ integrante.persona.emailinst }}
                                    </td>
                                    <td style="text-align: center">
                                        <span class="label label-{{ integrante.color_estado_acreditado }}">{{ integrante.get_estadoacreditado_display }}</span>
                                    </td>
                                    <td>
                                        <div class="btn-group" style="text-align: left">
                                            <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span class="caret"></span>
                                            </a>
                                            <ul class="dropdown-menu pull-right">
                                                <li><a class="mostrarhojavida" idi="{{ integrante.id|encrypt }}" href="javascript:;"><i class="fa fa-address-card"></i> Mostrar Hoja de Vida</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="info3">
                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbcontenido">
                        <thead>
                            <tr>
                                <th colspan="2">Contenido del Proyecto de Investigación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="width: 15%;"><strong>Resumen Propuesta:</strong></td>
                                <td style="width: 85%; text-align: justify">{{ proyecto.resumenpropuesta|safe }}</td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Formulación del problema:</strong></td>
                                <td style="width: 85%; text-align: justify">{{ proyecto.formulacionproblema|safe }}</td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Objetivo General:</strong></td>
                                <td style="width: 85%; text-align: justify">{{ proyecto.objetivogeneral|safe }}</td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Objetivos Específicos:</strong></td>
                                <td style="width: 85%;">
                                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdetalleobjetivos">
                                        <thead>
                                            <tr>
                                                <th style="width: 3%; text-align: center;">#</th>
                                                <th style="width: 97%; text-align: center;">Objetivo</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detalle_objetivos">
                                            {% for objetivo in proyecto.objetivos_especificos %}
                                                <tr>
                                                    <td style="text-align: right">{{ forloop.counter }}</td>
                                                    <td style="text-align: justify">{{ objetivo.descripcion }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Justificación:</strong></td>
                                <td style="width: 85%; text-align: justify">{{ proyecto.justificacion|safe }}</td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Estado del arte:</strong></td>
                                <td style="width: 85%; text-align: justify">{{ proyecto.estadoarte|safe }}</td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Metodología:</strong></td>
                                <td style="width: 85%; text-align: justify">{{ proyecto.metodologia|safe }}</td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Impactos:</strong></td>
                                <td style="width: 85%;">
                                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdetalleimpacto">
                                        <thead>
                                            <tr>
                                                <th style="width: 15%; text-align: center;">Tipo</th>
                                                <th style="width: 85%; text-align: center;">Detalle</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detalle_impactos">
                                            {% if proyecto.impactosocial %}
                                                <tr>
                                                    <td><strong>Impacto Social:</strong></td>
                                                    <td style="text-align: justify">{{ proyecto.impactosocial }}</td>
                                                </tr>
                                            {% endif %}
                                            {% if proyecto.impactocientifico %}
                                                <tr>
                                                    <td><strong>Impacto Científico:</strong></td>
                                                    <td style="text-align: justify">{{ proyecto.impactocientifico }}</td>
                                                </tr>
                                            {% endif %}
                                            {% if proyecto.impactoeconomico %}
                                                <tr>
                                                    <td><strong>Impacto Económico:</strong></td>
                                                    <td style="text-align: justify">{{ proyecto.impactoeconomico }}</td>
                                                </tr>
                                            {% endif %}
                                            {% if proyecto.impactopolitico %}
                                                <tr>
                                                    <td><strong>Impacto Político:</strong></td>
                                                    <td style="text-align: justify">{{ proyecto.impactopolitico }}</td>
                                                </tr>
                                            {% endif %}
                                            {% if proyecto.otroimpacto %}
                                                <tr>
                                                    <td><strong>Otro Impacto:</strong></td>
                                                    <td style="text-align: justify">{{ proyecto.otroimpacto }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Productos / Resultados / Compromisos:</strong></td>
                                <td style="width: 85%;">
                                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdetalleproductos">
                                        <thead>
                                            <tr>
                                                <th style="width: 3%; text-align: center;">#</th>
                                                <th style="width: 97%; text-align: center;">Descripción</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detalle_productos">
                                            {% for resultado in proyecto.resultados_compromisos %}
                                                <tr>
                                                    <td style="text-align: right">{{ forloop.counter }}</td>
                                                    <td style="text-align: justify">{{ resultado.resultado.descripcion }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Referencias Bibliográficas (En formato APA séptima edición):</strong></td>
                                <td style="width: 85%;">
                                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdetalleproductos">
                                        <thead>
                                            <tr>
                                                <th style="width: 3%; text-align: center;">#</th>
                                                <th style="width: 97%; text-align: center;">Referencia</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detalle_productos">
                                            {% for referencia in proyecto.referencias_bibliograficas %}
                                                <tr>
                                                    <td style="text-align: right">{{ forloop.counter }}</td>
                                                    <td style="text-align: justify">{{ referencia.descripcion }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>

                            {% if proyecto.archivoproyecto %}
                                <tr>
                                    <td style="width: 15%;"><strong>Archivo del proyecto:</strong></td>
                                    <td style="width: 85%;"><a target="_blank" href="{{ proyecto.archivoproyecto.url }}" class="btn btn-info tu" title="Descargar Archivo del proyecto"><i class="fa fa-download"></i> Descargar</a></td>
                                </tr>
                            {% endif %}
                            <tr>
                                <td style="width: 15%;"><strong>Archivo Formato Inscripción:</strong></td>
                                <td style="width: 85%;">
                                    {% if proyecto.archivodocumento %}
                                        <a target="_blank" href="{{ proyecto.archivodocumento.url }}" class="btn btn-success tu" title="Descargar Archivo"><i class="fa fa-download"></i> Descargar</a>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 15%;"><strong>Archivo Formato Inscripción Firmado:</strong></td>
                                <td style="width: 85%;">
                                    {% if proyecto.archivodocumentofirmado %}
                                        <a target="_blank" href="{{ proyecto.archivodocumentofirmado.url }}" class="btn btn-success tu" title="Descargar Archivo"><i class="fa fa-download"></i> Descargar</a>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="info4">
                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbpresupuesto">
                        <thead>
                            <tr>
                                <th colspan="6">Presupuesto del Proyecto de Investigación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="width: 17%;"><strong>Contempla compra equipos:</strong></td>
                                <td colspan="5" style="width: 83%; text-align: justify">{{ proyecto.get_compraequipo_display }}</td>
                            </tr>
                            <tr>
                                <td style="width: 17%;"><strong>Monto Total Proyecto:</strong></td>
                                <td style="width: 17%; text-align: justify">$ {{ proyecto.montototal|floatformat:2|intcomma }}</td>
                                <td style="width: 16%;"><strong>Total Presupuesto:</strong></td>
                                <td style="width: 17%; text-align: justify">$ {{ proyecto.presupuesto|floatformat:2|intcomma }}</td>
                                <td style="width: 16%;"><strong>Monto Mínimo Compra Equipo:</strong></td>
                                <td style="width: 17%; text-align: justify">$ {{ proyecto.monto_minimo_equipos|floatformat:2|intcomma }}</td>
                            </tr>

                            {% if proyecto.convocatoria.apertura.year == 2022 %}
                                <tr>
                                    <td style="width: 15%;"><strong>Archivo Presupuesto final:</strong></td>
                                    <td colspan="5" style="width: 85%;">
                                        {% if proyecto.archivopresupuesto %}
                                            <a target="_blank" href="{{ proyecto.archivopresupuesto.url }}" class="btn btn-success tu" title="Descargar Archivo"><i class="fa fa-download"></i> Descargar</a>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>

                    {% for tiporecurso in proyecto.presupuesto_grupo_totales %}
                        <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbpresupuesto">
                            <thead>
                                <tr>
                                    <th colspan="9">{{ tiporecurso.descripcion }} <span class="label label-success">$ {{ tiporecurso.totalgrupo|floatformat:2|intcomma }}</span> </th>
                                </tr>
                                <tr>
                                    <th style="text-align: center; width: 23%;">Recurso</th>
                                    <th style="text-align: center; width: 27%;">Descripción</th>
                                    <th style="text-align: center; width: 5%;">Unidad de Medida</th>
                                    <th style="text-align: center; width: 2%;">Cant.</th>
                                    <th style="text-align: center; width: 5%;">Valor Unitario</th>
                                    <th style="text-align: center; width: 2%;">Iva</th>
                                    <th style="text-align: center; width: 5%;">Valor Iva</th>
                                    <th style="text-align: center; width: 5%;">Valor Total</th>
                                    <th style="text-align: center; width: 20%;">Observaciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% with detalles=proyecto|args:tiporecurso.id|call:"presupuesto_detalle_tiporecurso" %}
                                    {% for detalle in detalles %}
                                        <tr>
                                            <td style="text-align: justify;">{{ detalle.recurso }}</td>
                                            <td style="text-align: justify;">{{ detalle.descripcion }}</td>
                                            <td style="text-align: justify;">{{ detalle.unidadmedida.nombre }}</td>
                                            <td style="text-align: right;">{{ detalle.cantidad }}</td>
                                            <td style="text-align: right;">{{ detalle.valorunitario }}</td>
                                            <td style="text-align: center;">
                                                {% if detalle.calculaiva %}<i class="fa fa-check" style="color: green" aria-hidden="true"></i>{% endif %}
                                            </td>
                                            <td style="text-align: right;">{{ detalle.valoriva }}</td>
                                            <td style="text-align: right;">{{ detalle.valortotal }}</td>
                                            <td style="text-align: right;">{{ detalle.observacion }}</td>
                                        </tr>
                                    {% endfor %}
                                {% endwith %}
                            </tbody>
                        </table>
                    {% endfor %}
                </div>
                <div class="tab-pane" id="info5">

                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbpresupuesto">
                        <thead>
                            <tr>
                                <th colspan="6">Cronograma del Proyecto de Investigación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="width: 17%;"><strong>Objetivo General:</strong></td>
                                <td colspan="5" style="width: 83%; text-align: justify">{{ proyecto.objetivogeneral|safe }}</td>
                            </tr>
                        </tbody>
                    </table>

                    {% for objetivo in proyecto.cronograma_objetivo_totales %}
                        <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbpresupuesto">
                            <thead>
                                <tr>
                                    <th colspan="6">Objetivo Específico: {{ objetivo.descripcion }} <span class="badge badge-info tu" title="Total Actividades">{{ objetivo.totalactividades }}</span> <span class="label label-success tu" title="Total % ponderación">{{ objetivo.totalponderacion|floatformat:2 }} %</span> </th>
                                </tr>
                                <tr>
                                    <th style="text-align: center; width: 45%;">Actividad</th>
                                    <th style="text-align: center; width: 5%;">Ponderación (%)</th>
                                    <th style="text-align: center; width: 5%;">Fecha Inicio</th>
                                    <th style="text-align: center; width: 5%;">Fecha Fin</th>
                                    <th style="text-align: center; width: 20%;">Entregable</th>
                                    <th style="text-align: center; width: 20%;">Responsables</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% with detalles=proyecto|args:objetivo.id|call:"cronograma_detallado_objetivo" %}
                                    {% for detalle in detalles %}
                                        <tr>
                                            <td style="text-align: justify;">{{ detalle.actividad }}</td>
                                            <td style="text-align: right;">{{ detalle.ponderacion|floatformat:2 }} %</td>
                                            <td style="text-align: center;">{{ detalle.fechainicio|date:"Y-m-d" }}</td>
                                            <td style="text-align: center;">{{ detalle.fechafin|date:"Y-m-d" }}</td>
                                            <td style="text-align: justify">
                                                {% if detalle.lista_entregables %}
                                                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdetalleproductos">
                                                        <tbody>
                                                            {% for entregable in detalle.lista_entregables %}
                                                                <tr>
                                                                    <td>{{ entregable.entregable }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                {% endif %}
                                            </td>
                                            <td style="text-align: justify">
                                                {% if detalle.lista_responsables %}
                                                    <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbdetalleproductos">
                                                        <tbody>
                                                            {% for responsable in detalle.lista_responsables %}
                                                                <tr>
                                                                    <td>{{ responsable.persona.nombre_completo_inverso }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% endwith %}
                            </tbody>
                        </table>
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" data-keyboard="false" id="itemspanelhojavida" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitlehojavida">Mostrar Hoja de Vida</h4>
        </div>
        <div class="modal-body panelbodyhojavida">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>
    
    <div class="modal fade static" data-keyboard="false" id="itemspanelevaluaciones" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitleevaluaciones">Evaluaciones de la Propuesta de Proyecto</h4>
        </div>
        <div class="modal-body panelbodyevaluaciones">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

{% endblock %}

{% extends "adm_asistenciaexamensede/manual/panel.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
    <script type="text/javascript" src='/static/js/select2.js?v=1.0.0'></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=1.0.0"/>
    <link type='text/css' rel='stylesheet' href="/static/datatables/1.12.1/css/dataTables.bootstrap5.min.css"/>
    <script type="text/javascript" src='/static/datatables/1.12.1/js/jquery.dataTables.min.js'></script>
    <script type="text/javascript" src='/static/datatables/1.12.1/js/dataTables.bootstrap5.min.js'></script>
    <link href="/static/bootstrap5/libs/datepicker/css/bootstrap-datepicker.css" rel="stylesheet">
    <script src="/static/bootstrap5/libs/datepicker/js/bootstrap-datepicker.js"> </script>
    <link href="/static/bootstrap5/libs/timepicker/css/bootstrap-timepicker.css" rel="stylesheet">
    <script src="/static/bootstrap5/libs/timepicker/js/bootstrap-timepicker.js"> </script>
    <style>
        .modal-open {
            overflow: hidden;
        }
        input[type="search"] {
            padding: 0.375rem 0.75rem;
            margin-right: 1rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            appearance: none;
            border-radius: 0.25rem;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
            width: 90% !important;
        }
    </style>
    <script type="text/javascript">
        var busqueda = function (page/*=undefined*/) {
            var term = $("#searchinput").val().trim().toUpperCase();
            page = typeof page == 'undefined' ? 1 : page;
            if (term.length > 0) {
                bloqueointerface();
                location.href = `{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&s=${term}&page=${page}`;
            } else {
                bloqueointerface();
                location.href = `{{ request.path }}??ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page=${page}`;
            }
            return false;
        };
        function disableScroll() {
            var x = window.scrollX;
            var y = window.scrollY;
            window.onscroll = function(){ window.scrollTo(x, y) };
        }

        function enableScroll() {
            window.onscroll = null;
        }

        $.fn.datepicker.dates['en'] = {
            days: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"],
            daysShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
            daysMin: ["D", "L", "M", "X", "J", "V", "S"],
            months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Deciembre"],
            monthsShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
            today: "Hoy",
            clear: "Borrar",
            format: "yyyy-mm-dd",
            titleFormat: "MM yyyy", /* Leverages same syntax as 'format' */
            weekStart: 0,

        };

        const actionRegistroAsistencia = function (id){
            bloqueointerface();
            var aData = {"action": "registrarAsistenciaExamen", 'id': id}
            $.ajax({
                type: "POST",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        $.unblockUI();
                        $("#contenedor_password_"+id).html(data.aData.contenedor_clave);
                        $("#contenedor_examen_"+id).html(data.aData.contenedor_examen);
                        $("#contenedor_asistencia_"+id).html(data.aData.contenedor_asistencia);
                        NotificationJG.success("Asistencia guardada");
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });

        };


        const actionQuitarAsistencia = function (id){
            bloqueointerface();
            var aData = {"action": "quitarAsistenciaExamen", 'id': id}
            $.ajax({
                type: "POST",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        $.unblockUI();
                        $("#contenedor_password_"+id).html(data.aData.contenedor_clave);
                        $("#contenedor_examen_"+id).html(data.aData.contenedor_examen);
                        $("#contenedor_asistencia_"+id).html(data.aData.contenedor_asistencia);
                        NotificationJG.success("Se quito asistencia correctamente");
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });

        };

        const actionHabilitarexamen = function (id){
            bloqueointerface();
            var aData = {"action": "habilitar_examen", 'id': id}
            $.ajax({
                type: "POST",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        $.unblockUI();
                        $("#boton_habilita_examen_"+id).html('<a class="btn btn-mini btn-success"><i class="fa fa-check-circle"></i> </a>');
                        NotificationJG.success("Registro exitoso");
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });

        };

        const habilitarExamenTodos = (id) => {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': 'loadFormAccesoExamenTodos',
                    'id': id
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.modal-body', $("#modalAcesoExamenTodos")).html(data.html);
                        $("#modalAcesoExamenTodos").modal({backdrop: 'static', }).modal('show');
                    } else {
                        mensajeDanger(data.message);
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeDanger("Error de conexión.");
                },
                dataType: "json"
            });
            /**/
        }

        const habilitarExamen = function (id){
            bloqueointerface();
            $(".action-save", $("#modalAcesoExamenIndividual")).show();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': 'loadFormAccesoExamenIndividual',
                    'id': id
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.modal-body', $("#modalAcesoExamenIndividual")).html(data.html);
                        $("#modalAcesoExamenIndividual").modal({backdrop: 'static', }).modal('show');
                        if(data.estado_examen == 'inprogress'){
                            $(".action-save", $("#modalAcesoExamenIndividual")).hide();
                        }else{
                            $(".action-save", $("#modalAcesoExamenIndividual")).show();
                        }
                    } else {
                        mensajeDanger(data.message);
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeDanger("Error de conexión.");
                },
                dataType: "json"
            });
        };

        const actionGeneratePasswordAulaPlanificacion = (id, edicion) => {
            var question = `Al realizar esta acción se creara una contraseña aleatoria. <br>¿Está seguro de crear una contraseña?`;
            Confirm.question(question, function () {
                bloqueointerface();
                var aData = {"action": "generatePasswordAulaPlanificacion", 'id': id, 'edicion': edicion}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: 'Se genero correctamente la contraseña',
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });


        }

        const actionGeneratePasswordMateriaAsignadaPlanificacion = (id, edicion, mensaje) => {
            var question = `Al realizar esta acción se creara una contraseña aleatoria. <br>¿Está seguro de crear una contraseña al/la estudiante <span class="label label-warning">${mensaje}</span>?`;
            Confirm.question(question, function () {
                bloqueointerface();
                var aData = {"action": "generatePasswordMateriaAsignadaPlanificacion", 'id': id, 'edicion': edicion}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: 'Se genero correctamente la contraseña',
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    $("#contenedor_password_"+id).html(data.aData.contenedor_clave_examen);
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });


        }

        const actionResetPasswordUser = (id, tipo_documento, documento, persona) => {
            var question = `Al realizar esta acción se restablecerá la contraseña con la o el ${tipo_documento}. <br>¿Está seguro de crear la siguiente contraseña <span class="label label-info">${documento}</span> al/la estudiante <span class="label label-warning">${persona}</span>?`;
            Confirm.question(question, function () {
                bloqueointerface();
                var aData = {"action": "generatePasswordUser", 'id': id}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: `Se genero correctamente la nueva contraseña ${data.aData.clave}`,
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {

                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });


        }

        const actionGenerateLinkAsistencia = (id) => {
            var question = `Al realizar esta acción se creara un enlace para la toma de asistencia. <br>¿Está seguro de crear el enlace?`;
            Confirm.question(question, function () {
                bloqueointerface();
                var aData = {"action": "generateTokenAsistencia", 'id': id}
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();

                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: `Se genero correctamente el enlace de asistencia`,
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                bloqueointerface();
                                location.reload();
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });


        }

        const copyLinkAsistencia = (link)=>{
            var aux = document.createElement("input");
            aux.setAttribute("value", link);
            document.body.appendChild(aux);
            aux.select();
            document.execCommand("copy");
            document.body.removeChild(aux);
        }

        const openModalAddAlumno = (id) =>{
            bloqueointerface();
            var aData = {"action": "listAlumno", 'id': id}
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        $.unblockUI();
                        $(".modal-body", $("#modalAddAlumno")).html(data.aData.html);
                        $("#modalAddAlumno").modal({backdrop: 'static', }).modal('show');
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });
        }
        const openModalAddUrl = (id, action, url, title) =>{
            $('#actionurlvideo').val(action);
            $('#inputurlvideo').val(url);
            $('#title_url_modal').html(title);
            $("#modalAddUrl").modal({backdrop: 'static', }).modal('show');
        }

        const loadData = (aData, modal/*=undefined*/) =>{
            bloqueointerface();
            modal = typeof modal == 'undefined' ? 'modalAddAlumno' : modal;
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        $.unblockUI();
                        $(".modal-body", $("#"+modal)).html(data.aData.html);
                        //$("#modalAddAlumno").modal({backdrop: 'static', }).modal('show');
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });
        }

        const paginateAll = (id) =>{
            bloqueointerface();
            let aData = {"action": "listAlumno", 'id': id}
            loadData(aData);
        }

        const paginateAll2 = () =>{
            bloqueointerface();
            let aData = {"action": "searchHorarioAlumno"}
            loadData(aData, 'modalSearchHorario');
        }


        const paginate = (id, page/*=undefined*/) =>{
            bloqueointerface();
            const term = $("#searchinput", $("#modalAddAlumno")).val().trim().toUpperCase();
            page = typeof page == 'undefined' ? 1 : page;
            let aData = {"action": "listAlumno", 'id': id, 'page': page}
            if (term.length > 0) {
                aData['s'] = term
            }
            loadData(aData);

        }

        const paginate2 = (page/*=undefined*/) =>{
            bloqueointerface();
            const term = $("#searchinput", $("#modalSearchHorario")).val().trim().toUpperCase();
            page = typeof page == 'undefined' ? 1 : page;
            let aData = {"action": "searchHorarioAlumno", 'page': page}
            if (term.length > 0) {
                aData['s'] = term
            }
            loadData(aData, 'modalSearchHorario');

        }

        const actionAddAlumno = (id, ida) =>{
            bloqueointerface();
            let aData = {"action": "addAlumnoPlanificacion", 'id': id, 'ida': ida}
            $.ajax({
                type: "POST",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        //$.unblockUI();
                        NotificationJG.success('Se adiciono correctamente el registro');
                        paginateAll(ida);
                        //$(".modal-body", $("#modalAddAlumno")).html(data.aData.html);
                        //$("#modalAddAlumno").modal({backdrop: 'static', }).modal('show');
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });
        }

        const saveUrlVideo = (id) =>{
            var question = `Al realizar esta acción es irreversible. <br>¿Está seguro de guardar la url de la grabación?`;
            Confirm.question(question, function () {
                bloqueointerface();
                let url = $('#inputurlvideo').val();
                let action = $('#actionurlvideo').val();
                let aData = {"action": action, 'id': id, 'url': url }
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: aData,
                    success: function(data) {
                        if (data.result) {
                            $.unblockUI();
                            Swal.fire({
                                title: `NOTIFICACIÓN`,
                                text: data.message,
                                type: 'success',
                                icon: 'success',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar',
                                cancelButtonText: 'Cancelar'
                            }).then((result) => {
                                if (result.value) {
                                    bloqueointerface();
                                    location.reload();
                                }
                            }).catch(error => {
                                NotificationJG.error(error);
                                $.unblockUI();
                            });
                        }
                        else{
                            NotificationJG.error(data.message);
                            $.unblockUI();
                        }

                    },
                    error: function() {
                        $.unblockUI();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            }, function () {
                NotificationJG.info("Enhorabuena has cancelado la acción.!");
            });
        }

        const openModalAccessMoodle = (id) =>{
            bloqueointerface();
            var aData = {"action": "loadAuditoriaAccesoMoodle", 'id': id}
            $.ajax({
                type: "POST",
                url: `{{ request.path }}`,
                data: aData,
                success: function(data) {
                    if (data.result) {
                        $.unblockUI();
                        $(".modal-body", $("#modalAccessMoodle")).html(data.aData.html);
                        $("#modalAccessMoodle").modal({backdrop: 'static', }).modal('show');
                    }
                    else{
                        NotificationJG.error(data.message);
                        $.unblockUI();
                    }
                },
                error: function() {
                    $.unblockUI();
                    NotificationJG.error("Error al enviar los datos.");
                },
                dataType: "json",
            });
        }


        $(function () {
            $("select").select2();
            //var $table = $('.datatable table');



            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });


            $("#btnSearch").click(function (){
                busqueda();

            });


            $(".action-close", $("#modalAcesoExamenIndividual")).click(function (){
                $("#modalAcesoExamenIndividual").modal('hide');

            });

            $(".action-close", $("#modalAcesoExamenTodos")).click(function (){
                $("#modalAcesoExamenTodos").modal('hide');

            });

            $(".action-close", $("#modalAddAlumno")).click(function (){
                $("#modalAddAlumno").modal('hide');
                bloqueointerface();
                location.reload();
            });

            $(".action-close", $("#modalAccessMoodle")).click(function (){
                $("#modalAccessMoodle").modal('hide');
            });

            $(".action-save", $("#modalAcesoExamenIndividual")).click(function (){
                bloqueointerface();
                let formdata = new FormData($("#formDarAccesoExamenIndividual", $("#modalAcesoExamenIndividual"))[0]);
                $.ajax({
                    type: "POST",
                    url: `{{ request.path }}`,
                    data: formdata,
                    success: function(data) {
                        $.unblockUI();
                        if (data.result === true) {
                            $("#modalAcesoExamenIndividual").modal('hide');
                            Swal.fire({
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                allowEnterKey: false,
                                type: 'success',
                                customClass: {
                                    confirmButton: 'btn btn-info'
                                },
                                title: 'Exitoso',
                                html: '<p>Información guardada correctamente.</p><p>El estudiante puede verificar en moodle el acceso al examen</p>',
                                confirmButtonText: 'Aceptar',
                            }).then((result) => {
                                if (result.value) {
                                    $("#contenedor_examen_"+data.aData.id).html(data.aData.contenedor_examen);
                                    $("#contenedor_password_"+data.aData.id).html(data.aData.contenedor_clave_examen);
                                }
                            })
                        } else {
                            Swal.fire({
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                allowEnterKey: false,
                                type: 'error',
                                customClass: {
                                    confirmButton: 'btn btn-info'
                                },
                                title: 'Ocurrio un error',
                                text: data.message,
                                confirmButtonText: 'Aceptar',
                            })
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $.unblockUI();
                        {#smoke.alert("Error de conexión.");#}
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg='Not connect: Verify Network.';
                        } else if (jqXHR.status == 404) {
                            msg='Requested page not found [404]';
                        } else if (jqXHR.status == 500) {
                            msg='Internal Server Error [500].';
                        } else if (textStatus === 'parsererror') {
                            msg='Requested JSON parse failed.';
                        } else if (textStatus === 'timeout') {
                            msg='Time out error.';
                        } else if (textStatus === 'abort') {
                            msg='Ajax request aborted.';
                        } else {
                            msg='Uncaught Error: ' + jqXHR.responseText;
                        }
                        //smoke.alert("Error al enviar los datos: " + msg);
                        NotificationJG.error("Error al enviar los datos: " + msg);
                    },
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false
                });

            });

            $(".action-save", $("#modalAcesoExamenTodos")).click(function (){
                var question = `¿Está seguro de habilitar el acceso al examen a todos los estudiantes?`;
                Confirm.question(question, function () {
                    bloqueointerface();
                    let formdata = new FormData($("#formDarAccesoExamenTodos", $("#modalAcesoExamenTodos"))[0]);
                    $.ajax({
                        type: "POST",
                        url: `{{ request.path }}`,
                        data: formdata,
                        success: function(data) {
                            $.unblockUI();
                            if (data.result === true) {
                                $("#modalAcesoExamenTodos").modal('hide');
                                Swal.fire({
                                    allowOutsideClick: false,
                                    allowEscapeKey: false,
                                    allowEnterKey: false,
                                    type: 'success',
                                    customClass: {
                                        confirmButton: 'btn btn-info'
                                    },
                                    title: 'Exitoso',
                                    html: '<p>Información guardada correctamente.</p><p>Los estudiante puede verificar en moodle el acceso al examen</p>',
                                    confirmButtonText: 'Aceptar',
                                }).then((result) => {
                                    if (result.value) {
                                        bloqueointerface();
                                        window.location.reload();
                                    }
                                })
                            } else {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    allowEscapeKey: false,
                                    allowEnterKey: false,
                                    type: 'error',
                                    customClass: {
                                        confirmButton: 'btn btn-info'
                                    },
                                    title: 'Ocurrio un error',
                                    text: data.message,
                                    confirmButtonText: 'Aceptar',
                                })
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            $.unblockUI();
                            {#smoke.alert("Error de conexión.");#}
                            var msg = '';
                            if (jqXHR.status === 0) {
                                msg='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                                msg='Requested page not found [404]';
                            } else if (jqXHR.status == 500) {
                                msg='Internal Server Error [500].';
                            } else if (textStatus === 'parsererror') {
                                msg='Requested JSON parse failed.';
                            } else if (textStatus === 'timeout') {
                                msg='Time out error.';
                            } else if (textStatus === 'abort') {
                                msg='Ajax request aborted.';
                            } else {
                                msg='Uncaught Error: ' + jqXHR.responseText;
                            }
                            //smoke.alert("Error al enviar los datos: " + msg);
                            NotificationJG.error("Error al enviar los datos: " + msg);
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }, function () {
                    NotificationJG.info("Enhorabuena se ha cancelado la habilitación del examen.!");
                });



            });

            {#$('#editurl').on('click', function (e){#}
            {#    e.preventDefault();#}
            {#    $('#')#}
            {##}
            {##}
            {##}
            {# })#}
        });
    </script>
{% endblock %}
{% block atras %}{{ request.path }}?idh={{ eTurnoPlanificacionSedeVirtualExamen.id }}{% endblock %}
{% block content %}

    <div class="card ">
    <div class="card-body">
        <ul class="breadcrumb2 px-0 mb-2">
            <li>
                <a href="{{ request.path }}?ids={{ eSede.id|encrypt }}" class="bloqueo_pantalla">{{ eSede.nombre }}</a>
                <span class="divider">/</span>
            </li>
            <li>
                <a href="{{ request.path }}?idf={{ eFechaPlanificacionSedeVirtualExamen.id|encrypt }}" class="bloqueo_pantalla">{{ eFechaPlanificacionSedeVirtualExamen.fecha }}</a>
                <span class="divider">/</span>
            </li>
            <li>
                <a href="{{ request.path }}?idh={{ eTurnoPlanificacionSedeVirtualExamen.id|encrypt }}" class="bloqueo_pantalla">{{ eTurnoPlanificacionSedeVirtualExamen.horainicio }} a {{ eTurnoPlanificacionSedeVirtualExamen.horafin }}</a>
                <span class="divider">/</span>
            </li>
            <li>
                <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}" class="bloqueo_pantalla">{{ eAulaPlanificacionSedeVirtualExamen.aula }}</a>
            </li>
        </ul>
        <div class="row">
            <div class="col-lg-12">
                <div class="card mb-4">
                    <div class="card-body border-top border-6 rounded-3 border-dark-info">
                        <ul class="nav nav-tabs mt-0 mb-2" id="tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="table-tab-listado" data-bs-toggle="pill" href="#listadoAlumno" role="tab" aria-controls="listadoAlumno" aria-selected="true">Listado de asistencia</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="table-tab-resumen" data-bs-toggle="pill" href="#resumen" role="tab" aria-controls="resumen" aria-selected="false">Resumen</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="tabContent">
                            <div class="tab-pane fade active show" id="listadoAlumno" role="tabpanel" aria-labelledby="table-tab-listado">
                                <div class="row">
                                    <div class="col-md-8 col-sm-8">
                                        {% if perms.inno.puede_crear_materiaasignadaplanificacion_examenvirtual %}
                                            <button onclick="openModalAddAlumno({{ eAulaPlanificacionSedeVirtualExamen.id }})" class="btn btn-dark-info btn-mini m-1"><i class="fa fa-plus"></i> Adicionar alumno</button>
                                        {% endif %}
{#                                        <button class="btn btn-success" type="button" id="accesoexamentodos" onclick="habilitarExamenTodos('{{ eAulaPlanificacionSedeVirtualExamen.id }}')"><i class="fa fa-cogs"></i> Dar acceso examen a todos</button>#}
                                        <div class="btn-group">
                                            <a href="{{ eAulaPlanificacionSedeVirtualExamen.responsable.profesor_set.first.urlzoom }}" target="_blank"
                                               class="btn btn-default">
                                                Enlace Meet <img src="/static/images/icons/google-meet-logo-6.png"
                                                                 style="width: 15px;margin-bottom: 2px;">
                                            </a>
                                        </div>
                                        {#                                    {% if not eAulaPlanificacionSedeVirtualExamen.password or eAulaPlanificacionSedeVirtualExamen.password == '' %}#}
                                        {#                                        <button class="btn btn-warning" onclick="actionGeneratePasswordAulaPlanificacion('{{ eAulaPlanificacionSedeVirtualExamen.id }}', 'new')" type="button"><i class="fa fa-key"></i> Generar contraseña de examen</button>#}
                                        {#                                    {% else %}#}
                                        {#                                        <button class="btn btn-warning" onclick="actionGeneratePasswordAulaPlanificacion('{{ eAulaPlanificacionSedeVirtualExamen.id }}', 'edit')" type="button"><i class="fa fa-key"></i> Cambiar contraseña de examen</button>#}
                                        {#                                        <button class="btn btn-success" type="button" id="accesoexamentodos" onclick="habilitarExamenTodos('{{ eAulaPlanificacionSedeVirtualExamen.id }}')"><i class="fa fa-cogs"></i> Dar acceso examen a todos</button>#}
                                        {#                                    {% endif %}#}
{#                                        {% if eAulaPlanificacionSedeVirtualExamen.aula.sedevirtual_id == 11 %}#}
{#                                            <button class="btn btn-primary" onclick="actionGenerateLinkAsistencia('{{ eAulaPlanificacionSedeVirtualExamen.id }}', 'new')" type="button"><i class="fa fa-link"></i> Generar enlace de asistencia</button>#}
{#                                        {% endif %}#}
                                        {% if eAulaPlanificacionSedeVirtualExamen.aula.sedevirtual_id == 11 and not eAulaPlanificacionSedeVirtualExamen.url_video %}
                                            <button class="btn btn-primary"
                                                    onclick="openModalAddUrl('{{ eAulaPlanificacionSedeVirtualExamen.id }}', 'saveUrlVideo', '', 'Adicionar Url de grabación')"
                                                    type="button"><i class="fa fa-link"></i> Ingresar url grabación
                                            </button>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-4 col-sm-4">
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" placeholder="Cedula, pasaporte o apellidos" aria-label="Buscar" aria-describedby="btnSearch" name="s" value="{{ search }}" id="searchinput">
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="button" id="btnSearch"><i class="fa fa-search"></i></button>
                                                {% if url_params %}
                                                    <a title="Ver todo" href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}" class="btn btn-default tr bloqueo_pantalla">
                                                        <i class="fas fa-sync-alt"></i>
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% if  eAulaPlanificacionSedeVirtualExamen.password %}
                                    <div class="row">
                                        <div class="col-12">
                                            {% if eAulaPlanificacionSedeVirtualExamen.turnoplanificacion.fechaplanificacion.supervisor %}
                                                <label><b>Supervisor: </b>{{ eAulaPlanificacionSedeVirtualExamen.turnoplanificacion.fechaplanificacion.supervisor }}</label>
                                            {% elif eAulaPlanificacionSedeVirtualExamen.supervisor %}
                                                <label><b>Supervisor: </b>{{ eAulaPlanificacionSedeVirtualExamen.supervisor }}</label>
                                            {% endif %}
                                            {% if eAulaPlanificacionSedeVirtualExamen.responsable %}
                                                <label><b>Aplicador: </b>{{ eAulaPlanificacionSedeVirtualExamen.responsable }}</label>
                                            {% endif %}
                                            {% if eAulaPlanificacionSedeVirtualExamen.password %}
                                                <label><b>Clave general de acceso al examen: </b>{{ eAulaPlanificacionSedeVirtualExamen.password }}</label>
                                            {% endif %}
                                            {% if eAulaPlanificacionSedeVirtualExamen.token %}
                                                {% if isLocal %}
                                                    <label><b>Enlace de toma de asistencia: </b>http://127.0.0.1:3000/alu_asistenica_virtual/{{ eAulaPlanificacionSedeVirtualExamen.token }}<button class="btn btn-link" href="javascript:;" onclick="copyLinkAsistencia('http://127.0.0.1:3000/alu_asistenica_virtual/{{ eAulaPlanificacionSedeVirtualExamen.token }}')">Copiar enlace</button></label>
                                                {% else %}
                                                    <label><b>Enlace de toma de asistencia: </b>https://sgaestudiante.unemi.edu.ec/alu_asistenica_virtual/{{ eAulaPlanificacionSedeVirtualExamen.token }}<button class="btn btn-link" href="javascript:;" onclick="copyLinkAsistencia('https://sgaestudiante.unemi.edu.ec/alu_asistenica_virtual/{{ eAulaPlanificacionSedeVirtualExamen.token }}')">Copiar enlace</button></label>
                                                {% endif %}
                                            {% endif %}
                                            {% if eAulaPlanificacionSedeVirtualExamen.url_video %}
                                                <b>Url Video: </b> <a class="btn btn-warning" data-bs-toggle="tooltip" title="Ver grabación" href="{{ eAulaPlanificacionSedeVirtualExamen.url_video }}" target="_blank"> <i class="fa fa-eye"></i></a>
                                                <a id="editurl" data-bs-toggle="tooltip" title="Editar enlace" nhref="{{ eAulaPlanificacionSedeVirtualExamen.responsable.profesor_set.first.urlzoom }}"
                                               class="btn btn-default" onclick="openModalAddUrl('{{ eAulaPlanificacionSedeVirtualExamen.id }}', 'editUrlVideo', '{{ eAulaPlanificacionSedeVirtualExamen.url_video }}','Editar Url de grabación')"><i class="fa fa-edit"></i></a>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}
                                <div class="table-responsive">
                                    <table class='table table-bordered table-striped'>
                                        <thead class="table-light">
                                        <tr>

                                            <th style="text-align: center; vertical-align: middle; width: 2%"></th>
                                            <th style="text-align: center; vertical-align: middle; width: 25%">Alumno</th>
                                            <th style="text-align: center; vertical-align: middle; width: 20%">Facultad/Carrera</th>
                                            <th style="text-align: center; vertical-align: middle; width: 20%">Materia/Nivel/Paralelo</th>
                                            <th style="text-align: center; vertical-align: middle; width: 8%">Clave Acceso Examen</th>
                                            <th style="text-align: center; vertical-align: middle; width: 10%">Examen</th>
                                            <th style="text-align: center; vertical-align: middle; width: 8%">Asistencia</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for eMateriaAsignadaPlanificacionSedeVirtualExamen in eMateriaAsignadaPlanificacionSedeVirtualExamenes %}
                                            <tr>

                                                <td style="text-align: center; vertical-align: middle">
                                                    {%  if persona.usuario.is_superuser %}
                                                        {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}<br>
                                                    {% endif %}
                                                    {% if perms.inno.puede_eliminar_materiaasignadaplanificacion_examenvirtual %}
                                                        <button onclick="actionDeleteAlumno({{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}, '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona }}', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.asignatura.nombre }}')" class="btn btn-danger btn-mini m-1"><i class="fa fa-trash"></i></button>
                                                    {% endif %}
                                                    <button onclick="openModalAccessMoodle({{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }})" class="btn btn-primary btn-mini m-1"><i class="fa fa-cogs"></i></button>
                                                </td>

                                                <td style="text-align: left; vertical-align: middle">
                                                    <div>
                                                        {% if perms.inno.puede_resetearclaveusuario_examenvirtual %}
                                                            {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.usuario %}
                                                                <a onclick="actionResetPasswordUser({{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.id }}, '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.tipo_documento }}', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.documento }}', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo }}' )" class="btn btn-warning btn-mini m-1 text-dark" data-bs-toggle="tooltip" data-bs-placement="top" title="Resetear clave inicio de sesión (Cédula/Pasaporte)"><i class="fa fa-user-secret"></i></a>
                                                                <b>Usuario:</b> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.usuario.username }}<br>
                                                            {% endif %}
                                                        {% endif %}
                                                        <strong>{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.tipo_documento }}:</strong> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.documento }}
                                                    </div>
                                                    <div>{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo_minus }}</div>
                                                    <div><strong>Teléfono celular:</strong> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.telefono|default_if_none:'S/N' }}</div>
                                                    <div><strong>Teléfono convencional:</strong> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.telefono_conv|default_if_none:'S/N' }}</div>
                                                    <div><strong>Correo personal:</strong> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.email|default_if_none:'S/N' }}</div>
                                                    <div><strong>Correo institucional:</strong> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.emailinst|default_if_none:'S/N' }}</div>
                                                    <!--<div></div>-->
                                                </td>
                                                <td style="text-align: left; vertical-align: middle">
                                                    <label class="badge badge-info">{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.coordinacion.alias }}</label> / {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.carrera }}
                                                </td>
                                                <td style="text-align: center;  vertical-align: middle">
                                                    {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.asignatura.nombre }}<br>
                                                    <span class="text-black-50">{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.asignaturamalla.nivelmalla.nombre }}</span><br>
                                                    <span class="text-dark-warning">{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.paralelomateria.nombre }}</span>
                                                    {%  if  eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.bloqueomatricula %}
                                                        <br>
                                                        <span class="label label-important tu" > MATRICULA BLOQUEADA</span>
                                                    {% endif %}
                                                {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.profesor_principal %}
                                                    <p><b>Profesor: </b>{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.profesor_principal.persona.nombre_completo_minus }}</p>
                                                {% endif %}
                                                </td>
                                                <td style="text-align: center;  vertical-align: middle">
                                                    <div id="contenedor_password_{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}">
                                                        {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.password %}
                                                            {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.password }}
                                                        {% endif %}
                                                        {#                                                    {% if not eMateriaAsignadaPlanificacionSedeVirtualExamen.password or eMateriaAsignadaPlanificacionSedeVirtualExamen.password == '' %}#}
                                                        {#                                                        <button class="btn btn-warning btn-mini p-1" onclick="actionGeneratePasswordMateriaAsignadaPlanificacion('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}', 'new', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo }}')" type="button"><i class="fa fa-key"></i> Generar contraseña</button>#}
                                                        {#                                                    {% else %}#}
                                                        {#                                                        <button class="btn btn-info text-black-50 btn-mini p-1" onclick="actionGeneratePasswordMateriaAsignadaPlanificacion('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}', 'edit', '{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.matricula.inscripcion.persona.nombre_completo }}')" type="button"><i class="fa fa-key"></i> Cambiar contraseña</button>#}
                                                        {#                                                    {% endif %}#}
                                                    </div>
                                                </td>
                                                <td style="text-align: center;  vertical-align: middle">
                                                    <div id="contenedor_examen_{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}">
                                                        {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.idcursomoodle and persona.usuario.is_superuser %}
                                                                <a data-bs-toggle="tooltip"
                                                                   title="Ir al curso de moodle"
                                                                   class="btn btn-mini btn-success"
                                                                   href="{% if eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.coordinacion.id == 9 %}{{ periodo.urlmoodle2 }}{% else %}{{ periodo.urlmoodle }}{% endif %}/course/view.php?id={{ eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia.idcursomoodle }}"
                                                                   target="_blank"><i class="fa fa-graduation-cap"></i></a>
                                                        {% endif %}
                                                        {% with examen_planificado=eMateriaAsignadaPlanificacionSedeVirtualExamen.materiaasignada.materia|args:eMateriaAsignadaPlanificacionSedeVirtualExamen.detallemodeloevaluativo|call:"examenplanificadosilabo" %}
                                                            {%  if persona.usuario.is_superuser %}
                                                                {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.idtestmoodle %}
                                                                    <p><span class="badge bg-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="IDTESTMOODLE">{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.idtestmoodle }}</span>
                                                                        </p>
                                                                {% endif %}
                                                            {% endif %}
                                                            {% if not examen_planificado %}
                                                                <div class="alert alert-warning m-1 p-1">
                                                                    <h5 class="alert-heading">No existe planificación de examen</h5>
                                                                </div>
                                                            {% else %}
                                                                {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.asistencia %}
                                                                    {% if examen_planificado %}
                                                                        {% if acceso_examen %}
                                                                            <p class="fs-6">{{ examen_planificado.nombretest }}</p>
                                                                            <p><a href="javascript:void(0);" onclick="habilitarExamen('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}')" class="btn btn-mini {% if eMateriaAsignadaPlanificacionSedeVirtualExamen.habilitadoexamen %}btn-success{% else %}btn-warning{% endif %}" ><i class="fa fa-list"></i></a></p>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% else %}
                                                                    <div class="alert alert-danger m-1 p-1">
                                                                        <h5 class="alert-heading">Debe registrar asistencia primero</h5>
                                                                    </div>
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endwith %}
                                                    </div>
                                                </td>
                                                <td style="text-align: center;  vertical-align: middle">
                                                    <div id="contenedor_asistencia_{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}">
                                                        {% if not eMateriaAsignadaPlanificacionSedeVirtualExamen.asistencia %}
                                                            <button type="button" class="btn btn-mini btn-info text-black-50" onclick="actionRegistroAsistencia('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}')"><i class="fa fa-edit"></i> Registrar asistencia</button>
                                                        {% else %}
                                                            <span class="badge bg-success text-black-50"><i class="fa fa-check-circle"></i> {{ eMateriaAsignadaPlanificacionSedeVirtualExamen.fecha_asistencia|date:'d-m-Y h:i A' }}</span>
                                                            <button type="button" class="btn btn-mini btn-danger" onclick="actionQuitarAsistencia('{{ eMateriaAsignadaPlanificacionSedeVirtualExamen.id }}')"><i class="fa fa-trash"></i> Quitar asistencia</button>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <td colspan="7" style="text-align: center; vertical-align: middle">NO EXISTEN REGISTROS</td>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>

                                {% if eMateriaAsignadaPlanificacionSedeVirtualExamenes|length %}
                                    <div class="row">
                                        <div class="col-12">
                                            <nav aria-label="Page navigation example">
                                                <ul class="pagination justify-content-end">
                                                    {% if paging.num_pages > 25 %}
                                                        {% if paging.primera_pagina %}
                                                            <li class="page-item">
                                                                <a class="page-link" href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page=1{{ url_params }}">1</a>
                                                            </li>
                                                            <li class="page-item">
                                                                <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page={{ paging.ellipsis_izquierda }}{{ url_params }}"
                                                                   class="active page-link">...</a></li>
                                                        {% endif %}
                                                        {% for pagenumber in paging.paginas %}
                                                            <li {% if pagenumber == page.number %}class='active page-item'
                                                                {% else %}class='page-item'{% endif %}>
                                                                <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page={{ pagenumber }}{{ url_params }}"
                                                                   class="page-link">{{ pagenumber }}</a>
                                                            </li>
                                                        {% endfor %}
                                                        {% if paging.ultima_pagina %}
                                                            <li class="page-item">
                                                                <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page={{ paging.ellipsis_derecha }}{{ url_params }}"
                                                                   class="active page-link">...</a></li>
                                                            <li class="page-item">
                                                                <a href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page={{ paging.num_pages }}{{ url_params }}"
                                                                   class="page-link">{{ paging.num_pages }}</a>
                                                            </li>
                                                        {% endif %}
                                                    {% else %}
                                                        {% for pagenumber in paging.page_range %}
                                                            <li {% if pagenumber == page.number %}class='active page-item'
                                                                {% else %}class="page-item"{% endif %}>
                                                                <a class="page-link"
                                                                   href="{{ request.path }}?ida={{ eAulaPlanificacionSedeVirtualExamen.id|encrypt }}&page={{ pagenumber }}{{ url_params }}">{{ pagenumber }}</a>
                                                            </li>
                                                        {% endfor %}
                                                    {% endif %}
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="tab-pane fade" id="resumen" role="tabpanel" aria-labelledby="table-tab-resumen">
                                {% if aCoordinaciones|length %}
                                    <div class="accordion accordion-flush" id="accordionCoordinaciones">
                                        {% for aCoordinacion in aCoordinaciones %}
                                            <div class="accordion-item">
                                                <h2 class="accordion-header" id="flush-heading{{ aCoordinacion.id }}">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse{{ aCoordinacion.id }}" aria-expanded="false" aria-controls="flush-collapse{{ aCoordinacion.id }}">
                                                        {{ aCoordinacion.nombre }}
                                                    </button>
                                                </h2>
                                                <div id="flush-collapse{{ aCoordinacion.id }}" class="accordion-collapse collapse" aria-labelledby="flush-heading{{ aCoordinacion.id }}" data-bs-parent="#accordionCoordinaciones">
                                                    <div class="accordion-body m-0 p-0">
                                                        <ul class="list-group list-group-flush">
                                                            {% for aMalla in aCoordinacion.aMallas %}
                                                                <li class="list-group-item">
                                                                    <label class="text-dark-warning">{{ aMalla.nombre }}</label>
                                                                    <ol class="list-group list-group-numbered">
                                                                        {% for aMateria in aMalla.aMaterias %}
                                                                            <li class="list-group-item d-flex justify-content-between align-items-start">

                                                                                <div class="ms-2 me-auto">
                                                                                    <div class="fw-bold">{{ aMateria.nombre }} - {{ aMateria.paralelo }} - {{ aMateria.nivel }}</div>
                                                                                    <label><strong>Profesor:</strong> <span class="text-dark-info">{{ aMateria.profesor }}</span></label>
                                                                                    <!--Número de estudiantes-->
                                                                                    {% if aCoordinacion.id == 9 %}
                                                                                        <a href="https://aulanivelacion.unemi.edu.ec/course/view.php?id={{ aMateria.idcursomoodle }}"
                                                                                           target="_blank"
                                                                                           class="btn btn-link">Ir al curso Moodle</a>
                                                                                    {% else %}
                                                                                        <a href="https://aulagrado.unemi.edu.ec/course/view.php?id={{ aMateria.idcursomoodle }}"
                                                                                           target="_blank"
                                                                                           class="btn btn-link">Ir al curso Moodle</a>
                                                                                    {% endif %}
                                                                                </div>
                                                                                <span class="badge bg-primary rounded-pill">{{ aMateria.total }}</span>
                                                                            </li>
                                                                        {% endfor %}

                                                                    </ol>

                                                                </li>
                                                            {% endfor %}
                                                        </ul>

                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}



                                    </div>
                                {% else %}
                                    <div class="alert alert-info">No se ecnontro ningun estudiante planificado</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAcesoExamenIndividual" tabindex="-1" aria-labelledby="modalAcesoExamenIndividual" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-2">Accesibilidad examen</h5>
                    <button type="button" class="btn-close action-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body m-2">
                    ...
                </div>
                <div class="modal-footer m-2">
                    <button type="button" class="btn btn-secondary action-close" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary action-save">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAcesoExamenTodos" tabindex="-1" aria-labelledby="modalAcesoExamenTodos" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-2">Accesibilidad examen</h5>
                    <button type="button" class="btn-close action-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body m-2">
                    ...
                </div>
                <div class="modal-footer m-2">
                    <button type="button" class="btn btn-secondary action-close" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary action-save">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAddAlumno" tabindex="-1" aria-labelledby="modalAddAlumno" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-2">Adicionar alumno</h5>
                    <button type="button" class="btn-close action-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body m-2">
                    ...
                </div>
                <div class="modal-footer m-2">
                    <button type="button" class="btn btn-secondary action-close" data-bs-dismiss="modal">Cerrar</button>
                    <!--<button type="button" class="btn btn-primary action-save">Guardar</button>-->
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalAddUrl" tabindex="-1" aria-labelledby="modalAddUrl" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-2" id="title_url_modal">Adicionar Url de grabación</h5>
                    <button type="button" class="btn-close action-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body m-2" id="urlvideo">
                    <div class="input-group mb-3">
                        <label for="url-video"></label>
                        <input type="hidden" value="saveUrlVideo" name="actionurlvideo" id="actionurlvideo">
                        <input type="text" class="form-control" placeholder="Url de video" aria-label="Url de video"
                               id="inputurlvideo" aria-describedby="basic-addon1">
                    </div>
                </div>
                <div class="modal-footer m-2">
                    <button type="button" class="btn btn-secondary action-close" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="saveurl" onclick="saveUrlVideo('{{ eAulaPlanificacionSedeVirtualExamen.id }}')">Guardar</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modalAccessMoodle" tabindex="-1" aria-labelledby="modalAccessMoodle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title m-2">Auditoria del examen</h5>
                    <button type="button" class="btn-close action-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body m-2">
                    ...
                </div>
                <div class="modal-footer m-2">
                    <button type="button" class="btn btn-secondary action-close" data-bs-dismiss="modal">Cerrar</button>
                    <!--<button type="button" class="btn btn-primary action-save">Guardar</button>-->
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block extraJs %}

{% endblock %}
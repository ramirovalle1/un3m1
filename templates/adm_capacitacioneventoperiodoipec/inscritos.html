{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet"/>

    <link rel="stylesheet" href="/static/css/jquery.fancybox.css?v=1.0.0" type="text/css" media="screen"/>
    <script type="text/javascript" src="/static/js/jquery.fancybox.pack.js?v=1.0.0"></script>
    <script src="/static/adicionalesjs/formquestionb4.js?0.24"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".fancybox").fancybox();
        });
        $(function () {
            $("select").select2({minimumResultsForSearch: 1});
            $(".tl").tooltip({position: "center up"});

            busqueda = function () {
                var term = $("#searchinput").val().toUpperCase().trim();
                var ide = $("#id_estado").val();

                if (term.length > 0) {
                    bloqueointerface();
                    location.href = "/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&s=" + term + "&ide=" + ide;
                } else {
                    bloqueointerface();
                    location.href = "/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&ide=" + ide;
                }
                return false;
            };

            $("#search").click(function () {
                busqueda();
            });
            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });
            $(".mostrardetalle_view").click(function () {
                var idi = $(this).attr('idi');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_capeventoperiodoipec",
                    data: {'action': 'verdetalle', 'idi': idi},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbody").html(data.data);
                            $("#itemspanel").modal({backdrop: 'static', width: '900px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $("#itemspanel .btn-cerrar").click(function () {
                $("#itemspanel").modal("hide");
                return false;
            });

            $(".certificado_view_pdf").click(function () {

                var id = $(this).attr('idi');

                {#                {% if eventoperiodo.instructor_principal %}#}
                {#debugger;#}
                openwindow('POST', '/adm_capeventoperiodoipec', {
                    action: 'reporte_certificadoprevio',
                    'id': id
                }, '_blank');
                {#smoke.alert("hola.");#}
                {#                {% else %}#}
                {#                    smoke.alert("No puede abrir, elija un instructor principal");#}
                {#                {% endif %}#}
            });

            $("#boton_notoficacionaprobada").click(function () {
                var idinscripcioncohorte = $('#idinscripcioncohorte').val();
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_capeventoperiodoipec",
                    data: {'action': 'reporte_certificado', 'id': idinscripcioncohorte},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            $("#modalnotoficacion").modal({backdrop: 'static', width: '600px'}).modal('hide');
                            $.unblockUI();
                            location.reload();
                            smoke.alert('El certificado fue generado y enviado al email');
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    }
                });

            });
            $("#cancel_notoficacioncancela").click(function () {
                $('#modalnotoficacion').modal('hide');
            });
            $(".verobservacioninscripcion").click(function () {
                var idins = $(this).attr("idins");
                if (idins) {
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/adm_capeventoperiodoipec",
                        data: {"action": "verobservacioninscripcion", "id": idins},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $(".panelbodyobservacion").html(data.data);
                                $("#modalobservacion").modal({
                                    backdrop: 'static',
                                    width: 500,
                                    height: 600
                                }).modal('show');
                            } else {
                                $("#modalobservacion").modal("hide");
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                            $("#modalobservacion").hide();
                        },
                        dataType: "json"
                    });
                }
            });
            $("#modalobservacion .cerrar_modalobservacion").click(function () {
                $("#modalobservacion").modal("hide");
            });

            $("#eliminamasivo").click(function () {
                smoke.confirm("¿Está seguro que desea eliminar inscritos con deuda pendiente?", function (e) {
                    if (e) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/adm_capeventoperiodoipec",
                            data: {'action': 'eliminamasivo', 'codeventoipec': '{{ eventoperiodo.pk }}'},
                            success: function (data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();
                                    {#NotificationJG.success(data.mensaje, 'Migración de rubros', 10000)#}
                                    {#mensajeSuccess(data.mensaje)#}
                                    {#smoke.alert(data.mensaje);#}
                                    location.reload();
                                } else {
                                    $.unblockUI();
                                    NotificationJG.warning(data.mensaje, 'Migración de rubros', 200000)
                                    {#smoke.alert(data.mensaje);#}
                                }
                            },
                            error: function () {
                                $.unblockUI();
                                smoke.alert("Error al enviar los datos.");
                            }
                        })
                    }
                }, {
                    ok: "SI, SEGURO",
                    cancel: "NO,CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            });

            {# Activar deuda masiva #}
            $("#activamasivo").click(function () {
                smoke.confirm("Una vez que genere al menos un rubro en el evento, ya no podrá modificar su costo. ¿Está seguro que desea generar rubros masivo a los inscritos?.", function (e) {
                    if (e) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/adm_capeventoperiodoipec",
                            data: {'action': 'activamasivo', 'codeventoipec': '{{ eventoperiodo.pk }}'},
                            success: function (data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();
                                    location.reload();
                                    {#NotificationJG.success(data.mensaje, 'Migración de rubros ok', 200000);#}
                                } else {
                                    $.unblockUI();
                                    mensajeWarning(data.mensaje, 'Migración de rubros');
                                }
                            },
                            error: function () {
                                $.unblockUI();
                                smoke.alert("Error al enviar los datos.");
                            }
                        })
                    }
                }, {
                    ok: "SI, SEGURO",
                    cancel: "NO,CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            });

            $(".activar_inscrito").click(function () {
                var idinscrito = $(this).attr('cod_inscrito');
                smoke.confirm("¿Está seguro que desea activar inscrito?", function (e) {
                    if (e) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/adm_capeventoperiodoipec",
                            data: {'action': 'activainscrito', 'idinscrito': '' + idinscrito + ''},
                            success: function (data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();
                                    smoke.alert('REGISTRO ACTIVADO');
                                    location.reload();
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function () {
                                $.unblockUI();
                                smoke.alert("Error al enviar los datos.");
                            }
                        })
                    }
                }, {
                    ok: "SI, SEGURO",
                    cancel: "NO,CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            });

        });

        function mostrarenvio(idinscripcion) {
            $('#idinscripcioncohorte').val(idinscripcion);
            {#$("#idnombrespostulante").html('');#}
            {#$("#idnombrespostulante").html(nompostulante);#}
            bloqueointerface();
            $("#modalnotoficacion").modal({backdrop: 'static', width: '600px'}).modal('show');
            $.unblockUI();
        }

        function notificarmasivo(idinscripcion) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_capeventoperiodoipec",
                data: {'action': 'inscritosmasivos', 'id': idinscripcion},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        $('#recalcularmodal').modal({keyboard: false, backdrop: 'static'}).modal("show");
                        var indice = 0;
                        var cantidad = parseInt(data.cantidad);
                        var inscritos = data.inscritos;
                        recalculo(inscritos, indice, (cantidad - 1));
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        function recalculo(lista, elemento, cantidad) {
            var inscrito = lista[elemento];
            var cp = (100 / (cantidad + 1)) * elemento + '%';
            if (elemento > cantidad) {
                terminarecalculo();
                location.reload();
            } else {
                $("#recalcularmodalprogresshint").html(inscrito.participante__apellido1 + ' ' + inscrito.participante__apellido2 + ' ' + inscrito.participante__nombres);
                $("#progressbar").css({'width': cp});
                $("#progressbar").html(((elemento * 100) / cantidad).toFixed(2) + '%');
                $.ajax({
                    type: "GET",
                    url: "/adm_capeventoperiodoipec",
                    data: {"action": "notificarinscritomsv", "id": inscrito.id},
                    success: function (data) {
                        if (data.result == 'ok') {
                            intentos = 0;
                            recalculo(lista, elemento + 1, cantidad);
                        } else {
                            intentos += 1;
                            if (intentos >= 100) {
                                fallorecalculo();
                            } else {
                                recalculo(lista, elemento, cantidad);
                            }
                        }
                    },
                    error: function () {
                        intentos += 1;
                        if (intentos >= 100) {
                            fallorecalculo();
                        } else {
                            recalculo(lista, elemento, cantidad);
                        }
                    },
                    dataType: "json"
                });
            }

        }

        function fallorecalculo() {
            $.unblockUI();
            $("#recalcularmodal").modal("hide");
            smoke.alert("Fallo al recalcular los resultados");
        }

        function terminarecalculo() {
            $("#recalcularmodal").modal("hide");
            NotificationJG.success("ENVIO EXITOSO", "CERTIFICADOS ENVIADOS CORRECTAMENTE");
        }


        function notificarmasivocorreo(idinscripcion) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_capeventoperiodoipec",
                data: {'action': 'inscritopagadomasivo', 'id': idinscripcion},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        $('#recalcularmodalcorreo').modal({keyboard: false, backdrop: 'static'}).modal("show");
                        var indice = 0;
                        var cantidad = parseInt(data.cantidad);
                        var inscritos = data.inscritos;
                        recalculocorreo(inscritos, indice, (cantidad - 1));
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        function notificarindividualcorreo(idinscripcion, id) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_capeventoperiodoipec",
                data: {'action': 'inscritopagadoindividual', 'id': idinscripcion, 'idinscrito':id},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        smoke.alert(`Credenciales notificadas correctamente`);
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        function generarcertificadosinnotificar(id) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_capeventoperiodoipec",
                data: {'action': 'generarcertificadosinnotificar', 'id' :id },
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        smoke.alert('Certificado generado');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        function solonotificarcertificado(id) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_capeventoperiodoipec",
                data: {'action': 'solonotificarcertificado', 'id' :id },
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        smoke.alert('Notificación enviada');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        function generarreportemasivo(idinscripcion) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: "/adm_capeventoperiodoipec",
                data: {'action': 'reporte_generar_masivo', 'id': idinscripcion},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        $.unblockUI();
                        location.reload();
                        smoke.alert("CERTIFICADOS GENERADOS");
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        {#function revisarcertificado(idinscripcion) {#}
        {#    bloqueointerface();#}
        {#    $.ajax({#}
        {#        type: "POST",#}
        {#        url: "/adm_capeventoperiodoipec",#}
        {#        data: {'action': 'pruebagenerarcertificado', 'id': idinscripcion},#}
        {#        success: function (data) {#}
        {#            $.unblockUI();#}
        {#            if (data.result == 'ok') {#}
        {#                $.unblockUI();#}
        {#                location.reload();#}
        {#                smoke.alert("REVISAR CERTIFICADO GENERADO");#}
        {#            } else {#}
        {#                smoke.alert(data.mensaje);#}
        {#            }#}
        {#        },#}
        {#        error: function () {#}
        {#            $.unblockUI();#}
        {#            smoke.alert("Error al obtener los datos");#}
        {#        },#}
        {#        dataType: "json"#}
        {#    });}#}

        function recalculocorreo(lista, elemento, cantidad) {
            var inscrito = lista[elemento];
            var cp = (100 / (cantidad + 1)) * elemento + '%';
            if (elemento > cantidad) {
                terminarecalculocorreo();
            } else {
                $("#recalcularmodalprogresshintcorreo").html(inscrito.participante__apellido1 + ' ' + inscrito.participante__apellido2 + ' ' + inscrito.participante__nombres);
                $("#progressbar").css({'width': cp});
                $("#progressbar").html(((elemento * 100) / cantidad).toFixed(2) + '%');
                $.ajax({
                    type: "GET",
                    url: "/adm_capeventoperiodoipec",
                    data: {"action": "notificarcorreomasivo", "id": inscrito.id},
                    success: function (data) {
                        if (data.result == 'ok') {
                            intentos = 0;
                            recalculocorreo(lista, elemento + 1, cantidad);
                        } else {
                            intentos += 1;
                            if (intentos >= 100) {
                                fallorecalculocorreo();
                            } else {
                                recalculocorreo(lista, elemento, cantidad);
                            }
                        }
                    },
                    error: function () {
                        intentos += 1;
                        if (intentos >= 100) {
                            fallorecalculocorreo();
                        } else {
                            recalculocorreo(lista, elemento, cantidad);
                        }
                    },
                    dataType: "json"
                });
            }
        }

        function fallorecalculocorreo() {
            $.unblockUI();
            $("#recalcularmodalcorreo").modal("hide");
            smoke.alert("Fallo al recalcular los resultados");
        }

        function terminarecalculocorreo() {
            $("#recalcularmodalcorreo").modal("hide");
            NotificationJG.success("ENVIO EXITOSO", "CORREOS ENVIADOS CORRECTAMENTE");
        }

        var intentos = 0;



        function generarubro(pk, nombre, accion) {
            Swal.fire({
                title: `Está a punto de generar rubro a \n ${nombre}`,
                {#text: `Una vez que genere al menos un rubro en el evento, ya no podrá modificar el costo ni el valor del rubro.`,#}
                type: 'warning',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.ajax({
                        type: 'POST',
                        url: '{{ reques.path }}',
                        async: false,
                        data: {
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            action: accion,
                            id: pk,
                        },
                        dataType: "json",
                        beforeSend: function () {
                            bloqueointerface();
                        }
                    }).done(function (data) {
                        setTimeout($.unblockUI, 1);
                        if (data.error === false) {
                            {#NotificationJG.success(data.message, 'Migración de rubros', 200000);#}
                            location.reload();
                        }
                        else{
                            NotificationJG.warning(data.message, 'Migración de rubros', 200000);
                        }
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        setTimeout($.unblockUI, 1);
                        NotificationJG.error('Error en el servidor', 'Advertencia!', 10000);
                    }).always(function () {
                    });
                } else {
                }
            })
        }

        function borrarrubro(pk, nombre, accion) {
            Swal.fire({
                title: `Está a punto de borrar rubro a \n ${nombre}`,
                type: 'warning',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.ajax({
                        type: 'POST',
                        url: '{{ reques.path }}',
                        async: false,
                        data: {
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            action: accion,
                            id: pk,
                            eli: 'eliminar'
                        },
                        dataType: "json",
                        beforeSend: function () {
                            bloqueointerface();
                        }
                    }).done(function (data) {
                        setTimeout($.unblockUI, 1);
                        if (data.error === false) {
                            location.reload();
                        }
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        setTimeout($.unblockUI, 1);
                        NotificationJG.error('Error en el servidor', 'Advertencia!', 10000);
                    }).always(function () {
                    });
                } else {
                }
            })
        }

        function formModal(id, text, action, width = '600px', footer = true) {
            $('.panelbodyform').empty();
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        if (footer === true) {
                            $('#footermodalform').hide();
                        }
                        $('.panelbodyform').html(data.data);
                        $('#itemspanelform .paneltitleform').html(text);
                        $("#itemspanelform").modal({backdrop: 'static', width: width}).modal('show');

                        smoke.alert(data.mensaje);


                    } else {

                        smoke.alert(data.mensaje);


                    }

                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function consultar(accion, participante, nombre, capeventoperiodo, pago, costo, rubro, ocultarcerrar = false) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {'action': accion, 'id':participante, 'nombre':nombre, 'capeventoperiodo':capeventoperiodo, 'pago':pago, 'costo':costo, 'rubro':rubro},
                success: function (data) {
                    $.unblockUI();

                    if (data.result == true) {
                        if (ocultarcerrar == true) {
                            $('#footerModalView').hide();
                        }
                        $('.tablaaqui').html(data.data)
                        $('#frmConsulta #nombre').html('Detalle de pagos');
                        $('#modalConsulta').modal({"backdrop": "static", "width": "900px"}).modal("show");
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });

        }

        function actualizargratuidad(idinscrito, indice, ideventoperiodo) {
            var estadogratuidad = false;
            if (indice.checked) {
                estadogratuidad = true;
            } else {
                estadogratuidad = false;
            }
            $.ajax({
                type: "GET",
                url: 'adm_capeventoperiodoipec',
                data: {
                    'action': 'inscritoaplicagratuidad',
                    'idinscrito': idinscrito,
                    'ideventoperiodo': ideventoperiodo,
                    'estadogratuidad': estadogratuidad,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        if (data.identificadorgratuidad == 1) {
                            $("#chksub_" + idinscrito).attr('checked', true);
                        }
                        if (data.identificadorgratuidad == 0) {
                            $("#chksub_" + idinscrito).attr('checked', false);
                        }
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }
    </script>
    <link href="/static/widget_ppp.css" rel="stylesheet"/>

{% endblock %}
{% block atras %}/adm_capeventoperiodoipec?action=planificacion&id={{ eventoperiodo.periodo_id }}{% endblock %}
{% block canvas %}
<div class="modal fade static" id="itemspanelform" style="display: none;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <h4><i class="fa fa-list"></i> <b class="paneltitleform">FORMULARIO MODAL</b></h4>
    </div>
    <div class="modal-body">
        <form autocomplete="off" method="post"
              enctype="multipart/form-data" action="{{ request.path }}">
            {% csrf_token %}
            <div class="row-fluid panelbodyform">
            </div>
        </form>
    </div>
    <div class="modal-footer" id="footermodalform">
        <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i
                class="fa fa-window-close"></i>
            Cerrar</a>
    </div>
</div>

<div class="modal static" id="recalcularmodal" style="display: none;">
    <div class="modal-header">
        <h3>Envio de Certificados <i class="fa fa-certificate"></i></h3>
    </div>
    <div class="modal-body">
        <div style='margin-bottom:1px;height: 20px;background-image: linear-gradient(to bottom, #dde2df, #d7e2dd)'
             class="progress progress-success progress-striped active">
            <div class="bar" style="font-weight: bold; width: 0;" id="progressbar" aria-valuenow="25"></div>
        </div>
        <div id="recalcularmodalprogresshint">
        </div>
    </div>
</div>
<div class="modal static" id="recalcularmodalcorreo" style="display: none;">
    <div class="modal-header">
        <h3>Envio de Correo <i class="fa fa-certificate"></i></h3>
    </div>
    <div class="modal-body">
        <div style='margin-bottom:1px;height: 20px;background-image: linear-gradient(to bottom, #dde2df, #d7e2dd)'
             class="progress progress-success progress-striped active">
            <div class="bar" style="font-weight: bold; width: 0;" id="progressbar" aria-valuenow="25"></div>
        </div>
        <div id="recalcularmodalprogresshintcorreo">
        </div>
    </div>
</div>


<div class='row-fluid'>
    <div class='span12'>
        <h4>{{ title }}</h4>
        <h5>Periodo: {{ eventoperiodo.periodo }}</h5>
        <h5>Planificación: {{ eventoperiodo.capevento }}</h5>
        <h5>Fecha: {{ eventoperiodo.fechainicio|date:"d-m-Y" }} - {{ eventoperiodo.fechafin|date:"d-m-Y" }}</h5>
    </div>
</div>

<div class="alert alert-block">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <h4>¡Advertencia!</h4>
  Una vez que genere al menos un rubro en el evento académico, ya no podrá modificar su costo.
</div>

    <div class='row-fluid' style="margin-bottom: 15px">
        <div class="span6">
            {#            {% if eventoperiodo.hay_cupo_inscribir %}#}
            {#                <a class="btn  btn-success"#}
            {#                   href="/adm_capeventoperiodoipec?action=addinscribir&id={{ eventoperiodo.id }}"><i#}
            {#                        class="fa fa-plus"></i> Adicionar</a>#}
            {#            {% endif %}#}
            {% if eventoperiodo.hay_cupo_inscribir %}
                <a class="btn  btn-success" href="javascript:void(0)"
                   onclick="formModal('{{ eventoperiodo.id }}','ADICIONAR INSCRITO','addinscribir_modal', '900px')"><i
                        class="fa fa-user-plus"></i> Adicionar </a>

            {% endif %}
            <div class="btn-group">
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="javascript:;">Reportes<span
                        class="caret"></span></a>
                <ul class="dropdown-menu pull-left" style="width: 230px;">
                    <li><a href="/adm_capeventoperiodoipec?action=descargarinscritos&id={{ eventoperiodo.id }}"
                           class="tu reporte"><i class="fa fa-file-excel-o"></i> Reporte en excel de inscritos</a></li>
                    {% if reporte_2 %}
                        <li><a nhref="/reportes?action=run&n={{ reporte_2.nombre }}&codigoevento={{ eventoperiodo.id }}"
                               tipos="{{ reporte_2.tiporeporte }}" class="reportedirecto reporte tu"
                               title="Reporte pdf"><i class="fa fa-print"></i> Reporte en pdf de inscritos</a></li>
                    {% endif %}
                    <li><a href="/adm_capeventoperiodoipec?action=reporte_inscrito_epunemi&id={{ eventoperiodo.id }}"
                           class="tu reporte"
                           title="Reporte pdf"><i class="fa fa-file-pdf-o"></i> Reporte en pdf con rubro en Epunemi</a>
                    </li>
            </div>
            <div class="btn-group" style="margin-right: 5px">
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span
                        class="caret"></span></a>
                <ul class="dropdown-menu pull-left" style="width: 190px;">
                    {% if periodo_ipec >= 2022 %}
                        <li><a href="javascript:void(0);"
                               class="" onclick="notificarmasivo('{{ eventoperiodo.id }}')"><i
                                class="fa fa-envelope"></i> Notificar Masivo</a></li>
                    {% endif %}

                    <li><a href="javascript:void(0);"
                           class="" onclick="notificarmasivocorreo('{{ eventoperiodo.id }}')"><i
                            class="fa fa-key"></i> Notificar credenciales</a></li>

                    {% if periodo_ipec >= 2022 %}
                        <li><a href="javascript:void(0);"
                               class="" onclick="generarreportemasivo('{{ eventoperiodo.id }}')"><i
                                class="fa fa-certificate"></i> Generar certificado masivo</a></li>
                    {% endif %}
                    <li><a href="javascript:;"
                           class="" id="eliminamasivo"><i
                            class="fa fa-trash"></i> Eliminar Deuda Masivo</a></li>
                    <li><a href="javascript:;"
                           class="" id="activamasivo"><i
                            class="fa fa-usd"></i> Activar Deuda Masivo</a></li>
            </div>
            {#            <a class="btn btn-danger" href="/adm_capeventoperiodoipec?action=generarmasivo&id={{ eventoperiodo.id }}"><i class="fa fa-download"></i> Generar Masivo</a>#}
            {#        <a class="btn btn-success" href="javascript:void(0);" onclick="notificarmasivo('{{ eventoperiodo.id }}')"><i#}
            {#                class="fa fa-envelope"></i> Notificar Masivo</a>#}
            {#        <a class="btn btn-info" href="javascript:void(0);" onclick="notificarmasivocorreo('{{ eventoperiodo.id }}')"><i#}
            {#                class="fa fa-key"></i> Notificar credenciales</a>#}
            {#        <a href="javascript:;" class='btn btn-danger' id="eliminamasivo">#}
            {#            <span class="fa fa-trash"></span> Eliminar Deuda Masivo#}
            {#        </a>#}
            {#        <a class="btn btn-info" href="javascript:void(0);" onclick="generarreportemasivo('{{ eventoperiodo.id }}')"><i#}
            {#                class="fa fa-key"></i> Generar certificados</a>#}

        </div>
    </div>

    <div class='row-fluid'>
        <div class="span8">
            <form class="form-search" onsubmit="return busqueda()">
                <input class='searchinput' type='text' id='searchinput' value='{{ search }}' autocomplete="off"/>
                <a href="javascript:;" id='search' class='btn btn-info'><span class="fa fa-search "></span> Buscar</a>
                {% if url_vars %}
                    <a href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}" id='allresults'
                       class='btn btn-info'><span class="fa fa-refresh "></span> Todos</a>
                {% endif %}
            </form>
        </div>
        <div class="span4">
            <select name="m" id="id_estado" style="width: 100%">
                <option value="0" {% if not ide %}selected{% endif %}>----Todos----</option>
                <option {% if ide == 1 %}selected{% endif %} value="1">Contado</option>
                <option {% if ide == 2 %}selected{% endif %} value="2">Diferido</option>
            </select>
        </div>
    </div>

<div class='row-fluid'>
    {#        <div class="span6">#}
    {#            <a href="/adm_capeventoperiodoipec?action=descargarinscritos&id={{ eventoperiodo.id }}" class="btn btn-warning btn-mini"><i class="fa fa-file-excel-o fa-lg"></i> Inscritos</a>#}
    {#            {% if reporte_2 %}#}
    {#                <a href="javascript:;" tipos="{{ reporte_2.tiporeporte }}" nhref="/reportes?action=run&n={{ reporte_2.nombre }}&codigoevento={{ eventoperiodo.id }}" class="reportedirecto btn btn-warning reporte tu" title=" Imprimir Certificado"><i class="fa fa-print"></i> Imprimir Inscritos</a>#}
    {#            {% endif %}#}
    {#        </div>#}

</div>

<div id="no-more-tables"><!-- inicio no more tables-->

    <div class='row-fluid'>
        <div class='span12'>
            <table class='table table-striped table-bordered'>
                <thead>
                <tr>
                    <th style="width: 30px;text-align: center;"> No.</th>
                    <th style="width: 30px;text-align: center;"> Aplica gratuidad</th>
                    <th style="width: 30px;text-align: center;"> Código</th>
                    <th style="width: 350px;text-align: center "> Inscrito</th>
                    <th style="width: 180px;text-align: center;">Observaciones</th>
                    <th style="width: 170px;text-align: center;">Pagos</th>
                    <th style="width: 30px;text-align: center"> Cancelado</th>
                    <th style="width: 100px;text-align: center;">Calificaciones</th>
                    <th style="width: 100px;text-align: center"> Estado</th>
                    <th style="width: 30px; text-align: center">Certificado</th>
                    {% if not eventoperiodo.publicarinscripcion %}
                        <th style="width: 30px; text-align: center">
                            {% if not eventoperiodo.publicarinscripcion %}
                                Particular
                                {#                        {% else %}#}
                                {#                            Unemi#}
                            {% endif %}
                        </th>
                    {% endif %}
                    <th style="width: 30px; text-align: center">
                        Unemi
                    </th>
                    <th style="width: 80px; text-align: center">Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for inscrito in inscritos %}
                <tr>
                    <td style="text-align: center;" data-title='Nª:'>
                        {{ forloop.counter }}
                    </td>
                    <td style="text-align: center;" data-title='Nª:'>
                        <input ids="gratuidad" type="checkbox" name="chksub_{{ inscrito.id }}"
                               id="chksub_{{ inscrito.id }}"
                               onclick="actualizargratuidad({{ inscrito.id }},this,{{ eventoperiodo.id }})"
                               style="vertical-align: middle" value="{{ inscrito.id }}" {% if inscrito.aplicagratuidad == 1 %}checked{% endif %}>
                    </td>
                    <td style="text-align: center;" data-title='Código'>
                        {{ inscrito.id }} <br>
                        {% if inscrito.participante.usuario and not inscrito.participante.usuario.is_superuser %}
                            <i class="fa fa-user"></i> {{ inscrito.participante.usuario }}
                        {% else %}
                            <span class="label label-info tu">USUARIO NO DIPONIBLE</span>
                        {% endif %}
                    </td>
                    <td style="text-align: left; width: auto" data-title='Inscrito'>
                        <div class="media flex-nowrap align-items-center"
                             style="white-space: nowrap;">
                            <div class="avatar avatar-sm mr-8pt" style="width: 60px">
                                {% if inscrito.participante.foto.foto %}
                                <img class="avatar img-circle grupo.matricula.inscripcion.file_info_image img-thumbnail"
                                     src="https://sga.unemi.edu.ec{{ inscrito.participante.foto.foto.url }}"
                                     width="50px">
                                {% else %}
                                {% if inscrito.participante.sexo_id == 1 %}
                                <img class="avatar img-circle grupo.matricula.inscripcion.file_info_image"
                                     src="/static/images/iconos/mujer.png">
                                {% else %}
                                <img class="avatar img-circle grupo.matricula.inscripcion.file_info_image"
                                     src="/static/images/iconos/hombre.png">
                                {% endif %}
                                {% endif %}
                            </div>
                            <div class="media-body" style="width: 140px">
                                <div class="d-flex align-items-center">
                                    <div class="flex d-flex flex-column">
                                        <i class="fa fa-user"></i> {{ inscrito.participante }}<br>
                                        <i class="fa fa-address-card"></i> {{ inscrito.participante.cedula }}
                                        | <i
                                            class="fa fa-phone"></i> {{ inscrito.participante.telefono }}
                                        {% if inscrito.participante.telefono %}
                                            <a href='https://web.whatsapp.com/send?l=en&phone=+593{{ inscrito.participante.telefono }}&text=Hola {{ inscrito.participante }}'
                                               target="_blank" class="btn btn-mini btn-success tu"
                                               title="Enviar mensaje por whatsapp">
                                                <i class="fa fa-whatsapp"></i>
                                            </a>
                                        {% endif %}<br>
                                        {% if inscrito.participante.emailinst %} <i class="fa fa-envelope"></i>
                                            {{ inscrito.participante.emailinst }} <br> {% endif %}
                                        <i class="fa fa-envelope"></i> {{ inscrito.participante.email }} <br>
                                        {% if inscrito.participante.idusermoodleposgrado == 0 %}
                                            <span class="label label-danger">
                                            Usuario no enrolado
                                        </span>
                                        {% endif %}
                                        {% if inscrito.formapago == 2 %}
                                            <span class="label label-warning">
                                            Diferido
                                            </span>
                                        {% else %}
                                            <span class="label label-info">
                                            Contado
                                            </span>
                                        {% endif %}
                                        {% if inscrito.existerubrocurso and inscrito.formapago == 2 %}
                                            <br>
                                            <span class="label label-info">{{ inscrito.cantidad_cuotas }} rubros generados</span>
                                            <span class="label label-success">{{ inscrito.cantidad_cuotas_pagadas }} rubros pagados</span><br>
                                            <span class="label label-warning">{{ inscrito.cantidad_cuotas_por_pagar }} rubros por pagar</span>
                                            <span class="label label-important">{{ inscrito.cantidad_cuotas_vencidas }} rubros vencidos</span>
                                        {% endif %}
                                        <br>
                                        <br>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>

                    <td tyle="text-align: center;" data-title='Observaciones'>
                        {% if inscrito.observacionmanual or archivo %}
                            <label style="padding-top: 5px"><a href="javascript:;" idins="{{ inscrito.id }}"
                                                               class="btn btn-mini btn-warning verobservacioninscripcion tu">
                                <i class='fa fa-eye'></i></a></label>
                        {% endif %}
                    </td>
                    <td style="text-align: center;" data-title='Pagos'>
                        {% if not inscrito.desactivado %}

                            {% if costo %}
                                <span class="label label-info tu">Sin costo</span>
                            {% else %}
                                {% if inscrito.existerubrocurso %}
                                    {% if inscrito.pagorubrocurso %}
                                        <span class="label label-warning">
                                            Pago: {{ inscrito.total_pagado_conrubro|floatformat:"0" }}
                                            </span>
                                    {% endif %}
                                    {#                                    {{ inscrito.total_pagado_rubro|floatformat:"0" }} #}
                                    <span class="label label-success">
                                        {% if inscrito.personalunemi %}
                                            Costo: {{ costoint|floatformat:"0" }}
                                        {% else %}
                                            {#                                            {% if inscrito.es_alumnounemi %}#}
                                            {#                                                {{ eventoperiodo.costo|floatformat:"0" }}#}
                                            {#                                            {% else %}#}
                                            Costo: {{ costoext|floatformat:"0" }}
                                            {#                                            {% endif %}#}
                                        {% endif %}</span>
                                    {#                                {% if inscrito.total_saldo_rubro > 0 %}#}
                                    {% if inscrito.total_valoradeuda > 0 %}
                                        <span class="label label-important ">
                                        saldo: {{ inscrito.total_deuda_edcon|floatformat:"0" }}
                                            </span>
                                    {% endif %}
                                    <br><br>
                                    {% if inscrito.pagorubrocurso %}
                                    {% else %}
                                        <a href="javascript:;" title="Eliminar rubro"
                                           class='btn btn-mini btn-danger tr'
                                           onclick="borrarrubro('{{ inscrito.id }}', '{{ inscrito.participante }}', 'borrar_rubro')"><i
                                                class='fa fa-trash'></i></a>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% if inscrito.existerubrocurso %}
                        <a href="javascript:void(0);" onclick="consultar('consultapagoepunemi','{{ inscrito.participante.id }}', '{{ inscrito.participante }}', '{{ inscrito.capeventoperiodo.id }}', '{{ inscrito.total_pagado_conrubro|floatformat:"0" }}', '{% if inscrito.personalunemi %} {{ costoint|floatformat:"0" }} {% endif %}{% if not inscrito.personalunemi %} {{ costoext|floatformat:"0" }} {% endif %}', '{{ inscrito.pagorubrocurso }}', true)" class="btn btn-info">
                            <i class="fa fa-money"></i>
                            Pagos Epunemi
                        </a>
                        <br>
                        <br>
                        {% if inscrito.rubrofuemigradoaepunemi %}
{#                            <i class="fa fa-refresh" aria-hidden="true"></i>#}
                            <span class="label label-success" title="Rubro migrado a Epunemi">MIGRADO A EPUNEMI</span>
                        {% endif %}
                    {% endif %}
                    </td>
                    <td style="text-align: center" data-title='Cancelado'>
                        <b>
                            {% if not inscrito.desactivado %}
                                {% if costo %}
                                    <span class="label label-info tu">Sin costo</span>
                                {% else %}
                                    {% if inscrito.existerubrocurso %}
                                        {% if inscrito.pagorubrocurso_2 %}
                                            <span class="label label-success">Si</span>
                                        {% else %}
                                            <span class="label label-warning">No</span>
                                        {% endif %}
                                    {% else %}
                                        Falta generar rubro <br><br>
                                        <div class="btn-group">
                                            <a href="javascript:;" title="Generar rubro"
                                               class='btn btn-mini btn-success tr'
                                               onclick="generarubro('{{ inscrito.id }}', '{{ inscrito.participante }}', 'generar_rubro')"
                                               style="margin-right: 8px"><i
                                                    class='fa fa-cogs'></i></a>
                                            <a class="btn btn-mini btn-info tr" href="javascript:void(0)" title="Generar rubros (diferido)"
                                               onclick="formModal('{{ inscrito.id }}','GENERAR RUBROS DE PAGO DIFERIDO','generarrubrodiferido', '350px')"><i
                                                    class="fa fa-cogs"></i></a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                <span class="label label-default">Desactivado por falta de pago</span>
                            {% endif %}
                        </b>
                    </td>
                    <td style="text-align: center;" data-title='Calificaciones'>
                        {% if not inscrito.desactivado %}

                            {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}
                                {{ notatotalinscrito.0.0|floatformat:2 }}<br>
                            {% endwith %}
                        {% endif %}

                    </td>
                    <td style="text-align: center;" data-title='Estado'>
                        {% if not inscrito.desactivado %}
                            {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}
                                <span class="label label-{% if notatotalinscrito.0.1 == 'APROBADO' %}success{% else %}important{% endif %}">{{ notatotalinscrito.0.1 }}</span>
                            {% endwith %}
                        {% endif %}
                    </td>
                    <td style="text-align: center" data-title='Certificado'>
                        {% if not inscrito.desactivado %}

                            {% if inscrito.emailnotificado %}
                                <i class="fa fa-check" style="color: green"></i>
                            {% else %}
                                <i class="fa fa-close" style="color: red"></i>
                            {% endif %}
                        {% endif %}
                    </td>
                    {% if not eventoperiodo.publicarinscripcion %}
                        <td style="text-align: center">
                            {% if not inscrito.desactivado %}

                                {% if not inscrito.capeventoperiodo.publicarinscripcion %}
                                    {% if inscrito.participante.existe_registro_datos_ipec %}
                                        <i class="fa fa-check" style="color: green"></i>
                                    {% else %}
                                        <i class="fa fa-close" style="color: red"></i>
                                    {% endif %}
                                    {#                                {% else %}#}
                                    {#                                    {% if inscrito.personalunemi %}#}
                                    {#                                        <i class="fa fa-check" style="color: green"></i>#}
                                    {#                                    {% else %}#}
                                    {#                                        {% if inscrito.es_alumnounemi %}#}
                                    {#                                            <i class="fa fa-check" style="color: green"></i>#}
                                    {#                                        {% else %}#}
                                    {#                                            <i class="fa fa-close" style="color: red"></i>#}
                                    {#                                        {% endif %}#}
                                    {#                                    {% endif %}#}
                                {% endif %}
                            {% endif %}
                        </td>
                    {% endif %}
                    <td style="text-align: center" data-title='Unemi'>
                        {% if inscrito.personalunemi %}
                            <i class="fa fa-check" style="color: green"></i>
                        {% else %}
                            {% if inscrito.es_alumnounemi %}
                                <i class="fa fa-check" style="color: green"></i>
                            {% else %}
                                <i class="fa fa-close" style="color: red"></i>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td style="text-align: center">
                        {% if not inscrito.desactivado %}
                            <div class="btn-group">
                                        <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown"
                                           href="javascript:;">Acciones<span
                                                class="caret"></span></a>
                                        <ul class="dropdown-menu pull-right" style="text-align: left">
                                            {% if not eventoperiodo.publicarinscripcion %}
                                                <li>
                                                    <a href="/adm_capeventoperiodoipec?action=editpersona&id={{ inscrito.id }}&tipo=2"><span
                                                            class="fa fa-edit "></span> Editar</a></li>
                                            {% endif %}
                                            {% if inscrito.capeventoperiodo.costo > 0 or inscrito.capeventoperiodo.costoexterno > 0 %}
                                                <li><a class="mostrardetalle_view " title="Detalle" href="javascript:;"
                                                       idi="{{ inscrito.id }}"><span class="fa fa-list"></span> Detalle</a>
                                                </li>
                                            {% endif %}
                                            {% if periodo_ipec >= 2022 %}
                                                {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}
                                                    {% if notatotalinscrito.0.1 == 'APROBADO' %}
                                                        {% if inscrito.capeventoperiodo.costo == 0 and inscrito.capeventoperiodo.costoexterno == 0 %}
{#                                                            {% if not inscrito.rutapdf or not inscrito.urlhtmlinsignia %}#}
                                                                <li><a class="certificado_view_pdf" title="Certificado"
                                                                       href="javascript:;" idi="{{ inscrito.id }}"><span
                                                                        class="fa fa-print"></span> Vista previa
                                                                    certificado</a>
                                                                </li>
{#                                                            {% endif %}#}
                                                        {% else %}
{#                                                            {% if not inscrito.rutapdf or not inscrito.urlhtmlinsignia %}#}
                                                                {% if inscrito.cancelo_rubro or inscrito.aplicagratuidad == 1 %}
                                                                    <li><a class="certificado_view_pdf"
                                                                           title="Certificado"
                                                                           href="javascript:;"
                                                                           idi="{{ inscrito.id }}"><span
                                                                            class="fa fa-print"></span> Vista previa
                                                                        certificado</a>
                                                                    </li>
                                                                {% endif %}
{#                                                            {% endif %}#}
                                                        {% endif %}
                                                    {% endif %}
                                                {% endwith %}
                                            {% endif %}
{#                                            {% if periodo_ipec >= 2021 %}#}
                                                {% if inscrito.capeventoperiodo.costo == 0 and inscrito.capeventoperiodo.costoexterno == 0 %}
                                                    {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}
                                                        {% if notatotalinscrito.0.1 == 'APROBADO' %}
                                                            <li><a href='#'
                                                                   onclick="mostrarenvio({{ inscrito.id }})"><span
                                                                    class="fa fa-mail-forward "></span> Generar
                                                                certificado y notificar</a>
                                                            </li>
                                                            {% if periodo_ipec >= 2022 %}
                                                                <li><a href="javascript:;"
                                                                       onclick="generarcertificadosinnotificar('{{ inscrito.id }}')"><span
                                                                        class="fa fa-certificate"></span> Generar
                                                                    certificado</a></li>

                                                                {% if inscrito.rutapdf %}
                                                                    <li><a href="javascript:;"
                                                                           onclick="solonotificarcertificado('{{ inscrito.id }}')"><span
                                                                            class="fa fa-envelope"></span> Notificar certificado</a>
                                                                    </li>
                                                                {% endif %}
                                                            {% endif %}
                                                            {#                                                {% if persona.id == 21966 %}#}
                                                            {#                                                <li><a href="#" onclick="revisarcertificado('{{ inscrito.id }}')"#}
                                                            {#                                                       class="fa fa-"><span class="fa fa-cog"></span> Revisar certificado</a>#}
                                                            {#                                                </li>#}
                                                            {#                                                {% endif %}#}
                                                        {% endif %}
                                                    {% endwith %}
                                                {% else %}
                                                    {% if inscrito.cancelo_rubro %}
                                                        {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}
                                                            {% if notatotalinscrito.0.1 == 'APROBADO' %}
                                                                <li><a href='#'
                                                                       onclick="mostrarenvio({{ inscrito.id }})"><span
                                                                        class="fa fa-mail-forward"></span> Generar
                                                                    certificado y notificar</a>
                                                                </li>
                                                                {% if periodo_ipec >= 2022 %}
                                                                    <li><a href="javascript:;"
                                                                           onclick="generarcertificadosinnotificar('{{ inscrito.id }}')"><span
                                                                            class="fa fa-certificate"></span> Generar
                                                                        certificado</a></li>
                                                                    {% if inscrito.rutapdf %}
                                                                        <li><a href="javascript:;"
                                                                               onclick="solonotificarcertificado('{{ inscrito.id }}')"><span
                                                                                class="fa fa-envelope"></span> Notificar
                                                                            certificado</a></li>
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endwith %}
                                                    {% else %}
                                                        {% if inscrito.aplicagratuidad == 1 %}
                                                            {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}
                                                                {% if notatotalinscrito.0.1 == 'APROBADO' %}
                                                                    <li><a href='#'
                                                                           onclick="mostrarenvio({{ inscrito.id }})"><span
                                                                            class="fa fa-mail-forward"></span> Generar
                                                                        certificado y notificar</a>
                                                                    </li>
                                                                    {% if periodo_ipec >= 2022 %}
                                                                        <li><a href="javascript:;"
                                                                           onclick="generarcertificadosinnotificar('{{ inscrito.id }}')"><span
                                                                            class="fa fa-certificate"></span> Generar
                                                                        certificado</a></li>
                                                                        {% if inscrito.rutapdf %}
                                                                            <li><a href="javascript:;"
                                                                                   onclick="solonotificarcertificado('{{ inscrito.id }}')"><span
                                                                                    class="fa fa-envelope"></span> Notificar
                                                                                certificado</a></li>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% endwith %}
                                                        {% endif %}
                                                    {% endif %}
                                                {% endif %}
{#                                            {% endif %}#}
{#                                <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown"#}
{#                                   href="javascript:;">Acciones xx<span#}
{#                                        class="caret"></span></a>#}
{#                                <ul class="dropdown-menu pull-right" style="text-align: left">#}
{#                                    {% if not eventoperiodo.publicarinscripcion %}#}
{#                                        <li>#}
{#                                            <a href="/adm_capeventoperiodoipec?action=editpersona&id={{ inscrito.id }}&tipo=2"><span#}
{#                                                    class="fa fa-edit "></span> Editar</a></li>#}
{#                                    {% endif %}#}
{#                                    {% if inscrito.capeventoperiodo.costo > 0 or inscrito.capeventoperiodo.costoexterno > 0 %}#}
{#                                        <li><a class="mostrardetalle_view " title="Detalle" href="javascript:;"#}
{#                                               idi="{{ inscrito.id }}"><span class="fa fa-list"></span> Detalle</a>#}
{#                                        </li>#}
{#                                    {% endif %}#}
{#                                    {% if periodo_ipec >= 2022 %}#}
{#                                        {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}#}
{#                                            {% if notatotalinscrito.0.1 == 'APROBADO' %}#}
{#                                                {% if inscrito.capeventoperiodo.costo == 0 and inscrito.capeventoperiodo.costoexterno == 0 %}#}
{#                                                    {% if not inscrito.rutapdf or not inscrito.urlhtmlinsignia %}#}
{#                                                        <li><a class="certificado_view_pdf" title="Certificado"#}
{#                                                               href="javascript:;" idi="{{ inscrito.id }}"><span#}
{#                                                                class="fa fa-print"></span> Vista previa certificado</a>#}
{#                                                        </li>#}
{#                                                    {% endif %}#}
{#                                                {% else %}#}
{#                                                    {% if not inscrito.rutapdf or not inscrito.urlhtmlinsignia %}#}
{#                                                        {% if inscrito.cancelo_rubro %}#}
{#                                                            <li><a class="certificado_view_pdf" title="Certificado"#}
{#                                                                   href="javascript:;" idi="{{ inscrito.id }}"><span#}
{#                                                                    class="fa fa-print"></span> Vista previa certificado</a>#}
{#                                                            </li>#}
{#                                                        {% endif %}#}
{#                                                    {% endif %}#}
{#                                                {% endif %}#}
{#                                            {% endif %}#}
{#                                        {% endwith %}#}
{#                                    {% endif %}#}
{#                                    {% if periodo_ipec >= 2022 %}#}
{#                                        {% if inscrito.capeventoperiodo.costo == 0 and inscrito.capeventoperiodo.costoexterno == 0 %}#}
{#                                            {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}#}
{#                                                {% if notatotalinscrito.0.1 == 'APROBADO' %}#}
{#                                                    <li><a href='#' onclick="mostrarenvio({{ inscrito.id }})"><span#}
{#                                                            class="fa fa-mail-forward "></span> Generar certificado y notificar</a>#}
{#                                                    </li>#}
{#                                                    <li><a href="javascript:;" onclick="generarcertificadosinnotificar('{{ inscrito.id }}')"><span#}
{#                                                        class="fa fa-certificate"></span> Generar certificado</a></li>#}
{#                                                    <li><a href="javascript:;" onclick="solonotificarcertificado('{{ inscrito.id }}')"><span#}
{#                                                        class="fa fa-envelope"></span> Notificar certificado</a></li>#}
    {#                                                {% if persona.id == 21966 %}#}
    {#                                                <li><a href="#" onclick="revisarcertificado('{{ inscrito.id }}')"#}
    {#                                                       class="fa fa-"><span class="fa fa-cog"></span> Revisar certificado</a>#}
    {#                                                </li>#}
    {#                                                {% endif %}#}
{#                                                {% endif %}#}
{#                                            {% endwith %}#}
{#                                        {% else %}#}
{#                                            {% if inscrito.cancelo_rubro %}#}
{#                                                {% with notatotalinscrito=inscrito|call:"instructor_notasfinales" %}#}
{#                                                    {% if notatotalinscrito.0.1 == 'APROBADO' %}#}
{#                                                        <li><a href='#' onclick="mostrarenvio({{ inscrito.id }})"><span#}
{#                                                                class="fa fa-mail-forward"></span> Generar certificado y notificar</a>#}
{#                                                        </li>#}
{#                                                        <li><a href="javascript:;" onclick="solonotificarcertificado('{{ inscrito.id }}')"><span#}
{#                                                        class="fa fa-envelope"></span> Notificar certificado</a></li>#}
{#                                                    {% endif %}#}
{#                                                {% endwith %}#}
{#                                            {% endif %}#}
{#                                        {% endif %}#}
{#                                    {% endif %}#}


                                    {% if inscrito.rutapdf %}
                                        <li><a target="_blank" href="{{ inscrito.download_link }}?v={{ version }}"><span
                                                class="fa fa-print"></span> Descargar certificado</a></li>
                                    {% endif %}
                                    {% if inscrito.cancelo_rubro or not eventoperiodo.generarrubro %}
                                        <li><a href='#' onclick="notificarindividualcorreo('{{ eventoperiodo.id }}','{{ inscrito.id }}')"><span
                                                class="fa fa-mail-forward "></span> Notificar credencial</a>
                                        </li>
                                    {% endif %}
                                    {% if not inscrito.cancelo_rubro %}
                                        <li><a href="javascript:;"
                                               nhref="/adm_capeventoperiodoipec?action=delinscrito&id={{ inscrito.id }}"
                                               class="eliminacionmodal"><span class="fa fa-minus"></span>
                                            Eliminar</a>
                                        </li>
                                    {% endif %}
                                    {#                                    {% endif %}#}

                                    {% if inscrito.cancelo_rubro %}
                                        <li>
                                            <a href="/adm_capeventoperiodoipec?action=moverinscrito&id={{ inscrito.id }}"><span
                                                    class="fa fa-refresh"></span> Mover</a></li>
                                    {% endif %}
                                    <li>
                                        <a href="/adm_capeventoperiodoipec?action=observacioninscripcion&id={{ inscrito.id }}&tipo=2"><span
                                                class="fa fa-list "></span> Observación</a></li>

                                    {% if not inscrito.participante.usuario.is_superuser and inscrito.participante.usuario %}
                                    <li><a class="confirmacionmodal" href="javascript:;"
                                           nhref="/adm_capeventoperiodoipec?action=resetearusu&id={{ inscrito.id }}"><i
                                            class="fa fa-key"></i> Resetear Clave Usuario</a></li>
                                    {% endif %}
                                </ul>
                            </div>

                        {% else %}

                            <a href="javascript:;" cod_inscrito='{{ inscrito.id }}'
                               class="activar_inscrito btn btn-success btn-mini"><span class="fa fa-check"></span></a>

                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="10">NO EXISTEN INSCRITOS REGISTRADOS</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class='row-fluid'>
    {% if paging.num_pages > 20 %}
        <div class='pagination'>
            <ul>
                {% if paging.primera_pagina %}
                    <li><a href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&page=1">1</a>
                    </li>
                    <li>
                        <a href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&apage={{ paging.ellipsis_izquierda }}"
                           class="active">...</a></li>
                {% endif %}
                {% for pagenumber in paging.paginas %}
                    <li {% if pagenumber == page.number %}class='active'{% endif %}><a
                            href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&page={{ pagenumber }}">{{ pagenumber }}</a>
                    </li>
                {% endfor %}
                {% if paging.ultima_pagina %}
                    <li>
                        <a href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&page={{ paging.ellipsis_derecha }}"
                           class="active">...</a></li>
                    <li>
                        <a href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&page={{ paging.num_pages }}">{{ paging.num_pages }}</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    {% else %}
        <div class='pagination'>
            <ul>
                {% for pagenumber in paging.page_range %}
                    <li {% if pagenumber == page.number %}class='active'{% endif %}><a
                            href="/adm_capeventoperiodoipec?action=inscritos&id={{ eventoperiodo.id }}&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>
<div class="modal fade static" id="itemspanel" style="display: none;">
    <div class="modal-header">
        <h3 class="paneltitle">Mostrar detalles del solicitud</h3>
    </div>
    <div class="modal-body panelbody">
    </div>
    <div class="modal-footer">
        <table class="pull-right">
            <tr>
                <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
            </tr>
        </table>
    </div>
</div>
<div class="modal fade static" id="modalnotoficacion" style="display: none;">
    <div class="modal-header">
        <h4 id="paneltitle">Generar certificado y envío de email</h4>
        <h4 id="idnombrespostulante"></h4>
    </div>
    <div class="modal-body notoficacionbody">
        {#        <div class="alert alert-danger">#}
        {#            <h4 class="alert-heading">ALERTA</h4>#}
        {#            Al dar clic en Aceptar, se eliminará la inscripción en la cual aplicó.#}
        {#        </div>#}
        <p style="margin-top: 16px;">Esta seguro(a) que desea enviar email?</p>
        <input type="hidden" id="idinscripcioncohorte" name="idinscripcioncohorte">
    </div>
    <div class="modal-footer">
        <p style="text-align: right; margin-bottom: 0">
            <a href="javascript:;" id="boton_notoficacionaprobada" class='btn btn-success'> Generar certificado y
                enviar email</a>
            <a href="javascript:;" id="cancel_notoficacioncancela" class='btn btn-default'> Cancelar</a>
        </p>
    </div>
</div>

<div class="modal fade static" id="modalobservacion" style="display: none;">
    <div class="modal-header">
        <h3 class="paneltitle">Observaciones</h3>
    </div>
    <div class="modal-body panelbodyobservacion">
    </div>
    <div class="modal-footer">
        <table class="pull-right">
            <tr>
                <td><a href="javascript:;" class="btn btn-default cerrar_modalobservacion">Cerrar</a></td>
            </tr>
        </table>
    </div>
</div>

<div class="modal fade" id="modalConsulta" >
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="frmConsulta" method="post" enctype="multipart/form-data" >{% csrf_token %}
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><b id="nombre"></b></h4>
                </div>
                <div class="modal-body tablaaqui">
                </div>
                <div class="modal-footer" id="footerModalView">

                    <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i
                            class="fa fa-window-close"></i>
                        Cerrar</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}


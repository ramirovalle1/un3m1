{% extends "at_activostecnologicos/base_activostecnologicos.html" %}
{% block atras %}/gestion_operaciones{% endblock %}
{% load sga_extras %}
{% block extraJs %}
    <script src="/static/adicionalesjs/formquestionb4.js?0.24"></script>
    <link rel="stylesheet" href="/static/css/bloques.css">
    <script type="text/javascript" src="/static/ckeditor/ckeditor-init.js?v=1.0.1"
            data-ckeditor-basepath="/static/ckeditor/ckeditor/" id="ckeditor-init-script"></script>
    <script type="text/javascript" src="/static/ckeditor/ckeditor/ckeditor.js?v=1.0.1"></script>
    <script>
        function formModal(idp, id, text, action, dimension = 'modal-lg', footer = true, idex = '') {
            bloqueointerface()
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                    'idp': idp,
                    'idex': idex,
                },
                success: function (data) {
                    $.unblockUI();
                    footer ? $('#footermodal').hide() : $('#footermodal').show();
                    $('#wmodal').removeClass('modal-lg modal-sm modal-xl modal-md modal-fullscreen').addClass(dimension)
                    if (data.result === true) {
                        $('#itemspanel .panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(`<i class="fa fa-list-ol"></i> ${text}`);
                        $("#itemspanel").modal({backdrop: 'static'}).modal('show');
                    } else {
                        mensajeDanger(data.message);
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeDanger("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function repallpdfactivotodos() {
            var cadena = $("#estados_cat").val()
            var url = "/at_activostecnologicos?action=pdflistadoactivostodos&cadenatexto=" + cadena;
            {#$(location).attr('href', url);#}
            window.open(url, '_blank');
        }

        function excelactivotodos() {
            var cadena = $("#estados_cat").val()
            var url = "/at_activostecnologicos?action=excellistadoactivos&cadenatexto=" + cadena;
            {#$(location).attr('href', url);#}
            window.open(url, '_blank');
        }

        function reporteinforme(tpreporte) {
            $('#id_action').val(tpreporte)
            valuelist_ = $('#estados_cat').val();
            valuelistestado = $('#estados_list').val();
            s = $('#searchinput').val();
            $('#id_lista').val(valuelist_)
            $('#id_lista_estado').val(valuelistestado)
            $('#id_s').val(s)
            $('#id_action').val(tpreporte)
            $("#repinforme").modal({backdrop: 'static', width: '600px'}).modal('show');
        }

        function enviarFormulario(accion) {
            var action = accion
            var lista = $('#estados_cat').val();
            var estado = $('#estados_list').val();
            var s = $('#searchinput').val();
            console.log(accion, lista, estado, s)
            var url = "/at_activostecnologicos?action=" + action + "&cadenatexto=" + lista + "&estado=" + estado + "&s=" + s;
            window.open(url, '_blank');
        }


        $(function () {
            $("#estados_list").select2({width: '100%'});
            $("#estados_cat").select2({width: '100%'});

            {% if persona_r %}
                $('#id_responsable').append(`<option name="responsable" value="{{ persona_r.id }}" selected>
                <div class="wrapper container"><div class="row"><div class="col-lg-2 text-center">
                <img src="{{ persona_r.get_foto }}" width="25px" height="25px" class="w-25px rounded-circle me-2"><span>{{ persona_r.nombre_completo }}</span></option></div></div></div>`)
            {% endif %}

            $(".detalleactivo").click(function () {
                var id = $(this).attr("cid");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/at_activostecnologicos",
                    data: {'action': 'detalle_activo', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#detalleconsmodal_body").html(data.html);
                            $("#detalleconsmodal").modal({"backdrop": "static", "width": "1000px"}).modal("show");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#detalleconsmodal_aceptar").click(function () {
                $("#detalleconsmodal").modal("hide");
            });

            $(".detalleactivo1").click(function () {
                var id = $(this).attr("cid");
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/at_activostecnologicos",
                    data: {'action': 'detalle_activo', 'id': id},
                    success: function (data) {
                        console.log(id);
                        $.unblockUI();
                        if (data.result === true) {
                            console.log('correcto');
                            $("#detalleactivomodal_body").html(data.data);
                            $("#detalleactivomodal").modal({"backdrop": "static", "width": "1000px"}).modal("show");
                        } else {
                            mensajeDanger(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
                return false;
            });
            $(".generaqrmd").click(function () {
                var id = $(this).attr("cid");
                var ids = $(this).attr("ids");
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/at_activostecnologicos",
                    data: {'action': 'generarcodigoqrtic', 'id': id, 'ids': ids},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {

                            $("#qrmodal_body").html(data.html);

                            // $("#qrmodal .modal-content").css({"position": "Center","width": "400px", "height": "400px"});
                            // $("#qrmodal").modal("show");
                            $("#qrmodal .modal-content").css({
                                "position": "absolute",
                                "top": "50%",
                                "left": "50%",
                                "transform": "translate(-50%, 20%)",
                                "width": "400px",
                                "height": "400px"
                            });
                            $("#qrmodal").modal("show");
                            // $("#qrmodal").modal({
                            //     backdrop: 'static',
                            //     keyboard: false,
                            //     width: "1076 px",
                            //     maxHeight: "1076 px",
                            // });
                            // $("#qrmodal").modal("show");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
                return false;
            });

            $("#detalleactivomodal_aceptar1").click(function () {
                $("#detalleactivomodal").modal("hide");
            });


            $(".reportedirecto").click(function () {
                var tipos = $(this).attr("tipos");
                var n = $(this).attr("n");
                var id = $(this).attr("id");
                var usuario = $(this).attr("usuario");
                $('#tipos_reporte').val(tipos);
                $('#n_reporte').val(n);
                $('#id_reporte').val(id);
                $('#usuario_reporte').val(usuario);
                $("#formatoreporte .panelbody").html(data.html);
                $("#formatoreporte").modal({"backdrop": "static", "width": "1000px"}).modal("show");
            });

            $.fn.select2.defaults.set('language', 'es');
            const cbPersona = $('#id_responsable');

            function formatRepo(repo) {
                if (repo.loading) {
                    return 'Buscando..'
                }
                var option = '';
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    option = $(`<b>${repo.text}</b>`);
                } else {
                    option = $(`<div class="wrapper container"><div class="row"><div class="col-lg-2 text-center"><img src="${repo.foto}" width="50px" height="50px" class="w-25px rounded-circle me-2"></div><div class="col-lg-10 text-left"><b>Documento:</b> ${repo.documento}<br><b>Nombres:</b> ${repo.text}<br></div></div></div>`);
                }
                return option;
            }

            ItemsDisplayPersonas = function (item) {
                if (item.text && item.documento) {
                    return $(`<span>${item.text}</span>`);
                } else if (item) {
                    return item.text;
                } else {
                    return 'Consultar Personas';
                }
            };

            cbPersona.select2({
                width: '100%',
                placeholder: "Consultar reponsables",
                allowClear: true,
                ajax: {
                    url: function (params) {
                        return `{{ reques.path }}?action=buscarpersonasactivos&q=${params.term}`;
                    },
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term,
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {
                        params.page = params.page || 1;
                        return {
                            results: data.results,
                            pagination: {
                                more: (params.page * 30) < data.total_count
                            }
                        };
                    },
                    cache: true
                },
                escapeMarkup: function (markup) {
                    return markup;
                }, // let our custom formatter work
                minimumInputLength: 1,
                templateResult: formatRepo, // omitted for brevity, see the source of this page
                templateSelection: ItemsDisplayPersonas // omitted for brevity, see the source of this page
            });
        });

    </script>

    <script>
        function solicitudaajax_mio(pk, nombre, accion, url, titulo) {
            Swal.fire({
                title: `${titulo}\n ${nombre}`,
                text: "Esta acción es irreversible",
                type: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: {action: accion, id: pk,},
                        success: function (data) {
                            if (data.result == 'ok') {
                                location.reload();
                            } else {
                                Swal.fire({
                                    title: `Advertencia`,
                                    text: data.mensaje,
                                    type: 'warning',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                })
                            }
                        },
                        error: function () {
                            setTimeout($.unblockUI, 1);
                            mensajeWarning("Error de conexión.");
                        },
                        dataType: "json"
                    });
                }
            })
        }
    </script>

    <script>
        $(function () {
            $('.activobaja').click(function () {
                var id = $(this).attr('ida');
                var valor;
                if ($(this).is(':checked')) {
                    valor = 'y';
                } else {
                    valor = 'n';
                }
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "{{ request.path }}",
                    data: {'action': 'iniciabaja', 'id': id, 'val': valor},
                    success: function (data) {
                        if (data.result === 'ok') {
                            $.unblockUI();
                        } else {
                            $.unblockUI();
                            if (valor === 'y') {
                                $("#ch_" + id).prop('checked', false);
                            } else {
                                $("#ch_" + id).prop('checked', true);
                            }
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        if (valor === 'y') {
                            alert();
                            $("#ch_" + id).prop('checked', false);
                        } else {
                            $("#ch_" + id).prop('checked', true);
                        }
                        smoke.alert("Error al enviar los datos.");
                    },
                    dataType: "json"
                });
            });
        });
    </script>
    <style>
        .btn-close {
            margin: -8px -3px -0rem auto !important;
        }
    </style>
{% endblock %}
{% block filtros %}
<div class="mb-1">
                <label for=""><i class="fa fa-laptop"></i> Categoria:</label>
                <select name="codigo" id="estados_cat" style="width: 260px" class="noselect2">
                    <option value="0">Todos</option>
                    {% for grupo in grupocatalogo %}
                        <option {% if grupo.id == codigo %}selected{% endif %}
                                value="{{ grupo.id }}">{{ grupo|lower|capfirst }}</option>
                    {% endfor %}
                </select>
            </div>
<div class="mb-1">
    <label for=""><i class="fa fa-traffic-light"></i> Estado:</label>
    <select name="estado" id="estados_list" style="width: 260px" class="noselect2">
        <option value="">Todos</option>
        {% for tc in estados %}
            <option {% if tc.id == estado %}selected{% endif %}
                    value="{{ tc.id }}">{{ tc.nombre|title }}</option>
        {% endfor %}
        <option value="informebaja" {% if 'informebaja' == estado %}selected{% endif %}>Informe Baja</option>
    </select>
</div>
<div class="mb-1">
    <label for=""><i class="fa fa-users"></i> Responsable:</label>
    <select name="responsable" id="id_responsable">
        <option value=""></option>
    </select>
</div>
{% endblock %}

{% block content %}
    <div class="row mb-2">
        <div class="col-lg-4">
            <a href="/at_activostecnologicos?action=add" id='nuevoactivotecnologico'
               class='btn btn-success'><i class="fa fa-plus "></i> Adicionar</a>
            <button id="btnGroupDrop1" type="button" class="btn btn-default dropdown-toggle"
                                data-bs-toggle="dropdown" aria-expanded="false"><i class="fa fa-list-alt"></i> Reportes <i
                                class="fa fa-angle-down"></i>
                        </button>
            <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                <li><a id='reporteexcel' href='javascript:void(0)'
                       onclick="enviarFormulario('excellistadoactivos_1')" class="dropdown-item "><i
                        class="fa fa-file-excel " style="margin-right: 5px;"></i> Exportar a Excel
                </a></li>
                <li>
                    <a id='reporteexcel' href="{{ request.path }}?action=excelcategorias" class="dropdown-item "><i
                        class="fa fa-file-excel " style="margin-right: 5px;"></i> Reporte de categorias</a>
                </li>

                <li><a id="descarga-docentes" href='javascript:void(0)'
                       onclick="reporteinforme('pdflistadoactivos')" class="dropdown-item "><i
                        class="fa fa-file-pdf " style="margin-right: 5px;"></i> Informe Pdf de Activos
                    (Vigentes)
                </a></li>

                <li><a id="descarga-docentes" href='javascript:void(0)'
                       onclick="reporteinforme('pdflistadoactivosinactios')" class="dropdown-item "><i
                        class="fa fa-file-pdf " style="margin-right: 5px;"></i> Informe Pdf de Activos (Dados de
                    baja)
                </a></li>

            </ul>
        </div>
        <div class='col-lg-8 text-end'>
            <p>
                <b><i class="fa fa-certificate"></i> Total activos: | </b>
                <span class="badge bg-primary">{{ totalregistros }}</span> |
                Con garantía: <span class="badge bg-success">{{ total_garantia }}</span> |
                Sin garantía: <span class="badge bg-success">{{ total_sin_garantia }}</span>
            </p>
            <p>
                Informe baja: <span class="badge bg-warning">{{ total_infome }} </span> |
                Proceso baja: <span class="badge bg-danger">{{ total_baja }}</span>
            </p>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-body border-top border-6 rounded-3 border-dark-info">
            <div class="">
                <table class="table table-bordered table-striped tabla_responsive">
                    <thead>
                    <tr class="table-light cabecera-fija">
                        <th class="text-center"><i class="fa fa-barcode"></i>
                            Códigos
                        </th>
                        <th class="text-center"><i class="fa fa-comment"></i>
                            Descripción
                        </th>
                        <th class="text-center"><i class="fa fa-user-tie"></i>
                            Responsable
                        </th>
                        <th class="text-center"><i class="fa fa-map"></i> Ubicación
                        </th>
                        <th class="text-center"><i class="fa fa-file-pdf"></i> Baja
                        </th>
                        <th class="text-center"><i class="fa fa-cogs"></i></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for listado in activos %}
                        <tr>
                            <td class="w-15 align-middle">
                                {% if listado.codigotic %}
                                    <p>
                                        <b>Tics: </b> {{ listado.codigotic }}
                                    </p>
                                {% endif %}
                                {% if listado.activotecnologico.codigogobierno %}
                                    <p>
                                        <b>Gobierno: </b>{{ listado.activotecnologico.codigogobierno }}
                                    </p>
                                {% endif %}
                                {% if listado.activotecnologico.codigointerno %}
                                    <p>
                                        <b>Interno: </b>{{ listado.activotecnologico.codigointerno }}
                                    </p>
                                {% endif %}
                             {% if listado.tiene_garantia %}
                                <label class="text-success">Garantía</label>
                                {% endif %}
                            </td>
                            <td class=" align-middle">
                                <div class="row">
                                    <div class="col">
                                        <a class="text-body detalleactivo1"
                                           cid="{{ listado.activotecnologico.id }}"
                                           href="javascript:void(0);">
                                            <div class="d-flex">
                                                <div class="ms-3">
                                                    <p class="mb-1">
                                                        <b>Modelo: </b>{{ listado.activotecnologico.modelo }}
                                                        {% if listado.activotecnologico.statusactivo == 2 %}
                                                            | <span class="badge bg-danger" title="Baja">Baja</span>
                                                        {% endif %}
                                                    </p>
                                                    <p class="mb-3 fs-6">
                                                        {{ listado.activotecnologico.descripcion }}
                                                    </p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
{#                                    <div class="col-auto text-center me-2">#}
{#                                        <a href="javascript:void(0)"#}
{#                                           class="badge-dot bg-info detalleactivo1"#}
{#                                           cid="{{ listado.activotecnologico.id }}"#}
{#                                           data-bs-toggle="tooltip" data-bs-placement="top" title=""#}
{#                                           data-bs-original-title="Detalle de activo">#}
{#                                        </a>#}
{#                                    </div>#}

                                    <div class="col-auto text-center me-2 v-align-middle justify-content-center">
                                        <a href="javascript:void(0)"
                                           cid="{{ listado.activotecnologico.id }}"
                                           class="detalleactivo1"
                                           data-bs-toggle="tooltip" data-bs-placement="top" title=""
                                           data-bs-original-title="Detalle de activo">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17"
                                                 fill="currentColor"
                                                 class="bi bi-info-circle-fill me-2" viewBox="0 0 16 16">
                                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
                                            </svg>
                                        </a>
                                    </div>
                                
                                </div>
                            </td>
                            <td class="text-center align-middle">
                                <div class="seleccionados"
                                     idsele="{{ listado.id }}">{{ listado.activotecnologico.responsable.nombre_completo_minus|default_if_none:"" }}
                                </div>
                            </td>
                            <td class="text-center align-middle"> {{ listado.activotecnologico.ubicacion|title2|default_if_none:"" }} <br>


                            </td>
                            <td class="text-center align-middle">
                                <b>Informe:</b>
                                {% if not listado.documento_informebaja %}
                                    No
                                {% else %}
                                    <a href="{{ listado.documento_informebaja.archivo.url }}" target="_blank"><i
                                            class="fa fa-file-pdf-o text-danger"></i></a>
                                    <br>
                                    <span class="text-{{ listado.documento_informebaja.color_estado }}">{% if listado.documento_informebaja.estadofirma  %}{{ listado.documento_informebaja.get_estadofirma_display }}{% else %}No actualizado{% endif %}</span>

                                {% endif %}
                                <br>
                                <b>Proceso de baja:</b>
                                {% if not listado.activotecnologico.procesobaja %}
                                    No
                                {% else %}
                                    <label class="label label-warning">Si</label>
                                {% endif %}
                            </td>
                            <td class="text-center w-5 align-middle">
                                <div class="dropdown">
                                    <div class="dropdown dropleft">
                                        <a href="javascript:void(0);"
                                           class="btn-icon btn btn-ghost btn-sm rounded-circle"
                                           data-bs-toggle="dropdown" data-offset="-140" aria-haspopup="true"
                                           aria-expanded="false">
                                            <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                        </a>
                                        <ul class="dropdown-menu">
                                            {% if perms.sagest.puede_gestionar_informeactivo_tecnologico %}
                                                {% if not listado.activotecnologico.existeinformebaja %}
                                                    <li class="dropdown-item">
                                                        <a href="javascript:void(0);"
                                                           onclick="formModal('{{ listado.activotecnologico.id|encrypt }}','{{ listado.id|encrypt }}','CREAR INFORME DE BAJA','addinformebaja')">
                                                            <i class="fa fa-leaf"></i> Ingreso informe baja
                                                        </a>
                                                    </li>
                                                {% elif not listado.firmo_director and listado.activotecnologico.existeinformebaja.responsable.id == persona.id %}
                                                    {% with puedefirmar=listado.activotecnologico|args:'AT'|call:'existe_directorresponsablebaja' %}
                                                        {% if puedefirmar %}
                                                            <li class="dropdown-item">
{#                                                                <a href="javascript:void(0);"#}
{#                                                                   onclick="formModal('{{ listado.activotecnologico.id|encrypt }}','{{ list.id|encrypt }}','Informe de baja','editinformebaja')">#}
{#                                                                    <i class="fa fa-leaf"></i> Editar informe baja#}
{#                                                                </a>#}
                                                                <a href="javascript:void(0);"
                                                                   onclick="formModalBase('{{ listado.activotecnologico.id|encrypt }}','Editar informe de baja - {{ list.informe.activofijo.codigogobierno }}','editinformebaja', '')"
                                                                  ><i class="fa fa-leaf"></i>
                                                                    Editar informe baja</a>
                                                            </li>
{#                                                            <li class="dropdown-item">#}
{#                                                                <a href="javascript:void(0);"#}
{#                                                                   onclick="formModalReport('{{ listado.activotecnologico.id|encrypt }}','Firmar informe de baja de {{ listado.informe_baja.solicita.nombre_completo_minus }}','firmarinformebaja')">#}
{#                                                                    <i class="fa fa-signature"></i> Firmar informe baja#}
{#                                                                </a>#}
{#                                                            </li>#}
                                                            <li class="dropdown-item">
                                                                <a href="javascript:void(0);"
                                                                   onclick="formModalBase('{{ listado.activotecnologico.existeinformebaja.id|encrypt }}','Firmar informe de baja - {{ listado.activotecnologico.codigogobierno }}','firmarinformebajanuevo','','modal-md')"
                                                                   ><i
                                                                        class="fa fa-signature "></i> Firmar informe baja</a>
                                                            </li>
{#                                                            <li class="dropdown-item">#}
{#                                                                <a href="javascript:void(0);"#}
{#                                                                   onclick="formModal('','{{ listado.activotecnologico.id|encrypt }}','Subir informe de baja firmado','subirinforme','modal-md')">#}
{#                                                                    <i class="fa fa-upload"></i> Subir informe de baja#}
{#                                                                </a>#}
{#                                                            </li>#}
                                                            <li class="dropdown-item">
                                                                <a
                                                                   href="javascript:void(0);"
                                                                   onclick="formModalBase('{{ listado.activotecnologico.id }}','SUBIR ARCHIVO DE BAJA', 'addarchivobaja','', 'modal-md')">
                                                                    <i class='fa fa-upload'></i>
                                                                    Subir informe de baja firmado
                                                                </a>
                                                            </li>
                                                        {% endif %}
                                                    {% endwith %}
                                                {% endif %}
                                            {% endif %}
                                            <li class="dropdown-item">
                                                <a href="/at_activostecnologicos?action=solicitudtraspaso&id={{ listado.id }}"
                                                   ;>
                                                    <i
                                                            class="fa fa-user"></i> Traspaso </a>
                                            </li>
                                            <li class="dropdown-item"><a
                                                    href="/at_activostecnologicos?action=historialtraspaso&id={{ listado.activotecnologico.id }}"
                                                    ;><i
                                                    class="fa fa-history"></i> Historial de traspasos asignados </a>
                                            </li>
                                            <li class="dropdown-submenu dropdown-item pull-left"><a
                                                    style="cursor:pointer;"><i
                                                    class="fa fa-paperclip"></i> Solicitudes </a>
                                                <ul class="dropdown-menu" style="width: 100%;">
                                                    <li class="dropdown-item" style="text-align: left;"><a
                                                            href="/at_activostecnologicos?action=solicitudestraspasoresponsable&id={{ listado.activotecnologico.responsable }}"
                                                            ;><i
                                                            class="fa fa-paperclip"></i> Solicitud al
                                                        responsable</a></li>
                                                    <li class="dropdown-item" style="text-align: left;"><a
                                                            href="/at_activostecnologicos?action=solicitudespendientesactivos&id={{ listado.activotecnologico.responsable }}"
                                                            ;><i
                                                            class="fa fa-paperclip"></i> Solicitud al posible
                                                        responsable</a></li>
                                                    <li class="dropdown-item" style="text-align: left;"><a

                                                            href="/at_activostecnologicos?action=solicitudespendientestraspasos&id={{ listado.activotecnologico.responsable }}"
                                                            ;><i
                                                            class="fa fa-paperclip"></i> Solicitud de traspaso por
                                                        confirmar</a>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li class="dropdown-item">
                                                <a class=" generaqrmd tu" title="CodigoQr" href='javascript:;'
                                                   cid="{{ listado.activotecnologico.id }}"
                                                   ids="{{ listado.codigotic }}"> <i class='fa fa-list'></i> Generar
                                                    código qr</a>
                                            </li>
                                            {% if listado.activotecnologico.statusactivo != 2 %}
                                                <li class="dropdown-item"><a id="btnNotificar" href='javascript:;'
                                                                             onclick="formModal({{ listado.activotecnologico.responsable.id }},{{ listado.pk }},'ENVIAR NOTIFICACIÓN A {{ listado.activotecnologico.responsable }}' ,'notificarresponsabledebien','modal-lg')">
                                                    <i class="fa fa-paper-plane"></i> Enviar notificación de activo</a>
                                                </li>
                                            {% endif %}
                                            <li>
                                                {% if not listado.activotecnologico.documento_activobaja_at %}
                                                    <a href="javascript:void(0);"
                                                       onclick="formModalBase('{{ listado.activotecnologico.id|encrypt }}','Verificación Técnica','verificaciontecnica','','modal-lg')"
                                                       class="dropdown-item"><i
                                                            class="bi bi-person-fill-dash dropdown-item-icon"></i>
                                                        Verificación técnica</a>
                                                {% endif %}
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);"
                                                   onclick="formModalBase('{{ listado.activotecnologico.id|encrypt }}','Historial de estados','historialestadosactivo','','modal-xl')"
                                                   class="dropdown-item"><i
                                                        class="fa fa-history dropdown-item-icon"></i> Historial de
                                                    estados</a>
                                            </li>

                                            {#                                <li class="dropdown-item"><a#}
                                            {#                                        onclick="formModal('0','INVENTARIO','addinventario', '700', '519','{{ listado.activotecnologico.id }}',0)"#}
                                            {#                                        href="javascript:void(0)" ;><i#}
                                            {#                                        class="fa fa-list"></i> Registrar en inventario </a></li>#}
                                        </ul>

                                    </div>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>

                            <td colspan="8" style="text-align: center">NO TIENE ACTIVOS</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <div class="card-footer border-top-0">
                    {% include 'paginacionb4.html' %}
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="repinforme" tabindex="-1" aria-labelledby="repinformeLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><i class="fa fa-file-pdf-o"></i> Generación de Informes</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <form method="GET" action="{{ request.path }}" target="_blank">
                    <input type="hidden" name="action" value="" id="id_action">
                    <input type="hidden" name="cadenatexto" value="" id="id_lista">
                    <input type="hidden" name="estado" value="" id="id_lista_estado">
                    <input type="hidden" name="s" value="" id="id_s">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <label for="id_fechadesde" class="form-label"><b>Fecha Ingreso Desde:</b> <span
                                        class="text-danger">*</span></label>
                                <input type="date" required name="fechadesde" id="id_fechadesde" class="form-control">
                            </div>
                            <div class="col-6">
                                <label for="id_fechahasta" class="form-label"><b>Fecha Ingreso Hasta:</b> <span
                                        class="text-danger">*</span></label>
                                <input type="date" required name="fechahasta" id="id_fechahasta" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary"><span class="fa fa-download"></span> Generar
                        </button>
                        <button type="button" class="btn btn-default" data-bs-dismiss="modal"><i
                                class="fa fa-window-close"></i> Cerrar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="detalleactivomodal" tabindex="-1" aria-labelledby="detalleactivomodalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detalleactivomodalLabel">Detalles de activo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="detalleactivomodal_body" style="padding-bottom: 0px"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info btn-aceptar" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="qrmodal" tabindex="-1" aria-labelledby="qrmodalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="qrmodalLabel">Código QR</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="qrmodal_body" style="padding-bottom: 0px"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info btn-aceptar" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="modalfirma" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg modal-fullscreen-xxl-down" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-list"></i> FIRMA SOLICITUD TRASPASO ACTIVO<b class="paneltitle1">FIRMA TRASPASO
                        ACTIVO</b></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbody1">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal1">
                    <a href="javascript:;" class="btn btn-default" data-bs-dismiss="modal"><i
                            class="fa fa-window-close"></i>
                        Cerrar</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block moreblock %}
    <div class="modal fade" id="detalleconsmodal" style="display: none;padding-right:28%">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="width:900px">
                <div class="modal-header">
                    <h3 class="paneltitle">Detalles <span cid={{ c.id }}></span></h3>
                </div>
                <div class="modal-body">
                    <div id="detalleconsmodal_body" style="max-height: 400px; overflow: auto">

                    </div>
                </div>
                <div class="modal-footer">
                    <div style="float: right">
                        <a href="javascript:;" id="detalleconsmodal_aceptar" class="btn btn-info"> Aceptar</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="formatoreporte" style="display: none;">
        <input type="hidden" value="" id="tipos_reporte">
        <input type="hidden" value="" id="n_reporte">
        <input type="hidden" value="" id="id_reporte">
        <input type="hidden" value="" id="usuario_reporte">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">Formato de reporte</h4>
                </div>
                <div class="modal-body">
                    <div class="panelbody">
                        <select class="form-select" style="width: 100%;" id="formatoreporte_formato">
                            <option id="formatopdf" value="0">PORTABLE DOCUMENT FORMAT (PDF)</option>
                            <option id="formatodoc" value="1">MICROSOFT WORD (DOCX)</option>
                            <option id="formatoxls" value="2">MICROSOFT EXCEL (XLXS)</option>
                            <option id="formatocsv" value="3">COMMA-SEPARATED VALUES (CSV)</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" id="formatoreporte_run" class="btn btn-success">Ejecutar</a>
                    <a href="javascript:;" id="formatoreporte_close" class="btn">Cerrar</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document" id="wmodal">
            <div class="modal-content" style="border-radius: 17px!important;">
                <div class="modal-header">
                    <h4><b class="paneltitle">FORMULARIO MODAL</b></h4>
                    <button type="button" class="btn-close btn-cerrar-modal fs-5" data-toggle="modal"
                            data-bs-dismiss="modal" aria-label="Close">
                        X
                    </button>
                </div>
                <div class="modal-body" style="padding: 1.5%;">
                    <form class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row panelbody">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal" id="cerrar"><i
                            class="fa fa-times"></i> Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
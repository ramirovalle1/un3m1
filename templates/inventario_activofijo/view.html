{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}
    <script src="/static/js/highcharts.js"></script>
    <script src="/static/js/exporting.js"></script>
    <script src="/static/js/data.js"></script>

{#    <script src="/static/adicionalesjs/formquestion.js?0.24"></script>#}
    <script src="/static/adicionalesjs/formquestionb4.js?0.24"></script>
    {#    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>#}
{#    <script src="/static/js/jquery.table2excel.js"></script>#}
    <script type="text/javascript">

        $(function () {

            $(".descargarexcel").click(function () {
            });

            $(".detalleactivo").click(function () {
                var id = $(this).attr("cid");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/inventario_activofijo",
                    data: {'action': 'detalle_activo', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#detalleactivomodal_body").html(data.html);
                            $("#detalleactivomodal").modal({"backdrop": "static", "width": "1000px"}).modal("show");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
                return false;
            });
            $("#detalleactivomodal_aceptar").click(function () {
                $("#detalleactivomodal").modal("hide");
            });
            $(".detallemantenimiento").click(function () {
                var id = $(this).attr("idact");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/inventario_activofijo",
                    data: {'action': 'detalle_mantenimiento', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#detalleactivomantenimientomodal_body").html(data.html);
                            $("#detalleactivomantenimientomodal").modal({
                                "backdrop": "static",
                                "width": "1000px"
                            }).modal("show");
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
                return false;
            });
            $("#detalleactivomantenimientomodal_aceptar").click(function () {
                $("#detalleactivomantenimientomodal").modal("hide");
            });
            $("#detalledificiomodal_aceptar").click(function () {
                $("#detalledificiomodal").modal("hide");
            });

            busqueda = function () {
                var codigo = $("#grupo_list").val();
                bloqueointerface();
                location.href = "/inventario_activofijo?action=inventario&codigo=" + codigo;
            };

            $("#grupo_list").change(function () {
                busqueda();
            });

            $(".filterable tr:has(td)").each(function () {
                var t = $(this).text().toLowerCase();
                $("<td class='indexColumn'></td>").hide().text(t).appendTo(this);
            });

            $("#FilterTextBox").keyup(function () {
                var s = $(this).val().toLowerCase().split(" ");
                $(".filterable tr:hidden").show();
                $.each(s, function () {
                    $(".filterable tr:visible .indexColumn:not(:contains('" + this + "'))").parent().hide();
                });
                $(".filterable3 tr:hidden").show();
            });

            $(".filterable2 tr:has(td)").each(function () {
                var t = $(this).text().toLowerCase();
                $("<td class='indexColumn2'></td>").hide().text(t).appendTo(this);
            });

            $("#FilterTextBox2").keyup(function () {
                var s = $(this).val().toLowerCase().split(" ");
                $(".filterable2 tr:hidden").show();
                $.each(s, function () {
                    $(".filterable2 tr:visible .indexColumn2:not(:contains('" + this + "'))").parent().hide();
                });
            });

        });

            function formModal(id, text, action, width, height, activo, responsable) {
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/inventario_activofijo",
                    data: {
                        'action': action,
                        'id': id,
                        'activo':activo,
                        'responsable':responsable
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result === true) {
                            $('.panelbody').html(data.data);
                            $('#itemspanel .paneltitle').html(text);
                            $("#itemspanel").modal({backdrop: 'static', width: width, height: height}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            };

    </script>
    <style>
        .factIva {
            font-family: Geneva, Arial, Helvetica, sans-serif;
            font-size: 12px;
            background-color: #FFFFFF;
            border: 1px solid #999999;
            border-bottom: 1px solid #CCCCCC;
        }

        .caja {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 8pt;
            text-decoration: none;
            color: #000000;
            font-weight: normal;
            border-top: 1px solid #CCCCCC;
            border-right: 1px solid #CCCCCC;
            border-bottom: 0px solid #CCCCCC;
            border-left: 0px solid #CCCCCC;
            text-align: left;
        }

    </style>
    <script>

        function reporteinforme(tpreporte) {
            $('#id_action').val(tpreporte)
            valuelist_ = $('#grupo_list').val();
            $('#id_lista').val(valuelist_)
            $('#id_action').val(tpreporte)
            $("#repinforme").modal({backdrop: 'static', width: '600px'}).modal('show');
        }

        function repall() {
            var cadena = $("#grupo_list").val()
            var url = "/inventario_activofijo?action=excellistadoactivos&cadenatexto=" + cadena;
            $(location).attr('href', url);
        }

        function repallpdfactivotodos() {
            var cadena = $("#grupo_list").val()
            var url = "/inventario_activofijo?action=pdflistadoactivostodos&cadenatexto=" + cadena;
            $(location).attr('href', url);
        }

        function reporteinformeactivostecnologicos(){
            $("#repinformeactivostecnologicos").modal({backdrop: 'static', width: '600px'}).modal('show');
        }

        function repallpdfbajatodos() {
            var cadena = $("#grupo_list").val()
            var url = "/inventario_activofijo?action=pdflistadoactivosinactiostodos&cadenatexto=" + cadena;
            $(location).attr('href', url);
        }

        function historial(id){
            $("#aprobarcerrar").css('display', 'none');
            bloqueointerface();

            $.ajax({
                type: "GET",
                url: "/inventario_activofijo",
                data: {'action': 'historialtraspaso', 'id': id},

                success: function (data) {

                    $.unblockUI();
                    if (data.result == 'ok') {

                        $(".panelbodyhistorial").html(data.data);
                        $("#itemspanelhistorial").modal({backdrop: 'static', width: '1000px'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function cerrar(){
            $("#itemspanelhistorial").modal("hide");
            return false;
        }

        function solicitud(id, accion){
            $("#aprobarcerrar").css('display', 'none');
            bloqueointerface();

            $.ajax({
                type: "GET",
                url: "/inventario_activofijo",
                data: {'action': accion, 'id': id},

                success: function (data) {

                    $.unblockUI();
                    if (data.result == 'ok') {

                        $(".panelbodyhistorial").html(data.data);
                        $("#itemspanelhistorial").modal({backdrop: 'static', width: '1000px'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function generarcodigotics(){
            $("#aprobarcerrar").css('display', 'none');
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/inventario_activofijo",
                data: {'action': 'generarcodigotics'},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        var title = 'Códigos Tics generados'
                        var tipo = 'success'
                        if (data.contador == 0){
                            title = 'Todos los activos ya cuentan con Código Tics'
                        }
                         if ((data.contador == 0) && (data.migrados == 'No')){
                             title = "Los activos aún no han sido migrados.<br/> Por favor, realizar la migración"
                             tipo = 'warning'
                         }

                        Swal.fire({
                            title: title,
                            text: 'Cantidad de Códigos Tics generados:  ' + data.contador,
                            type: tipo,
                            icon: 'success',
                            showCancelButton: false,
                            allowOutsideClick: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Aceptar',
                            cancelButtonText: 'Cancelar'
                        })
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }


        function migraractivos(){
            $("#aprobarcerrar").css('display', 'none');
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/inventario_activofijo",
                data: {'action': 'migraractivos'},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        var title = 'Activos Fijos migrados correctamente'
                        if (data.contador == 0){
                            title = 'Todos los activos se encuentran migrados'
                        }
                        Swal.fire({
                            title: title,
                            text: 'Cantidad de Activos migrados:  ' + data.contador,
                            type: 'success',
                            icon: 'success',
                            showCancelButton: false,
                            allowOutsideClick: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Aceptar',
                            cancelButtonText: 'Cancelar',
                            showConfirmButton: false,
                            timer : 5000
                        })
                        location.reload();
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }



        function generarcodigoqr(id){
            $("#aprobarcerrar").css('display', 'none');
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/inventario_activofijo",
                data: {'action': 'generarcodigoqrtic', 'id': id},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        var link = document.createElement("a");
                        link.download = 'Activo-'+data.activo;
                        link.href = 'https://sga.unemi.edu.ec/media/qrcode/activos/Activo'+ data.activo + '.png'
                        link.click();
                        Swal.fire({
                            title: `Código qr generado`,
                            text: data.contador,
                            type: 'success',
                            icon: 'success',
                            showCancelButton: false,
                            allowOutsideClick: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Aceptar',
                            cancelButtonText: 'Cancelar',
                            showConfirmButton: false,
                            timer: 2000
                        })
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function busquedaActivo(){
            var term = $("#FilterTextBox").val().trim().toUpperCase();
            var codigo = $("#grupo_list").val();
            if (term.length > 0) {
                bloqueointerface();
                location.href = "/inventario_activofijo?codigo=" + codigo + "&baja=1&s=" + term;
            } else {
                bloqueointerface();
                location.href = "/inventario_activofijo?codigo=" + codigo + "&baja=1";
            }
            return false;
        }

        function buscar(){
            busqueda();
        }



    </script>
{% endblock %}
{% block atras %}/gestion_operaciones{% endblock %}
{% block canvas %}
    <div class='row'>
        <div class='col-lg-12'>
            <h3 class="texto-blue">{{ title }}</h3>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class='row'>
            <div class="col-12 pb-2">
        {% if perms.sagest.puede_modificar_mantenimientos and perms.sagest.puede_gestionar_informeactivo_tecnologico %}
            <a href="/inventario_activofijo?action=inventariotics&codigo=0&baja=1" class='btn btn-info'
               target="_blank"><span
                    class="fa fa-list-alt"></span> Inventario (Tics)</a>
            <a href="/inventario_activofijo?action=periodoinventario" class='btn btn-info'
               ><span
                    class="fa fa-list-alt"></span> Periodos inventario</a>
            <a style="background: #0d95e8;" href="/helpdesk_hdplanificacion" class='btn btn-info'
               target="_blank"><span
                    class="fa fa-list-alt"></span> Mantenimientos</a>
            <a onclick="migraractivos()" class='btn btn-primary'><span
                    class="fa fa-code"></span> Migrar Activos</a>
            <a onclick="generarcodigotics()" class='btn btn-warning'><span
                    class="fa fa-code"></span> Generar código Tics</a>
        <a href="/inventario_activofijo?action=inventariotecnologico" class='btn btn-success'><span
                class="fa fa-list-alt"></span> Indicadores</a>
        <a href="/at_activostecnologicos?action=add" class='btn btn-primary'><span
                class="fa fa-plus"></span> Adicionar activo tecnológico</a>


{#        <div class="d-flex justify-content-between mt-2  align-content-center" style="width: 304px !important;">#}
{#             <div class="p-0 m-0 dropbottom">#}
{#                <a class="btn btn-mini dropdown-toggle" data-bs-toggle="dropdown" href="javascript:;">#}
{#                    <i class="fa fa-file-pdf"></i> Generar Informes <span class="caret" style="margin-left: 1px !important;margin-top: 5px !important;"></span>#}
{#                </a>#}
{#                <ul class="dropdown-menu" style="text-align: left">#}
{#                    <li class="dropdown-item">#}
{#                        <a href='javascript:void(0)' onclick="repall()">#}
{#                            <i class="fa fa-file-excel-o"></i> Exportar a Excel <b>(Todos)</b>#}
{#                        </a></li>#}
{#                    <li class="dropdown-item"><a href='javascript:void(0)' onclick="reporteinforme('excellistadoactivos')">#}
{#                        <i class="fa fa-file-excel-o"></i> Exportar a Excel <b>(Por Fechas)</b>#}
{#                        </a></li>#}
{#                    <li class="dropdown-item"><a href='javascript:void(0)' onclick="reporteinforme('pdflistadoactivos')">#}
{#                        <i class="fa fa-file-pdf-o"></i> Informe de Activos <b>(Vigentes)</b>#}
{#                        </a></li>#}
{#                    <li class="dropdown-item"><a href='javascript:void(0)' onclick="reporteinforme('pdflistadoactivosinactios')">#}
{#                        <i class="fa fa-file-pdf-o"></i> Informe de Activos <b>(Dados de baja por fecha)</b>#}
{#                    </a></li>#}
{#                    <li class="dropdown-item"><a href="/inventario_activofijo?action=pdflistadoactivosinactivos" target="_blank">#}
{#                        <i class="fa fa-file-pdf-o"></i> Informe de Activos <b>(Dados de baja)</b>#}
{#                    </a></li>#}
{#                    <li class="dropdown-item"><a href='javascript:void(0)' onclick="repallpdfactivotodos('pdflistadoactivostodos')">#}
{#                        <i class="fa fa-file-pdf-o"></i> <b>Todos</b> Informe de Activos <b>(Vigentes)</b>#}
{#                    </a></li>#}
{#                    <li class="dropdown-item"><a href='javascript:void(0)' onclick="reporteinformeactivostecnologicos('reporteactivostecnologicos')">#}
{#                        <i class="fa fa-file-excel-o"></i> Reporte de activos tecnológicos<b>(Por administrativos o docente)</b>#}
{#                    </a></li>#}
{#                     <li class="dropdown-item"><a href='javascript:void(0)' onclick="reporteinformeactivostecnologicos('reporteactivostecnologicos')">#}
{#                        <i class="fa fa-file-excel-o"></i> Reporte de activos tecnológicos<b>(Por administrativos o docente)</b>#}
{#                    </a></li>#}
{#                </ul>#}
{#            </div>#}
{##}
{##}
{#            <div class="p-0 m-0 dropbottom" >#}
{#                <a class="btn btn-mini  dropdown-toggle" data-toggle="dropdown"#}
{#                   href="javascript:;">Gestión de solicitudes de traspaso#}
{#                    <span class="caret" style="margin-left: 1px !important;margin-top: 5px !important;"></span>#}
{#                </a>#}
{#                <ul class="dropdown-menu">#}
{#                    <li class="dropdown-item"><a href="/inventario_activofijo?action=solicitudestraspasoresponsable" ;><i#}
{#                                class="fa fa-user"></i> Solicitudes pendientes (Responsable) </a></li>#}
{#                    <li class="dropdown-item"><a href="/inventario_activofijo?action=solicitudespendientesactivos" ;><i#}
{#                                class="fa fa-user"></i> Solicitudes pendientes (Posible responsable) </a></li>#}
{#                    <li class="dropdown-submenu dropdown-item"><a style="cursor:pointer;"><i#}
{#                            class="fa fa-user"></i> Solicitudes de traspaso </a>#}
{#                        <ul class="dropdown-menu pull-right" style="width: 100%;">#}
{#                            <li class="dropdown-item" style="text-align: left;"><a#}
{#                                    href="/inventario_activofijo?action=solicitudesconfirmadostraspasos" ;><i#}
{#                                    class="fa fa-paperclip"></i> Traspasos confirmados</a></li>#}
{#                            <li class="dropdown-item" style="text-align: left;"><a#}
{#                                    href="/inventario_activofijo?action=solicitudespendientestraspasos" ;><i#}
{#                                    class="fa fa-paperclip"></i> Traspasos pendientes</a></li>#}
{#                        </ul>#}
{#                    </li>#}
{#                </ul>#}
{#            </div>#}
{##}
{#        </div>#}
{##}



        {% endif %}
    </div>
</div>

<div class='row' style="margin-left: 0px;margin-bottom: 5px">
    <div class="col-12 pb-2">
        <table class="" style="background:rgba(0, 0, 0, 0);border-color: transparent">
            <tr>
                <td style="width: 15%">
                    <form class="form-search" style="width: 100%">
                        <select id="grupo_list" style="width: 100%;float: left">
                            <option value="0">TODOS</option>
                            {% for grupo in grupocatalogo %}
                                <option {% if codigo == grupo.id %}selected{% endif %}
                                        value="{{ grupo.id }}">{{ grupo }}</option>
                            {% endfor %}
                        </select>
                    </form>
                </td>
                <td style="width: 15%">
                    <form class="form-search" onsubmit="busquedaActivo()">
                        <input type="search" style="text-transform: uppercase; margin-bottom: 0px;" class=""
                               id="FilterTextBox" name="FilterTextBox" value='{{ search }}'>
                    </form>
                </td>

                <td style="width: 16%; vertical-align: middle">
                    <a class="btn btn-info  tu" title="Buscar" id="busqueda" href='javascript:;'
                       onclick="busquedaActivo()"> <i class='fa fa-search'></i> </a>
                </td>
            </tr>
        </table>
    <label class="label label-info"><i class="fa fa-info-circle"></i> Total de registros {{ totalregistros }}</label>
    <label class="label label-warning"><i class="fa fa-info-circle"></i> Activos tecnológicos sin archivos de baja {{ totalactivos_sin_archivobaja }}</label>
    </div>
            <table class="table table-bordered table-striped" style="background:rgba(0, 0, 0, 0);border-color: transparent">

        </div>
        <div class="modal" role="dialog" id="repinforme">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4><i class="fa fa-list"></i> <b class="paneltitle"> Generación de Informes</b></h4>
                    </div>
                    <form class="form-horizontal form-modal" target="_blank" method="GET"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        <div class="modal-body">

                            {% csrf_token %}
                            <input type="hidden" name="action" value="" id="id_action">
                            <input type="hidden" name="cadenatexto" value="" id="id_lista">
                            <div class="modal-body">
                                <div class="row-fluid">
                                    <div class="span6">
                                        <label for=""><b>Fecha Ingreso Desde:</b> <span  class="text-error">*</span></label>
                                        <input type="date" required name="fechadesde" id="id_fechadesde" width="100%"
                                               class="form-control"
                                               style="width: 100%">
                                    </div>
                                    <div class="span6">
                                        <label for=""><b>Fecha Ingreso Hasta:</b> <span class="text-error">*</span></label>
                                        <input type="date" required name="fechahasta" id="id_fechahasta" width="100%"
                                               class="form-control"
                                               style="width: 100%">
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="submit" class='btn btn-success'>
                                <span class="fa fa-download"></span> Generar
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" role="dialog" id="repinformeactivostecnologicos">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4><i class="fa fa-list"></i> <b class="paneltitle"> Generación de Informes</b></h4>
                    </div>
                    <form class="form-horizontal form-modal" target="_blank" method="GET"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        <div class="modal-body">

                            {% csrf_token %}
                            <input type="hidden" name="action" value="reporteactivostecnologicos" id="reporteactivostecnologicos">
                            <input type="hidden" name="id" value="0" id="reporteactivostecnologicos">
                            <div class="modal-body">
                                <div class="row-fluid">
                                    <div class="span6">
                                        <label for=""><b>Tipo perfil:</b> <span  class="text-error">*</span></label>
                                        <select id='tipoperfil' style="width: 90%" name="tipoperfilpersona">
                                            <option value="0" selected>Todos</option>
                                            <option value="1" selected>Administrativos</option>
                                            <option value="2" selected>Docentes</option>
                                        </select>
                                    </div>
                                    <div class="span6">
                                        <label for=""><b>Tipo activos:</b> <span  class="text-error">*</span></label>
                                        <select id='tipoperfil' style="width: 90%" name="tipoactivos">
                                            <option value="0" selected>Todos</option>
                                            <option value="1" selected>Tecnológicos</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="submit" class='btn btn-success'>
                                <span class="fa fa-download"></span> Generar
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="card mb-4">
            <div class="card-body border-top border-6 rounded-3 border-dark-info">
                <div class="table-responsive-xxl">

        <table class="table table-bordered table-striped">
            <thead>
            <tr>
                <th style="text-align: center; width: 70px" class="caja">Código Tics</th>
                <th style="text-align: center; width: 200px" class="caja">Descripción</th>
                <th style="text-align: center; width: 50px" class="caja">Modelo</th>
                <th style="text-align: center; width: 50px" class="caja">Fecha de Ingreso</th>
                <th style="text-align: center; width: 50px" class="caja">Responsable</th>
                <th style="text-align: center; width: 80px" class="caja">Ubicación</th>
                <th style="text-align: center; width: 80px" class="caja">Informe de baja</th>
                <th style="text-align: center; width: 50px" class="caja"></th>
            </tr>
            </thead>
            <tbody>
            {% for listado in listadocatalogo %}
                <tr>
                    <td style="text-align: center" class="caja">
                        {% if listado.codigotic %}
                            <div class="seleccionados" idsele="{{ listado.activotecnologico.id }}">{{ listado.codigotic }}
                            </div>
                        {% endif %}
                    </td>
                    <td style="text-align: left" class="caja">
                        <div class="seleccionados" idsele="{{ listado.activotecnologico.id }}">{{ listado.activotecnologico.codigointerno }}
                            - {{ listado.activotecnologico }}</div>
                        <label class="label label-info tu">
                            {{ listado.activotecnologico.fechaingreso|date:"Y-m-d" }}
                        </label>
                        {% if listado.activotecnologico.statusactivo == 2 %}
                                <label class="label label-important tu" title="Baja">BAJA</label>
                        {% endif %}
                    </td>
                    <td style="text-align: center" class="caja">
                        <div class="seleccionados" idsele="{{ listado.activotecnologico.id }}">{{ listado.activotecnologico.modelo }}
                        </div>
                    </td>
                    <td style="text-align: center" class="caja">
                        <div class="seleccionados" idsele="{{ listado.id }}">{{ listado.activotecnologico.fechaingreso|date:"d-m-Y" }}
                        </div>
                    </td>
                    <td style="text-align: center" class="caja">
                        <div class="seleccionados" idsele="{{ listado.id }}">{{ listado.activotecnologico.responsable|default_if_none:"" }}
                        </div>
                    </td>
                    <td style="text-align: center" class="caja"> {{ listado.activotecnologico.ubicacion|default_if_none:"" }}</td>
                    <td style="text-align: center" class="caja">
                        {% if not listado.activotecnologico.archivobaja or listado.activotecnologico.archivobaja == '' %}
                            NO
                        {% else %}
                            SI
                        {% endif %}
                    </td>
                    <td style="text-align: center" class="caja">
                        <div class="dropbottom" >
                            <a class="btn btn-mini dropdown-toggle" data-bs-toggle="dropdown"
                               href="javascript:;">Acciones<span
                                    class="caret" style="margin-top: 5px!important; margin-left: 1px !important;"></span></a>
                            {% if perms.sagest.puede_modificar_mantenimientos and perms.sagest.puede_gestionar_informeactivo_tecnologico %}
                            <ul class="dropdown-menu">

                                <li class="dropdown-item"><a onclick="formModal('0','RESPONSABLE','addresponsable', '320', '285','{{ listado.activotecnologico.id }}','{{ listado.activotecnologico.responsable.id }}')"
                                    href="javascript:void(0)";><i
                                        class="fa fa-user"></i>  Traspaso </a></li>
                                <li class="dropdown-item"><a onclick="historial('{{ listado.activotecnologico.id }}')"
                                        href="javascript:void(0)";><i
                                        class="fa fa-history"></i> Historial de traspasos asignados </a></li>
                                <li class="dropdown-submenu dropdown-item pull-left"><a style="cursor:pointer;"><i
                                        class="fa fa-paperclip"></i> Solicitudes </a>
                                    <ul class="dropdown-menu" style="width: 100%;">
                                        <li class="dropdown-item" style="text-align: left;"><a
                                                onclick="solicitud('{{ listado.activotecnologico.id }}','solicitudactivoresponsable')"
                                                href="javascript:void(0)" ;><i
                                                class="fa fa-paperclip"></i> Solicitud al
                                            responsable</a></li>
                                        <li class="dropdown-item" style="text-align: left;"><a
                                                onclick="solicitud('{{ listado.activotecnologico.id }}','solicitudactivo')"
                                                href="javascript:void(0)" ;><i
                                                class="fa fa-paperclip"></i> Solicitud al posible
                                            responsable</a></li>
                                        <li class="dropdown-item" style="text-align: left;"><a
                                                onclick="solicitud('{{ listado.activotecnologico.id }}','solicitudtraspaso')"
                                                href="javascript:void(0)" ;><i
                                                class="fa fa-paperclip"></i> Solicitud de traspaso por
                                            confirmar</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="dropdown-item"><a
                                        onclick="generarcodigoqr('{{ listado.activotecnologico.id }}')"
                                        href="javascript:void(0)" ;><i
                                        class="fa-solid fa-qrcode"></i> Generar código qr </a></li>
                                <li class="dropdown-item"><a
                                        onclick="formModal('0','INVENTARIO','addinventario', '700', '519','{{ listado.activotecnologico.id }}',0)"
                                        href="javascript:void(0)" ;><i
                                        class="fa fa-list"></i> Registrar en inventario </a></li>
                            </ul>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                <tr>
                    {% empty %}
                    <td colspan="8" style="text-align: center">NO TIENE ACTIVOS</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade static" id="detalleactivomodal" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Detalles de activo</h3>
        </div>
        <div class="modal-body" id="detalleactivomodal_body"></div>
        <div class="modal-footer">
            <div style="float: right">
                <a href="javascript:;" id="detalleactivomodal_aceptar" class="btn btn-info btn-aceptar"> Aceptar</a>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="detalleactivomantenimientomodal" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Detalles de mantenimientos</h3>
        </div>
        <div class="modal-body" id="detalleactivomantenimientomodal_body"></div>
        <div class="modal-footer">
            <div style="float: right">
                <a href="javascript:;" id="detalleactivomantenimientomodal_aceptar" class="btn btn-info btn-aceptar">
                    Aceptar</a>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="detalledificiomodal" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Detalles Mantenimiento Preventivo</h3>
        </div>
        <div class="modal-body" id="detalledificiomodal_body"></div>
        <div class="modal-footer">
            <div style="float: right">
                <a href="javascript:;" id="detalledificiomodal_aceptar" class="btn btn-info btn-aceptar"> Aceptar</a>
            </div>
        </div>
    </div>

    <div class="modal" role="dialog" id="itemspanel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbody">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

        <div class="modal fade static" id="itemspanel" style="display: none;">
            <div class="modal-header">
                <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal form-modal" autocomplete="off" method="post"
                      enctype="multipart/form-data" action="{{ request.path }}">
                    {% csrf_token %}
                    <div class="modal-body panelbody">
                    </div>
                </form>
            </div>
        </div>

    <div class="modal fade" tabindex="-1" role="dialog" id="itemspanelhistorial">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Modal title</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                <div class="modal-body panelbodyhistorial">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

        <div class="modal fade static" id="itemspanelhistorial" style="display: none;">
            <div class="modal-body panelbodyhistorial">
                <div class="modal-header">
                    <h3 class="paneltitle">Mostrar historial de Asesores </h3>
                </div>
            </div>
            <div class="modal-footer">
                <table class="pull-right">
                    <tr>
                        <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-aprobarcerrar btn-success"> Guardar</a>
                        </td>
                        <td><a onclick="cerrar()" class="btn btn-cerrar btn-info">Cerrar</a></td>
                    </tr>
                </table>
            </div>
        </div>
    <div class="card-footer border-top-0">
        {% include 'paginacionb4.html' %}
    </div>



{% endblock %}



{##}
{##}
{##}
{##}
{#{% block canvas %}#}
{#    <div class='row-fluid'>#}
{#        <div class='span12'>#}
{#            <h4>{{ title }}</h4>#}
{#        </div>#}
{#    </div>#}
{#    #}
{#    <a onclick="formModal('0','PERIODO','addperiodoinventario', '600', '380',0,0)"#}
{#                                       href="javascript:void(0)"; class='btn btn-success'><span#}
{#                class="fa fa-plus"></span> Añadir periodo</a>#}
{#    <div class='row-fluid'>#}
{#        <div class='span7' style="margin-left: 0px;margin-bottom: 5px">#}
{#            <table class="" style="background:rgba(0, 0, 0, 0);border-color: transparent">#}
{#                <tr>#}
{#                    <td style="width: 15%">#}
{#                        <form class="form-search" onsubmit="busquedaActivo()">#}
{#                            <input type="search" style="text-transform: uppercase; margin-bottom: 0px;" class=""#}
{#                                   id="FilterTextBox" name="FilterTextBox" value='{{ search }}'>#}
{#                        </form>#}
{#                    </td>#}
{##}
{#                    <td style="width: 16%; vertical-align: middle">#}
{#                        <a class="btn btn-info  tu" title="Buscar" id="busqueda" href='javascript:;'#}
{#                           onclick="busquedaActivo()"> <i class='fa fa-search'></i> </a>#}
{#                    </td>#}
{#                </tr>#}
{#            </table>#}
{#                <label class="label label-info"><i class="fa fa-info-circle"></i> Total periodos {{ totales }}</label>#}
{#        </div>#}
{##}
{#    </div>#}
{#    <div>#}
{#        <table class="table table-bordered table-striped" id="example" width="100%">#}
{#            <thead>#}
{#            <tr>#}
{#                <th style="text-align: center; width: 60px" class="caja">Nombre</th>#}
{#                <th style="text-align: center; width: 30px" class="caja">Fecha inicio</th>#}
{#                <th style="text-align: center; width: 30px" class="caja">Fecha fin</th>#}
{#                <th style="text-align: center; width: 30px" class="caja">Fecha cierre</th>#}
{#                <th style="text-align: center; width: 80px" class="caja">Detalle</th>#}
{#                <th style="text-align: center; width: 40px" class="caja">Estado</th>#}
{#                <th style="text-align: center; width: 10px" class="caja"></th>#}
{#            </tr>#}
{#            </thead>#}
{#            <tbody>#}
{#            {% for listado in listadocatalogo %}#}
{#                <tr>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        {{ listado.nombre|default_if_none:'' }}#}
{#                    </td>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        {{ listado.fechainicio|date:"Y-m-d" }}#}
{#                    </td>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        {{ listado.fechafin|date:"Y-m-d" }}#}
{#                    </td>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        {% if listado.fechacierre %}#}
{#                            {{ listado.fechacierre|date:"Y-m-d" }}#}
{#                        {% else %}#}
{#                            -----#}
{#                        {% endif %}#}
{#                    </td>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        {{ listado.detalle }}#}
{#                    </td>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        {% if listado.estado == 1 %}#}
{#                            <label class="label label-success">PERIODO ABIERTO</label>#}
{#                        {% else %}#}
{#                            {% if listado.estado == 2 %}#}
{#                                <label class="label label-warning">PERIODO CERRADO</label>#}
{#                            {% endif %}#}
{#                        {% endif %}#}
{#                    </td>#}
{#                    <td style="text-align: center" class="caja">#}
{#                        <div class="dropbottom" >#}
{#                            <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown"#}
{#                               href="javascript:;">Acciones<span#}
{#                                    class="caret" style="margin-top: 5px !important; margin-left: 1px !important;"></span></a>#}
{#                            <ul class="dropdown-menu">#}
{#                            {% if listado.estado == 1 %}#}
{#                                    <li class="dropdown-item">#}
{#                                        <a onclick="formModal('0','EDITAR INVENTARIO','editperiodoinventario', '700', '350','{{ listado.id }}','{{ listado.id }}')"#}
{#                                           href="javascript:void(0)" ;><i#}
{#                                                class="fa fa-pencil-square-o"></i> Editar </a></li>#}
{#                                    <li class="dropdown-item"><a href="javascript:;"#}
{#                                           idr="{{ listado.id }}" text="{{ listado.nombre }}"#}
{#                                           class="confirmar_eliminar"><i#}
{#                                            class="fa fa-close"></i> Eliminar </a></li>#}
{#                                    <li class="dropdown-item">#}
{#                                        <a onclick="formModal('{{ listado.id }}','Evidencia','subirevidenciaperiodo', '700', '446',0,0)"#}
{#                                               href="javascript:void(0)"; class=''><i#}
{#                                                    class="fa fa-arrow-up"></i> Subir evidencia#}
{#                                        </a>#}
{#                                    </li>#}
{##}
{#                            {% endif %}#}
{#                            <li class="dropdown-item"><a href="/inventario_activofijo?action=inventariotics&codigo=0&baja=1&idperiodoinv={{ listado.id }}"><i#}
{#                                                class="fa fa-eye"></i> Gestiòn Inventario </a></li>#}
{#                            <li class="dropdown-item"><a href="/inventario_activofijo?action=verevidenciaperiodoinv&idperiodoinv={{ listado.id }}" ><i#}
{#                                                class="fa fa-eye"></i> Gestiòn evidencias </a></li>#}
{#                            </ul>#}
{#                        </div>#}
{#                    </td>#}
{#                </tr>#}
{#                <tr>#}
{#                    {% empty %}#}
{#                    <td colspan="8" style="text-align: center">NO TIENE REGISTROS DE PERIODOS</td>#}
{#                </tr>#}
{#            {% endfor %}#}
{#            </tbody>#}
{#        </table>#}
{#    </div>#}
{#    <div class="modal fade static" id="detalleactivomodal" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h3 class="paneltitle">Detalles de activo</h3>#}
{#        </div>#}
{#        <div class="modal-body" id="detalleactivomodal_body"></div>#}
{#        <div class="modal-footer">#}
{#            <div style="float: right">#}
{#                <a href="javascript:;" id="detalleactivomodal_aceptar" class="btn btn-info btn-aceptar"> Aceptar</a>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    <div class="modal fade static" id="detalleactivomantenimientomodal" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h3 class="paneltitle">Detalles de mantenimientos</h3>#}
{#        </div>#}
{#        <div class="modal-body" id="detalleactivomantenimientomodal_body"></div>#}
{#        <div class="modal-footer">#}
{#            <div style="float: right">#}
{#                <a href="javascript:;" id="detalleactivomantenimientomodal_aceptar" class="btn btn-info btn-aceptar">#}
{#                    Aceptar</a>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    <div class="modal fade static" id="detalledificiomodal" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h3 class="paneltitle">Detalles Mantenimiento Preventivo</h3>#}
{#        </div>#}
{#        <div class="modal-body" id="detalledificiomodal_body"></div>#}
{#        <div class="modal-footer">#}
{#            <div style="float: right">#}
{#                <a href="javascript:;" id="detalledificiomodal_aceptar" class="btn btn-info btn-aceptar"> Aceptar</a>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="modal" role="dialog" id="itemspanel">#}
{#        <div class="modal-dialog" role="document">#}
{#            <div class="modal-content">#}
{#                <div class="modal-header">#}
{#                    <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>#}
{#                </div>#}
{#                <div class="modal-body">#}
{#                    <form class="form-horizontal form-modal" autocomplete="off" method="post"#}
{#                          enctype="multipart/form-data" action="{{ request.path }}">#}
{#                        {% csrf_token %}#}
{#                        <div class="row-fluid panelbody">#}
{#                        </div>#}
{#                    </form>#}
{#                </div>#}
{#                <div class="modal-footer">#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="modal fade static" id="itemspanel" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>#}
{#        </div>#}
{#        <div class="modal-body">#}
{#            <form class="form-horizontal form-modal" autocomplete="off" method="post"#}
{#                  enctype="multipart/form-data" action="{{ request.path }}">#}
{#                {% csrf_token %}#}
{#                <div class="row-fluid panelbody">#}
{#                </div>#}
{#            </form>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="modal fade static" id="itemspanel_reporteactivo" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h4 id="paneltitle">Seleccione el activo tecnológico</h4>#}
{#        </div>#}
{#        <div class="modal-body">#}
{#            <div class='row-fluid' style="height: 100px">#}
{#                <form class="form-search">#}
{#                    <i class="fa fa-graduation-cap"></i> Activos: <br>#}
{#                    <select formwidth="350px" id="id_grupoactivos" name="activos" tabindex="-1" class="select2-accessible">#}
{#                    </select>#}
{#                </form>#}
{#            </div>#}
{#        </div>#}
{#        <div class="modal-footer">#}
{#            <input type='hidden' id="evento" name='idp' value='0'/>#}
{#            <a onclick="reporteactivoinventario()" class="btn btn-success btn-aceptar" style="cursor: pointer"> Generar reporte</a>#}
{#            <a style="cursor: pointer" onclick="cerrarmodalreporte()" class="btn btn-cerrar">Cerrar</a>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="modal fade static" id="itemspanel_reporteresponsableactivo" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h4 id="paneltitle">Seleccione el responsable y activo fijo</h4>#}
{#        </div>#}
{#        <div class="modal-body">#}
{#            <div class='row-fluid' style="height: 100px">#}
{#                <form class="form-search">#}
{#                    <i class="fa fa-graduation-cap"></i> Activo: <br>#}
{#                    <select formwidth="350px" id="id_grupoactivo" name="activos" tabindex="-1" class="select2-accessible">#}
{#                    </select>#}
{#                    <i class="fa fa-user"></i> Responsable: <br>#}
{#                    <select formwidth="350px" id="id_gruporesponsables" name="responsables" tabindex="-1" class="select2-accessible">#}
{#                    </select>#}
{#                </form>#}
{#            </div>#}
{#        </div>#}
{#        <div class="modal-footer">#}
{#            <input type='hidden' id="evento" name='idp' value='0'/>#}
{#            <a onclick="reporteresponsableactivoinventario()" class="btn btn-success btn-aceptar" style="cursor: pointer"> Generar reporte</a>#}
{#            <a style="cursor: pointer" onclick="cerrarmodal()" class="btn btn-cerrar">Cerrar</a>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="modal fade static" id="itemspanel_reporteresponsable" style="display: none;">#}
{#        <div class="modal-header">#}
{#            <h4 id="paneltitle">Seleccione el responsable</h4>#}
{#        </div>#}
{#        <div class="modal-body">#}
{#            <div class='row-fluid' style="height: 100px">#}
{#                <form class="form-search">#}
{#                    <i class="fa fa-user"></i> Responsable: <br>#}
{#                    <select formwidth="350px" id="id_responsable" name="responsables" tabindex="-1" class="select2-accessible">#}
{#                    </select>#}
{#                </form>#}
{#            </div>#}
{#        </div>#}
{#        <div class="modal-footer">#}
{#            <input type='hidden' id="evento" name='idp' value='0'/>#}
{#            <a onclick="reporteresponsable()" class="btn btn-success btn-aceptar" style="cursor: pointer"> Generar reporte</a>#}
{#            <a style="cursor: pointer" onclick="cerrarmodalResponsable()" class="btn btn-cerrar">Cerrar</a>#}
{#        </div>#}
{#    </div>#}
{##}
{#<div class='row-fluid'>#}
{#        <div class="span12">#}
{#            {% if paging.num_pages > 20 %}#}
{#                <div class='pagination'>#}
{#                    <ul>#}
{#                        {% if paging.primera_pagina %}#}
{#                            <li><a href="/inventario_activofijo?action=periodoinventario&{% if search %}s={{ search }}&{% endif %}{% if perfil %}perfil={{ perfil }}&{% endif %}page=1">1</a></li>#}
{#                            <li><a href="/inventario_activofijo?action=periodoinventario&{% if search %}s={{ search }}&{% endif %}{% if perfil %}perfil={{ perfil }}&{% endif %}page={{ paging.ellipsis_izquierda }}" class="active">...</a></li>#}
{#                        {% endif %}#}
{#                        {% for pagenumber in paging.paginas %}#}
{#                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/inventario_activofijo?action=periodoinventario&{% if search %}s={{ search }}&{% endif %}{% if perfil %}perfil={{ perfil }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>#}
{#                        {% endfor %}#}
{#                        {% if paging.ultima_pagina %}#}
{#                            <li><a href="/inventario_activofijo?action=periodoinventario&{% if search %}s={{ search }}&{% endif %}{% if perfil %}perfil={{ perfil }}&{% endif %}page={{ paging.ellipsis_derecha }}" class="active">...</a></li>#}
{#                            <li><a href="/inventario_activofijo?action=periodoinventario&{% if search %}s={{ search }}&{% endif %}{% if perfil %}perfil={{ perfil }}&{% endif %}page={{ paging.num_pages }}">{{ paging.num_pages }}</a></li>#}
{#                        {% endif %}#}
{#                    </ul>#}
{#                </div>#}
{#            {% else %}#}
{#                <div class='pagination'>#}
{#                    <ul>#}
{#                        {% for pagenumber in paging.page_range %}#}
{#                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/inventario_activofijo?action=periodoinventario&{% if search %}s={{ search }}&{% endif %}{% if perfil %}perfil={{ perfil }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>#}
{#                        {% endfor %}#}
{#                    </ul>#}
{#                </div>#}
{#            {% endif %}#}
{#        </div>#}
{#    </div>#}
{#    <div class="card-footer border-top-0">#}
{#        {% include 'paginacionb4.html' %}#}
{#    </div>#}
{#{% endblock %}#}

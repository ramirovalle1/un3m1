{% extends "ajaxform.html" %}
{% load sga_extras %}
{% block extraheading %}
    <script type="text/javascript" src="/static/ckeditor/ckeditor-init.js?v=1.0.1" data-ckeditor-basepath="/static/ckeditor/ckeditor/" id="ckeditor-init-script"></script>
    <script type="text/javascript" src="/static/ckeditor/ckeditor/ckeditor.js?v=1.0.1"></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>
    <link rel="stylesheet" href="/static/css/stylesfc.css">
    <script type="text/javascript">
        $(function(){
            //Contendrá los ids de objetivos eliminados de las tablas (los existentes en base de datos)
            lista_items1 = [];
            //Contendrá los ids de resultados/compromisos eliminados de las tablas (los existentes en base de datos)
            lista_items2 = [];
            //Contendrá los ids de referencias bibliográficas eliminadas de las tablas (los existentes en base de datos)
            lista_items3 = [];

            let nfr = {{ totalresultados }};
            let numeroresultado = {{ totalresultados }};

            let nfrb = {{ totalreferencias }};
            let numeroreferencia = {{ totalreferencias }};

            let nf = {{ totalobjetivos }};
            let numeroobjetivo = {{ totalobjetivos }};

            $('[data-bs-toggle="tooltip"]').on('click', function () {
                $(this).tooltip('hide');
            });

            {% if not resumenpropuesta %}
                $("#objetivos_aux, #referencias_aux, #declaratoria_aux").addClass("validate[required]");
            {% endif %}

            configurarChkEditor = function (nombreCampo, nombreCampo2, obligatorio){
                CKEDITOR.replace(nombreCampo, {
                    language: 'es',
                    width: '100%',
                    height: 200,
                    resize_enabled: false,
                    toolbarGroups: [
                        { name: 'styles' },
                        { name: 'basicstyles' },
                        { name: 'undo' },
                        { name: 'listindentalign',  groups: [ 'list', 'indent', 'align' ] },
                        { name: 'links' },
                        { name: 'insert' },
                        { name: 'tools' },
                        { name: 'mode' }
                    ],
                    removeButtons: 'Image,Flash'
                });

                if(obligatorio) $("#"+nombreCampo+"_aux").addClass("validate[required]");
            };

            configurarChkEditor('resumenpropuesta', 'resumenpropuesta', true);
            configurarChkEditor('formulacionproblema', 'formulacionproblema', true);
            configurarChkEditor('objetivogeneral', 'objetivogeneral', true);
            configurarChkEditor('justificacion', 'justificacion', true);
            configurarChkEditor('estadoarte', 'estadoarte', true);
            configurarChkEditor('metodologia', 'metodologia', true);

            CKEDITOR.instances['resumenpropuesta'].on('change', function() {
                if(CKEDITOR.instances['resumenpropuesta'].getData().length > 0)
                    $("#resumenpropuesta_aux").val("OK");
                else
                    $("#resumenpropuesta_aux").val("");
            });

            CKEDITOR.instances['formulacionproblema'].on('change', function() {
                if(CKEDITOR.instances['formulacionproblema'].getData().length > 0)
                    $("#formulacionproblema_aux").val("OK");
                else
                    $("#formulacionproblema_aux").val("");
            });

            CKEDITOR.instances['objetivogeneral'].on('change', function() {
                if(CKEDITOR.instances['objetivogeneral'].getData().length > 0)
                    $("#objetivogeneral_aux").val("OK");
                else
                    $("#objetivogeneral_aux").val("");
            });

            CKEDITOR.instances['justificacion'].on('change', function() {
                if(CKEDITOR.instances['justificacion'].getData().length > 0)
                    $("#justificacion_aux").val("OK");
                else
                    $("#justificacion_aux").val("");
            });

            CKEDITOR.instances['estadoarte'].on('change', function() {
                if(CKEDITOR.instances['estadoarte'].getData().length > 0)
                    $("#estadoarte_aux").val("OK");
                else
                    $("#estadoarte_aux").val("");
            });

            CKEDITOR.instances['metodologia'].on('change', function() {
                if(CKEDITOR.instances['metodologia'].getData().length > 0)
                    $("#metodologia_aux").val("OK");
                else
                    $("#metodologia_aux").val("");
            });

            $(".agregaobjetivo").click(function() {
                if(datosobjetivocompleto()){
                    nf += 1;
                    numeroobjetivo ++;
                    borrar_fila_default_objetivo();

                    nueva = '<tr id="fila_'+nf.toString()+'">'+
                            '<td style="width:3%; text-align: right; font-weight: bold">'+numeroobjetivo.toString()+'</td>' +
                            '<td style="width: 94%; text-align: left"><input type="hidden" name="idobjetivoespecifico[]" value="0"><input autocomplete="off" style="text-align: left; width: 100%; text-transform: none" maxlength="250" class="form-imput" id="objetivoespecifico'+ nf.toString() +'" name="objetivoespecifico[]"  type="text" value="" ><div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div></td>'+
                            '<td style="width: 3%; text-align: center"><a href="javascript:;" class="btn btn-tini btn-danger eliminaritem" ido="0" idf="'+nf.toString()+'" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar"><i class="fa fa-remove"></i></a></td>'+
                            '</tr>';

                    $("#detalle_objetivos").append(nueva);
                    $("#objetivoespecifico"+nf.toString()).addClass("validate[required]");
                    $("#detalle_objetivos").find(".eliminaritem").tooltip();
                    $(".eliminaritem").unbind("click.eliminarItem");
                    $(".eliminaritem").bind("click.eliminarItem", eliminarItem);
                }else{
                    mensajeWarningSwal("No se puede agregar más filas para Objetivos específicos", "Ingrese la información completa de cada objetivo");
                }
            });

            agregar_fila_default_objetivo = function (){
                filadefault = '<tr id="fila_default_objetivo">'+
                              '<td colspan="3" style="text-align: center">No hay detalles de objetivos específicos</td>'+
                              '</tr>';
                $("#detalle_objetivos").append(filadefault);
                $("#objetivos_aux").addClass("validate[required]");
            };

            borrar_fila_default_objetivo = function (){
                $("#fila_default_objetivo").remove();
                $("#objetivos_aux").removeClass("validate[required]");
            };

            datosobjetivocompleto = function (){
                let c1e = true;

                $('input[name="objetivoespecifico[]"]').each(function() {
                    if($(this).val().trim()==''){
                        c1e = false;
                        return false;
                    }
                });

                return c1e;
            };

            eliminarItem = function() {
                $(this).tooltip('hide');
                let id = $(this).attr("idf");
                let idobjetivo = $(this).attr("ido");

                if(idobjetivo != '0'){
                    var item = {idobjetivo: idobjetivo};
                    lista_items1.push(item)
                }

                $("#fila_"+id).remove();
                let rowCount = $('#tbdetalleobjetivos tr').length;
                numeroobjetivo = 0;

                $("#tbdetalleobjetivos tbody tr").each(function (index) {
                    numeroobjetivo ++;
                    $(this).children("td").each(function (index2) {
                        if(index2 == 0)
                            $(this).html(numeroobjetivo.toString());
                    });
                });

                if(numeroobjetivo == 0)
                    agregar_fila_default_objetivo();

            };

            $(".agregaresultado").click(function() {
                if(datosresultadocompleto()){
                    nfr += 1;
                    numeroresultado ++;

                    nueva = '<tr id="filaresultado_'+nfr.toString()+'">' +
                            '<td style="width: 3%;text-align: right; font-weight: bold">'+numeroresultado.toString()+'</td>' +
                            '<td style="width: 84%; text-align: left"><input type="hidden" name="idresultadocompromiso[]" value="0"><input type="hidden" name="idtiporesultado[]" value="0"><input type="hidden" name="idtiporesultadonofijo[]" value="0"><input type="hidden" name="obligtiporesultado[]" value="False"><input type="hidden" name="tiporegistro[]" value="N"><input autocomplete="off" type="hidden" name="destiporesultado[]" value=""><input autocomplete="off" style="text-align: left; width: 100%; text-transform: none" maxlength="250" class="form-imput" id="descripciontiporesultado' + nfr.toString() +'" name="descripciontiporesultado[]"  type="text" value="" ><div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div></td>' +
                            '<td style="width: 10%; text-align: center"><input type="checkbox" value="" name="marcados[]" checked onclick="return false;"></td>' +
                            '<td style="width: 3%; text-align: center"><a href="javascript:;" class="btn btn-tini btn-danger eliminaritemresultado" idrc="0" idf="'+nfr.toString()+'" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar"><i class="fa fa-remove"></i></a></td>' +
                            '</tr>';

                    $("#detalle_resultados").append(nueva);
                    $("#descripciontiporesultado"+nfr.toString()).addClass("validate[required]");
                    $("#detalle_resultados").find(".eliminaritemresultado").tooltip();
                    $(".eliminaritemresultado").unbind("click.eliminarItemResultado");
                    $(".eliminaritemresultado").bind("click.eliminarItemResultado", eliminarItemResultado);
                }else{
                    mensajeWarningSwal("No se puede agregar más filas para Resultados", "Ingrese todas las descripciones de los resultados");
                }
            });

            datosresultadocompleto = function (){
                let c1e = true;

                $('input[name="descripciontiporesultado[]"]').each(function() {
                    if($(this).val().trim()==''){
                        c1e = false;
                        return false;
                    }
                });

                return c1e;
            };

            eliminarItemResultado = function() {
                $(this).tooltip('hide');
                let id = $(this).attr("idf");
                let idresultado = $(this).attr("idrc");

                if(idresultado != '0'){
                    let item = {idresultado: idresultado};
                    lista_items2.push(item)
                }

                $("#filaresultado_"+id).remove();
                let rowCount = $('#tbdetalleresultados tr').length;
                numeroresultado = 0;

                $("#tbdetalleresultados tbody tr").each(function (index) {
                    numeroresultado ++;
                    $(this).children("td").each(function (index2) {
                        if(index2 == 0)
                            $(this).html(numeroresultado.toString());
                    });
                });
            };

            $(".agregareferencia").click(function() {
                if(datosreferenciacompleto()){
                    nfrb += 1;
                    numeroreferencia ++;
                    borrar_fila_default_referencia();

                    nueva = '<tr id="filarb_'+nfrb.toString()+'">' +
                            '<td style="width: 3%; text-align: right; font-weight: bold">'+numeroreferencia.toString()+'</td>' +
                            '<td style="width: 94%; text-align: left"><input type="hidden" name="idreferenciabib[]" value="0"><input autocomplete="off" style="text-align: left; width: 100%; text-transform: none" maxlength="250" class="form-imput" id="referenciabib'+ nfrb.toString() +'" name="referenciabib[]"  type="text" value="" ><div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div></td>' +
                            '<td style="width: 3%; text-align: center"><a href="javascript:;" class="btn btn-tini btn-danger eliminaritemrefbib" idrb="0" idf="'+nfrb.toString()+'" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar"><i class="fa fa-remove"></i></a></td>' +
                            '</tr>';


                    $("#detalle_referencia").append(nueva);
                    $("#referenciabib"+nfrb.toString()).addClass("validate[required]");
                    $("#detalle_referencia").find(".eliminaritemrefbib").tooltip();
                    $(".eliminaritemrefbib").unbind("click.eliminarItemRefBib");
                    $(".eliminaritemrefbib").bind("click.eliminarItemRefBib", eliminarItemRefBib);
                }else{
                    mensajeWarningSwal("No se pueden agregar más filas para Refencias bibliográficas", "Ingrese la información completa para cada referencia bibliográfica");
                }
            });

            agregar_fila_default_referencia = function (){
                filadefault = '<tr id="fila_default_referencia">'+
                              '<td colspan="3" style="text-align: center">No hay detalles de referencias bibliográficas</td>'+
                              '</tr>';
                $("#detalle_referencia").append(filadefault);
                $("#referencias_aux").addClass("validate[required]");
            };

            borrar_fila_default_referencia = function (){
                $("#fila_default_referencia").remove();
                $("#referencias_aux").removeClass("validate[required]");
            };

            datosreferenciacompleto = function (){
                let c1e = true;

                $('input[name="referenciabib[]"]').each(function() {
                    if($(this).val().trim()==''){
                        c1e = false;
                        return false;
                    }
                });

                return c1e;
            };

            eliminarItemRefBib = function() {
                $(this).tooltip('hide');
                let id = $(this).attr("idf");
                let idreferencia = $(this).attr("idrb");

                if(idreferencia != '0'){
                    let item = {idreferencia: idreferencia};
                    lista_items3.push(item)
                }

                $("#filarb_"+id).remove();
                let rowCount = $('#tbreferenciabib tr').length;
                numeroreferencia = 0;

                $("#tbreferenciabib tbody tr").each(function (index) {
                    numeroreferencia ++;
                    $(this).children("td").each(function (index2) {
                        if(index2 == 0)
                            $(this).html(numeroreferencia.toString());
                    });
                });

                if(numeroreferencia == 0)
                    agregar_fila_default_referencia();

            };

            $(".resultados").click(function(){
                let id = $(this).attr('idfila');
                if($(this).is(':checked'))
                    $("#auxresultados"+id).val("S");
                else
                    $("#auxresultados"+id).val("");
            });

            $(".declaratoria").click(function(){
                if($(this).is(':checked'))
                    $("#declaratoria_aux").val("S");
                else
                    $("#declaratoria_aux").val("");
            });

            agregarValidacionResultados = function (){
                $(".auxresultados").each(function(){
                    $(this).addClass("validate[required]");
                });
            };

            {% if resumenpropuesta %}
                agregarValidacionObjetivos = function (){
                    $(".objetivos").each(function(){
                        $(this).addClass("validate[required]");
                    });
                };

                agregarValidacionDescripcionesResultados = function (){
                    $(".descripcionesresultado").each(function(){
                        $(this).addClass("validate[required]");
                    });
                };

                agregarValidacionReferencias = function (){
                    $(".referencias").each(function(){
                        $(this).addClass("validate[required]");
                    });
                };

                agregarValidacionObjetivos();
                $(".eliminaritem").unbind("click.eliminarItem");
                $(".eliminaritem").bind("click.eliminarItem", eliminarItem);

                agregarValidacionDescripcionesResultados();
                $(".eliminaritemresultado").unbind("click.eliminarItemResultado");
                $(".eliminaritemresultado").bind("click.eliminarItemResultado", eliminarItemResultado);

                agregarValidacionReferencias();
                $(".eliminaritemrefbib").unbind("click.eliminarItemRefBib");
                $(".eliminaritemrefbib").bind("click.eliminarItemRefBib", eliminarItemRefBib);

            {% endif %}

            agregarValidacionResultados();

            $('textarea').css({'padding':'3px', 'resize':'none'});
            $(':input[readonly]').css({'cursor':'not-allowed'});

            {% if not puedeeditar %}
                $("#formbutton").hide();
            {% endif %}

        });
    </script>
{% endblock %}
{% block atras %}/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoria.id|encrypt }}&id={{ id }}{% endblock %}
{% block titulo %}{{ title }}{% endblock %}
{% block formaction %}/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoria.id|encrypt }}&id={{ id }}{% endblock %}
{% block formdestinationswal %}/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoria.id|encrypt }}&id={{ id }}{% endblock %}
{% block formextra %}
    <input type='hidden' name='action' value='editcontenidoproyecto'/>
    <input type='hidden' name='id' value='{{ id }}'/>
{% endblock %}
{% block formback %}/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoria.id|encrypt }}&id={{ id }}{% endblock %}
{% block buttonname %}Guardar{% endblock %}
{% block formsuffix %}
    <div id="fieldset_resumenpropuesta" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="resumenpropuesta" style="padding-right: 10px;">Resumen de la Propuesta (Máximo 500 palabras): /{{ puedeeditar }}/</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="resumenpropuesta" id="resumenpropuesta">{{ resumenpropuesta }}</textarea>
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="resumenpropuesta_aux" value="{% if resumenpropuesta %}OK{% endif %}">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

    <div id="fieldset_formulacionproblema" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="formulacionproblema" style="padding-right: 10px;">Formulación del problema (Máximo 100 palabras):</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="formulacionproblema" id="formulacionproblema">{{ formulacionproblema }}</textarea>
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="formulacionproblema_aux" value="{% if formulacionproblema %}OK{% endif %}">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

    <div id="fieldset_objetivogeneral" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="objetivogeneral" style="padding-right: 10px;">Objetivo general:</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="objetivogeneral" id="objetivogeneral">{{ objetivogeneral }}</textarea>
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="objetivogeneral_aux" value="{% if objetivogeneral %}OK{% endif %}">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <table class="table table_primary table-bordered table-striped" id="tbdetalleobjetivos">
            <thead>
                <tr>
                    <th colspan="3">Objetivos Específicos</th>
                </tr>
                <tr>
                    <th style="width: 3%;" class="text-center">#</th>
                    <th style="width: 94%;" class="text-center">Objetivo</th>
                    <th style="width: 3%;" class="text-center">
                        {% if puedeeditar %}
                            <a href="javascript:;" id="btnagregarcuota" class="btn btn-success btn-mini agregaobjetivo" data-bs-toggle="tooltip" data-bs-placement="top" title="Agregar Objetivo específico"><i class="fa fa-plus"></i> </a>
                        {% endif %}
                    </th>
                </tr>
            </thead>
            <tbody id="detalle_objetivos">
                {% if objetivos %}
                    {% for objetivo in objetivos %}
                        <tr id="fila_{{ forloop.counter }}">
                            <td class="text-end"><b>{{ forloop.counter }}</b></td>
                            <td class="text-start"><input type="hidden" name="idobjetivoespecifico[]" value="{{ objetivo.id }}"><input autocomplete="off" style="text-align: left; width: 100%; text-transform: none" maxlength="250" class="objetivos form-control" id="objetivoespecifico{{ forloop.counter }}" name="objetivoespecifico[]"  type="text" value="{{ objetivo.descripcion }}" ><div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div></td>
                            <td class="text-center">
                                {% if not objetivo.tiene_cronograma_actividades %}
                                    <a href="javascript:;" class="btn btn-tini btn-danger eliminaritem" ido="{{ objetivo.id }}" idf="{{ forloop.counter }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar"><i class="fa fa-remove"></i></a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr id="fila_default_objetivo">
                        <td colspan="3" class="text-center">No hay detalles de objetivos específicos</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="objetivos_aux" value="">
        <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0;"></div>
    </div>

    <div id="fieldset_justificacion" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="justificacion" style="padding-right: 10px;">Justificación (Máximo 300 palabras):</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="justificacion" id="justificacion">{{ justificacion }}</textarea>
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="justificacion_aux" value="{% if justificacion %}OK{% endif %}">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

    <div id="fieldset_estadoarte" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="estadoarte" style="padding-right: 10px;">Estado del arte (Máximo 1000 palabras):</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="estadoarte" id="estadoarte">{{ estadoarte }}</textarea>
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="estadoarte_aux" value="{% if estadoarte %}OK{% endif %}">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

    <div id="fieldset_metodologia" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="metodologia" style="padding-right: 10px;">Metodología (Máximo 1000 palabras):</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="metodologia" id="metodologia">{{ metodologia }}</textarea>
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="metodologia_aux" value="{% if metodologia %}OK{% endif %}">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

    <div style="width: 100%; height: max-content; display: inline-block">
        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span style="padding:0 10px; background: white;">Impactos (Ingrese al menos uno)</span></h6>
    </div>

    <div id="fieldset_impactosocial" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="impactosocial" style="padding-right: 10px;">Social:</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="impactosocial" id="impactosocial" class="form-control" rows="4">{{ impactosocial|safe }}</textarea>
                <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
            </div>
        </div>
    </div>

    <div id="fieldset_impactocientifico" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="impactocientifico" style="padding-right: 10px;">Ambiental:</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="impactocientifico" id="impactocientifico" class="form-control" rows="4">{{ impactocientifico|safe }}</textarea>
                <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
            </div>
        </div>
    </div>


    <div id="fieldset_impactoeconomico" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="impactoeconomico" style="padding-right: 10px;">Económico:</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="impactoeconomico" id="impactoeconomico" class="form-control" rows="4">{{ impactoeconomico|safe }}</textarea>
                <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
            </div>
        </div>
    </div>

    <div id="fieldset_impactopolitico" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="impactopolitico" style="padding-right: 10px;">Político:</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="impactopolitico" id="impactopolitico" class="form-control" rows="4">{{ impactopolitico|safe }}</textarea>
                <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
            </div>
        </div>
    </div>

    <div id="fieldset_otroimpacto" class="col-md-12" style="float: left;">
        <div class="row">

        </div>
        <div class="input-group">
            <div class="label-text col-md-3 col-sm-3 col-12"  style="display: table;height: 30px;">
                <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                    <label for="otroimpacto" style="padding-right: 10px;">Otro:</label>
                </div>
            </div>
            <div class="control-group col-md-9 col-sm-9 col-12" style="float: left; width: 100">
                <textarea name="otroimpacto" id="otroimpacto" class="form-control" rows="4">{{ otroimpacto|safe }}</textarea>
                <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <table class="table table_primary table-bordered table-striped" id="tbdetalleresultados">
            <thead>
                <tr>
                    <th colspan="4">Productos / Resultados / Compromisos</th>
                </tr>
                <tr>
                    <th style="width: 3%;" class="text-center">#</th>
                    <th style="width: 91%;" class="text-center">Descripción</th>
                    <th style="width: 3%;">Sel.</th>
                    <th style="width: 3%;" class="text-center">
                        {% if puedeeditar %}
                            <a href="javascript:;" id="btnagregarresultado" class="btn btn-success btn-mini agregaresultado" data-bs-toggle="tooltip" data-bs-placement="top" title="Agregar Resultado"><i class="fa fa-plus"></i> </a>
                        {% endif %}
                    </th>
                </tr>
            </thead>
            <tbody id="detalle_resultados">
                {% if tiposresultados %}
                    {% for tiporesultado in tiposresultados %}
                        <tr id="filaresultado_{{ forloop.counter }}">
                            <td class="text-end"><b>{{ forloop.counter }}</b></td>
                            <td class="text-justify"><input autocomplete="off" type="hidden" name="destiporesultado[]" value="{{ tiporesultado.descripcion }}">{{ tiporesultado.descripcion }} {% if tiporesultado.obligatorio %}<span title="Obligatorio" style="color: red; font-weight: bold">*</span>{% endif %}<input type="hidden" name="idresultadocompromiso[]" value="0"><input type="hidden" name="idtiporesultado[]" value="{{ tiporesultado.id }}"><input type="hidden" name="obligtiporesultado[]" value="{{ tiporesultado.obligatorio }}"><input type="hidden" name="tiporegistro[]" value="E"></td>
                            <td class="text-center">
                                <input type="checkbox" value="{{ tiporesultado.id }}" class="resultados" idfila="{{ forloop.counter }}" id="marcados{{ forloop.counter }}" name="marcados[]" >
                                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" class="auxresultados" id="auxresultados{{ forloop.counter }}" value="">
                                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                            </td>
                            <td class="text-center">&nbsp;</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    {% for resultado in resultados %}
                        {% if resultado.resultado.fijo %}
                            <tr id="filaresultado_{{ forloop.counter }}">
                                <td width="3%" style="text-align: right; font-weight: bold">{{ forloop.counter }}</td>
                                <td width="84%" style="text-align: justify"><input type="hidden" name="destiporesultado[]" value="{{ resultado.resultado.descripcion }}">{{ resultado.resultado.descripcion }}{% if resultado.resultado.obligatorio %}<span title="Obligatorio" style="color: red; font-weight: bold">*</span>{% endif %}</td>
                                <td width="10%" style="text-align: center"><input type="checkbox" value="{{ resultado.resultado.id }}" {% if resultado.marcado %}checked{% endif %} name="marcados[]" {% if resultado.resultado.obligatorio %}onclick="return false;"{% endif %}></td>
                                <td width="3%" style="text-align: center"><input type="hidden" name="tiporegistro[]" value="E">   <input type="hidden" name="obligtiporesultado[]" value="{{ resultado.resultado.obligatorio }}">  <input type="hidden" name="idresultadocompromiso[]" value="{{ resultado.id }}">  <input type="hidden" name="idtiporesultado[]" value="{{ resultado.resultado.id }}">   </td>
                            </tr>
                        {% else %}
                            <tr id="filaresultado_{{ forloop.counter }}">
                                <td width="3%" style="text-align: right; font-weight: bold">{{ forloop.counter }}</td>
                                <td width="84%" style="text-align: justify"><input type="hidden" name="destiporesultado[]" value="{{ resultado.resultado.descripcion }}">  <input autocomplete="off" style="text-align: left; width: 100%; text-transform: none" maxlength="250" class="descripcionesresultado" id="descripciontiporesultado{{ forloop.counter }}" name="descripciontiporesultado[]"  type="text" value="{{ resultado.resultado.descripcion }}" > <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div></td>
                                <td width="10%" style="text-align: center"><input type="checkbox" value="{{ resultado.resultado.id }}" name="marcados[]" checked onclick="return false;"></td>
                                <td width="3%" style="text-align: center"><input type="hidden" name="tiporegistro[]" value="E">  <input type="hidden" name="obligtiporesultado[]" value="{{ resultado.resultado.obligatorio }}">  <input type="hidden" name="idresultadocompromiso[]" value="{{ resultado.id }}">  <input type="hidden" name="idtiporesultado[]" value="{{ resultado.resultado.id }}"> <input type="hidden" name="idtiporesultadonofijo[]" value="{{ resultado.resultado.id }}">  <a href="javascript:;" class="btn btn-tini btn-danger eliminaritemresultado tu" idrc="{{ resultado.id }}" idf="{{ forloop.counter }}" title="Eliminar"><i class="fa fa-remove"></i></a></td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>

    <div class="row-fluid">
        <table class="table table-bordered table-striped table_primary" id="tbreferenciabib">
            <thead>
                <tr>
                    <th colspan="3">Referencia Bibliográfica (En formato APA séptima edición)</th>
                </tr>
                <tr>
                    <th style="width: 3%;" class="text-center">#</th>
                    <th style="width: 94%;" class="text-center">Referencia</th>
                    <th style="width: 3%;" class="text-center">
                        {% if puedeeditar %}
                            <a href="javascript:;" id="btnagregarreferencia" class="btn btn-success btn-mini agregareferencia" data-bs-toggle="tooltip" data-bs-placement="top" title="Agregar Referencia Bibliográfica"><i class="fa fa-plus"></i> </a>
                        {% endif %}
                    </th>
                </tr>
            </thead>
            <tbody id="detalle_referencia">
                {% if referencias %}
                    {% for referencia in referencias %}
                        <tr id="filarb_{{ forloop.counter }}">
                            <td class="text-end"><b>{{ forloop.counter }}</b></td>
                            <td><input type="hidden" name="idreferenciabib[]" value="{{ referencia.id }}"><input autocomplete="off" style="text-align: left; width: 100%; text-transform: none" maxlength="250" class="referencias" id="referenciabib{{ forloop.counter }}" name="referenciabib[]"  type="text" value="{{ referencia.descripcion }}" ><div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div></td>
                            <td class="text-center">
                            {% if puedeeditar %}
                                <a href="javascript:;" class="btn btn-tini btn-danger eliminaritemrefbib" idrb="{{ referencia.id }}" idf="{{ forloop.counter }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar"><i class="fa fa-remove"></i></a>
                            {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr id="fila_default_referencia">
                        <td colspan="3" class="text-center">No hay detalles de referencias bibliográficas</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="referencias_aux" value="">
        <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
    </div>

    <div class='row-fluid' id="politicas">
        <div class='span12'>
            <div class="alert alert-info">
                <h4 class="alert-heading">Compromiso:</h4>
                <input type="checkbox" class="declaratoria" id="chkdeclaratoria" value="1" name="chkdeclaratoria" {% if existeresumen %}checked disabled{% endif %}> NOS COMPROMETEMOS A ENTREGAR LOS RESULTADOS EN EL INFORME FINAL DEL PROYECTO.
                <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="declaratoria_aux" value="">
                <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
            </div>
        </div>
    </div>

{% endblock %}
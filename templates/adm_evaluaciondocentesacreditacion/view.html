{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src='/static/js/select2.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=1.0.0"/>
    <script>
        $(function() {
            var intentos = 0;

            function fallorecalculo(){
                $.unblockUI();
                $("#recalcularmodal").modal("hide");
                smoke.alert("Fallo al recalcular los resultados");
            }

            function terminarecalculo(){
                $("#recalcularmodal").modal("hide");
            }

            function recalculo(lista, elemento, cantidad){
                var profesor = lista[elemento];
                var cp = (100 / (cantidad+1)) * elemento + '%';
                if (elemento>cantidad){
                    terminarecalculo();
                } else {
                    {#$("#recalcularmodalprogresshint").html(profesor.nombre);#}
                    $("#recalcularmodalprogresshint").html(profesor.profesor__persona__apellido1 + ' ' + profesor.profesor__persona__apellido2 + ' ' + profesor.profesor__persona__nombres);
                    $("#progressbar").css({'width': cp});
                    $.ajax({
                        type: "POST",
                        url: "/adm_evaluaciondocentesacreditacion",
                        {#data: {"action": "recalcularprofesoresevaluar", "id": profesor.id},#}
                        data: {"action": "recalcularprofesoresevaluar", "iddistributivo": profesor.id },
                        success: function(data) {
                            if (data.result=='ok'){
                                intentos = 0;
                                recalculo(lista, elemento+1, cantidad);
                            } else {
                                intentos += 1;
                                if (intentos>=100){
                                    fallorecalculo();
                                } else {
                                    recalculo(lista, elemento, cantidad);
                                }
                            }
                        },
                        error: function() {
                            intentos += 1;
                            if (intentos>=100){
                                fallorecalculo();
                            } else {
                                recalculo(lista, elemento, cantidad);
                            }
                        },
                        dataType: "json"
                    });
                }
            }

            $("#recalcular").click(function(){
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacion",
                    data: {'action': 'profesoresevaluar'},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $('#recalcularmodal').modal({keyboard: false, backdrop: 'static'}).modal("show");
                            var indice = 0;
                            var cantidad = parseInt(data.cantidad);
                            var profesores = data.profesores;
                            recalculo(profesores, indice, (cantidad-1));
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos");
                    },
                    dataType: "json"
                });

            });

            function terminarecalculomigracion(){
                $("#migrarmodal").modal("hide");
                bloqueointerface();
                location.reload();
            }

            function fallorecalculomigrar(){
                $.unblockUI();
                $("#recalcularmodal").modal("hide");
                smoke.alert("Fallo al recalcular los resultados");
            }

            function recalculomigracion(lista, elemento, cantidad){
                var profesor = lista[elemento];
                var cp = (100 / (cantidad+1)) * elemento + '%';
                if (elemento>cantidad){
                    terminarecalculomigracion();
                } else {
                    $("#migrarmodalprogresshint").html(profesor.nombre);
                    $("#progressbarmigrar").css({'width': cp});
                    $.ajax({
                        type: "POST",
                        url: "/adm_evaluaciondocentesacreditacion",
                        data: {"action": "migrarprofesoresevaluar", "id": profesor.id},
                        success: function(data) {
                            if (data.result=='ok'){
                                intentos = 0;
                                recalculomigracion(lista, elemento+1, cantidad);
                            } else {
                                intentos += 1;
                                if (intentos>=100){
                                    fallorecalculomigrar();
                                } else {
                                    recalculomigracion(lista, elemento, cantidad);
                                }
                            }
                        },
                        error: function() {
                            intentos += 1;
                            if (intentos>=100){
                                fallorecalculomigrar();
                            } else {
                                recalculomigracion(lista, elemento, cantidad);
                            }
                        },
                        dataType: "json"
                    });
                }
            }

            $("#migrarevaluacion").click(function(){
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacion",
                    data: {'action': 'profesoresevaluarmigrar'},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $('#migrarmodal').modal({keyboard: false, backdrop: 'static'}).modal("show");
                            var indice = 0;
                            var cantidad = parseInt(data.cantidad);
                            var profesores = data.profesores;
                            recalculomigracion(profesores, indice, (cantidad-1));
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos");
                    },
                    dataType: "json"
                });

            });
            $(".detalleautoxevaluar").click(function () {
                bloqueointerface();
                var idp = $(this).attr('idp');
                $("#faltantedirectivos").hide()
                $("#faltantepares").hide()
                $.ajax({
                    type: "GET",
                    url: "/adm_evaluaciondocentesacreditacion",
                    data: {'action': 'detalleautoxevaluar','id': idp},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result === 'ok') {
                            $("#body-modal").html(data.data);
                            $("#paneltitle").html('DETALLE DE PERSONAS POR AUTOEVALUARCE');
                            $("#showdetalle").modal({backdrop:'static', width: '650px'}).modal('show');
                        } else {
                            alertaDanger(data.mensaje)
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        alertaDanger("Error de conexión.")
                    },
                    dataType: "json"
                });
            });
            $(".detalledirxevaluar").click(function () {
                $("#faltantedirectivos").show()
                $("#faltantepares").hide()
                bloqueointerface();
                var idp = $(this).attr('idp');
                $.ajax({
                    type: "GET",
                    url: "/adm_evaluaciondocentesacreditacion",
                    data: {'action': 'detalledirxevaluar','id': idp},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result === 'ok') {
                            $("#body-modal").html(data.data);
                            $("#paneltitle").html('DETALLE DE DIRECTIVOS POR COEVALUAR');
                            $("#showdetalle").modal({backdrop:'static', width: '650px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $(".detalleparesxevaluar").click(function () {
                $("#faltantedirectivos").hide()
                $("#faltantepares").show()
                bloqueointerface();
                var idp = $(this).attr('idp');
                $.ajax({
                    type: "GET",
                    url: "/adm_evaluaciondocentesacreditacion",
                    data: {'action': 'detalleparesxevaluar','id': idp},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result === 'ok') {
                            $("#body-modal").html(data.data);
                            $("#paneltitle").html('DETALLE DE PARES POR COEVALUAR');
                            $("#showdetalle").modal({backdrop:'static', width: '650px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#cerrardetallemodal").click(function () {
                $("#showdetalle").modal("hide");
            });

            $(".generarreporte").click(function () {
                $("#generarreporte").modal({backdrop:'static', width: '500'}).modal('show');
            });

             $(".generarreportedirect").click(function () {
                     openwindow('GET' ,'/adm_evaluaciondocentesacreditacion', {action:'generarreportedirect'}, '_blank');
            });

             $(".generarreportepar").click(function () {
                     openwindow('GET' ,'/adm_evaluaciondocentesacreditacion', {action:'generarreportepar'}, '_blank');
            });

            $(".generarreporte_procesar").click(function () {
                $("#generarreporte").modal('hide');
                var periodos =  JSON.stringify($('#id_periodos').val());
                if(periodos){
                    openwindow('GET' ,'/adm_evaluaciondocentesacreditacion', {action:'reporteprofesores', periodos: periodos}, '_blank');
                }
                else{
                    smoke.alert("Seleccione al menos un periodo.")
                }
            });

            $(".generarreporte_cerrar").click(function () {
                $("#generarreporte").modal('hide');
            });

            $('select').select2({
                placeholder: 'Selecione periodo',
                allowClear: true
            });
            $("#total_cancel").click(function () {
                $('#modalnotoficacionimportar').modal('hide');
            });

        });
        function vertotales(idproceso) {
            bloqueointerface();
            $.get("/adm_evaluaciondocentesacreditacion", {
                'action': 'vertotales',
                'idproceso': idproceso
            }, function (data) {
                if (data.results) {
                    $("#contenidoparticipantes").empty();
                    $("#modalnotoficacionimportar").modal({backdrop: 'static', width: '600px'}).modal('show');
                    $(".elementosubtema").remove();
                    {#for (elemento in data.listadoaprobados) {#}
                    $("#contenidoparticipantes").append('<tr>' +
                        '<td style="text-align: center;" class="idtema" width="40%">' + data.total + '</td>' +
                        '<td style="text-align:center;" width="40%">' + data.realizadas + '</td>' +
                        '<td style="text-align:center;" width="20%">' + data.porcentaje.toFixed(2) + '</td>' +
                        '</tr>');
                    {# }#}
                    $.unblockUI();

                }
            }, 'json');

        }

        function NotificarEvaluacion(pk, accion, subjects) {
            Swal.fire({
                title: `<h4>Notificar evaluación de directivos</h4>`,
                html: `Al confirmar esta acción, notificará la evaluación de directivos a los siguientes evaluadores sobre los siguientes docentes:<br> ${subjects}`,
                type: 'warning',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.ajax({
                        type: 'POST',
                        url: '/adm_evaluaciondocentesacreditacion',
                        async: false,
                        data: {
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            action: accion,
                            id: pk,
                        },
                        dataType: "json",
                        beforeSend: function () {
                            bloqueointerface();
                        }
                    }).done(function (data) {
                        setTimeout($.unblockUI, 1);
                        if (data.result == 'ok') {

                            let timerInterval
                            Swal.fire({
                                title: '',
                                html: '<b>Guardando cambios...</b>',
                                timer: 2000,
                                timerProgressBar: true,
                                didOpen: () => {
                                    Swal.showLoading()
                                    const b = Swal.getHtmlContainer().querySelector('b')
                                    timerInterval = setInterval(() => {
                                        b.textContent = Swal.getTimerLeft()
                                    }, 100)
                                },
                                willClose: () => {
                                    clearInterval(timerInterval)
                                }
                            }).then((result) => {
                                /* Read more about handling dismissals below */
                                if (result.dismiss === Swal.DismissReason.timer) {
                                    console.log('I was closed by the timer')
                                }
                            })
                            location.reload();
                        } else {
                            alertaDanger(data.mensaje, 10000);
                        }
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        setTimeout($.unblockUI, 1);
                        alertaDanger('Error en el servidor', 'Advertencia!', 10000);
                    }).always(function () {
                    });
                } else {
                }
            });
        }

    </script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3>{{ title }}</h3>
                <h6>Resultado de evaluación docente.</h6>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="btn-group" role="group" style="padding: 8px">
            <button id="btnGroupDrop1" type="button" class="btn btn-default dropdown-toggle me-2" data-bs-toggle="dropdown" aria-expanded="false">
                Acciones <i class="fa fa-angle-down"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                <li><a href="/adm_evaluaciondocentesacreditacion?action=caracteristicas" class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-list"></i> Caracter&iacute;sticas de evaluación</a></li>
                <li><a href="/adm_evaluaciondocentesacreditacion?action=rubricas" class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-list"></i> R&uacute;bricas de evaluación</a></li>
                <li><a href="/adm_evaluaciondocentesacreditacion?action=listadistributivo" class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-list"></i> Distributivo</a></li>
                <li><a href="javascript:;" id="recalcular" class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-retweet"></i> Recalcular</a></li>
                <li><a href="/adm_evaluaciondocentesacreditacion?action=consulcriterios&idperiodo={{ periodo.id }}" class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-table"></i> Tipos Criterios</a></li>
                {% if proceso.mostrarresultados %}
                    <li><a href="/adm_evaluaciondocentesacreditacion?action=ocultarresultados"  class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-eye-slash"></i> Ocultar Resultado</a></li>
                {% else %}
                    <li><a href="/adm_evaluaciondocentesacreditacion?action=mostrarresultados" class="dropdown-item" href="#"><i class="fa fa-eye"></i> Mostrar Resultado</a></li>
                {% endif %}
                {% if proceso.mostrarfirmas %}
                    <li><a href="/adm_evaluaciondocentesacreditacion?action=ocultarfirmas" class="dropdown-item" href="#"><i class="fa fa-eye-slash"></i> Ocultar Firma</a></li>
                {% else %}
                    <li><a href="/adm_evaluaciondocentesacreditacion?action=mostrarfirmas" class="dropdown-item" href="#"><i class="fa fa-eye"></i> Mostrar Firma</a></li>
                {% endif %}
                <li><a href="/adm_evaluaciondocentesacreditacion?action=cronogramaencuesta" class="dropdown-item" href="#"><i class="fa fa-clock-o"></i> Cronograma de encuesta de evaluación</a></li>
                {#            {% if not evaluacionmigrada %}#}
                {#                <li><a href="javascript:;" id="migrarevaluacion" class="dropdown-item" href="#"><i class="fa fa-reply-all"></i> Migrar evaluación</a></li>#}
                {#            {% endif %}#}
            </ul>
            <button id="btnGroupDrop2" type="button" class="btn btn-default dropdown-toggle me-2" data-bs-toggle="dropdown" aria-expanded="false">
                Resultados <i class="fa fa-angle-down"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="btnGroupDrop2">
                <li>
                    <a href="/adm_evaluaciondocentesacreditacion?action=resultados_matriz_evaluacion" class="dropdown-item" href="#"><i class="fa fa-table"></i> Resultados matriz de evaluación</a>
                </li>
                <li>
                    <a href="/adm_evaluaciondocentesacreditacion?action=resultados_generales_coordinacion" class="dropdown-item" href="#"><i class="fa fa-table"></i> Resultados generales por facultades</a>
                </li>
                <li>
                    <a href="/adm_evaluaciondocentesacreditacion?action=resultados_generales_carrera" class="dropdown-item" href="#"><i class="fa fa-table"></i> Resultados generales por carreras</a>
                </li>
                <li>
                    <a href="/adm_evaluaciondocentesacreditacion?action=resultados_docentes_coordinacion" class="dropdown-item" href="#"><i class="fa fa-list"></i> Resultados por docentes y facultades</a>
                </li>
                <li>
                    <a href="/adm_evaluaciondocentesacreditacion?action=resultados_docentes_carrera" class="dropdown-item" href="#"><i class="fa fa-list"></i> Resultados por docentes y carreras</a>
                </li>
                <li>
                    <!--a href="/adm_evaluaciondocentesacreditacion?action=consultarevaluacion" class="btn-form"><i class="fa fa-search"></i> Resumen general del proceso evaluativo</a-->
                    <a href="/adm_evaluaciondocentesacreditacion?action=consultarevaluacionfac&idperiodo={{ periodo.id }}"
                       class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-search"></i> Resumen general
                        del proceso evaluativo</a>
                </li>
                <li>
                    <a href="/adm_evaluaciondocentesacreditacion?action=consulpromeval&idperiodo={{ periodo.id }}" class="dropdown-item bloqueo_pantalla" href="#"><i class="fa fa-search"></i> Detalle promedio del proceso evaluativo</a>
                </li>
            </ul>
            <button id="btnGroupDrop3" type="button" class="btn btn-default dropdown-toggle me-2" data-bs-toggle="dropdown" aria-expanded="false">
                Reportes <i class="fa fa-angle-down"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="btnGroupDrop3">
                <li>
                    <a class="generarreporte dropdown-item"  href="#"><i class="fa fa-table"></i> Asignaturas, capacitación, notas de profesores</a>
                </li>
                <li>
                    <a class="generarreportedirect dropdown-item"  href="#"><i class="fa fa-table"></i> Directivos Evaluacion</a>
                </li>
                <li>
                    <a class="generarreportepar dropdown-item"  href="#"><i class="fa fa-table"></i> Pares Evaluacion</a>
                </li>
            </ul>
            <a href="/adm_evaluaciondocentesacreditacion?action=tablasponderativas" class="btn btn-default bloqueo_pantalla me-2">
                <i class="fa fa-table"></i> Tablas Ponderativas
            </a>
            {#            <a href="/adm_evaluaciondocentesacreditacion?action=listapreguntas" class="btn btn-default bloqueo_pantalla">#}
            {#                <i class="fa fa-table"></i> Preguntas#}
            {#            </a>#}
            <a href="/adm_evaluaciondocentesacreditacion?action=modalidadesevaluar" class="btn btn-default bloqueo_pantalla me-2">
                <i class="fa fa-table"></i> Modalidad evaluar
            </a>
            <a href="/adm_evaluaciondocentesacreditacion?action=eva_inv_vinc" class="btn btn-default bloqueo_pantalla me-2">
                <i class="fa fa-table"></i> Investigación y Vinculación
            </a>
        </div>
        {% if evaluacionmigrada %}
            <div class='span5 alert alert-info'>
                <strong>Los datos ya fueron migrados a la tabla histórica</strong>
                <a href="/adm_evaluaciondocentesacreditacion?action=descargarevalmigracion" class="btn btn-warning btn-mini"><i class="fa fa-file-excel-o fa-lg"></i> Descargar</a>
            </div>
        {% endif %}

        <div class="card mb-4">
            <div class="card-body border-top border-6 rounded-3 border-dark-info table-responsive">
                <h3 class="fw-bolder">TOTAL EVALUACIONES NO PROCESADAS: {{ noprocesadas }}</h3>
                <table class='table table-bordered table-striped' id="example">
                    <thead class="table-light">
                    <tr>
                        <th>Matriz de Evaluaci&oacute;n (Tipos)</th>
                        <th style="text-align: center; width: 150px">Total</th>
                        <th style="text-align: center; width: 150px">Realizada</th>
                        <th style="text-align: center; width: 150px">Desde</th>
                        <th style="text-align: center; width: 150px">Hasta</th>
                        <th style="text-align: center; width: 150px">Estado</th>
                        <th style="width: 100px;"> </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr style="text-align: center;">
                        <td><span class="label label-info">1</span> ESTUDIANTES (HETEROEVALUACION)</td>
                        <td style="text-align: center;" colspan="2">
                            <a class="btn btn-success active btn-mini" href='#' onclick="vertotales({{ proceso.id }})">Ver totales</a>
                            {#                        {{ proceso.hetero_total }}#}
                        </td>
                        {#                    <td style="text-align: center;">#}
                        {#                        {{ proceso.hetero_realizadas }}#}
                        {#                    </td>#}
                        <td style="text-align: center;">{{ proceso.instrumentoheteroinicio|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentoheterofin|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{% if proceso.instrumentoheteroactivo %}<label class="label label-success">ACTIVO</label>{% else %}<label class="label label-warning">INACTIVO</label>{% endif %}</td>
                        <td style="text-align: left;">
                            {% if proceso.periodo.tipo.id == 3 %}
                                {% if perms.posgrado.puede_configurar_evaluaciones_posgrado or persona.usuario.is_superuser %}
                                    <a href="/adm_evaluaciondocentesacreditacion?action=activacioninstrumento&id=1"
                                       class="btn btn-mini btn-primary tu" title="Activacion"><i class="fa fa-cogs"></i></a>
                                {% endif %}
                            {% else %}
                                {% if perms.sga.puede_activar_evaluacion_docente or persona.usuario.is_superuser %}
                                <a href="/adm_evaluaciondocentesacreditacion?action=activacioninstrumento&id=1"
                                   class="btn btn-mini btn-primary tu" title="Activacion"><i class="fa fa-cogs"></i></a>
                                {% endif %}
                            {% endif %}
                            <a href="/adm_evaluaciondocentesacreditacion?action=consultacarreras&id=1" class="btn btn-mini btn-primary tu" title="Planificar fechas evaluación sin cronograma"><i class="fa fa-calendar"></i></a>
                            {#                        <a href="/adm_evaluaciondocentesacreditacion?action=cronogramafacultadproceso&id=1" class="btn btn-mini btn-primary tl" title="Planificar Cronograma por Facultad"><i class="fa fa-calendar-o"></i></a>#}
                        </td>
                    </tr>
                    <tr>
                        <td><span class="label label-info">2</span> AUTOEVALUACION (AUTOEVALUACION) </td>
                        <td style="text-align: center;">
                            {#                            {{ proceso.auto_total }} #}
                            {{ proceso.auto_totaldis }}
                        </td>
                        <td style="text-align: center;">{{ proceso.auto_realizadas }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentoautoinicio|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentoautofin|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{% if proceso.instrumentoautoactivo %}<label class="label label-success">ACTIVO</label>{% else %}<label class="label label-default">INACTIVO</label>{% endif %}</td>
                        <td style="text-align: left;">
                            {% if perms.sga.puede_activar_evaluacion_docente  or persona.usuario.is_superuser %}
                                <a href="/adm_evaluaciondocentesacreditacion?action=activacioninstrumento&id=2" class="btn btn-mini btn-primary tu" title="Activacion"><i class="fa fa-cogs"></i></a>
                            {% endif %}
                            <a href="/adm_evaluaciondocentesacreditacion?action=consultacarreras&id=2" class="btn btn-mini btn-primary tu" title="Planificar fechas evaluación sin cronograma"><i class="fa fa-calendar"></i></a>
                            {#                        {% if proceso.auto_sin_realizar %}#}
                            <a class="btn btn-mini btn-warning btn-form detalleautoxevaluar tu"  href="javascript:;" idp="{{ proceso.id }}" title="Faltantes por evaluar"><i class="fa fa-exclamation-triangle  blinkimg"></i></a>
                            {#                        {% endif %}#}
                        </td>
                    </tr>
                    <tr style="text-align: center;">
                        <td><span class="label label-info">3</span> PARES (COEVALUACION) </td>
                        <td style="text-align: center;">{{ proceso.par_total }}</td>
                        <td style="text-align: center;">{{ proceso.par_realizadas }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentoparinicio|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentoparfin|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{% if proceso.instrumentoparactivo %}<label class="label label-success">ACTIVO</label>{% else %}<label class="label label-default">INACTIVO</label>{% endif %}</td>
                        <td style="text-align: left;">
                            {% if perms.sga.puede_activar_evaluacion_docente or persona.usuario.is_superuser %}
                                 <a href="/adm_evaluaciondocentesacreditacion?action=activacioninstrumento&id=4" class="btn btn-mini btn-primary tu" title="Activacion"><i class="fa fa-cogs"></i></a>
                            {% endif %}
                            {% if proceso.par_sin_realizar %}
                                <a class="btn btn-mini btn-warning btn-form detalleparesxevaluar tu"  href="javascript:;" idp="{{ proceso.id }}" title="Faltantes por evaluar"><i class="fa fa-exclamation-triangle  blinkimg"></i></a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td><span class="label label-info">4</span> DIRECTIVOS (COEVALUACION) {% if proceso.periodo.tipo.id == 3 %}
                            {% if proceso.instrumentodirectivoactivo %}
                                <a href="javascript:void(0);"
                                   onclick="NotificarEvaluacion('{{ proceso.id }}', 'notificardirectivos', '{{ subjects }}')"
                                   class="btn btn-warning btn-mini tu" title="Notificar evaluación">
                                    <span class="fa fa-bell"></span>
                                </a>
                            {% endif %}
                        {% endif %}</td>
                        <td style="text-align: center;">{{ proceso.dir_total }}</td>
                        <td style="text-align: center;">{{ proceso.dir_realizadas }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentodirectivoinicio|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{{ proceso.instrumentodirectivofin|date:'d-m-Y' }}</td>
                        <td style="text-align: center;">{% if proceso.instrumentodirectivoactivo %}<label class="label label-success">ACTIVO</label>{% else %}<label class="label label-default">INACTIVO</label>{% endif %}</td>
                        <td style="text-align: left;">
                            {% if perms.sga.puede_activar_evaluacion_docente or persona.usuario.is_superuser %}
                                <a href="/adm_evaluaciondocentesacreditacion?action=activacioninstrumento&id=3" class="btn btn-mini btn-primary tu" title="Activacion"><i class="fa fa-cogs"></i></a>
                            {% endif %}
                            {% if periodo.tipo.id == 3 %}
                                {% if perms.posgrado.puede_configurar_evaluaciones_posgrado or persona.usuario.is_superuser %}
                                    <a href="/adm_evaluaciondocentesacreditacion?action=asignarevaluaciondirectivopos"
                                       class="btn btn-mini btn-warning tu btn-form" title="Asignar Posgrado"><i
                                            class="fa fa-user"></i></a>
                                {% endif %}
                            {% else %}
                                <a href="/adm_evaluaciondocentesacreditacion?action=asignarevaluaciondirectivo"
                                   class="btn btn-mini btn-warning tu btn-form" title="Asignar"><i
                                        class="fa fa-user"></i></a>
                            {% endif %}
                            {% if proceso.dir_sin_realizar %}
                                <a class="btn btn-mini btn-warning btn-form detalledirxevaluar tu"  href="javascript:;" idp="{{ proceso.id }}" title="Faltantes por evaluar"><i class="fa fa-exclamation-triangle  blinkimg"></i></a>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="modal static" id="recalcularmodal" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Recalculando evaluaciones</h3>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated"  id="progressbar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                    </div>

                    {#                    <div class="progress progress-striped active">#}
                    {#                        <div class="bar" style="width: 0;" id="progressbar" aria-valuenow="25"></div>#}
                    {#                    </div>#}
                    <div id="recalcularmodalprogresshint">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal static" id="migrarmodal" style="display: none;">
        <div class="modal-header">
            <h3>Migrar evaluaciones</h3>
        </div>
        <div class="modal-body">
            <div class="progress progress-striped active">
                <div class="bar" style="width: 0;" id="progressbarmigrar"></div>
            </div>
            <div id="migrarmodalprogresshint">
            </div>
        </div>
    </div>

    <div class="modal fade" id="showdetalle" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle"></h4>
                    <br>
                </div>
                <div class="modal-body" id="body-modal">
                    <div class="tabbable"> <!-- Only required for left/right tabs -->
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="modal-footer">
                            <a  href="/adm_evaluaciondocentesacreditacion?action=excellfaltantesdirectivos" id="faltantedirectivos" target="_blank" class="btn btn-warning"><i class="fa fa-file-excel"></i> Descargar</a>
                            <a  href="/adm_evaluaciondocentesacreditacion?action=excellfaltantespares" id="faltantepares" target="_blank" class="btn btn-warning"><i class="fa fa-file-excel"></i> Descargar</a>
                            <a  href="javascript:;" id="cerrardetallemodal" class="btn btn-success">Cerrar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="generarreporte" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Generar reporte</h3>
                </div>
                <div class="modal-body">
                    <b>Periodos: </b>
                    <div style="text-align: center">
                        <select id="id_periodos" multiple="multiple" style="width: 100%">
                            {% for peri in listaperiodos %}
                                <option value="{{ peri.id|encrypt }}">{{ peri }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer" style="text-align: right">
                    <a href="javascript:;" class="btn btn-danger generarreporte_procesar"><i class="fa fa-plus"></i> Procesar</a>
                    <a href="javascript:;" class="btn btn-info generarreporte_cerrar"> Cerrar</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalnotoficacionimportar" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">ESTUDIANTES (HETEROEVALUACION)</h4>
                </div>
                <div class="modal-body">
                    <div class="card mb-4">
                        <div class="card-body border-top border-6 rounded-3 border-dark-info">
                            <table class='table table-bordered tabla_paginada table-striped' id="example">
                                <thead class="table-light">
                                <thead>
                                <tr>
                                    <th style="text-align: center">TOTALES</th>
                                    <th style="text-align: center">REALIZADAS</th>
                                    <th style="text-align: center">%</th>
                                </tr>
                                </thead>
                                <tbody id="contenidoparticipantes">
                                </tbody>
                            </table>
                            <input type="hidden" id="idgrupoexa" name="idgrupoexa">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <p style="text-align: right; margin-bottom: 0">
                        <a href="javascript:;" id="total_cancel" class='btn btn-default'> Cancelar</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

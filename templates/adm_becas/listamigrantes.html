{% extends "basebs.html" %}
{% load sga_extras %}
{% load static %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <script>
        var cumplerequisito ;
        $(document).ready(function() {
            var nFilas = $("#tablita tr").length;
            $("#total").html(nFilas);
        });
        $(function() {
            $("select").select2({minimumResultsForSearch: 20 });
            $(".tl").tooltip({position:"center up"});

            $("#paises, #estadomatricula").change(function(){
                busqueda();
            });

            busqueda = function(){
                var term = $("#searchinput").val().trim().toUpperCase();
                var p = $("#paises").val();
                var em = $("#estadomatricula").val();
                if (term.length>0){
                    bloqueointerface();
                    location.href = "/adm_becas?action=listamigrante&s="+term+"&p="+p+"&em="+em;
                }
                else{
                    bloqueointerface();
                    location.href = "/adm_becas?action=listamigrante&p="+p+"&em="+em;
                }
                return false;
            };

            $("#search").click(function() {
                busqueda();
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    busqueda();
                }
            });

            $(".detallesolicitud").click(function() {
                $("#aprobarcerrar").css('display', 'none');
                var id = $(this).attr('idt');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_becas",
                    data: {'action': 'probabilidad', 'id': id,'tipo':22},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbody").html(data.data);
                            var height = $(window).height()-150;
                            $("#itemspanel").modal({backdrop: 'static', width: '60%', height: height}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $("#itemspanel .btn-cerrar").click(function() {
                $("#itemspanel").modal("hide");
                return false;
            });

            var tabhojavida = localStorage.getItem('tabhojavida');
            if (!tabhojavida){
                tabhojavida = "#1";
                localStorage.setItem("tabhojavida", tabhojavida);
            }

            $('.tabs').each(function(){
                if ($(this).attr('href') == tabhojavida){
                    $(this).trigger('click');
                }
            }).click(function(){
                localStorage.setItem("tabhojavida", $(this).attr('href'));
            });

            $("#divasignacion").click(function() {
                bloqueointerface();
                location.href = '/adm_becas';
            });
            $("#diveconomica").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listaquintil';
            });
            $("#divpromedio").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listapromedio';
            });
            $("#divdeporte").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listadeporte';
            });
            $("#divdiscapacitados").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listadiscapacitados';
            });
            $("#divsolicitud").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listasolicitudes';
            });
            $("#divprimernivel").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listaprimernivel';
            });
            $("#divetnia").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listaetnia';
            });
            $("#divextranjero").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listaextranjero';
            });
            $("#divmigrante").click(function() {
                bloqueointerface();
                location.href = '/adm_becas?action=listamigrante';
            });
            actualizar_lista = function (id) {
                var id = parseInt(id);
                smoke.confirm("¿Está seguro de solicitar beca.?", function(e){
                    if (e){
                        bloqueointerface();
                        $.post("/adm_becas", {"action":'asignarsolicitud', "id": id,"tipo":22}, function(data) {
                            if (data.result=='ok') {
                                location.href = '/adm_becas?action=listasolicitudes';
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        }, "json");
                    }
                }, {
                    ok: "SI,SEGURO",
                    cancel: "NO,CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            };

            $(".imprimirdiscapacitados").click(function () {
                $("#panelperiodo").modal({backdrop:'static', width: '300'}).modal('show');
            });

            $("#cerrar").click(function () {
                $("#panelperiodo").modal('hide');
            });

            $("#generar").click(function () {
                var periodoacctual=$("#periodoaactual").val();
                var periodovalida=$("#periodovalida").val();
                var modalidad=$("#modalidad").val();
                if (periodoacctual>0  && periodovalida>0 && modalidad>0 ){
                    $("#panelperiodo").modal('hide');
                    openwindow('POST' ,'/adm_becas', {action: 'imprimir_discapacitados', 'periodoactual':periodoacctual, 'periodovalida':periodovalida, 'modalidad':modalidad},'_blank');
                }
            });

            $(".btn-showform").click(function () {
                data_json = $(this).data('json');
                $('.dropdown-menu').trigger('click');
                bloqueointerface();
                $.get("{{request.url}}",data_json)
                    .then(function (data) {
                    if (data.result) {
                        $("#modalform .modal-body").html(data.data);
                        $("#modalform .paneltitleform").html(data.title);
                        $("#modalform").modal({backdrop: 'static', width: '80%'}).modal('show');
                        if(data_json.show){
                            console.log(data_json);
                            $('.btn-guardarmodalform').hide();
                            $('.btn-closemodalform').removeClass('btn-danger');
                            $('.btn-closemodalform').addClass('btn-default');
                            $('.btn-closemodalform').html('<i class="fa fa-window-close"></i> Cancelar');
                            if(cumplerequisito){
                                $('.btn-guardarmodalform').show();
                            }else{
                                $('.btn-guardarmodalform').hide();
                            }
                        }
                        $.unblockUI()
                    } else {
                        NotificationJG.error(data.mensaje)
                        $.unblockUI()
                    }
                }).fail(function (error) {
                    NotificationJG.error('Error en conexión con el servidor');
                    $.unblockUI()
                });
                return false;
            });

            $(".btn-actionadvertencia").click(function () {
                let data_json = $(this).data('json');
                let question = `¿Está seguro de  realizar la acción?<br>
                                <span class="label label-info">${data_json.nombre}</span><br>`;
                for (const elemento of data_json.objects_extra) {
                    question += `<br><span class="label ${elemento.class}">${elemento.name}</span>`;
                }
                Confirm.question(question, function () {
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "{{ request.path }}",
                        data: data_json,
                        success: function (data) {
                            if (data.result) {
                                Swal.fire({
                                    title: `NOTIFICACIÓN`,
                                    text: data.mensaje,
                                    type: 'success',
                                    icon: 'success',
                                    showCancelButton: false,
                                    allowOutsideClick: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar',
                                    cancelButtonText: 'Cancelar'
                                }).then((result) => {
                                    if (result.value) {
                                        bloqueointerface();
                                        location.reload();
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        toast: true,
                                        position: 'top-end',
                                        type: 'error',
                                        title: 'Ocurrio un error inesperado',
                                        showConfirmButton: false,
                                        timer: 6000
                                    });
                                });
                            } else {

                                NotificationJG.error(data.mensaje);
                            }
                            $.unblockUI();
                        },
                        error: function () {
                            $.unblockUI();
                            NotificationJG.error("Error al enviar los datos.");
                        },
                        dataType: "json",
                    });
                }, function () {
                    NotificationJG.info("Enhorabuena el registro esta salvado.!");

                });
            });

            $(".btn-showformimportararchivo").click(function () {
                data_json = $(this).data('json');
                bloqueointerface();
                $('.dropdown-menu').trigger('click');
                $.get("{{request.url}}",data_json)
                    .then(function (data) {
                    if (data.result) {
                        $("#modalformimportararchivo .modal-body").html(data.data);
                        $("#modalformimportararchivo .paneltitleform").html(data.title);
                        $("#modalformimportararchivo").modal({backdrop: 'static', width: '30%'}).modal('show');
                        if(data_json.show){
                            console.log(data_json);
                            console.log(cumplerequisito);
                            $('.btn-closemodalformimportararchivo').removeClass('btn-danger');
                            $('.btn-closemodalformimportararchivo').addClass('btn-default');
                            $('.btn-closemodalformimportararchivo').html('<i class="fa fa-window-close"></i> Cancelar');
                            $('.btn-guardarmodalformimportararchivo').hide();
                        }
                        $.unblockUI();
                    } else {
                        NotificationJG.error(data.mensaje)
                        $.unblockUI();
                    }
                }).fail(function (error) {
                    NotificationJG.error('Error en conexión con el servidor');
                    $.unblockUI()
                });
                return false;
            });

            $(".btn-guardarmodalformimportararchivo").click(function () {
                bloqueointerface();
                console.log($('#modalformimportararchivo .modal-body').find('form'))
                let form = $('#modalformimportararchivo .modal-body').find('form')
                let formdata = new FormData(form[0]);
                $.ajax({
                    type: "POST",
                    url: "{{ request.path }}",
                    data: formdata,
                    success: function (data) {
                        if (data.result === 'ok' || data.result === true) {
                            location.reload();
                        } else {
                            $.unblockUI();
                            NotificationJG.error(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error('Error de conexión  con el servidor');
                    },
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false
                });
            });
            $(".confirmar_eliminar").click(function () {
                var text = $(this).attr("text");
                var id = $(this).attr("idr");
                console.log(text);
                var question = `Al eliminar el registro no podra volver a recuperar los datos. <br>¿Está seguro de eliminar <span class="label label-warning">${text}</span>?`;
                Confirm.ajax({
                    "model": "PreInscripcionBeca",
                    'id': id,
                    "permission": "puede_eliminar_preinscritobeca",
                    "app_label": "sga"
                }, function () {
                    Confirm.question(question, function () {
                        bloqueointerface();
                        var aData = {"action": "deletepreinscripcionbeca", 'id': id}
                        $.ajax({
                            type: "POST",
                            url: "/adm_becas",
                            data: aData,
                            success: function (data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();

                                    Swal.fire({
                                        title: `NOTIFICACIÓN`,
                                        text: data.mensaje,
                                        type: 'success',
                                        icon: 'success',
                                        showCancelButton: false,
                                        allowOutsideClick: false,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: 'Aceptar',
                                        cancelButtonText: 'Cancelar'
                                    }).then((result) => {
                                        if (result.value) {
                                            location.reload();
                                        }
                                    }).catch(error => {
                                        NotificationJG.error(error);
                                        $.unblockUI();
                                    });
                                } else {
                                    NotificationJG.error(data.mensaje);
                                    $.unblockUI();
                                }

                            },
                            error: function () {
                                $.unblockUI();
                                NotificationJG.error("Error al enviar los datos.");
                            },
                            dataType: "json",
                        });
                    }, function () {
                        NotificationJG.info("Enhorabuena el registro esta salvado.!");
                        var h = $(window).height() - 350;
                        $('#modalConfirmAjax').modal({
                            backdrop: 'static',
                            keyboard: false,
                            width: "60%",
                            height: h
                        }).modal('show');
                    });

                }, function () {
                    NotificationJG.info("Enhorabuena el registro esta salvado.!");
                    $.unblockUI();
                });

            });
            $('.btn-fancybox').fancybox({
                openEffect: 'elastic',
                closeEffect: 'elastic',
                //modal: true,
                showCloseButton: true,
                hideOnOverlayClick: false,
                hideOnContentClick: false,
                autoSize: true,
                type: 'iframe',
                iframe: {
                    preload: false // fixes issue with iframe and IE
                }
            });
            $(".btn-showformimportararchivobecarios").click(function () {
                data_json = $(this).data('json');
                bloqueointerface();
                $('.dropdown-menu').trigger('click');
                $.get("{{request.url}}", data_json)
                    .then(function (data) {
                        if (data.result) {
                            $("#modalformimportararchivobecarios .modal-body").html(data.data);
                            $("#modalformimportararchivobecarios .paneltitleform").html(data.title);
                            $("#modalformimportararchivobecarios").modal({backdrop: 'static', width: '30%'}).modal('show');
                            if (data_json.show) {
                                console.log(data_json);
                                console.log(cumplerequisito);
                                $('.btn-closemodalformimportararchivobecarios').removeClass('btn-danger');
                                $('.btn-closemodalformimportararchivobecarios').addClass('btn-default');
                                $('.btn-closemodalformimportararchivobecarios').html('<i class="fa fa-window-close"></i> Cancelar');
                                $('.btn-guardarmodalformimportararchivobecarios').hide();
                            }
                            $.unblockUI();
                        } else {
                            NotificationJG.error(data.mensaje)
                            $.unblockUI();
                        }
                    }).fail(function (error) {
                    NotificationJG.error('Error en conexión con el servidor');
                    $.unblockUI()
                });
                return false;
            });
            $(".btn-guardarmodalformimportararchivobecarios").click(function () {
                bloqueointerface();
                console.log($('#modalformimportararchivobecarios .modal-body').find('form'))
                let form = $('#modalformimportararchivobecarios .modal-body').find('form')
                let formdata = new FormData(form[0]);
                $.ajax({
                    type: "POST",
                    url: "{{ request.path }}",
                    data: formdata,
                    success: function (data) {
                        if (data.result === 'ok' || data.result === true) {
                            $('#modalformimportararchivobecarios').modal("hide");
                            $.unblockUI();
                            NotificationJG.success(data.mensaje);
                        } else {
                            $.unblockUI();
                            NotificationJG.error(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        NotificationJG.error('Error de conexión  con el servidor');
                    },
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false
                });
            });
        });
        function imprimirmigrantes(a=''){
            openwindow('POST' ,'/adm_becas', {action: 'imprimir_migrantes', a:a},'_blank');
        }
    </script>
{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4>
            <h5>PERIODO ACTUAL: {{ periodo }}</h5>
            <h5>PERIODO CALIFICA: {{ periodoanterior }} </h5>
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>
            {#            <div class="btn-group ">#}
            {#                <a class="btn dropdown-toggle " data-toggle="dropdown" href="#"> Configuración <span class="caret"></span></a>#}
            {#                <ul class="dropdown-menu">#}
            {#                    <li><a  href="/adm_becas?action=configbecaperiodo"> <i class="fa fa-cogs"></i> Configuración de Periodo</a></li>#}
            {#                    <li><a  href="/adm_becas?action=listatipobeca"> <i class="fa fa-cogs"></i> Gestión de Tipos de Becas</a></li>#}
            {#                    <li><a  href="/adm_becas?action=listautilizacion"> <i class="fa fa-cogs"></i> Justificativos Desembolso</a></li>#}
            {#                    <li><a  href="/adm_becas?action=listarequisito"> <i class="fa fa-cogs"></i> Gestión de Requisitos</a></li>#}
            {#                </ul>#}
            {#            </div>#}
            <div class="btn-group ">
                <a class="btn dropdown-toggle " data-toggle="dropdown" href="#"> Reportes <span class="caret"></span></a>
                <ul class="dropdown-menu">
{#                    <li><a class="infomepago"> <i class="fa fa-file-pdf-o"></i> Informe de Pago de Beca</a></li>#}
                    <li><a href="javascript:;" onclick="imprimirmigrantes()" class="pull-right"><i class="fa fa-file-excel-o"></i> Generar Excel Migrantes Ecuatorianos Retornados</a></li>
                    <li><a href="javascript:;" onclick="imprimirmigrantes('requisitos_completos')" ><i class="fa fa-file-excel-o"></i> Generar Excel Migrantes Ecuatorianos Retornados aceptados</a></li>
                    <li><a href="javascript:;" onclick="imprimirmigrantes('requisitos_incompletos')" ><i class="fa fa-file-excel-o"></i> Generar Excel Migrantes Ecuatorianos Retornados rechazados</a></li>
{#                    <li><a href="javascript:;" class="imprimirdiscapacitados" class="pull-right"><i class="fa fa-file-excel-o"></i> Generar Excel Discapacitados</a></li>#}
                </ul>
            </div>
            {% with configuracion=tipobeca|args:periodo|call:"get_configuracion_x_periodo" %}
                {% if configuracion %}
                    {% if perms.sga.puede_asignar_actualizar_requisitos_becas %}
                        <a class="btn btn-warning btn-actionadvertencia" data-json='{"action":"addupdatepreinscripcionbecarequisitos", "idc":"{{ configuracion.id|encrypt }}", "id":"{{ tipobeca.id|encrypt }}", "nombre":"{{ tipobeca.nombre }}", "objects_extra":[{"name":"{{ configuracion }}","class":"label-default"}]}'>
                            <span class="fa fa-refresh ">  Asignar/Actualizar requisitos preinscripción </span>
                        </a>
                    {% endif %}
                    {% if perms.sga.puede_importar_archivo_requisitos_becas %}
                        <a href='javascript:;' data-json='{"action":"importar_archivopreinscriptos_becas", "id":"{{ tipobeca.id|encrypt }}" }' class="btn btn-success btn-showformimportararchivo">
                            <i class="fa fa-upload"></i> Importar archivo requisitos
                        </a>
                    {% endif %}
                {% endif %}
            {% endwith %}
            {% if perms.sga.puede_importar_archivo_becarios %}
                {% if matriculados.count > 0 %}
                    <a href='javascript:;' class="btn btn-success btn-showformimportararchivobecarios" data-json='{"action":"importar_archivoexcelbecarios", "id":"{{ tipobeca.id|encrypt }}"}'><i class="fa fa-upload"></i> Importar archivo de becarios</a>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="row-fluid">
        <a class="btn " href="#" id="divasignacion" data-toggle="tab"><i class="fa fa-user-circle-o"></i> BECADOS </a>
        <a class="btn" href="#" id="divsolicitud" data-toggle="tab"><i class="fa fa-id-card-o"></i> SOLICITUDES </a>
        <a class="btn " href="#" id="diveconomica" data-toggle="tab"><i class="fa fa-money"></i> SOCIO ECONÓMICA </a>
        <a class="btn " href="#" id="divpromedio"  data-toggle="tab"><i class="fa fa-star"></i> ACADÉMICA</a>
        <a class="btn" href="#" id="divdeporte"  data-toggle="tab"><i class="fa fa-futbol-o"></i> DEPORTE</a>
        <a class="btn" href="#" id="divdiscapacitados" data-toggle="tab"><i class="fa fa-wheelchair-alt"></i> DISCAPACIDAD</a>
        <a class="btn" href="#" id="divprimernivel" data-toggle="tab"><i class="fa fa-list-ol"></i> PRIMER NIVEL</a>
        <a class="btn" href="#" id="divetnia" data-toggle="tab"><i class="fa fa-list-ol"></i> Etnia/Nacionalidad</a>
        <a class="btn" href="#" id="divextranjero" data-toggle="tab"><i class="fa fa-list-ol"></i> Ecuatoriano en el Extranjero</a>
        <a class="btn btn-success" href="#" id="divmigrante" data-toggle="tab"><i class="fa fa-list-ol"></i> Migrante retornado o deportado</a>
    </div><hr>
    <div class="row-fluid">
        <div style="" class="span1">
        </div>
        <div style="" class="span3">
            <form class="form-search">
                <label><b>Estado de Matricula:</b></label>
                <select name="estadomatricula" id="estadomatricula" data-width="50%">
                    <option value="0">--TODOS--</option>
                    <option value="1" {% if em_id == 1 %}selected{% endif %}>Pendiente de Pago</option>
                    <option value="2" {% if em_id == 2 %}selected{% endif %}>Matriculado</option>
                </select>
            </form>
        </div>
        <div style="" class="span3">
            <form class="form-search">
                <label><b>Pais de Retorno:</b></label>
                <select name="paises" id="paises" data-width="50%">
                    <option value="0">--TODOS--</option>
                    {% for pais in paises %}
                        <option value="{{ pais.id }}" {% if p_id == pais.id %}selected{% endif %}>{{ pais.nombre }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <div style="text-align: right;" class="span5">
            <form class="form-search">
                <label><b>Busqueda:</b></label>
                <input class='searchinput' type='text' id='searchinput' placeholder="Buscar por cédula" value='{{ search }}' autocomplete="off"/>
                <a href="javascript:;" id='search' class='btn btn-info'><span class="fa fa-search " ></span> Buscar</a>
                {% if search or ids %}
                    <a href="/adm_becas?action=listamigrante" id='allresults' class='btn btn-info'><span class="fa fa-refresh " ></span> Todos</a>
                {% endif %}
            </form>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a class="tabs" href="#menu1" data-toggle="tab">
                        <img src="/static/images/iconosmini/categorias.png" width="15px"> Listado
                    </a>
                </li>
                <li class="">
                    <a class="tabs" href="#menu2" data-toggle="tab">
                        <img src="/static/images/iconosmini/planpractica.png" width="15px"> Resumen
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="menu1">
                    <div class="row-fluid">
                        <div class="span12">
                            <div id="no-more-tables">
                                <table class='table table-bordered' id="discapacitados" cellpadding="0" cellspacing="0">
                                    <thead>
                                    <tr><th colspan="8" >Total: {{ total }}</th></tr>
                                    <tr>
                                        <th style="width: 8%; text-align: center; vertical-align: middle">-</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle">ORDEN</th>
                                        <th style="width: 45%; text-align: center; vertical-align: middle">ESTUDIANTE</th>
                                        <th style="width: 9%; text-align: center; vertical-align: middle">RESIDENCIA</th>
                                        <th style="width: 12%; text-align: center; vertical-align: middle">NIVEL / MATRICULA</th>
                                        <th style="width: 12%; text-align: center; vertical-align: middle">EMAIL / TELÉFONOS</th>
                                        <th style="width: 8%;text-align: center; vertical-align: middle">FOTO</th>
                                        <th style="width: 10%; text-align: center; vertical-align: middle">ACCIONES</th>
                                    </tr>
                                    </thead>
                                    <tbody id="tablita">
                                    {% for becado in matriculados %}
                                        {% with notas=becado|args:anterior|args:tipobeca.minimo_asistencia|args:tipobeca.minimo_promedio|call:'promedio_asistencia_alumno' %}
                        {#                    {% for r in requisitos|slice:":1" %}#}
                        {#                        {% with valida=r|args:becado.inscripcion.id|args:idper|args:tipobeca.minimo_asistencia|args:tipobeca.minimo_promedio|call:'validar_requisito_general' %}#}
                                                   {% with preinscripcionbeca=becado.get_preinscripcionbeca %}
                                                    <tr>
                                                        <td style="text-align: center; vertical-align: middle">
                                                            {% with estadorenovacion=becado|args:tipobeca|args:periodoanterior|call:'estado_renovacion_beca' %}
                                                                {{ estadorenovacion }}
                                                            {% endwith %}
                                                        </td>
                                                        <td style="text-align: center; vertical-align: middle">{{ preinscripcionbeca.orden }}</td>
                                                        <td style="vertical-align: middle">
                                                            <b>Apellidos y Nombres: </b>{{ becado.inscripcion.persona }}<br>
                                                            <b>Documento: </b>{{ becado.inscripcion.persona.cedula }}<br>
                                                            <b>Dirección: </b>{{ becado.inscripcion.persona.direccion_completa }}<br>
                                                            <b>Carrera: </b>{{ becado.inscripcion.carrera }}<br>
                                                            <b>Promedio General: </b> {{ notas.0.0 }}
                                                            <b>Asistencia: </b> {{ notas.0.1 }}
                                                        </td>
                                                        <td style="vertical-align: middle; text-align: center">
                                                            <b>Pais Retorno: </b>{{ becado.inscripcion.persona.registro_migrante.paisresidencia.nombre }} <br>
                                                            <b>Años - Meses: </b>{{ becado.inscripcion.persona.registro_migrante.anioresidencia }} - {{ becado.inscripcion.persona.registro_migrante.mesresidencia }} <br>
                                                            <b>Fecha: </b>{{ becado.inscripcion.persona.registro_migrante.fecharetorno | date:'Y-m-d' }}
                                                        </td>
                                                        <td style="vertical-align: middle; text-align: center">
                                                            {%  if becado.inscripcion.estado_gratuidad == 1 %}
                                                                <span class="label label-success tu" data-original-title="Estado de Gratuidad" >GRATUIDAD COMPLETA</span> <br>
                                                            {% endif %}
                                                            {%  if becado.inscripcion.estado_gratuidad == 2 %}
                                                                <span class="label label-success tu" data-original-title="Estado de Gratuidad" >GRATUIDAD PARCIAL</span> <br>
                                                            {% endif %}
                                                            <span class="label label-info tu" title="Nivel academico"> {{ becado.inscripcion.sesion.nombre }} - {{ becado.nivelmalla }}</span> <br>
                                                            {% if becado.estado_matricula == 1 %}
                                                                <span class="label label-warning tu" title="Estado de Matricula">{{ becado.get_estado_matricula }}</span>
                                                            {% else %}
                                                                <span class="label label-success tu" title="Estado de Matricula">{{ becado.get_estado_matricula }}</span>
                                                            {% endif %}
                                                            {% with matricula=becado.inscripcion|args:periodo|call:"matricula_periodo" %}
                                                                {% if matricula.tipomatriculalumno %}
                                                                    <br> <b>Per actual:</b>
                                                                    <span class="label {% if matricula.tipomatriculalumno == "REGULAR" %}label-success{% else %}label-inverse{% endif %} tu" >
                                                                                {{ matricula.tipomatriculalumno }}
                                                                            </span>
                                                                {% endif %}
                                                            {% endwith %}<br>
                                                            {% with matricula=becado.inscripcion|args:periodoanterior|call:"matricula_periodo" %}
                                                                {% if matricula.tipomatriculalumno %}
                                                                    <b>Per anterior:</b>
                                                                    <span class="label {% if matricula.tipomatriculalumno == "REGULAR" %}label-success{% else %}label-inverse{% endif %} tu" >
                                                                                {{ matricula.tipomatriculalumno }}
                                                                            </span>
                                                                {% endif %}
                                                            {% endwith %}
                                                        </td>
                                                        <td class="hidden-phone hidden-tablet " style="vertical-align: middle">
                                                            {% if becado.inscripcion.persona.email %}<a href="mailto:{{ becado.inscripcion.persona.email}}">{{ becado.inscripcion.persona.email }}</a><br>{% endif %}
                                                            {% if becado.inscripcion.persona.emailinst %}<a href="mailto:{{ becado.inscripcion.persona.emailinst}}">{{ becado.inscripcion.persona.emailinst }}</a><br>{% endif %}
                                                            {%  for telefono in becado.inscripcion.persona.lista_telefonos %}
                                                                {{ telefono }}{% if not forloop.last %}, {% endif %}
                                                            {% endfor %}
                                                            {% if becado.inscripcion.identificador %}
                                                                <br/><span class="label label-info">{{ becado.inscripcion.identificador }}</span>
                                                            {% endif %}
                                                        </td>
                                                        <td style="text-align: center; vertical-align: middle">
                                                            {% if becado.inscripcion.persona.tiene_foto %}
                                                                <a title="{{ becado.inscripcion.persona.nombre_completo }}" href='{{ becado.inscripcion.persona.foto.foto.url }}' class="fancybox" rel="group"><img src="{{ becado.inscripcion.persona.foto.foto.url }}" width="30px"></a>
                                                            {% endif %}
                                                        </td>
                                                        <td style="text-align: center; vertical-align: middle">
                                                            <div class="btn-group" style="text-align: left">
                                                                <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span class="caret"></span>
                                                                </a>
                                                                <ul class="dropdown-menu pull-right">
                                                                    <li>
                                                                        <a href="javascript:;" id="asignar" idn="{{ becado.inscripcion.id }}" onclick="actualizar_lista({{ becado.inscripcion.id }});" class="tu">
                                                                            <span class="fa fa-id-card-o"></span> Solicitar Beca
                                                                        </a>
                                                                    </li>
                                                                    <li>
                                                                        <a href="javascript:;" idt="{{ becado.inscripcion.id }}" class="detallesolicitud" data-original-title="Probabilidad Becado">
                                                                            <i class="fa fa-eye"></i> Ver Probabilidad
                                                                        </a>
                                                                    </li>
                                                                    <li>
                                                                        <a href='javascript:;' data-json='{"action":"showrequisitospreinscripcion", "show":true, "id":"{{ becado.inscripcion.id|encrypt }}" }' class="btn-showform">
                                                                            <i class="fa fa-eye "></i> Cumplimiento de Requisitos
                                                                        </a>
                                                                    </li>
                                                                    {% if perms.sga.puede_eliminar_preinscritobeca %}
                                                                            <li><a class="confirmar_eliminar" href="javascript:;" idr="{{ preinscripcionbeca.id }}" text="{{ preinscripcionbeca}}"><i class="fa fa-trash"></i> Eliminar</a></li>
                                                                    {% endif %}
                                                                </ul>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endwith %}
                        {#                        {% endwith %}#}
                        {#                    {% endfor %}#}
                                        {% endwith %}
                                    {% empty %}
                                        <tr style="text-align: center">
                                            <td colspan="6">NO EXISTEN  REGISTROS</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class='row-fluid'>
                                        <div class="span12">
                                            {% if paging.num_pages > 10 %}
                                                <div class='pagination'>
                                                    <ul>
                                                        {% if paging.primera_pagina %}
                                                            <li><a href="/adm_becas?action=listamigrante&{% if search %}s={{ search }}&{% endif %}page=1">1</a></li>
                                                            <li><a href="/adm_becas?action=listamigrante&{% if search %}s={{ search }}&{% endif %}page={{ paging.ellipsis_izquierda }}" class="active">...</a></li>
                                                        {% endif %}
                                                        {% for pagenumber in paging.paginas %}
                                                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_becas?action=listamigrante&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>
                                                        {% endfor %}
                                                        {% if paging.ultima_pagina %}
                                                            <li><a href="/adm_becas?action=listamigrante&{% if search %}s={{ search }}&{% endif %}page={{ paging.ellipsis_derecha }}" class="active">...</a></li>
                                                            <li><a href="/adm_becas?action=listamigrante&{% if search %}s={{ search }}&{% endif %}page={{ paging.num_pages }}">{{ paging.num_pages }}</a></li>
                                                        {% endif %}
                                                    </ul>
                                                </div>
                                            {% else %}
                                                <div class='pagination'>
                                                    <ul>
                                                        {% for pagenumber in paging.page_range %}
                                                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_becas?action=listamigrante&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="menu2">
                    <div class="row-fluid">
                        <div class='span6'>
                            <table class="table table-striped table-bordered">
                                <thead>
                                <tr>
                                    <th style="text-align: center"><i class="fa fa-tag"></i> Estado</th>
                                    <th style="text-align: center"><i class="fa fa-users"></i> Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td style="text-align: center"><i class="fa fa-circle"
                                                                      style="color:#2ECC71; font-size: 18px"></i> Nueva
                                    </td>
                                    <td style="text-align: center">{{ resumen.count_nueva }}</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center"><i class="fa fa-circle"
                                                                      style="color:#F4D03F; font-size: 18px"></i>
                                        Renovación
                                    </td>
                                    <td style="text-align: center">{{ resumen.count_renovacion }}</td>
                                </tr>
                                </tbody>
                            </table>
                            <table class="table table-striped table-bordered">
                                <thead>
                                <tr>
                                    <th style="text-align: center"><i class="fa fa-tag"></i> Estado Matricula</th>
                                    <th style="text-align: center"><i class="fa fa-users"></i> Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for estado_matr in resumen.estados_matriculas %}
                                    <tr>
                                        <td style="text-align: center">{{ estado_matr.name }}</td>
                                        <td style="text-align: center">{{ estado_matr.count }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class='span6'>
                            <table class="table table-striped table-bordered">
                                <thead>
                                <tr>
                                    <th style="text-align: center"><i class="fa fa-tag"></i> Cumplimientos de Requisitos
                                    </th>
                                    <th style="text-align: center"><i class="fa fa-users"></i> Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td style="text-align: center"><i class="fa fa-circle"
                                                                      style="color:#F4D03F; font-size: 18px"></i>
                                        Pedientes de validar
                                    </td>
                                    <td style="text-align: center">{{ resumen.totalpendientesrequisitos }}</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center"><i class="fa fa-circle"
                                                                      style="color:#2ECC71; font-size: 18px"></i>
                                        Cumplen todos los requisitos
                                    </td>
                                    <td style="text-align: center">{{ resumen.totalcumplenrequisitos }}</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center"><i class="fa fa-circle"
                                                                      style="color:#b80c2e; font-size: 18px"></i> No
                                        Cumplen todos los requisitos
                                    </td>
                                    <td style="text-align: center">{{ resumen.totalrechazadosrequisitos }}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span12">
                            <table class="table table-bordered table-striped tabla_paginada">
                                <thead>
                                <tr>
                                    <th style="text-align: center"><i class="fa fa-book"></i> Carrera</th>
                                    {% for nivel in niveles %}
                                        <th style="text-align: center">
                                            {{ nivel }}
                                        </th>
                                    {% endfor %}
                                    <th style="text-align: center">Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for carrera in resumen.carreras %}
                                    <tr>
                                        <td style="text-align: center">{{ carrera.name }}</td>
                                        {% for countbecariosnivel in carrera.niveles %}
                                            <td style="text-align: center; {% if countbecariosnivel > 0 %}background-color:#a5dc86;{% endif %}">{{ countbecariosnivel }}</td>
                                            {#                                        {{ car |args:nivel|args:matriculados|call:"total_preinscripcion__becas" }}#}
                                        {% endfor %}
                                        <td style="text-align: center">{{ carrera.total }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="10" style="text-align: center">
                                            <i class="fa fa-info-circle"></i> SIN REGISTROS
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade static" id="itemspanel" style="display: none;" data-width="" aria-labelledby="" aria-hidden="true" tabindex="-1" role="dialog" style="display: block;"  data-keyboard="false" data-backdrop="static">
        <div class="modal-header">
            <h3 class="paneltitle">Mostrar Cumplimiento de Requisitos Generales</h3>
        </div>
        <div class="modal-body panelbody">

        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-aprobarcerrar btn-success"> Guardar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="modal fade static" id="panelperiodo" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitle">Seleccione periodo</h4>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-danger invalidofechas" style="display: none">
                <i class="fa fa-info-sign"></i> Seleccione periodo...!!!
            </div>
            <div style="text-align: center;">
                <label style="font-size: 12px">Periodo actual:
                    <select style="width: 100%" class="no-margin-bottom select2" id='periodoaactual' >
                        {% for periodo1 in periodosregular %}
                            <option {% if periodo.id == periodo1.id %}selected{% endif %} value="{{ periodo1.id }}">{{ periodo1 }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label style="font-size: 12px">Periodo valida:
                    <select style="width: 100%" class="no-margin-bottom select2" id='periodovalida'>
                        {% for periodo2 in periodosregular %}
                            <option {% if periodoanterior.id == periodo2.id %}selected{% endif %} value="{{ periodo2.id }}">{{ periodo2 }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label style="font-size: 12px">Modalidad:
                    <select style="width: 100%" class="no-margin-bottom select2" id='modalidad'>
                        {% for modalidad in modalidadesinscripcion %}
                            <option value="{{ modalidad.id }}">{{ modalidad }}</option>
                        {% endfor %}
                    </select>
                </label>
            </div>
        </div>
        <div class="modal-footer" style="text-align: center">
            <a href="javascript:;" class="btn btn-danger" id="generar"><i class="fa fa-plus"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info" id="cerrar"> Cancelar</a>
        </div>
    </div>
    <div class="row-fluid">
        <div class="modal fade static" id="modalform" style="display: none;">
            <div class="modal-header">
                <h4><i class="fa fa-list"></i> <b class="paneltitleform">FORMULARIO MODAL</b></h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <div class="row-fluid">
                    <div class="form-group">
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-12">
                            <button type="button" id="submit"
                                    class="btn btn-success btn-guardarmodalform">
                                <i class="fa fa-file"></i> Generar solicitud Beca
                            </button>
                            <a href="javascript:;" class="btn btn-danger btn-closemodalform" data-dismiss="modal">
                                <i class="fa fa-window-close"></i>Cancelar
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="modal fade static" id="modalformimportararchivo" style="display: none;" data-width="" aria-labelledby="" aria-hidden="true" tabindex="-1" role="dialog" style="display: block;"  data-keyboard="false" data-backdrop="static">
            <div class="modal-header">
                <h4><i class="fa fa-list"></i> <b class="paneltitleform">FORMULARIO MODAL</b></h4>
                <a class="btn btn-success btn-mini tu btn-fancybox" style="margin-top: 10px;"
             data-fancybox-type="iframe" href="{% static 'formatos_importacion/plantilla_requisitos_preinscritosbecas.pdf' %}"
             title="Explicación de importación">
             <i class="fa fa-file-pdf-o"></i>
             </a>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <div class="row-fluid">
                    <div class="form-group">
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-12">
                            <button type="button" id="submit"
                                    class="btn btn-success btn-guardarmodalformimportararchivo">
                                <i class="fa fa-upload"></i> Importar
                            </button>
                            <a href="javascript:;" class="btn btn-danger btn-closemodalformimportararchivo" data-dismiss="modal">
                                <i class="fa fa-window-close"></i>Cancelar
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="modal fade static" id="modalformimportararchivobecarios" style="display: none;" data-width=""
             aria-labelledby=""
             aria-hidden="true" tabindex="-1" role="dialog" style="display: block;" data-keyboard="false"
             data-backdrop="static">
            <div class="modal-header">
                <h4><i class="fa fa-list"></i> <b class="paneltitleform">FORMULARIO MODAL</b></h4>
                <a class="btn btn-success btn-mini tu btn-fancybox" style="margin-top: 10px;"
                   data-fancybox-type="iframe"
                   href="{% static 'formatos_importacion/plantilla_requisitos_preinscritosbecas.pdf' %}"
                   title="Explicación de importación">
                    <i class="fa fa-file-pdf-o"></i>
                </a>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <div class="row-fluid">
                    <div class="form-group">
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-12">
                            <button type="button" id="submit"
                                    class="btn btn-success btn-guardarmodalformimportararchivobecarios">
                                <i class="fa fa-upload"></i> Importar
                            </button>
                            <a href="javascript:;" class="btn btn-danger btn-closemodalformimportararchivo"
                               data-dismiss="modal">
                                <i class="fa fa-window-close"></i>Cancelar
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}

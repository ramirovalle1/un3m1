{% load sga_extras %}
{% load humanize %}
{% load tz %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<?python import sitetemplate ?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://purl.org/kid/ns#" py:extends="sitetemplate">
<html lang="en">
<head>
    <meta charset=UTF-8">
    <style type="text/css">

        @page {
            size: a4 landscape;/*size: a4 landscape;*/
            left: 1.5cm;
            right: 1.5cm;
            bottom: 1.5cm;
            top: 6.4cm;
            @frame header_frame {
                -pdf-frame-content: header_content;
                margin-left: 1.5cm;  margin-right: 1.5cm ; margin-top: 1.0cm; height: 4cm;
            }
            @frame footer {
                -pdf-frame-content: footerContent;
                bottom: 0cm;
                margin-left: 2.5cm;
                margin-right: 1cm;
                text-align: right;
                height: 1cm;
            }
        }

        @page horizontal {
            size: a4 landscape;/*size: a4 landscape;*/
            left: 1.5cm;
            right: 1.5cm;
            bottom: 1.5cm;
            top: 6.4cm;
            @frame header_frame {
                -pdf-frame-content: header_content_2;
                margin-left: 1.5cm;  margin-right: 1.5cm ; margin-top: 1.0cm; height: 4cm;
            }
            @frame footer {
                -pdf-frame-content: footerContent;
                bottom: 0cm;
                margin-left: 2.5cm;
                margin-right: 1cm;
                text-align: right;
                height: 1cm;
            }
        }


        {#@page horizontal {#}
        {#    size: a4 landscape;#}
        {#    left: 2.5cm;#}
        {#    right: 2.5cm;#}
        {#    bottom: 1.5cm;#}
        {#    top: 4.0cm;#}
        {#    @frame header_frame {#}
        {#    -pdf-frame-content: header_content;#}
        {#    margin-left: 1.5cm;  margin-right: 1.5cm ; margin-top: 1.0cm; height: 4cm;#}
        {#}#}
        {#@frame footer {#}
        {#-pdf-frame-content: footerContent;#}
        {#bottom: 0cm;#}
        {#margin-left: 2.5cm;#}
        {#margin-right: 1cm;#}
        {#text-align: right;#}
        {#height: 1cm;#}
        {#}#}
        {#}#}
    </style>
</head>
<body>
<div id="header_content">
    <table style="text-align: center; width: 100%;">
        <tr>
            <td style="width: 22%; text-align: right; vertical-align: middle;"><img src="https://sga.unemi.edu.ec/media/reportes/encabezados_pies/logounemi2022.jpg" width="200" height="70"></td>
            <td style="width: 56%; font-size:19px; font-family: 'Arial Black'; color: rgb(3, 45, 70); text-align: center">
                <table style="border: 0px; padding: 2px; line-height: 10px;">
                    <tr>
                        <td style="font-weight: bold">Vicerrectorado de Investigación y Posgrado</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold">Coordinación de Investigación</td>
                    </tr>
                    <tr>
                        <td style="font-size: 17px;">Evaluación Externa de Propuestas de Proyectos de Investigación</td>
                    </tr>
                    <tr>
                        <td style="font-size: 17px;">{{ data.evaluacion.proyecto.convocatoria.descripcion }}</td>
                    </tr>
                </table>
            </td>
            <td style="width: 22%;" valign="top"><br>
                <div style="text-align: right; font-size: 8px; font-weight: bold; font-family: Arial; color: rgb(3, 45, 70)">
{#                    No {{ data.evaluacion.id }}#}
{#                    <br>#}
{#                    Fecha de emisión: {{ data.evaluacion.fecha|date:"d-m-Y" }}<br>#}
                    Página:	<pdf:pagenumber></pdf:pagenumber> de <pdf:pagecount></pdf:pagecount>
                </div>
            </td>
        </tr>
    </table>
    <br>
    <table style="border: 0.5px solid #000000; font-size:14px; line-height:10px; vertical-align:top; padding:3px; font-family: Times New Roman">
        <tr>
            <td style="width: 80%; color: rgb(3, 45, 70); background-color: rgb(239, 239 ,239);"><b>Título:</b></td>
            <td style="width: 7%; color: rgb(3, 45, 70); background-color: rgb(239, 239 ,239);"><b>Código:</b></td>
            <td style="width: 13%;">{{ data.evaluacion.proyecto.codigo|default_if_none:"" }}</td>
        </tr>
        <tr>
            <td colspan="3" style="text-align: justify">{{ data.evaluacion.proyecto.titulo }}</td>
        </tr>
    </table>
    <div style="text-align: justify; padding-top: 10px; padding-bottom: 10px; font-family: Times New Roman; font-size: 16px; color: rgb(3, 45, 70);"><strong>Rúbricas de Evaluación</strong></div>
</div>

<div id="header_content_2">
    <table style="text-align: center; width: 100%;">
        <tr>
            <td style="width: 22%; text-align: right; vertical-align: middle;"><img src="https://sga.unemi.edu.ec/media/reportes/encabezados_pies/logounemi2022.jpg" width="200" height="70"></td>
            <td style="width: 56%; font-size:19px; font-family: 'Arial Black'; color: rgb(3, 45, 70); text-align: center">
                <table style="border: 0px; padding: 2px; line-height: 10px;">
                    <tr>
                        <td style="font-weight: bold">Vicerrectorado de Investigación y Posgrado</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold">Coordinación de Investigación</td>
                    </tr>
                    <tr>
                        <td style="font-size: 17px;">Evaluación Externa de Proyectos de Investigación</td>
                    </tr>
                    <tr>
                        <td style="font-size: 17px;">Convocatoria {{ data.evaluacion.proyecto.convocatoria.descripcion }}</td>
                    </tr>
                </table>
            </td>
            <td style="width: 22%;" valign="top"><br>
                <div style="text-align: right; font-size: 8px; font-weight: bold; font-family: Arial; color: rgb(3, 45, 70)">
{#                    No {{ data.evaluacion.id }}#}
{#                    <br>#}
{#                    Fecha de emisión: {{ data.evaluacion.fecha|date:"d-m-Y" }}<br>#}
                    Página:	<pdf:pagenumber></pdf:pagenumber> de <pdf:pagecount></pdf:pagecount>
                </div>
            </td>
        </tr>
    </table>
    <br>
    <table style="border: 0.5px solid #000000; font-size:14px; line-height:10px; vertical-align:top; padding:3px; font-family: Times New Roman">
        <tr>
            <td style="width: 80%; color: rgb(3, 45, 70); background-color: rgb(239, 239 ,239);"><b>Título:</b></td>
            <td style="width: 7%; color: rgb(3, 45, 70); background-color: rgb(239, 239 ,239);"><b>Código:</b></td>
            <td style="width: 13%;">{{ data.evaluacion.proyecto.codigo|default_if_none:"" }}</td>
        </tr>
        <tr>
            <td colspan="3" style="text-align: justify">{{ data.evaluacion.proyecto.titulo }}</td>
        </tr>
    </table>
{#    <div style="text-align: justify; padding-top: 10px; padding-bottom: 10px; font-family: Times New Roman; font-size: 16px; color: rgb(3, 45, 70);"><strong>Rúbricas de Evaluación</strong></div>#}
</div>

<div style="text-align: justify; font-family: Times New Roman; font-size: 11px;">
    <table repeat="1" style="border: 0.5px solid #000000; font-size:11px; line-height:10px; vertical-align:middle; padding:3px; font-family: Times New Roman;">
        <tr style="color: rgb(3, 45, 70);">
            <td width="2%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">N°</td>
            <td width="15%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">CATEGORÍA</td>
            <td width="69%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">ITEM</td>
            <td width="7%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">PUNTAJE MÁXIMO</td>
            <td width="7%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">PUNTAJE ASIGNADO</td>
        </tr>
        {% for rubrica in data.rubricas %}
            {% with detalles=data.evaluacion|args:rubrica|call:"detalle_evaluacion_items_rubrica" %}
                {% for detalle in detalles %}
                    {% if forloop.counter == 1 %}
                        <tr>
                            <td style="text-align: center">{{ detalle.numero }}</td>
                            <td style="text-align: center" rowspan="{{ rubrica.total_items_rubrica }}">
                                <strong>{{ rubrica.categoria }} {{ rubrica.valoracion }}</strong><br>
                                {{ rubrica.descripcion }}
                            </td>
                            <td style="text-align: justify;">
                                {{ detalle.rubricaitem.item }}
                            </td>
                            <td style="text-align: center;">
                                {{ detalle.rubricaitem.puntajemaximo }}
                            </td>
                            <td style="text-align: center">
                                {{ detalle.puntaje }}
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td style="text-align: center">{{ detalle.numero }}</td>
                            <td style="text-align: justify">
                                {{ detalle.rubricaitem.item }}
                            </td>
                            <td style="text-align: center">
                                {{ detalle.rubricaitem.puntajemaximo }}
                            </td>
                            <td style="text-align: center">
                                {{ detalle.puntaje }}
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% endwith %}
        {% endfor %}
        <tr style="color: rgb(3, 45, 70);">
            <td colspan="3" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">TOTAL</td>
            <td style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">100</td>
            <td style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239);">{{ data.evaluacion.puntajetotal }}</td>
    </table>
</div><br>


<pdf:nextpage name="horizontal">
    <div style="text-align: justify; font-family: Times New Roman; font-size: 11px;">
        <table style="border: 0px solid #000000; font-size:11px; line-height:10px; vertical-align:middle; padding:3px; font-family: Times New Roman;">
            <tr style="color: rgb(3, 45, 70);">
                <td colspan="3" width="86%" style="text-align: right; font-weight: bold;">DECISIÓN</td>
                <td width="7%" style="text-align: center; font-weight: bold;"></td>
                <td width="7%" style="text-align: center; font-weight: bold;"></td>
            </tr>
            <tr style="color: rgb(3, 45, 70);">
                <td colspan="3" width="69%" style="text-align: right;"> EL PROYECTO ES ACEPTADO Y NO REQUIERE MODIFICACIONES(PUNTAJE MAYOR O IGUAL A {{ data.minimoaprobacion }})</td>
                <td width="7%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239); border: 1px; ">{% if data.evaluacion.estado == 1 %}X{% endif %}</td>
                <td width="7%" style="text-align: center; font-weight: bold;">&nbsp;</td>
            </tr>
            <tr style="color: rgb(3, 45, 70);">
                <td colspan="3" width="69%" style="text-align: right;"> EL PROYECTO SERÁ ACEPTADO LUEGO DE MODIFICACIONES MENORES(PUNTAJE MAYOR O IGUAL A {{ data.minimoaprobacion }})</td>
                <td width="7%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239); border: 1px; ">{% if data.evaluacion.estado == 2 %}X{% endif %}</td>
                <td width="7%" style="text-align: center; font-weight: bold;">&nbsp;</td>
            </tr>
            <tr style="color: rgb(3, 45, 70);">
                <td colspan="3" width="69%" style="text-align: right;"> EL PROYECTO DEBE SER PRESENTADO NUEVAMENTE LUEGO DE MODIFICACIONES MAYORES</td>
                <td width="7%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239); border: 1px; ">{% if data.evaluacion.estado == 3 %}X{% endif %}</td>
                <td width="7%" style="text-align: center; font-weight: bold;">&nbsp;</td>
            </tr>
            <tr style="color: rgb(3, 45, 70);">
                <td colspan="3" width="69%" style="text-align: right;"> EL PROYECTO ES RECHAZADO</td>
                <td width="7%" style="text-align: center; font-weight: bold; background-color: rgb(239, 239, 239); border: 1px; ">{% if data.evaluacion.estado == 4 %}X{% endif %}</td>
                <td width="7%" style="text-align: center; font-weight: bold;">&nbsp;</td>
            </tr>
        </table>

        <table style="border: 0px solid #000000; font-size:11px; line-height:10px; vertical-align:middle; padding:3px; font-family: Times New Roman;">
            <tr style="color: rgb(3, 45, 70);">
                <td style="text-align: left; font-weight: bold;">Observaciones</td>
            </tr>
            <tr style="color: rgb(3, 45, 70);">
                <td style="text-align: justify; background-color: rgb(239, 239, 239); border: 1px; ">
                    {% if data.evaluacion.observacion %}
                        {{ data.evaluacion.observacion }}
                    {% else %}
                        &nbsp;
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
    <br>
{#    <h3 style="font-family: Times New Roman; font-size: 16px; color: rgb(3, 45, 70);">Firmas de responsabilidad</h3>#}
    <div style="text-align: justify; font-family: Times New Roman; font-size: 11px;">

        <table style="border: 0px solid #000000; font-size:11px; line-height:10px; vertical-align:middle; padding:3px; font-family: Times New Roman;">
            <tr style="color: rgb(3, 45, 70);">
                <td style="text-align: left; font-weight: bold; font-size: 16px;">Firmas de Responsabilidad</td>
                <td style="text-align: right; font-size: 14px;">Milagro, {{ data.fechaevaluacion }}</td>
            </tr>
        </table>

        <table style="border: 0px; font-size:14px; line-height:10px; vertical-align:top; padding:3px; font-family: Times New Roman">
            <tr style="height: 120px;">
                <td style="text-align: center; vertical-align: bottom;">________________________________________</td>
                <td style="text-align: center; vertical-align: bottom;">________________________________________</td>
                <td style="text-align: center; vertical-align: bottom;">________________________________________</td>
            </tr>
            <tr>
                <td style="text-align: center;">{{ data.evaluador }}</td>
                <td style="text-align: center;">{% if data.coordinador %}{{ data.coordinador }}{% else %}&nbsp;{% endif %}</td>
                <td style="text-align: center;">{% if data.director %}{{ data.director }}{% else %}&nbsp;{% endif %}</td>
            </tr>
            <tr>
                <td style="text-align: center; font-weight: bold; vertical-align: top;">EVALUADOR DEL PROYECTO</td>
                <td style="text-align: center; font-weight: bold; vertical-align: top;">{% if data.coordinador.mi_cargo_actual %}{{ data.coordinador.mi_cargo_actual.denominacionpuesto.descripcion }}{% else %}&nbsp;{% endif %}</td>
                <td style="text-align: center; font-weight: bold; vertical-align: top;">{% if data.director.mi_cargo_actual %}{{ data.director.mi_cargo_actual.denominacionpuesto.descripcion }}{% else %}&nbsp;{% endif %}</td>
            </tr>
        </table>
    </div>
</body>
</html>
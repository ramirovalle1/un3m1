{% extends 'basebs.html' %}
{% block atras %}/{% endblock %}
{% block heading %}
    <script type="text/javascript" src='/static/js/select2.js?v=1.0.0'></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=1.0.0"/>
    <script>
        $(function () {
            $(".deletetematica").click(function () {
                var codtematica = $(this).attr('codtematica');
                var nomtematica = $(this).attr('nomtematica');
                smoke.confirm("¿Está seguro de eliminar temática de " + nomtematica + ".?", function (e) {
                    if (e) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/adm_complexivotematica",
                            data: {'action': 'deletetematica', 'codtematica': codtematica},
                            error: function () {
                                $.unblockUI();
                                smoke.alert("Error al obtener los datos.");
                            },
                            success: function (data) {
                                if (data.result == "ok") {
                                    location.reload();
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            }
                        });
                    }
                }, {
                    ok: "SI, ELIMINAR",
                    cancel: "NO, CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });

            });

            $("select").select2({minimumResultsForSearch: 15});
            busqueda = function () {
                var term = $("#searchinput").val().trim().toUpperCase();
                var pid = $("#titperiodo").val();
                var fid = $("#facul_list").val();
                var cid = $("#carre_list").val();
                var aid = $("#opci_list").val();
                bloqueointerface();
                if (term.length > 0) {
                    if (parseInt(pid) > 0) {
                        if (parseInt(fid) > 0) {
                            if (parseInt(cid) > 0) {
                                if (parseInt(aid) > 0) {
                                    location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid + "&fac=" + fid + "&car=" + cid + "&opc=" + aid;
                                } else {
                                    location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid + "&fac=" + fid + "&car=" + cid;
                                }
                            } else {
                                if (parseInt(aid) > 0) {
                                    location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid + "&fac=" + fid + "&opc=" + aid;
                                } else {
                                    location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid + "&fac=" + fid;
                                }
                            }
                        } else {
                            if (parseInt(aid) > 0) {
                                location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid + "&opc=" + aid;
                            } else {
                                location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid;
                            }
                        }
                    } else {
                        alert("1");
                        location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid;
                    }
                } else {
                    location.href = "/adm_complexivotematica?s=" + term + "&per=" + pid;
                }
                return false;
            };
            $("#search").click(function () {
                busqueda();
            });
            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });

            $("#titperiodo").change(function () {
                bloqueointerface();
                var id = $(this).val();
                var facultad = $('#facul_list').val();
                var carrera = 0;
                if ($('#carre_list').val() !== null) {
                    carrera = $('#carre_list').val();
                }
                location.href = "/adm_complexivotematica?per=" + id + "&fac=" + facultad + "&car=" + carrera;
            });

            {% if perms.sga.puede_editar_cupotematica %}
                $('.cupos').blur(function () {
                    var elemento = $(this);
                    var id;
                    var valoranterior = elemento.attr("va");
                    var valoractual = elemento.val();
                    if (valoractual != '') {
                        if (valoractual != valoranterior) {
                            id = elemento.attr("aid");
                            bloqueointerface();
                            $.post("/adm_complexivotematica", {
                                'action': 'updatecupo',
                                'id': id,
                                'vc': valoractual
                            }, function (data) {

                                if (data.result == 'ok') {
                                    elemento.attr({'va': data.valor});
                                    elemento.val(data.valor);
                                    location.reload();
                                } else {
                                    elemento.val(valoranterior);
                                    smoke.alert(data.mensaje);
                                    $.unblockUI();
                                }
                            }).error(function () {
                                $.unblockUI();
                                elemento.val(valoranterior);
                                smoke.alert("Fallo al cambiar el cupo");
                            });
                        }
                    } else {
                        elemento.val(valoranterior);
                    }

                }).click(function () {
                    var elemento = $(this);
                    elemento.val('')
                });
            {% endif %}

            $(".showmodal").on('click', function () {
                var id = $(this).attr('aid');
                var tupla = [];
                $.get('/adm_complexivotematica?action=detalle&id=' + id, function (data) {
                    $("#detgrupo").html(data.grupo);
                    $("#detdirector").html(data.director);
                    $("#detcodirector").html(data.codirector);
                    var x = 1;
                    $("#detlineas").empty();
                    $("#detlineas").append("<tr><th style='text-align: center; width: 45px; '>No.</th><th style=''>Área de Investigación</th></tr>");
                    for (var linea in data.lista) {
                        $("#detlineas").append("<tr><td style='text-align: center;'>" + x + "</td><td style='text-align: justify;'>" + data.lista[linea] + "</td></tr>");
                        x++;
                    }
                    $("#detallemodal").modal('show');
                });

            });
            $('#cerrardetallemodal').click(function () {
                $('#detallemodal').modal('hide');
            });
            $("#facul_list").change(function () {
                var periodo = $("#titperiodo").val();
                var facultad = $('#facul_list').val();
                var aid = $("#opci_list").val();
                var term = $("#searchinput").val().trim().toUpperCase();
                bloqueointerface();
                if (term.length > 0) {
                    if (parseInt(aid) > 0) {
                        location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad + "&opc=" + aid;
                    } else {
                        location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad;
                    }
                } else {
                    if (parseInt(aid) > 0) {
                        location.href = "/adm_complexivotematica?per=" + periodo + "&fac=" + facultad + "&opc=" + aid;
                    } else {
                        location.href = "/adm_complexivotematica?per=" + periodo + "&fac=" + facultad;
                    }
                }
            });
            $("#carre_list").change(function () {
                var periodo = $("#titperiodo").val();
                var facultad = $('#facul_list').val();
                var carrera = $('#carre_list').val();
                var aid = $("#opci_list").val();
                var term = $("#searchinput").val().trim().toUpperCase();
                bloqueointerface();
                if (term.length > 0) {
                    if (parseInt(aid) > 0) {
                        location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad + "&car=" + carrera + "&opc=" + aid;
                    } else {
                        location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad + "&car=" + carrera;
                    }
                } else {
                    if (parseInt(aid) > 0) {
                        location.href = "/adm_complexivotematica?per=" + periodo + "&fac=" + facultad + "&car=" + carrera + "&opc=" + aid;
                    } else {
                        location.href = "/adm_complexivotematica?per=" + periodo + "&fac=" + facultad + "&car=" + carrera;
                    }
                }
                {#location.href = "/adm_complexivotematica?per="+periodo+"&fac="+facultad+"&car="+carrera;#}
            });
            $("#opci_list").change(function () {
                var periodo = $("#titperiodo").val();
                var facultad = $('#facul_list').val();
                var aid = $("#opci_list").val();
                var term = $("#searchinput").val().trim().toUpperCase();
                bloqueointerface();
                var carrera = 0;
                if ($('#carre_list').val() !== null) {
                    carrera = $('#carre_list').val();
                }
                if (term.length > 0) {
                    if (parseInt(aid) > 0) {
                        if (parseInt(facultad) > 0) {
                            if (carrera > 0) {
                                location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad + "&car=" + carrera + "&opc=" + aid;
                            } else {
                                location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad + "&opc=" + aid;
                            }
                        } else {
                            location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&opc=" + aid;
                        }
                    } else {
                        if (parseInt(facultad) > 0) {
                            if (carrera > 0) {
                                location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad + "&car=" + carrera;
                            } else {
                                location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo + "&fac=" + facultad;
                            }
                        } else {
                            location.href = "/adm_complexivotematica?s=" + term + "&per=" + periodo;
                        }
                    }
                } else {
                    if (parseInt(facultad) > 0) {
                        if (carrera > 0) {
                            location.href = "/adm_complexivotematica?per=" + periodo + "&fac=" + facultad + "&car=" + carrera;
                        } else {
                            location.href = "/adm_complexivotematica?per=" + periodo + "&fac=" + facultad;
                        }
                    } else {
                        location.href = "/adm_complexivotematica?per=" + periodo;
                    }
                }
            });
            {% if perms.sga.puede_editar_cupotematica %}
                $(".reportes").click(function () {
                    var elemento = $(this);
                    var action = elemento.attr("action");
                    var periodo = {{ perid.id }};
                    var carrera = {% if car_id.id %}{{ car_id.id }}{% else %}0{% endif %};
                    {#                if (carrera !== 0){#}
                    $.ajax({
                        type: "GET",
                        url: "/adm_complexivotematica",
                        data: {"action": "confreporte", "opcion": action, "per": periodo, "car": carrera},
                        success: function (data) {
                            if (data.result == 'ok') {
                                location.href = "/adm_complexivotematica?action=" + action + "&per=" + periodo + "&car=" + carrera
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                });
            {% endif %}
            $(".nominatutor").click(function () {
                var car = $(this).attr('car');
                var per = $("#titperiodo").val();
                {#var per = $(this).attr('per');#}
                if (car.length > 0) {
                    location.href = "/adm_complexivotematica?action=nominatutor&p=" + per + "&c=" + car;
                } else {
                    location.href = "/adm_complexivotematica?action=nominatutor&p=" + per;
                }
            });
            $(".cambiartutor").on('click', function () {
                var id = $(this).attr("id");
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_complexivotematica",
                    data: {'action': 'cambiartutor', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#deletemodal").html(data.data);
                            $("#deletemodal").modal({backdrop: 'static', width: '650px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $("#id_fechaini, #id_fechafin").addClass("validate[required]").datepicker({format: "yyyy-mm-dd"}).on('changeDate', function (ev) {
                $(this).datepicker('hide');
            })
            $("#modal_autoregistro").click(function () {
                $("#id_fechaini").val('');
                $("#id_fechafin").val('');
                $("#alertaingresoaddindicador").hide();
                $("#itemspaneladdaciones .incompletoaddindicador").hide();
                $("#itemspaneladdaciones .incompletovaloresaddindicador").hide();
                $("#generar_reporte").show();
                $("#guardar").hide();
                $("#modaladdindicadores").modal({backdrop: 'static', width: '250px'}).modal('show');
            });
            $("#cerrarindicadoresadd").click(function () {
                $("#modaladdindicadores .incompletoaddindicadores").hide();
                $("#modaladdindicadores .incompletovaloindicadores").hide();
                $("#modaladdindicadores").modal("hide");
            });

            $("#generar_reporte").click(function () {
                var id_fini = $("#id_fechaini").val();
                var id_ffin = $("#id_fechafin").val();
                var cmbgenero = $("#cmbgenero").val();
                var carrera_list = $("#carrera_list").val();
                openwindow('GET', '/adm_complexivotematica', {
                    action: 'excelactatribunal',
                    fechainicio: id_fini,
                    cmbgenero: cmbgenero,
                    fechafin: id_ffin,
                    carrera: carrera_list
                }, '_blank');
                $("#modaladdindicadores").modal("hide");
            });

            {% if perms.sga.puede_editar_cupotematica %}
                $('.grupos').blur(function () {
                    var elemento = $(this);
                    var id;
                    var valoranterior = elemento.attr("vant");
                    var valoractual = elemento.val();

                    if (valoractual != '') {
                        if (valoractual != valoranterior) {
                            id = elemento.attr("aid");
                            bloqueointerface();
                            $.post("/adm_complexivotematica", {
                                'action': 'actualizacantidadgrupo',
                                'id': id,
                                'cg': valoractual
                            }, function (data) {

                                if (data.result == 'ok') {
                                    $.unblockUI();
                                    //elemento.attr({'vant': data.valor});
                                    //elemento.val(data.valor);
                                    location.reload();
                                } else {
                                    elemento.val(valoranterior);
                                    smoke.alert(data.mensaje);
                                    $.unblockUI();
                                }
                            }).error(function () {
                                $.unblockUI();
                                elemento.val(valoranterior);
                                smoke.alert("Fallo al cambiar el cupo");
                            });
                        }
                    } else {
                        elemento.val(valoranterior);
                    }

                }).click(function () {
                    var elemento = $(this);
                    elemento.val('')
                });
            {% endif %}

            $("#cerrarcupogrupo, #cerrarcupogrupo2").click(function () {
                $('#itemspanelcupogrupo').modal('hide');
            });

            $(".asignacupogrupo").click(function () {
                var idt = $(this).attr('aid');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_complexivotematica",
                    data: {'action': 'asignacupogrupo', 'idt': idt},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodycupogrupo").html(data.data);
                            $(".paneltitlecupogrupo").html(data.title);
                            $("#itemspanelcupogrupo").modal({backdrop: 'static', width: '550px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

        });

        function pdftutoresgrupos(idper) {
            var codifacu =
            {{ facultad }}
            var codicarr = {{ carrera }}
                openwindow('POST', '/adm_complexivotematica', {
                    action: 'reportetutoresgrupo_pdf',
                    idper: idper,
                    codifacu: codifacu,
                    codicarr: codicarr
                }, '_blank');
        }

        function reporterevision_nuevo(idper) {
            var codifacu =
            {{ facultad }}
            var cid = $("#carre_list").val();
            openwindow('GET', '/adm_complexivotematica', {
                action: 'reporte_revision',
                idper: idper,
                codifacu: codifacu,
                codicarr: cid
            }, '_blank');
        }
    </script>
{% endblock %}
{% block canvas %}
    <div class="row-fluid">
        <div class="span3">
            <h4>{{ title }}</h4>
        </div>
        <div class="span4">
            <form class="form-search">
                <b>Periodo: </b>
                <select name="titperiodo" id="titperiodo" style="width: 300px">
                    {% for per in titperiodos %}
                        <option
                                {% if perid.id == per.id %} selected {% endif %} value="{{ per.id }}">{{ per.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <div class='span5'>
            <form class="form-search" onsubmit="return busqueda()">
                <input class='searchinput' type='text' id='searchinput' value='{{ search }}' autocomplete="off"/>
                <a href="javascript:;" id='search' class='btn btn-info'><i class="fa fa-search "></i>
                    <t class="hidden-phone hidden-tablet ">Buscar</t>
                </a>
                {% if search or car_id or facuid or op or id %}
                    <a href="/adm_complexivotematica" class='btn btn-info'><i class="fa fa-refresh "></i>
                        <t class="hidden-phone hidden-tablet ">Todos</t>
                    </a>
                {% endif %}
            </form>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span4">
            <form class="form-search">
                <b>Facultad: </b>
                <select id="facul_list" style="width: 350px">
                    <option value="0">Todos...</option>
                    {% for fac in facultades %}
                        <option {% if facuid.id == fac.id %} selected {% endif %} value="{{ fac.id }}">
                            {{ fac }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <div class="span5">
            <form class="form-search">
                <b>Carrera: </b>
                <select id="carre_list" style="width: 450px">
                    <option value="0">Todos...</option>
                    {% for car in carreras %}
                        <option {% if car_id.id == car.id %} selected {% endif %}  value="{{ car.id }}">
                            {{ car }}
                            {% if car.codigo %}
                                - SNIESE: {{ car.codigo }}
                            {% endif %}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>

        <div class="span3">
            <form class="form-search">
                <b>Activo: </b>
                <select id="opci_list" style="width: 100px">
                    <option {% if op == 0 %} selected {% endif %}  value="{{ 0 }}"> Todos</option>
                    <option {% if op == 1 %} selected {% endif %}  value="{{ 1 }}"> Con Grupos</option>
                    <option {% if op == 2 %} selected {% endif %}  value="{{ 2 }}"> Sin Grupos</option>

                </select>
            </form>
        </div>

    </div>
    <div class="row-fluid">
        <div class="span6">
            <div class="btn-group ">
                <a class="btn dropdown-toggle btn-default" data-toggle="dropdown" href="#"><i
                        class="fa fa-file-excel-o "></i> Reportes <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href='/adm_complexivotematica?action=listadofirmas&idperiodo={{ perid.id }}'
                           class="bloqueo_pantalla"><span class="fa fa-list"></span> Listado firmas</a></li>
                    <li><a href="/adm_complexivotematica?action=nominatematica&per=
                            {{ perid.id }}{% if car_id.id %}&car={{ car_id.id }}{% endif %}"><i
                            class="fa fa-file-excel-o"></i> Reporte Línea de investigación</a></li>
                    <li><a href="/adm_complexivotematica?action=nominaestudiante&per=
                            {{ perid.id }}{% if car_id.id %}&car={{ car_id.id }}{% endif %}"><i
                            class="fa fa-file-excel-o"></i> Reporte Estudiante</a></li>
                    <li><a class="nominatutor" href="javascript:;" per="{{ perid.id }}" {% if car_id.id %}
                           car="{{ car_id.id }}"{% else %}car=""{% endif %}><i class="fa fa-file-excel-o"></i> Reporte
                        Acompañante</a></li>
                    <li><a href="/adm_complexivotematica?action=nominaestudiantes_numerohoras&per=
                            {{ perid.id }}{% if car_id.id %}&facu={{ facultad }}{% endif %}"><i
                            class="fa fa-file-excel-o"></i> Reporte grupos acompañamiento</a></li>

                    {#                    <li><a href="/adm_complexivotematica?action=reporte_revision&per={{ perid.id }}{% if car_id.id %}&car={{ car_id.id }}{% endif %}"><i class="fa fa-file-excel-o"></i> Reporte revisión tema</a></li>#}

                    <li><a onclick="reporterevision_nuevo({{ perid.id }})" href="javascript:;"><span
                            class="fa fa-file-pdf-o"></span> Reporte revisión tema</a></li>

                    <li><a href="#" id="modal_autoregistro"><i class="fa fa-file-excel-o"></i> Reporte actas tribunales</a>
                    </li>
                    <li><a onclick="pdftutoresgrupos({{ perid.id }})" href="javascript:;"><span
                            class="fa fa-file-pdf-o"></span> Imprimir listado tutores grupos</a></li>


                    <li>
                        <a href="/adm_complexivotematica?action=reportetutoresgrupo_exc&idper={{ perid.id }}&codifacu={{ facultad }}&codicarr={{ carrera }}"><span
                                class="fa fa-file-excel-o"></span> Imprimir listado tutores grupos</a></li>
                    <li>
                        <a href="/adm_complexivotematica?action=reportetplanestudiantes&idper={{ perid.id }}"><span
                                class="fa fa-file-excel-o"></span> Reporte planificación estudiantes*</a>
                    </li> <li>
                    <a href="/adm_complexivotematica?action=reporteextension&idper={{ perid.id }}"><span
                            class="fa fa-file-excel-o"></span> Reporte extensión de cronograma*</a></li>
                </ul>
            </div>
            <a href='/adm_complexivotematica?action=tiempopropuesta' class="btn btn-default">
                <i class="fa fa-cogs"> </i> Configurar extensión de cronograma
            </a>
            <a href='/adm_complexivotematica?action=asignaturastitulacion' class="btn btn-success bloqueo_pantalla">
                <i class="fa fa-book"> </i> Integración curricular
            </a>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            {% if perid.id < 14 %}
                <table class='table table-bordered table-striped'>
                    <thead>
                    <tr>
                        <th style="width: 50px; text-align: center;">No</th>
                        <th>Línea de investigación</th>
                        <th style="width: 50px; text-align: center;">Info</th>
                        <th style="width: 250px; text-align: center;">Carrera</th>
                        <th style="width: 190px; text-align: center;">Acompañante</th>
                        <th style="width: 50px; text-align: center;">Cupo</th>
                        <th style="width: 50px; text-align: center;">Grupo</th>
                        <th style="width: 50px; text-align: center;">Ins</th>
                        <th style="width: 50px; text-align: center;">Trib.<br>Asig.</th>
                        <th style="width: 80px; text-align: center;"></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for tematica in tematicas %}
                        <tr>
                            <td style="text-align: center;">{{ forloop.counter }}</td>
                            <td>{{ tematica.tematica }}<br>
                                <span class="label {% if tematica.tematica.vigente %}label-success{% else %}label-important{% endif %}">{% if tematica.tematica.vigente %}
                                    Vigente{% else %}No Vigente{% endif %}</span>
                            </td>
                            <td style="text-align: center;"><a href="javascript:;"
                                                               class="btn btn-mini btn-info showmodal tu"
                                                               aid="{{ tematica.id }}" title="Detalles"><i
                                    style="font-size: 15px" class="fa fa-list"></i></a></td>
                            <td style="text-align: center;"> {{ tematica.carrera }} </td>
                            <td style="text-align: center;">{{ tematica.tutor }}</td>
                            <td style="text-align: center;">
                                {% if perms.sga.puede_editar_cupotematica and tematica.tematica.vigente %}
                                    <input style="text-align: center;" class="form-imput input-mini cupos"
                                           aid="{{ tematica.id }}" type="text" va="{{ tematica.cupo }}"
                                           value="{{ tematica.cupo }}">
                                {% else %}
                                    {{ tematica.cupo }}
                                {% endif %}
                            </td>
                            <td style="text-align: center;"><span
                                    class="btn btn-success">{{ tematica.cantidad_grupos }}</span></td>
                            <td style="text-align: center;"><span
                                    class="btn btn-success">{{ tematica.cantidad_inscritos }}</span></td>
                            <td style="text-align: center;">{{ tematica.tribunal_asignado_grupos }}/{{ tematica.cantidad_grupos }}</td>
                            <td style="text-align: center; ">
                                <a class="btn btn-mini btn-warning tu"
                                   href="/adm_complexivotematica?action=vergrupos&id={{ tematica.id }}&c={{ facuid.id }}&s={{ search }}&per={{ perid.id }}"
                                   title="Ver Grupos"><i class="fa fa-group"></i></a>
                                <a href="javascript:;" class="btn btn-mini btn-info tu cambiartutor"
                                   id="{{ tematica.id }}" title="Cambiar tutor"><i class="fa fa-user"></i></a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="10" style="text-align: center">No se han Asignado línea de investigación</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                {#                NUEVA TABLA#}
                <table class='table table-bordered table-striped'>
                    <thead>
                    <tr>
                        <th style="width: 50px; text-align: center;">No</th>
                        <th>Línea de investigación</th>
                        <th style="width: 50px; text-align: center;">Info</th>
                        <th style="width: 250px; text-align: center;">Carrera</th>
                        <th style="width: 190px; text-align: center;">Acompañante</th>
                        <th style="width: 50px; text-align: center;">Grupos</th>
                        <th style="width: 20px; text-align: center;"></th>
                        <th style="width: 50px; text-align: center;">Cupos</th>
                        <th style="width: 50px; text-align: center;">Ins</th>
                        <th style="width: 50px; text-align: center;">Trib.<br>Asig.</th>
                        <th style="width: 80px; text-align: center;"></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for tematica in tematicas %}
                        <tr>
                            <td style="text-align: center;">
                                {{ forloop.counter }}
                                <br>{{ tematica.id }}
                            </td>
                            <td>{{ tematica.tematica }}<br>
                                <span class="label {% if tematica.tematica.vigente %}label-success{% else %}label-important{% endif %}">{% if tematica.tematica.vigente %}
                                    Vigente{% else %}No Vigente{% endif %}</span>
                            </td>
                            <td style="text-align: center;"><a href="javascript:;"
                                                               class="btn btn-mini btn-info showmodal tu"
                                                               aid="{{ tematica.id }}" title="Detalles"><i
                                    style="font-size: 15px" class="fa fa-list"></i></a></td>
                            <td style="text-align: center;"> {{ tematica.carrera }} </td>
                            <td style="text-align: center;">{{ tematica.tutor }}</td>
                            <td style="text-align: center;">
                                {% if perms.sga.puede_editar_cupotematica and tematica.tematica.vigente %}
                                    {#                                    <input style="text-align: center;" class="form-imput input-mini cupos" aid="{{ tematica.id }}" type="text" va="{{ tematica.cupo }}" value="{{ tematica.cupo }}">#}
                                    <input style="text-align: center;" class="form-imput input-mini grupos"
                                           aid="{{ tematica.id }}" type="text" vant="{{ tematica.cantidadgrupo }}"
                                           value="{{ tematica.cantidadgrupo }}">
                                {% else %}
                                    {#                                    {{ tematica.cupo }}#}
                                    {{ tematica.cantidadgrupo }}
                                {% endif %}
                            </td>
                            <td style="text-align: center;">
                                {% if tematica.cantidadgrupo > 0 %}
                                    <a href="javascript:;" class="btn btn-mini btn-warning asignacupogrupo tu"
                                       aid="{{ tematica.id }}" title="Cupos de Grupos"><i style="font-size: 15px"
                                                                                          class="fa fa-list-ol"></i></a>
                                    </td>
                                {% endif %}
                            {#                            <td style="text-align: center;"> <span class="btn btn-success">{{ tematica.cantidad_grupos }}</span> </td>#}
                            <td style="text-align: center;"><span class="btn btn-success tu"
                                                                  title="Total Cupos Alumnos">{{ tematica.total_cupos_grupos }}</span>
                            </td>
                            <td style="text-align: center;"><span class="btn btn-success tu"
                                                                  title="Total Inscritos">{{ tematica.cantidad_inscritos }}</span>
                            </td>
                            <td style="text-align: center;">{{ tematica.tribunal_asignado_grupos }}/{{ tematica.cantidad_grupos }}</td>
                            <td style="text-align: left; ">
                                <div class="btn-group ">
                                    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span
                                            class="caret"></span></a>
                                    <ul class="dropdown-menu pull-right" style="text-align: left">
                                        <li>
                                            <a href='/adm_complexivotematica?action=vergrupos&id={{ tematica.id }}&c={{ facuid.id }}&s={{ search }}&per={{ perid.id }}'
                                               class="bloqueo_pantalla"><span class="fa fa-group"></span> Ver grupos</a>
                                        </li>
                                        <li><a href="javascript:;" class="cambiartutor" id="{{ tematica.id }}"><span
                                                class="fa fa-user"></span> Cambiar tutor</a></li>
                                        {% if tematica.cantidad_inscritos == 0 %}
                                            <li><a href="javascript:;" class="deletetematica"
                                                   codtematica="{{ tematica.id }}"
                                                   nomtematica="{{ forloop.counter }}_{{ tematica.tutor }}"><span
                                                    class="fa fa-minus"></span> Eliminar</a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="10" style="text-align: center">No se han Asignado línea de investigación</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>

    <div class="modal fade static" id="detallemodal" style="display: none;">
        <div class="modal-header">
            <h4 id="paneltitle">Detalle línea de investigación</h4>
        </div>
        <div class="modal-body">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th style="width: 80px">Detalle:</th>
                    <td id="detgrupo"></td>
                </tr>
                <tr>
                    <th style="width: 80px">Director:</th>
                    <td id="detdirector"></td>
                </tr>
                <tr>
                    <th style="width: 80px">CoDirector:</th>
                    <td id="detcodirector"></td>
                </tr>
                </thead>
            </table>
            <table class="table table-bordered">
                <thead id="detlineas">
                </thead>
            </table>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" id="cerrardetallemodal" class="btn btn-info">Cerrar</a>
        </div>
    </div>
    <div class='row-fluid'>
        <div class="span12">
            {% if paging.num_pages > 20 %}
                <div class='pagination'>
                    <ul>
                        {% if paging.primera_pagina %}
                            <li><a href="/adm_complexivotematica?page=1&per=
                                    {{ perid.id }}{% if facuid %}&fac={{ facuid.id }}{% endif %}{% if car_id %}&car={{ car_id.id }}{% endif %}&opc={{ op }}&s={{ search }}">1</a>
                            </li>
                            <li><a href="/adm_complexivotematica?page={{ paging.ellipsis_izquierda }}&per=
                                    {{ perid.id }}{% if facuid %}&fac={{ facuid.id }}{% endif %}{% if car_id %}&car={{ car_id.id }}{% endif %}&opc={{ op }}&s={{ search }}"
                                   class="active">...</a></li>
                        {% endif %}
                        {% for pagenumber in paging.paginas %}
                            <li {%  if pagenumber == page.number %}class='active'{% endif %}><a
                                    href="/adm_complexivotematica?page={{ pagenumber }}&per=
                                            {{ perid.id }}{% if facuid %}&fac={{ facuid.id }}{% endif %}{% if car_id %}&car={{ car_id.id }}{% endif %}&opc={{ op }}&s={{ search }}">{{ pagenumber }}</a>
                            </li>
                        {% endfor %}
                        {% if paging.ultima_pagina %}
                            <li><a href="/adm_complexivotematica?page={{ paging.ellipsis_derecha }}&per=
                                    {{ perid.id }}{% if facuid %}&fac={{ facuid.id }}{% endif %}{% if car_id %}&car={{ car_id.id }}{% endif %}&opc={{ op }}&s={{ search }}"
                                   class="active">...</a></li>
                            <li><a href="/adm_complexivotematica?page={{ paging.num_pages }}&per=
                                    {{ perid.id }}{% if facuid %}&fac={{ facuid.id }}{% endif %}{% if car_id %}&car={{ car_id.id }}{% endif %}&opc={{ op }}&s={{ search }}">{{ paging.num_pages }}</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            {% else %}
                <div class='pagination'>
                    <ul>
                        {% for pagenumber in paging.page_range %}
                            <li {%  if pagenumber == page.number %}class='active'{% endif %}><a
                                    href="/adm_complexivotematica?page={{ pagenumber }}&per=
                                            {{ perid.id }}{% if facuid %}&fac={{ facuid.id }}{% endif %}{% if car_id %}&car={{ car_id.id }}{% endif %}&opc={{ op }}&s={{ search }}">{{ pagenumber }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>
    <div class="modal fade static" id="deletemodal" style="display: none;">
    </div>
    <div class="modal fade static" id="modaladdindicadores" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Acta tribunal</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-info incompletoaddindicadores" style="display: none;">
                <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
            </div>
            <div class="alert alert-danger" id="incompletovaloresaddindicadores" style="display: none;">
                <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la
                fecha/hora HASTA
            </div>
            <div class="alert alert-danger" id="alertaingresoaddindicadores" style="display: none;"> FECHAS YA FUERON
                INGRESADAS
            </div>
            <div class="row-fluid">
                <form id="formulario2" class='form-vertical' action="" method="POST">
                    <b><span class="carreraindicador"> </span></b><br>
                    Fecha Inicio.:<br><input type="text" name="id_fechaini" id="id_fechaini" placeholder="Fecha Inicio">
                    <br>Fecha Fin.:<br><input type="text" name="id_fechafin" id="id_fechafin" placeholder="Fecha Fin">
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-warning" id="generar_reporte"><i class="fa fa-table"></i> Generar
                Reporte</a>
            <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarindicadoresadd">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelcupogrupo" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlecupogrupo">Revisar y Validar Cédula</h4></td>
                    <td><a href="javascript:;" id="cerrarcupogrupo" title="Cerrar"
                           class="btn btn-danger btn-mini pull-right"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodycupogrupo">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success" id="guardarcupogrupo"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger" id="cerrarcupogrupo2"> Cerrar</a>
        </div>
    </div>

{% endblock %}
{#{% extends "ajaxformbs.html" %}#}
{#{% load sga_extras %}#}
{% extends "base.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
{#    <link rel="stylesheet" href="/static/eventostyle.css?0.1">#}
{#    <link rel="stylesheet" href="/static/eventoframework.css?0.1">#}
{#    <link href="/static/intro.js/minified/introjs.min.css" rel="stylesheet"/>#}
{#    <script src="/static/intro.js/minified/intro.min.js"></script>#}
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0'></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script>

    <style>
        ::-webkit-scrollbar {
          width: 10px;
          height: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
          box-shadow: inset 0 0 5px grey;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
          background: silver;
        }

        label.label, span.label {
            font-size: 11px !important;
            padding:3px;
            margin: .5px;
            border-radius: 4px;
        }

        .course-card-body {
            background-color: white;
            border-left: 1px solid rgba(157, 157, 157, 0.55);
            border-right: 1px solid rgba(157, 157, 157, 0.55);
            border-bottom: 1px solid rgba(157, 157, 157, 0.55);
            border-bottom-left-radius: 10px 10px;
            border-bottom-right-radius: 10px 10px;

        }

        .scrollable-menu {
            height: auto;
            max-height: 200px;
            overflow-x: hidden;
        }

        .table {
            width: 100%;
            margin-bottom: 1rem;
            color: #212529;
        }

        .table-borderless th,
        .table-borderless td,
        .table-borderless thead th,
        .table-borderless tbody + tbody {
            border: 0;
        }

        .span-for-btnbuscar {
            position: absolute;
            top: 8px;
            right: 8px;
            margin-right: 0;
            transition: right 0.2s;
        }

        .show {
            right: 5px;
        }

        /* REMUEVE EL BACKGROUND-COLOR CHANGE ON BT-TABLES */
        .add-solicitud-donacion:focus {
            outline: 0 !important;
        }

        .table tbody tr.info td {
            background-color: unset !important;
            color: unset !important;
        }

        /* PINTA DE BLANCO LOS BOTONES READONLY */
        .grupo-botones .btn {
            background-color: #FFF;
            color: black;
            cursor: pointer;
        }

        .box_border {
            border: 1px solid rgba(157, 157, 157, 0.1);
            /*border-top: 0;*/
            background-color: #fff;
            padding: 0;
            background-clip: padding-box;
        }

        .box_border:hover {
            box-shadow: 0px 0px 15px rgba(157, 157, 157, 0.5);
        }

        .shadow-data-container {
            padding: 4px;
            border-radius: 10px;
        }

        .white-shadow-img {
            border: 1px solid rgba(157, 157, 157, 0.55);
            display: block;
            margin: 0 auto;
            border-radius: 50%;
            box-shadow: 8px 3px 1px #ccc;
            -webkit-box-shadow: 6px 2px 7px #ccc;
            -moz-box-shadow: 8px 3px 1px #ccc;
        }

        .nav-link.tabs.active{
            border-top:3px solid #ffaa46;
        }

        .searchinput {
            border-top: 0;
            border-radius: 20px;
        }

        @media only screen and (max-width: 960px) {
            .break-on-lg {
                width: 100%;
            }

            .none-on-sm {
                display: none;
            }
        }

    </style>
    <script>
        function del(a){
            bloqueointerface();
            let tab = $(a).attr('tab');
            if (parseInt(tab)){
                let form = '#form-' + tab;
                let ctrl = $(a.children).attr('class');
                if (ctrl === 'td'){
                    $(form+' select[name="'+ ctrl +'"]').val(0).trigger('change');
                }else{
                    $(form+' input[name="'+ ctrl +'"]').val('');
                }
                $(form).submit();
            }
        }

        $(function () {
            /*COPIA EL CONTENEDOR MI PERFIL A OTRO DIV CON DISPLAY:FALSE PARA CUANDO SE HAGA CLICK EN EL TAB 'MIS PUBLICACIONES' REPONERLO*/
            $('.course-card-body-copy').html($('.course-card-body').html());

            /*CARGAR DETALLE PUBLICACIÓN*/
            $('.card-to-open-details').click(function () {
                var id = $(this).attr('idsoli');
                formModal(id, 'DETALLE DE LA PUBLICACIÓN', 'detallepublicacion', '90%')
            });

            /*MUESTRA LOS DATOS DE MI PERFIL AL HACER CLICK EN EL TAB MIS PUBLICACIONES*/
            $('#tab-show-own-profile').click(function () {
                $('.course-card-body').html($('.course-card-body-copy').html())
            });

            $('.alert-subir-evidencia').click(function () {
                alertaDanger('Actualmente ya cuenta con una solicitud vigente.');
            });

            ItemsDisplay = function (item) {
                if (item.text) {
                    return $('<span>' + item.text + '</span>');
                } else {
                    if (item.name) {
                        return $('<span>' + item.name + '</span>');
                    } else {
                        return '---------';
                    }
                }
            };

            $(".grupo_filtro").select2({
                placeholder: "Agrupar por",
                allowClear: true,
                escapeMarkup: function (markup) {
                    return markup;
                },
                templateResult: ItemsDisplay,
                templateSelection: ItemsDisplay
            });

            $(".select2-selection__placeholder > span").attr('style', 'margin-left:20%;');
            $('.select2  .selection .select2-selection').attr('style', 'border-radius:20px');


            $('.form-control').change(function () {
                bloqueointerface()
                let tab = $(this).attr('tab');
                if (tab) {
                    $('#form-'+tab).submit()
                }else{
                    $.unblockUI()
                }
            });

            /*var tabcontratos = localStorage.getItem('tabcontratos');

            if (!tabcontratos) {
                tabcontratos = "#{{ tab_init|safe }}";
                localStorage.setItem("tabcontratos", tabcontratos);
            }

            $('.tabs').each(function () {
                if ($(this).attr('href') == tabcontratos) {
                    $(this).trigger('click');
                }
            }).click(function () {
                localStorage.setItem("tabcontratos", $(this).attr('href'));
            });

            localStorage.removeItem('tabcontratos');*/

            //Pintar de azul el borde del nav y el grupo de botones.
            $('.grupo-botones .btn').click(function () {
                $('.grupo-botones .btn').css({'background-color': '#ffffff', 'color': 'black'});
                $(this, 'input').css({'background-color': '#006dcc', 'color': 'white'});
            });

            $('.add-solicitud-donacion').click(function () {
                location.href = '{{ request.path|safe }}?action=addpublicacion';
            });


            //SOBREPOSICIONAR MODAL
            $('body').on('shown.bs.modal', '.modal', function () {
                $(this).find('select').each(function () {
                    var dropdownParent = $(document.body);
                    if ($(this).parents('.modal.in:first').length !== 0)
                        dropdownParent = $(this).parents('.modal.in:first');
                    $(this).select2({
                        dropdownParent: dropdownParent
                        // ...
                    });
                });
            });

        });

        function eliminar(pk, nombre, accion) {
            Swal.fire({
                title: `<h4>Estás por eliminar este registro:\n ${nombre}</h4>`,
                text: "Esta acción es irreversible",
                type: 'warning',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.ajax({
                        type: 'POST',
                        url: '{{ reques.path }}',
                        async: false,
                        data: {
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            action: accion,
                            id: pk,
                        },
                        dataType: "json",
                        beforeSend: function () {
                            bloqueointerface();
                        }
                    }).done(function (data) {
                        setTimeout($.unblockUI, 1);
                        if (data.error === false) {

                            let timerInterval
                            Swal.fire({
                              title: '',
                              html: '<b>Eliminando...</b>',
                              timer: 2000,
                              timerProgressBar: true,
                              didOpen: () => {
                                Swal.showLoading()
                                const b = Swal.getHtmlContainer().querySelector('b')
                                timerInterval = setInterval(() => {
                                  b.textContent = Swal.getTimerLeft()
                                }, 100)
                              },
                              willClose: () => {
                                clearInterval(timerInterval)
                              }
                            }).then((result) => {
                              /* Read more about handling dismissals below */
                              if (result.dismiss === Swal.DismissReason.timer) {
                                console.log('I was closed by the timer')
                              }
                            })


                            location.reload();
                        }
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        setTimeout($.unblockUI, 1);
                        alertaDanger('Error en el servidor', 'Advertencia!', 10000);
                    }).always(function () {
                    });
                } else {
                }
            });
        }

        function mostrarPerfilPostulante(idsoli) {
            var contentdata = $('.content-data-for-display-profile-' + idsoli);
            var url_wtsp = contentdata.attr('telefono') + '&nbsp;<a style="color: black;" class="btn btn-mini btn-success tu" data-original-title="Enviar mensaje por whatsapp" href="https://api.whatsapp.com/send?phone=593' + contentdata.attr('telefono').slice(1) + '&text=Hola,%20' + contentdata.attr('nombre') + '" target="_blank"><i class="fa fa-whatsapp" style="color:#fff" aria-hidden="true"></i></a>';
            $('#data-contacto-telefono').html(url_wtsp);
            $('#data-contacto-foto').attr('src', contentdata.attr('foto'));
            $('#data-contacto-nombre').text(contentdata.attr('nombrecompleto'));
            $('#data-contacto-direccion').text(contentdata.attr('direccion'));

            var email_principal;
            email_principal = contentdata.attr('emailinst') === undefined ? contentdata.attr('email') : contentdata.attr('emailinst');
            var url_email = '<a style="color: black;" href="mailto:' + email_principal + '" target="_blank">' + email_principal + '</a>';
            $('#data-contacto-email').html(url_email);

            contentdata.attr('carrera') === undefined ? $('#data-contacto-carrera').text('') : $('#data-contacto-carrera').text(contentdata.attr('carrera'));
            contentdata.attr('nivel') === undefined ? $('#data-contacto-nivel').text('') : $('#data-contacto-nivel').text(contentdata.attr('nivel'));
            $('.info-contacto-footer').hide('slow');
        }

        function formModal(id, text, action, width = '85%') {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: '{{ request.path }}',
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbodysolidonacion').html(data.data);
                        $('#itemspanelsolidonacion .modal-title').html(text);
                        $("#itemspanelsolidonacion").modal({
                            backdrop: 'static',
                            width: width,
                            keyboard: false
                        }).modal('show').on('hidden.bs.modal', function (e) {
                            $("#itemspanelsolidonacion .panelbodysolidonacion").empty();
                        });

                        return true;
                    } else {
                        mensajeWarning(data.mensaje);
                        return false;
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeWarning("Error de conexión.");
                    return false;
                },
                dataType: "json"
            });
        }

    </script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    <!-- color: rgba(28,50,71,1);
    white-space: nowrap;
    -->

    <div class="modal fade static" id="itemspanelsolidonacion" style="display: none">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 style="display:inline-block"><b class="modal-title"></b></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12">
                            <form id="form2" class="form-horizontal form-modal" autocomplete="off" method="post" enctype="multipart/form-data" action="{{ request.path }}">
                                {% csrf_token %}
                                <div class="panelbodysolidonacion"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class='row'>
        <div class='col-lg-12 mx-0 px-1'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title }}</h3>
                <h6>Socioeconómico</h6>
            </div>
        </div>
    </div>

    {% if notification %}
        <div class="alert alert-warning" role="alert">
           <i class="fa fa-bell blinkimg"></i> Existen <b>{{ notification }}</b> nuevas contribuciones. &nbsp;&nbsp; <a href="?action=detallerecaudacion&id={{ lastpublication|encrypt }}" class="btn btn-warning"><i class="fa fa-link"></i> Ver Contribuciones </a>
        </div>
    {% endif %}

    <div class='row' style="font-family: Inter, 'sans-serif';">
        <!-- INICIO INFORMACION CONTACTO -->
        <div class='col-sm-12 col-md-3 col-lg-3'>
            <div style="position: sticky;top: 0;" class="row">
                <div class="card course-card-body" style="padding:0;">
                    <div class="card-header border-bottom" style="border-top:3px solid #ffaa46">
                        <section style="margin-top: 6px;"><img class="white-shadow-img" id="data-contacto-foto" src="{{ persona.get_foto }}" width="135" height="135"></section>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <div style="text-align: left;font-family: Inter, 'sans-serif';font-style: normal;">
                                    <div class="row">
                                        <div class="col-12" style="text-align: center">
                                            <span style="line-height: 16px; font-size: 12px;text-align: center;">
                                                <b style="box-shadow: grey;font-family: Inter, 'sans-serif';font-size:13px;">DATOS DE CONTACTO &#128172; &#x1f4dd;</b>
                                            </span><br>
                                            {% if persona.datos_ultima_matricula2 %}
                                                <label id="data-contacto-carrera" style="font-size:12px;">{{ persona.datos_ultima_matricula2.carrera|upper|default:"----" }}</label>
                                                <label id="data-contacto-nivel" class="label">
                                                    {% if persona.datos_ultima_matricula2 %}
                                                        {{ persona.datos_ultima_matricula2.nivel }}
                                                    {% else %}
                                                        ----
                                                    {% endif %}
                                                </label>
                                            {% else %}
                                                ----
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 mx-2">
                                            <b>Nombre: </b><span id="data-contacto-nombre">{{ persona.nombre_completo_inverso|lower|title }}</span><br>
                                            <b>Teléfono: </b><span id="data-contacto-telefono">{{ persona.telefono|default:"----" }}</span><br>
                                            <b>Email: </b><span id="data-contacto-email">{{ persona.emailinst|default:"----" }}</span><br>
                                            <b>Dirección: </b><span id="data-contacto-direccion">{% if persona.direccion_completa.strip %}{{ persona.direccion_completa|lower|title|default:"----" }}{% else %}----{% endif %}</span>
                                        </div>
                                    </div>
{#                                    <hr style="color: gray;">#}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="row-fluid text-center mt-2">
                            <div class="dropdown dropstart border-1">
                                <a href="javascript:void(0);" class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="dropdown" data-offset="-140" aria-haspopup="true" aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
                                <div class="dropdown-menu">
                                    <span class="dropdown-header">ACCIONES</span>
                                    <a class="dropdown-item" onclick="formModal(0, 'MIS DONACIONES', 'misdonaciones', '90%')"><span class="fa fa-eye"></span> &nbsp;Mis donaciones</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN INFORMACION CONTACTO -->
        <!-- INICIO PUBLICACIONES -->
        <div class='col-sm-12 col-md-9 col-lg-9'>
            <div class="" style="font-size:12px;">
                <div class="card card-primary card-outline card-outline-tabs">
                    <div class="card-body">
                        <nav>
                            <div class="nav nav-tabs" id="nav-for-donaciones"  role="tablist">
                                {% if not externo %}<button class="nav-link {% if tab_number == 1 %}active{% endif %} tabs" id="tab-show-own-profile" data-bs-toggle="tab" data-bs-target="#tab-mis-publicaciones" type="button" role="tab" aria-controls="tab-mis-publicaciones" aria-selected="true">Mis publicaciones</button>{% endif %}
                                <button class="nav-link {% if tab_number == 2 %}active{% endif %} tabs" id="externals" data-bs-toggle="tab" data-bs-target="#tab-publicaciones-externas" type="button" role="tab" aria-controls="tab-publicaciones-externas" aria-selected="true">Publicaciones externas</button>
                            </div>
                        </nav>
                        <div class="tab-content">
                            <!-- INICIO MIS PUBLICACIONES -->
                            {% if not externo %}
                                <div class="tab-pane fade {% if tab_number == 1 %}show active{% endif %}" style="overflow: hidden;" id="tab-mis-publicaciones" role="tabpanel" aria-labelledby="tab-show-own-profile">
                                    <div class="card main-data-publicaciones-externas mb-4 border-0">
                                        <!-- INICIO FILTROS -->
                                        <div class="card-header mt-4">

                                            <form id="form-1" method="GET" action="{{ request.path }}" enctype="text/plain">
                                                <div class="row">
                                                    <div class="col-lg-6 col-md-12 col-sm-12 d-sm-none d-md-none d-lg-block">
                                                        <section class="break-on-lg" style="float:left;">
                                                            <input title="Buscar" name="s" value="{% if tab_number == 1 %}{{ s|default:"" }}{% endif %}" class="form-control searchinput" type="text" placeholder="  Buscar publicación..." style="font-family:Arial, FontAwesome;border-radius: 20px;width: 100%;min-width: 179px;" tab="1">
                                                            <input class="form-control" type="hidden" name="tab" value="1">
                                                        </section>
                                                    </div>
                                                    <div class="col-lg-6 col-md-12 col-sm-12">
                                                        <section class="break-on-lg" style="float:right;">
                                                            {% with ev=mispublicaciones.first.evidenciaejecucion %}
                                                                <a style="border-radius: 20px;width: 100%" class="btn btn-success {% if ev or not mispublicaciones %}add-solicitud-donacion{% else %}alert-subir-evidencia{% endif %}"><i class="fa fa-plus-circle"></i>&nbsp;Agregar nueva solicitud</a>
                                                            {% endwith %}
                                                        </section>
                                                    </div>

                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-sm-12 col-md-12 col-lg-4">
                                                        <h4 style="margin-top: 2px;">Mis publicaciones<small class="text-muted">&nbsp;&nbsp;{{ mispublicaciones.count }} total</small></h4>
                                                    </div>
                                                    <div class="col-sm-12 col-md-6 col-lg-4">
                                                        <div class="row">
                                                            <div class="col-lg-2 d-sm-none d-md-none d-lg-block"></div>
                                                            <div class="col-lg-8 col-md-12 col-sm-12">
                                                                <div class="input-group mb-3">
                                                                  <input title="Desde" value="{% if tab_number == 1 %}{{ fi|default:"" }}{% endif %}" style="border-bottom-left-radius: 20px;border-top-left-radius: 20px;" type="date" class="form-control" aria-label="Desde" tab="1" name="fi">
                                                                  <input title="Hasta" value="{% if tab_number == 1 %}{{ ff|default:"" }}{% endif %}" style="border-bottom-right-radius: 20px;border-top-right-radius: 20px;" type="date" class="form-control" aria-label="Hasta" tab="1" name="ff">
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-2 d-sm-none d-md-none d-lg-block"></div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-6 col-lg-3">
                                                        <select class="grupo_filtro form-control" style="border-radius:20px;width: 100%"  tab="1" name="td">
                                                            <option value="0" style="text-align: center" {% if not td %} selected {% endif %}>--TODOS--</option>
                                                            {% for gb in groupbymispublicaciones %}
                                                                <option value="{{ gb.0 }}" {% if td == gb.0 and tab_number == 1 %} selected {% endif %}>{{ gb.1 }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
{#                                                <div class="row">#}
{#                                                    <div class="col" style="width: 100%">#}
{#                                                        #}
{#                                                    </div>#}
{#                                                </div>#}
                                            </form>
                                            <div class="row">
                                                <div class="row-fluid" style="text-align: center">
                                                    <div class="col-12">
                                                    {% if url_vars_filter %}
                                                        <div class="row-fluid">
                                                        <hr class="px-4" style="width:60%; margin: auto;border-color:lightgrey;"><br>
                                                            {% for var in url_vars_filter %}
                                                                <button tab="1" onclick="del(this);" type="button" class="btn rounded-pill">
                                                                    <span class="{{ var.0 }}"><i class="fa fa-times" style="font-size: 9px;padding: 3px;color: silver;"></i>{{ var.1|upper }}</span>
                                                                </button>
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- FIN FILTROS -->
                                        <div class="card-body" data-bs-spy="scroll">
                                            {% for md in mispublicaciones %}
                                                <div style="display: none">
                                                    <section class="content-data-for-display-profile-{{ md.id }}"
                                                             idsoli="{{ md.id }}"
                                                             nombrecompleto="{{ md.persona.nombre_completo_inverso|lower|title }}"
                                                             nombre="{{ md.persona.nombres|lower|title }}"
                                                             telefono="{{ md.persona.telefono }}"
                                                             emailinst="{{ md.persona.emailinst }}"
                                                             email="{{ md.persona.email }}"
                                                             direccion="{{ md.persona.direccion_completa|lower|title }}"
                                                             foto="{% if md.mostrarfotoperfil %}{{ md.persona.get_foto }}{% else %}https://sga.unemi.edu.ec/static/images/no-disponible.png{% endif %}"
                                                             {% if md.persona.datos_ultima_matricula2 %} carrera="{{ md.persona.datos_ultima_matricula2.carrera|default:"-" }}"
                                                             nivel="{{ md.persona.datos_ultima_matricula2.nivel|default:"-" }}
                                                             {% endif %}">
                                                    </section>
                                                </div>
                                                <div style="overflow: hidden;" class="p-2">
                                                    <div class="card box_border mb-3">
                                                        {# ESTO PINTA LA LINEA NARANJA EN EL CARD: border-top border-4 border-dark-info#}
                                                        <div class="card-body rounded-3 pt-2" id="border-box-mis-publicaciones">
                                                            <div class="row">
                                                                <div class="col-12 align-middle">
                                                                    <div class="align-middle mt-1" style="float: left;">
                                                                        {% if md.estadoprioridad == 1 %}
                                                                            <span class="label label-danger bg-danger" style="padding:3px;">SE PRECISA URGENTE</span>
                                                                        {% elif md.estadoprioridad == 2 %}
                                                                            <span class="label label-warning" style="padding:3px;">SOLICITUD DESTACADA</span>
                                                                        {% endif %}
                                                                        <span onclick="formModal('{{ md.pk|encrypt }}', ' DETALLE DE APROBACIÓN', 'mostrardetalleaprobacion_view', '80%');" style="cursor: pointer;">
                                                                            <span class="label {{ md.color_estado }}" style="padding:3px;">{{ md.get_estado_display }}</span>
                                                                        </span>
                                                                        {% if md.DIAS_FIN_RECEPCION.days < 5 %}
                                                                            <span class="label label-info">QUEDAN {{ md.DIAS_FIN_RECEPCION.days|default:"0" }} DÍAS</span>
                                                                        {% endif %}
                                                                    </div>
                                                                    <section style="float: right;">
                                                                        <div class="dropdown dropstart">
                                                                            <a href="javascript:void(0);" class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="dropdown" data-offset="-140" aria-haspopup="true" aria-expanded="false">
                                                                                <i class="fa fa-ellipsis-v"></i>
                                                                            </a>
                                                                            <div class="dropdown-menu">
                                                                                <li class="border-bottom">
                                                                                    <a href="javascript:;" class="dropdown-item card-to-open-details" idsoli="{{ md.id|encrypt }}">
                                                                                        <i class="fa fa-th-list" aria-hidden="true"></i>&nbsp;Detalle de la solicitud
                                                                                    </a>
                                                                                </li>
                                                                                <li class="border-bottom">
                                                                                    <a class="dropdown-item" onclick="formModal('{{ md.pk|encrypt }}', ' DETALLE DE APROBACIÓN', 'mostrardetalleaprobacion_view', '80%');" href="javascript:;">
                                                                                        <i class="fa fa-history" aria-hidden="true"></i>&nbsp;Estado de aprobación
                                                                                    </a>
                                                                                </li>
                                                                                <li class="border-bottom">
                                                                                    <a type="button" class="position-relative dropdown-item" href="{{ request.path }}?action=detallerecaudacion&id={{ md.id|encrypt }}">
                                                                                        <i class="fa fa-percent" aria-hidden="true"></i>&nbsp;Porcentaje de recaudación
                                                                                        {% if notification %}
                                                                                            <span class="position-absolute top-0 start-0 translate-middle badge rounded-pill bg-danger">
                                                                                                <span style="font-size: 10px;" class="blinkimg">&#x1f381;</span>
                                                                                                <span class="visually-hidden">unread messages</span>
                                                                                            </span>
                                                                                        {% endif %}
                                                                                    </a>
                                                                                </li>
                                                                                {% if md.estado == 1 %}
                                                                                    <li class="border-bottom">
                                                                                        <a class="dropdown-item" onclick="eliminar('{{ md.id|encrypt }}', '{{ md.nombre|upper }}', 'deletepublicacion', '{{ request.path }}' )" href="javascript:void(0);">
                                                                                            <i class="fa fa-trash"></i>&nbsp;Eliminar solicitud</a>
                                                                                    </li>
                                                                                {% endif %}
        {#                                                                            {% if md.estado == 2 %}#}
                                                                                    <li class="border-bottom">
                                                                                        <a class="dropdown-item" href="{{ request.path|safe }}?action=editpublicacion&id={{ md.id|encrypt }}">
                                                                                            <i class="fa fa-edit"></i>&nbsp;Editar
                                                                                        </a>
                                                                                    </li>
        {#                                                                            {% endif %}#}
                                                                            </div>
                                                                        </div>
                                                                    </section>
                                                                </div>
                                                            </div>
                                                            <div class="row" style="align-items: center;vertical-align: center">
                                                                <div class="col-sm-12 col-md-12 col-lg-2 none-on-sm">
                                                                    <div class="border-0">
                                                                        <section class="mb-1">
                                                                            <a href="javascript:;" id="btn-show-own-profile" onclick="mostrarPerfilPostulante({{ md.id }})">
                                                                                {% if md.mostrarfotoperfil %}
                                                                                    <img class="white-shadow-img" src="{{ md.persona.get_foto }}" width="100" height="100">
                                                                                {% else %}
                                                                                    <img class="white-shadow-img" src="https://sga.unemi.edu.ec/static/images/no-disponible.png" width="100" height="100">
                                                                                {% endif %}
                                                                            </a>
                                                                        </section>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-12 col-md-12 col-lg-10">
                                                                    <section style="padding-left: 10px;">
                                                                        <h4>{{ md.nombre|lower|title }}<br><small class="text-muted">{{ md.tipodonacion|lower|title }}</small></h4>
                                                                        <span style="font-size: 14px;">
                                                                            <img alt="maps" src="https://www.unemi.edu.ec/wp-content/uploads/2022/04/MAPS.png" width="13">{{ md.persona.canton|lower|title }}, {{ md.persona.provincia|lower|title }}
                                                                        </span>
                                                                        <p style="text-align: justify;font-size: 13px">{{ md.objetivo }}</p>
                                                                        <div class="none-on-sm my-2">
                                                                            {% for gp in md.get_productos %}
                                                                                {% if forloop.counter < 3 %}
                                                                                <span class="badge" style="font-size:10px;border:1px solid rgba(157, 157, 157, 0.55);color:black;font-weight: normal;background-color: #fff">{{ gp.producto }}</span>
                                                                                {% else %}
                                                                                <span class="badge" style="font-size:10px;border:1px solid rgba(157, 157, 157, 0.55);color:black;font-weight: normal;background-color: #fff">...</span>
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </section>
                                                                    <section style="padding-left: 10px" class="mb-1">
                                                                        {% if not md.PUBLICADO_HACE.days %}
                                                                            {#                                                                Hace {{ md.PUBLICADO_HACE|stringformat:"s"|slice:"7:9"  }} horas#}
                                                                            {% with time=md|args:md.PUBLICADO_HACE|call:"get_timepublicadohace" %}
                                                                                Hace
                                                                                {% if time.0.0 %}
                                                                                    {{ time.0.0 }} horas
                                                                                {% else %}
                                                                                    {% if time.0.1 %}
                                                                                        {{ time.0.1 }} minutos
                                                                                    {% else %}
                                                                                        {{ time.0.2 }} segundos
                                                                                    {% endif %}
                                                                                {% endif %}
                                                                            {% endwith %}
                                                                        {% else %}
                                                                            Hace {{ md.PUBLICADO_HACE.days|default:"0" }} dias
                                                                        {% endif %}
                                                                        {#                                                        str(data['mispublicaciones'][0].PUBLICADO_HACE).split(',')[1].split('.')[0]#}
                                                                    </section>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% empty %}
{#                                                <div><label class="label label-secondary text-center">NO EXISTEN REGISTROS EN EL PERIODO SELECCIONADO</label></div>#}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            <!-- INICIO PUBLICACIONES EXTERNAS -->
                            <div class="tab-pane fade {% if tab_number == 2 %}show active{% endif %}" id="tab-publicaciones-externas" role="tabpanel" aria-labelledby="externals">
                                <div class="card main-data-publicaciones-externas mb-4 border-0">
                                    <!-- INICIO FILTROS -->
                                    <div class="card-header mt-4">
                                        <form id="form-2" method="GET" action="{{ request.path }}" enctype="text/plain">
                                            <input class="form-control" type="hidden" name="tab" value="2">
                                            <div class="row-fluid">
                                                <div class="col-sm-12 col-md-12 col-lg-3">
                                                    <div class="row-fluid text-container form-to-filter-publicaciones-externas" style="float:left;">
                                                        <div class="input-group me-3 col-sm-12">
                                                            <input name="s" tab="2" value="{% if tab_number == 2 %}{{ s|default:"" }}{% endif %}" class="form-control" type="text" placeholder="  Buscar publicación..." style="font-family:Arial, FontAwesome;border-radius: 20px;width: 100%">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12 col-md-12 col-lg-3">
                                                    <h4 style="margin-top: 2px;">Publicaciones externas<small class="text-muted">&nbsp;&nbsp;{{ publicacionesexternas.count }} total</small></h4>
                                                </div>
                                                <div class="col-sm-12 col-md-6 col-lg-6">
                                                    <div class="row">
                                                        <div class="col-lg-3 d-sm-none d-md-none d-lg-block"></div>
                                                        <div class="col-lg-6 col-md-12 col-sm-12">
                                                            <div class="input-group mb-3">
                                                              <input value="{% if tab_number == 2 %}{{ fi|default:"" }}{% endif %}" style="border-bottom-left-radius: 20px;border-top-left-radius: 20px;" type="date" class="form-control" title="Desde" aria-label="Desde" tab="2" name="fi">
                                                              <input value="{% if tab_number == 2 %}{{ ff|default:"" }}{% endif %}" style="border-bottom-right-radius: 20px;border-top-right-radius: 20px;" type="date" class="form-control" title="Hasta" aria-label="Hasta" tab="2" name="ff">
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-3 d-sm-none d-md-none d-lg-block"></div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 col-md-6 col-lg-3">
                                                    <select class="grupo_filtro form-control" style="border-radius:20px;width: 100%" tab="2" name="td">
                                                        <option value="0" style="text-align: center" {% if not td %}  {% endif %}>--TODOS--</option>
                                                        {% for gb in groupbypublicacionesexternas %}
                                                            <option value="{{ gb.0 }}" {% if td|add:"0" == gb.0|add:"0" and tab_number == 2 %} selected {% endif %}>{{ gb.1 }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </form>
                                        <div class="row">
                                            <div class="row-fluid" style="text-align: center">
                                                <div class="col-12">
                                                {% if url_vars_filter2 %}
                                                    <hr class="px-4" style="width:60%; margin: auto;border-color:lightgrey;"><br>
                                                    <div class="row-fluid">
                                                        {% for var in url_vars_filter2 %}
                                                            <button tab="2" onclick="del(this);" type="button" class="btn rounded-pill">
                                                                <span class="{{ var.0 }}"><i class="fa fa-times" style="font-size: 9px;padding: 3px;color: silver;"></i>{{ var.1|upper }}</span>
                                                            </button>
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- FIN FILTROS -->
                                    <div class="card-body" data-bs-spy="scroll">
                                        <table class="table table-responsive table-borderless">
                                            <tbody>
                                                <tr>
                                                    <div class="row">
                                                        <div class="col-12">
                                                            {% for md in publicacionesexternas %}
                                                                <div style="display: none">
                                                                    <section class="content-data-for-display-profile-{{ md.id }}"
                                                                             idsoli="{{ md.id }}"
                                                                             nombrecompleto="{{ md.persona.nombre_completo_inverso|lower|title }}"
                                                                             nombre="{{ md.persona.nombres|lower|title }}"
                                                                             emailinst="{{ md.persona.emailinst }}"
                                                                             email="{{ md.persona.email }}"
                                                                             telefono="{{ md.persona.telefono }}"
                                                                             direccion="{{ md.persona.direccion_completa|lower|title }}"
                                                                             foto="{% if md.mostrarfotoperfil %}{{ md.persona.get_foto }}{% else %}https://sga.unemi.edu.ec/static/images/no-disponible.png{% endif %}"
                                                                            {% if md.persona.datos_ultima_matricula2 %} carrera="{{ md.persona.datos_ultima_matricula2.carrera|default:"----" }}"
                                                                             nivel="{{ md.persona.datos_ultima_matricula2.nivel|default:"-" }}
                                                                             {% endif %}">
                                                                    </section>
                                                                </div>
                                                                <div>
                                                                    <div class="card box_border mb-3">
                                                                        {# ESTO PINTA LA LINEA NARANJA EN EL CARD: border-top border-4 border-dark-info#}
                                                                        <div class="card-body border-1 rounded-3 pt-2" id="border-box-mis-publicaciones">
                                                                            <div class="row">
                                                                                <div class="col-md-10 col-sm-12 align-middle mt-1">
                                                                                    <section style="float: left;">
                                                                                        {% if md.estadoprioridad == 1 %}
                                                                                            <span class="label bg-danger">SE PRECISA URGENTE</span>
                                                                                        {% elif md.estadoprioridad == 2 %}
                                                                                            <span class="label label-warning">SOLICITUD DESTACADA</span>
                                                                                        {% endif %}
    {#                                                                                            {% if md.DIAS_FIN_RECEPCION.days < 5 %}#}
                                                                                        <span class="label label-info">QUEDAN {{ md.DIAS_FIN_RECEPCION.days|default:"0" }} DÍAS</span>
    {#                                                                                            {% endif %}#}
                                                                                    </section>
                                                                                </div>
                                                                                <div class="col-md-1"></div>
                                                                                <div class="col-md-1 col-sm-12">
                                                                                    <div class="dropdown dropstart" style="float: right;">
                                                                                        <a href="javascript:void(0);" class="btn-icon btn btn-ghost btn-sm rounded-circle"
                                                                                           data-bs-toggle="dropdown" data-offset="-140"
                                                                                           aria-haspopup="true" aria-expanded="false">
                                                                                            <i class="fa fa-ellipsis-v"></i>
                                                                                        </a>
                                                                                        <div class="dropdown-menu">
                                                                                            <a href="javascript:;" class="dropdown-item card-to-open-details" idsoli="{{ md.id|encrypt }}"><i class="fa fa-th-list" aria-hidden="true"></i>&nbsp;Detalle de la solicitud</a>
                                                                                            {% if persona %}
                                                                                                {% if not persona == md.persona %}
                                                                                                    <a href="{% if tiene_datos_donacion %}/publicaciondonacion?action=listaproductos&id={{ md.id|encrypt }}{% else %}/donaciones{% endif %}" class="dropdown-item"><i class="fa fa-handshake-o" aria-hidden="true"></i>&nbsp;Donar</a>
                                                                                                {% endif %}
                                                                                            {% endif %}
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row" style="align-items: center;vertical-align: center">
                                                                                <div class="col-sm-3 col-md-3 col-lg-2">
                                                                                    <div class="border-0">
                                                                                        <section class="mb-1">
                                                                                            <a href="javascript:;" onclick="mostrarPerfilPostulante({{ md.id }})">
                                                                                                {% if md.mostrarfotoperfil %}
                                                                                                    <img class="white-shadow-img" src="{{ md.persona.get_foto }}" width="100" height="100">
                                                                                                {% else %}
                                                                                                    <img class="white-shadow-img" src="https://sga.unemi.edu.ec/static/images/no-disponible.png" width="100" height="100">
                                                                                                {% endif %}
                                                                                            </a>
                                                                                        </section>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-9 col-md-9 col-lg-10" idsoli="{{ md.id|encrypt }}">
                                                                                    <section style="padding-left: 10px;">
                                                                                        <h4>{{ md.nombre|lower|title }}<br><small class="text-muted"> {{ md.tipodonacion|lower|title }}</small></h4>
                                                                                        <span style="font-size: 14px;"><img src="https://www.unemi.edu.ec/wp-content/uploads/2022/04/MAPS.png" width="13">
                                                                                            {{ md.persona.canton|lower|title }}, {{ md.persona.provincia|lower|title }}
                                                                                        </span>
                                                                                        <p style="text-align: justify;font-size: 13px;">{{ md.objetivo }}</p><br>
                                                                                        {% for gp in md.get_productos %}

                                                                                            {% if forloop.counter <= 2 %}
                                                                                                <span class="badge" style="font-size:10px;border:1px solid rgba(157, 157, 157, 0.55);border-radius:10px;color:black;font-weight: normal;background-color: #fff">{{ gp.producto }}</span>
                                                                                                {% if forloop.counter == 2 %}
                                                                                                    <span class="badge" style="font-size:10px;border:1px solid rgba(157, 157, 157, 0.55);border-radius:10px;color:black;font-weight: normal;background-color: #fff">...</span>
                                                                                                {% endif %}
                                                                                            {% endif %}
                                                                                        {% endfor %}
                                                                                    </section>
                                                                                    <br>
                                                                                    <section class="mb-2" style="padding-left: 10px">
                                                                                        {% if not md.PUBLICADO_HACE.days %}
                                                                                            {% with time=md|args:md.PUBLICADO_HACE|call:"get_timepublicadohace" %}
                                                                                                Hace
                                                                                                {% if time.0.0 %}
                                                                                                    {{ time.0.0 }} horas
                                                                                                {% else %}
                                                                                                    {% if time.0.1 %}
                                                                                                        {{ time.0.1 }} minutos
                                                                                                    {% else %}
                                                                                                        {{ time.0.2 }} segundos
                                                                                                    {% endif %}
                                                                                                {% endif %}
                                                                                            {% endwith %}
                                                                                        {% else %}
                                                                                            Hace {{ md.PUBLICADO_HACE.days|default:"0" }}
                                                                                            dias
                                                                                        {% endif %}
                                                                                    </section>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                {% empty %}
{#                                                                <div class="row-fluid">#}
{#                                                                    <div class="card">#}
{#                                                                        <div class="card-body text-center">#}
{#                                                                            <label class="label label-secondary mb-1">NO EXISTEN REGISTROS EN EL PERIODO SELECCIONADO</label>#}
{#                                                                        </div>#}
{#                                                                    </div>#}
{#                                                                </div>#}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </tr>
                                            </tbody>
                                        </table>


                                        <!--FIN PAGINACION PUBLICACION EXTERNA-->

                                    </div>
                                    <div class="card-footer border-top-0">
                                        {% if publicacionesexternas %}
                                            <div class="col-lg-12">
                                                <nav style="margin-bottom: 7px">
                                                    {% if paging.num_pages > 5 %}
                                                        <ul class="pagination justify-content-center mb-0">
                                                            {% if paging.primera_pagina %}
                                                                <li class="page-item">
                                                                    <a class="page-link bloqueo_pantalla" href="?page=1{{ url_vars }}&tab=2">1</a>
                                                                </li>
                                                                <li class="page-item">
                                                                    <a href="?page={{ paging.ellipsis_izquierda }}{{ url_vars }}&tab=2"
                                                                       class="active page-link bloqueo_pantalla">...</a></li>
                                                            {% endif %}
                                                            {% for pagenumber in paging.paginas %}
                                                                <li {% if pagenumber == page.number %}class='active page-item '
                                                                    {% else %}class='page-item'{% endif %}>
                                                                    <a href="?page={{ pagenumber }}{{ url_vars }}&tab=2"
                                                                       class="page-link bloqueo_pantalla">{{ pagenumber }}</a>
                                                                </li>
                                                            {% endfor %}
                                                            {% if paging.ultima_pagina %}
                                                                <li class="page-item">
                                                                    <a href="?page={{ paging.ellipsis_derecha }}{{ url_vars }}&tab=2"
                                                                       class="active page-link bloqueo_pantalla">...</a></li>
                                                                <li class="page-item">
                                                                    <a href="?page={{ paging.num_pages }}{{ url_vars }}&tab=2"
                                                                       class="page-link bloqueo_pantalla">{{ paging.num_pages }}</a>
                                                                </li>
                                                            {% endif %}
                                                        </ul>
                                                    {% else %}
                                                        <ul class="pagination justify-content-center mb-0">
                                                            {% for pagenumber in paging.page_range %}
                                                                <li {% if pagenumber == page.number %}class='active page-item'
                                                                    {% else %}class="page-item"{% endif %}>
                                                                    <a class="page-link bloqueo_pantalla"
                                                                       href="?page={{ pagenumber }}{{ url_vars }}&tab=2">{{ pagenumber }}</a>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% endif %}
                                                </nav>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <!--FIN PUBLICACIONES EXTERNAS-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN PUBLICACIONES -->
    </div><br>
    <div class="course-card-body-copy" style="display: none;"></div>
{% endblock %}
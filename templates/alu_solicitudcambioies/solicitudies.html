{% extends "basepse.html" %}
{% load sga_extras %}
{% block  heading %}
    <script src='/static/js/jquery.validationEngine.js' type="text/javascript"></script>
    <script src='/static/js/jquery.validationEngine-es.js' type="text/javascript"></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css"/>
    <script type="text/javascript" src="/static/js/bootstrap-filestyle.min.js"> </script>
    <script src="/static/adicionalesjs/formquestion.js?0.24"></script>
    <link href="/static/cajasforms.css?4.0.0" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="/static/js/bootstrap-filestyle.min.js?v=1.0.1"></script>
    <style>
        .help-text{
            color:red;

        }
        form input, form select,form textarea {
            text-transform: initial;
        !important;
        }

        input[type="file"] {
            width: 10%; !important;
        }
    </style>
    <script type="text/javascript">
        var numImplemento = 1;
        function limpiarseguimiento(){
            $('.listsolicitud').empty();
            $('.seguimiento').empty();
        }
        $(function () {
            $('#tbrequisitos').on("click", "tbody tr td .deleteInfoImplemento", function () {
                $(this).parents('tr').remove();
            })
            $("select").select2({width: '100%'});
            $(":file").filestyle({"input": false});
            $('#solicitar').click(function (){
                {% if apertura %}
                   limpiarseguimiento()
                   $("#form")[0].reset();
                   $('#formregistro').removeAttr('hidden')
                {% else %}
                    $('#sinperiodo').removeAttr('hidden')
                    limpiarseguimiento()
                {% endif %}
            })

            $('#consultar').click(function (){
                if ($('#id_ced').val().trim()){
                    $('#formregistro').attr('hidden','hidden')
                    $('#sinperiodo').attr('hidden','hidden')
                    var respuesta=validarcedula($('#id_ced').val().trim());
                    if (respuesta[0]==false){
                        $('.listsolicitud').empty();
                        $('.help-textced').html(respuesta[1]);
                        $('#id_ced').val('')

                    }else{
                        cargarform('listsolicitudes')
                        $('.deleteInfoImplemento').trigger('click');
                    }
                }else{
                    Swal.fire(
                      'Campo cédula vacia',
                      'Por favor ingrese su cédula antes de realizar la consulta',
                      'warning'
                    )
                }
            })
            $("#id_ced").keypress(function(e) {
                   if(e.which == 13) {
                      $('#consultar').trigger("click");
                   }
                });
            {% if apertura %}
                $('.filepdf').on('change', function () {
                    var rutaimg = $(this).val();
                    var extension = rutaimg.substring(rutaimg.length - 3, rutaimg.length);
                    if (extension.toLowerCase() === 'pdf') {
                        $('.filepdf').fadeIn("fast").attr('src', URL.createObjectURL(event.target.files[0]));
                    } else {
                        $(this).val(null);
                        $(this).filestyle('clear');
                        Swal.fire(
                          'Seleccione un archivo formato .pdf',
                          'Documento con el formato no permitido',
                          'warning'
                        )
                    }
                });

                $('#carrerasfilter').select2({
                    language: {
                        inputTooShort: function () {
                            return "Ingresa al menos un caracter...";
                        },
                        "noResults": function () {
                            return "Sin resultados (Recuerda ingresar tu puntaje para buscar poder buscar una carrera)";
                        },
                        "searching": function () {
                            return "Buscando...";
                        }
                    },
                    allowClear : true,
                    debug: true,
                    ajax: {
                        delay: 250,
                        type: 'POST',
                        url: '/alu_solicitudcambioies',
                        data: function (params) {
                            return {
                                term: params.term,
                                'action': 'buscarcarrera',
                                'periodo': {{ apertura.pk }},
                                'puntaje': $('#puntajeobtenido').val()
                            };
                        },
                        processResults: function (data) {
                            return {
                                results: data
                            };
                        },
                    },
                    placeholder: 'BUSCAR UNA CARRERA',
                    minimumInputLength: 1,
                });

                $('#puntajeobtenido').on('keypress', function (e){
                    if (e.which !== 8 && e.which !== 0 && (e.which < 48 || e.which > 57)) {
                        return false;
                    }
                }).on('keyup', function (e){
                    if ($('#carrerasfilter').val() !== null){
                            NotificationJG.error('Haz cambiado tu puntaje, vuelve a elegir una carrera por favor');
                        }
                    $('#carrerasfilter').find('option:selected').remove().end().empty().val(null).trigger('change');
                    if ($('#puntajeobtenido').val() <= 0) {
                        NotificationJG.error('Debes ingresar su puntaje para poder buscar');
                    }
                })
                $('#universidadfilter').select2({
                    language: {
                        inputTooShort: function () {
                            return "Ingresa al menos un caracter...";
                        },
                        "noResults": function () {
                            return "Sin resultados (Recuerda ingresar tu puntaje para buscar poder buscar una carrera)";
                        },
                        "searching": function () {
                            return "Buscando...";
                        }
                    },
                    allowClear : true,
                    debug: true,
                    ajax: {
                        delay: 250,
                        type: 'GET',
                        url: '/alu_solicitudcambioies',
                        data: function (params) {
                            return {
                                term: params.term,
                                'action': 'buscaruniversidad',
                            };
                        },
                        processResults: function (data) {
                            return {
                                results: data
                            };
                        },
                    },
                    placeholder: 'BUSCAR UNA UNIVERSIDAD',
                    minimumInputLength: 1,
                }).on('select2:select', function (e) {
                    if ($(this).val() == 9139) {
                        $("#universidadtext1").css('display', 'block')
                    }
                    else {
                        $("#universidadtext1").css('display', 'none').val('')
                        $("#id_universidadtext").val('')
                        }
                })
            {% endif %}
        });
        bloqueointerface = function(){
                if (!$(".blockUI").length){
                    $.blockUI({message: $('#throbber'), css: { 'border': '1px solid', 'border-radius' : '10px', 'left': '46%', 'width':'120px',  'padding': '15px',  '-webkit-border-radius': '10px', '-moz-border-radius': '10px', opacity: .6, color: '#000' }});
                }
            };
        function remove(el, opts) {
            var full = (el == window);
            var $el = $(el);
            var data = $el.data('blockUI.history');
            var to = $el.data('blockUI.timeout');
            if (to) {
                clearTimeout(to);
                $el.removeData('blockUI.timeout');
            }
            opts = $.extend({}, $.blockUI.defaults, opts || {});
            bind(0, el, opts); // unbind events

            if (opts.onUnblock === null) {
                opts.onUnblock = $el.data('blockUI.onUnblock');
                $el.removeData('blockUI.onUnblock');
            }

            var els;
            if (full) // crazy selector to handle odd field errors in ie6/7
                els = $('body').children().filter('.blockUI').add('body > .blockUI');
            else
                els = $('.blockUI', el);

            if (full)
                pageBlock = pageBlockEls = null;

            if (opts.fadeOut) {
                els.fadeOut(opts.fadeOut);
                setTimeout(function() { reset(els,data,opts,el); }, opts.fadeOut);
            }
            else
                reset(els, data, opts, el);
        };
        $(function() {
            clienteinfo = function(window) {
                {
                    var unknown = '-';

                    // screen
                    var screenSize = '';
                    if (screen.width) {
                        width = (screen.width) ? screen.width : '';
                        height = (screen.height) ? screen.height : '';
                        screenSize += '' + width + " x " + height;
                    }

                    // browser
                    var nVer = navigator.appVersion;
                    var nAgt = navigator.userAgent;
                    var browser = navigator.appName;
                    var version = '' + parseFloat(navigator.appVersion);
                    var majorVersion = parseInt(navigator.appVersion, 10);
                    var nameOffset, verOffset, ix;

                    // Opera
                    if ((verOffset = nAgt.indexOf('Opera')) != -1) {
                        browser = 'Opera';
                        version = nAgt.substring(verOffset + 6);
                        if ((verOffset = nAgt.indexOf('Version')) != -1) {
                            version = nAgt.substring(verOffset + 8);
                        }
                    }
                    // Opera Next
                    if ((verOffset = nAgt.indexOf('OPR')) != -1) {
                        browser = 'Opera';
                        version = nAgt.substring(verOffset + 4);
                    }
                    // MSIE
                    else if ((verOffset = nAgt.indexOf('MSIE')) != -1) {
                        browser = 'Microsoft Internet Explorer';
                        version = nAgt.substring(verOffset + 5);
                    }
                    // Chrome
                    else if ((verOffset = nAgt.indexOf('Chrome')) != -1) {
                        browser = 'Chrome';
                        version = nAgt.substring(verOffset + 7);
                    }
                    // Safari
                    else if ((verOffset = nAgt.indexOf('Safari')) != -1) {
                        browser = 'Safari';
                        version = nAgt.substring(verOffset + 7);
                        if ((verOffset = nAgt.indexOf('Version')) != -1) {
                            version = nAgt.substring(verOffset + 8);
                        }
                    }
                    // Firefox
                    else if ((verOffset = nAgt.indexOf('Firefox')) != -1) {
                        browser = 'Firefox';
                        version = nAgt.substring(verOffset + 8);
                    }
                    // MSIE 11+
                    else if (nAgt.indexOf('Trident/') != -1) {
                        browser = 'Microsoft Internet Explorer';
                        version = nAgt.substring(nAgt.indexOf('rv:') + 3);
                    }
                    // Other browsers
                    else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) < (verOffset = nAgt.lastIndexOf('/'))) {
                        browser = nAgt.substring(nameOffset, verOffset);
                        version = nAgt.substring(verOffset + 1);
                        if (browser.toLowerCase() == browser.toUpperCase()) {
                            browser = navigator.appName;
                        }
                    }
                    // trim the version string
                    if ((ix = version.indexOf(';')) != -1) version = version.substring(0, ix);
                    if ((ix = version.indexOf(' ')) != -1) version = version.substring(0, ix);
                    if ((ix = version.indexOf(')')) != -1) version = version.substring(0, ix);

                    majorVersion = parseInt('' + version, 10);
                    if (isNaN(majorVersion)) {
                        version = '' + parseFloat(navigator.appVersion);
                        majorVersion = parseInt(navigator.appVersion, 10);
                    }

                    // mobile version
                    var mobile = /Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);

                    // cookie
                    var cookieEnabled = (navigator.cookieEnabled) ? true : false;

                    if (typeof navigator.cookieEnabled == 'undefined' && !cookieEnabled) {
                        document.cookie = 'testcookie';
                        cookieEnabled = (document.cookie.indexOf('testcookie') != -1) ? true : false;
                    }

                    // system
                    var os = unknown;
                    var clientStrings = [
                        {s:'Windows 10', r:/(Windows 10.0|Windows NT 10.0)/},
                        {s:'Windows 8.1', r:/(Windows 8.1|Windows NT 6.3)/},
                        {s:'Windows 8', r:/(Windows 8|Windows NT 6.2)/},
                        {s:'Windows 7', r:/(Windows 7|Windows NT 6.1)/},
                        {s:'Windows Vista', r:/Windows NT 6.0/},
                        {s:'Windows Server 2003', r:/Windows NT 5.2/},
                        {s:'Windows XP', r:/(Windows NT 5.1|Windows XP)/},
                        {s:'Windows 2000', r:/(Windows NT 5.0|Windows 2000)/},
                        {s:'Windows ME', r:/(Win 9x 4.90|Windows ME)/},
                        {s:'Windows 98', r:/(Windows 98|Win98)/},
                        {s:'Windows 95', r:/(Windows 95|Win95|Windows_95)/},
                        {s:'Windows NT 4.0', r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},
                        {s:'Windows CE', r:/Windows CE/},
                        {s:'Windows 3.11', r:/Win16/},
                        {s:'Android', r:/Android/},
                        {s:'Open BSD', r:/OpenBSD/},
                        {s:'Sun OS', r:/SunOS/},
                        {s:'Linux', r:/(Linux|X11)/},
                        {s:'iOS', r:/(iPhone|iPad|iPod)/},
                        {s:'Mac OS X', r:/Mac OS X/},
                        {s:'Mac OS', r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},
                        {s:'QNX', r:/QNX/},
                        {s:'UNIX', r:/UNIX/},
                        {s:'BeOS', r:/BeOS/},
                        {s:'OS/2', r:/OS\/2/},
                        {s:'Search Bot', r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}
                    ];
                    for (var id in clientStrings) {
                        var cs = clientStrings[id];
                        if (cs.r.test(nAgt)) {
                            os = cs.s;
                            break;
                        }
                    }

                    var osVersion = unknown;

                    if (/Windows/.test(os)) {
                        osVersion = /Windows (.*)/.exec(os)[1];
                        os = 'Windows';
                    }

                    switch (os) {
                        case 'Mac OS X':
                            osVersion = /Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];
                            break;

                        case 'Android':
                            osVersion = /Android ([\.\_\d]+)/.exec(nAgt)[1];
                            break;

                        case 'iOS':
                            osVersion = /OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);
                            osVersion = osVersion[1] + '.' + osVersion[2] + '.' + (osVersion[3] | 0);
                            break;
                    }

                    // flash (you'll need to include swfobject)
                    /* script src="//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js" */
                    var flashVersion = 'no check';
                    if (typeof swfobject != 'undefined') {
                        var fv = swfobject.getFlashPlayerVersion();
                        if (fv.major > 0) {
                            flashVersion = fv.major + '.' + fv.minor + ' r' + fv.release;
                        }
                        else  {
                            flashVersion = unknown;
                        }
                    }
                }

                window.jscd = {
                    screen: screenSize,
                    browser: browser,
                    browserVersion: version,
                    browserMajorVersion: majorVersion,
                    mobile: mobile,
                    os: os,
                    osVersion: osVersion,
                    cookies: cookieEnabled,
                    flashVersion: flashVersion
                };
            };

            clienteinfo(window);

            var navegador = jscd.browser +' '+ jscd.browserMajorVersion;
            var os =  jscd.os +' '+ jscd.osVersion;
            var cookies = jscd.cookies;
            var screensize = jscd.screen;

            $("#id_cedula").change(function(){
                $('.help-textcedula').html('');
                if ($("#id_tipoiden").val()==1){
                    var respuesta=validarcedula($("#id_cedula").val().trim());
                    if (respuesta[0]==false){
                        $('.help-textcedula').html(respuesta[1]);
                        $("#id_cedula").val('')
                    }
                }
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/alu_solicitudcambioies",
                    data: {'action': 'consultacedula', "cedula":this.value, },
                    success: function(data) {
                        if (data.result == 'ok') {
                            $.unblockUI();
                            $("#id_nombres").val(data.nombres);
                            $("#id_apellido1").val(data.apellido1);
                            $("#id_apellido2").val(data.apellido2);
                            $("#id_correo").val(data.email);
                            $("#id_celular").val(data.telefono);
                             $('#id_genero').val(data.idgenero).trigger('change.select2');
                        }else{
                            $.unblockUI();
                            $("#id_nombres").val('');
                            $("#id_apellido1").val('');
                            $("#id_apellido2").val('');
                            $("#id_correo").val('');
                            $("#id_celular").val('');
                        }
                        {#$("#registro_bt").removeAttr('disabled');#}
                    },
                    error: function() {
                        $.unblockUI();
                        {#$("#registro_bt").removeAttr('disabled');#}
                        $("#errormensaje_r").html('Error al enviar los datos al servidor').show();
                    },
                    dataType: "json"
                });
            });

            var submitBtn = document.getElementById("submit");

            $("#registro_bt").click(function(){
                var valid = $("form").validationEngine('validate');
                if (valid){
                    $('.controls input').each(function(){
                        if ($(this).attr('type')=='text'){
                            $(this).val($(this).val().trim());
                        }
                    });
                    var dataForm = new FormData($("#form")[0]);

                    bloqueointerface()
                     $.ajax({
                        type: "POST",
                        url: "/alu_solicitudcambioies",
                        data: dataForm,
                        processData: false,
                        contentType: false,
                        success: function(data) {
                            if (data.result == 'ok') {
                                $.unblockUI();
                                Swal.fire(
                                    'Confirmación',
                                    data.mensaje,
                                    'success',
                                ).then((result) => {
                                    if (!result.isConfirmed) {
                                         cargarform('seguimiento',data.solicitud)
                                        $('#formregistro').attr('hidden','hidden')
                                        $("#form")[0].reset()
                                        $("#carrerasfilter").empty()
                                        $("#universidadfilter").empty()
                                        $('#id_cedula').val(data.solicitud)
                                        }
                                    }
                                )
                            }else{
                                $.unblockUI();
                                Swal.fire(
                                    'Mensaje',
                                    data.mensaje,
                                    'warning'
                                    )
                            }
                            {#$("#registro_bt").removeAttr('disabled');#}
                        },
                        error: function() {
                            $.unblockUI();
                            {#$("#registro_bt").removeAttr('disabled');#}
                            $("#errormensaje_r").html('Error al enviar los datos al servidor').show();
                        },
                        dataType: "json"
                     });

                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    return false;
                    $.unblockUI();
                }
            });
            $("#id_cedula, #id_cursos,#id_participaciones, #id_nombres, #id_apellido1,#id_cedula, #id_apellido2,#id_correo,#id_celular,#id_sexo,#id_universidad,#carrerasfilter,#puntajeobtenido,#id_cedula,#id_telefonocontacto, #id_nombrecontacto, #id_emailuniversidad, #id_universidadtext").addClass("validate[required]");
            $("#id_correo").addClass("validate[custom[email]");
            $("#id_emailuniversidad").addClass("validate[custom[email]");

        });
        function registrar(op){
            if(op==1){
                $("#registro").css("display","block");
                $("#maincontent").css("display","none");
            }else{
                $("#registro").css("display","none");
                $("#maincontent").css("display","block");
            }
        }
        $(function(){
            $(document).bind("contextmenu",function(e){
                return false;
            });
        });

        //aqui entra
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    </script>
    <script type="text/javascript">
        function validarcedula(cedula){
            if (cedula.length == 10) {

            //Obtenemos el digito de la region que sonlos dos primeros digitos
            var digito_region = cedula.substring(0, 2);

            //Pregunto si la region existe ecuador se divide en 24 regiones
            if (digito_region >= 1 && digito_region <= 24) {

                // Extraigo el ultimo digito
                var ultimo_digito = cedula.substring(9, 10);

                //Agrupo todos los pares y los sumo
                var pares = parseInt(cedula.substring(1, 2)) + parseInt(cedula.substring(3, 4)) + parseInt(cedula.substring(5, 6)) + parseInt(cedula.substring(7, 8));

                //Agrupo los impares, los multiplico por un factor de 2, si la resultante es > que 9 le restamos el 9 a la resultante
                var numero1 = cedula.substring(0, 1);
                var numero1 = (numero1 * 2);
                if (numero1 > 9) {
                    var numero1 = (numero1 - 9);
                }

                var numero3 = cedula.substring(2, 3);
                var numero3 = (numero3 * 2);
                if (numero3 > 9) {
                    var numero3 = (numero3 - 9);
                }

                var numero5 = cedula.substring(4, 5);
                var numero5 = (numero5 * 2);
                if (numero5 > 9) {
                    var numero5 = (numero5 - 9);
                }

                var numero7 = cedula.substring(6, 7);
                var numero7 = (numero7 * 2);
                if (numero7 > 9) {
                    var numero7 = (numero7 - 9);
                }

                var numero9 = cedula.substring(8, 9);
                var numero9 = (numero9 * 2);
                if (numero9 > 9) {
                    var numero9 = (numero9 - 9);
                }

                var impares = numero1 + numero3 + numero5 + numero7 + numero9;

                //Suma total
                var suma_total = (pares + impares);

                //extraemos el primero digito
                var primer_digito_suma = String(suma_total).substring(0, 1);

                //Obtenemos la decena inmediata
                var decena = (parseInt(primer_digito_suma) + 1) * 10;

                //Obtenemos la resta de la decena inmediata - la suma_total esto nos da el digito validador
                var digito_validador = decena - suma_total;

                //Si el digito validador es = a 10 toma el valor de 0
                if (digito_validador == 10)
                    var digito_validador = 0;

                //Validamos que el digito validador sea igual al de la cedula
                if (digito_validador == ultimo_digito) {
                    return true;
                } else {
                    var respuesta=[false,'La cedula es incorrecta']
                    return respuesta;
                }

            } else {
                // imprimimos en consola si la region no pertenece
                $('.help-textcedula').html('Esta cedula no pertenece a ninguna region');
                $("#id_cedula").val('')
                return false;
            }
        } else {
            //imprimimos en consola si la cedula tiene mas o menos de 10 digitos
            var respuesta=[false,'Esta cedula tiene menos de 10 Digitos']
            return respuesta;
        }
}
        function cargarform(action,id){
            $('.seguimiento').empty();
            bloqueointerface()
            $.ajax({
                    type: "GET",
                    url: `{{ request.path }}`,
                    data: {
                        'action':action,
                        'cedula':$('#id_ced').val(),
                        'id':id
                    },
                    success: function (data) {
                        if (data.result === true) {
                            $.unblockUI();
                            if (id){
                                $('.seguimiento').html(data.data);
                                $('.deleteInfoImplemento').trigger('click');
                            }else{
                                $('.listsolicitud').html(data.data);
                            }

                        } else {
                            $.unblockUI();
                            mensajeWarning(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        $("#registro_bt").removeAttr('disabled');
                        $("#errormensaje_r").html('Error al enviar los datos al servidor').show();
                    },
                    dataType: "json"
                })
        }
        function cargarmodaldocumentos(id,text, footer=true){
            bloqueointerface()
            $.ajax({
                    type: "GET",
                    url: `{{ request.path }}`,
                    data: {
                        'action':'cargarfile',
                        'id':id
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result === true) {
                                if (footer === true) {
                                    $('#footermodalform').hide();
                                }
                                $('.panelbodyform').html(data.data);
                                $('#modaldocumentos .paneltitleform').html(text);
                                $("#modaldocumentos").modal({backdrop: 'static'}).modal('show');
                        } else {
                            $.unblockUI();
                            mensajeWarning(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        $("#registro_bt").removeAttr('disabled');
                        $("#errormensaje_r").html('Error al enviar los datos al servidor').show();
                    },
                    dataType: "json"
                })

        }

        function btnAddarchivo(id, nombre_input) {
            var tabla= '#tbrequisitos' + id
            console.log(nombre_input)
            $(tabla+' tbody').append($('<tr>', {'id': numImplemento}).append(
            $('<td>').append('<b>Seleccione el Nivel:</b>').append($('<select>',{
                'class': 'form-control nivel',
                'name': `nivel_${nombre_input}[]`,
                'style': 'width:100%',
                'id': `nivel${numImplemento}`,
                'attr':'required'
            }).append('<option value="">---------</option>')
            {% for nivel in nivelesdemallas %}
                 .append($('<option>',{
                    value: '{{ nivel.id }}',
                    text: '{{ nivel }}'
                })){% endfor %}).append('<b>Nombre de Asignatura:</b>').append($('<input>', {
                'class': 'form-control descripcion',
                'type':'text',
                'name': `desc_${nombre_input}[]`,
                'style': 'width:100%',
                'id': `desc${numImplemento}`,
                'placeholder': 'Ejem. Matemáticas',
                'attr':'required',
            })).append($('<input>', {
                'class': 'filepdf',
                'type':'file',
                'accept':".pdf",
                'name': `doc_${nombre_input}[]`,
                'style': 'width:100%',
                'id': `fam${numImplemento}`,

            })),
            $('<td style="text-align: center; width: 10px">', {}).append($('<button>', {
                'type': 'button',
                'required': 'true',
                'onclick': `deleteInfo(${numImplemento})`,
                'class': 'btn btn-danger btn-mini deleteInfoImplemento',
                'html': '<i class="fa fa-times"></i>'
            }))));
            numImplemento += 1;
}
        function btnAddarchivo1(id, nombre_input) {
            var tabla= '#tbrequisitos' + id
            $(tabla+' tbody').append($('<tr>', {'id': numImplemento}).append(
            $('<td>').append('<b>Nombre del Documento:</b>').append($('<input>', {
                'class': 'form-control descripcion',
                'type':'text',
                'name': `desc_${nombre_input}[]`,
                'style': 'width:100%',
                'id': `desc${numImplemento}`,
                'placeholder': 'Describir un alias',
                'attr':'required',
            })).append($('<input>', {
                'class': 'filepdf',
                'type':'file',
                'accept':".pdf",
                'name': `doc_${nombre_input}[]`,
                'style': 'width:100%',
                'id': `fam${numImplemento}`,

            })),
            $('<td style="text-align: center; width: 10px">', {}).append($('<button>', {
                'type': 'button',
                'required': 'true',
                'onclick': `deleteInfo(${numImplemento})`,
                'class': 'btn btn-danger btn-mini deleteInfoImplemento',
                'html': '<i class="fa fa-times"></i>'
            }))));
            numImplemento += 1;
}
        function deleteInfo(id) {
            numImplemento -= 1;
            $(`#${id}`).closest('tr').remove();
        }
    </script>
{% endblock %}
{% block pagetitle %}Registro IES{% endblock %}
{% block canvas %}<br>
    <div class="modal fade static" id="modaldocumentos" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h6>
                        <i class="fa fa-cloud-upload"></i> <b class="paneltitleform"> </b>
                    </h6>
                </div>
                <div class="modal-body">
                    <div class="row-fluid">
                    <div class="panelbodyform" style="text-align: justify;">
                    </div>
                </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-outline-success">Insertar</a>
                    <a class="btn btn-outline-danger" data-dismiss="modal">
                    <i class="fa fa-close"></i> Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modalcarrerascambio" style="display: none;">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-sort-numeric-asc"></i> <i class="fa fa-book"></i><b>Listado de Carreras</b>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="opacity: 2 !important;">
                    <span aria-hidden="true"><i class="fa fa-times" style="color: white"></i></span>
                    </button></h4>
                </div>
                <div class="modal-body">
                    <div class="row-fluid ">
                    <div class="col-sm-9" style="text-align: justify;">
                        {% for carrera in  apertura.carreras_periodo %}
                            {% if carrera.puntajerequerido > 0 %}
                            <p><h7> <b>{{ carrera.carrera.nombre_completo_inscripcion }} </b>{% if carrera.cupo_disponible <= 0 %}<span class="label label-important">Cupo agotado</span>{% endif %} </h7>
                                <br>
                                <b>Puentaje requerido: </b>{{ carrera.puntajerequerido }} <br>
                                <b>Cupo disponible: </b>{% if carrera.cupo_disponible <= 0 %}0{% else %}{{ carrera.cupo_disponible  }}{% endif %}<br></p>{% endif %}
                        {% endfor %}
                    </div>
                    <div class="col-sm-3">
                        <img src="/static/images/undraw/maestro.png" width="100px" height="100px">
                    </div>
                </div>
                </div>
                <div class="modal-footer">
                    <div style="float: right" id="footermodalform">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
           <div class="info-box">
                <span class="info-box-icon bg-warning mt-2" style="width: 50px; height: 50px"><i class="fa fa-university" aria-hidden="true"></i></span>
                <div class="info-box-content p-3">
                    <h3><b> Formulario de cambio IES</b></h3>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-4 col-md-4 col-sm-12">
               <div class="info-box p-3">
    {#                   <span class="info-box-icon bg-blue-dark"><i class="fa fa-info"></i></span>#}
                   <div class="info-box-content">
                       <h4><i class="fa fa-info-circle" style="color: #007bff"></i><b> Información </b></h4>
                       <p> Si ya tiene una solicitud realizada, puede consultar con su numero de cedula el estado de su tramite.</p>

                       <p>Si desea realizar una solicitud de cambio de <b>Institución de Educación Superior.</b> seleccione solicitar cambio</p>
                       <a href="javascript:void(0);" class="btn btn-outline-info" id="solicitar"><i class="fa fa-check-circle-o"></i> Solicitar cambio IES</a>
                   </div>
               </div>
            </div>
        <div class="col-lg-6 col-md-8 col-sm-12">
               <div class="card card-success card-outline">
                   <div class="card-body">
                        <div class="info-box">
                            <span class="info-box-icon bg-blue-dark mt-3 ml-2" style="width: 25px; height: 25px"><i class="fa fa-user" aria-hidden="true"></i></span>
                            <div class="info-box-content">
                                <h5><b>Datos del solicitante</b></h5>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label"><b><i class="fa fa-id-card"></i> Tipo de identificación:</b></label><br>
                            <select class="select2-accessible form-control" aria-label="Default select example">
                              <option value="1" selected>CEDULA</option>
                              <option value="2">PASAPORTE</option>
                            </select>
                        </div>
                       <div>
                            <label class="form-label"><b><i class="fa fa-address-card"></i> Cédula o Pasaporte</b></label><br>
                            <input class="form-control" type="text" id="id_ced" placeholder="Ejem. 0302244924">
                           <div class="help-textced" style="color: red"></div>
                            <label style="color: rgb(1, 46, 70); font-size: 12px" class="ml-1"> Nota: Para ingresar pasaporte digite VS al inicio de la numeración. Ejemplo: VSA0928</label>
                       </div>
                       <div>
                           <i class="fa-solid fa-magnifying-glass"></i>
                           <button type="button" class="btn btn-outline-success" id="consultar"><i class="fa fa-search"></i> Consultar</button>

{#                           <a href="javascript:void(0);" class="btn btn-outline-info" id="registrarusuario"><i class="fa fa-check-circle-o"></i> Solicitar</a>#}
                       </div>
                   </div>
               </div>
       </div>
    </div>
    <div class="row justify-content-center" id="formregistro" hidden>
         <div class="col-lg-10 col-sm-12">
            <div class="card card-info card-outline">
               <div class="card-body">
                    <h4><b><i class="fa fa-university" style="color: #179aaf"></i> Registro de solicitud para cambio de Universidad </b></h4>
                    <h4><i class="fa fa-check-circle text-success"></i> {{ apertura.motivo }}</h4>
                    {% for cor in apertura.coordinaciones %}
                        <dvi class="mb-2">
                            <span class="badge badge-warning">{{ cor.nombre }}</span>
                        </dvi>
                    {% endfor %}<br><br>
                    {% if puedeinscribirse %}
                        <form class="" method="POST" id='form' enctype="multipart/form-data" action="/alu_solicitudcambioies">
                            {% csrf_token %}
                            <input type="hidden" name="id" value="{{ apertura.id }}"/>
                            <input type="hidden" name="action" value="{{ action }}"/>
                            <div class="alert alert-error" id="errormensaje_r" hidden="hidden"></div>
                            <div class="col-md-12">
                                <h6><b><i class="fa fa-user"></i> DATOS PERSONALES</b></h6>
                                <hr style="margin-top: 0px">
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                <label>Tipo de identificación</label>
                                    <select id="id_tipoiden" name="iden" tabindex="-1" class="select2-accessible form-control" aria-hidden="true">
                                        <option value="1" selected="selected">CEDULA</option>
                                        <option value="2">PASAPORTE</option>
                                    </select>
                                    <div class="help-text"></div>
                            </div>

                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                <label>Cédula o Pasaporte</label>
                                <input type='text' name='cedula' id="id_cedula" maxlength="13" class='form-control' />
                                <div class="help-textcedula" style="color: red"></div>
                                <div class="help" style="color: #f34141; font-size: 12px" ><b>Nota: Para ingresar pasaporte digite VS al inicio de la numeración, Ejemplo: VSA0928.</b></div>
                                <div class="help-text"></div>
                            </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Nombres</label>
                                        <input type='text' name='nombres' id="id_nombres"  class='input-block-level form-control'/>
                                        <div class="help-text"></div>
                                </div>
                            </div>
                             <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label>Apellido Paterno</label>
                                        <input type='text' name='apellido1' id="id_apellido1"   class='input-block-level form-control'/>
                                        <div class="help-text"></div>
                                </div>
                            </div>
                             <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Apellido Materno</label>
                                    <input type='text' name='apellido2' id="id_apellido2"   class='input-block-level form-control'/>
                                    <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Teléfono</label>
                                        <input type='text' name='celular' id="id_celular" style="text-transform: none;"  class=' form-control'/>
                                        <div class="help-text"></div>
                                </div>
                            </div>
                             <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Género</label>
                                    <div class="controls">
                                        <select  id="id_genero" name="gen" tabindex="-1" class="select2-accessible form-control" aria-hidden="true">
                                            <option value="1">MUJER</option>
                                            <option value="2">HOMBRE</option>
                                        </select>
                                        <div class="help-text"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                             <div class="form-group">
                                    <label>Correo</label>
                                        <input type='text' name='email' id="id_correo" style="text-transform: none;"  class='form-control'/>
                                        <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <h6><b><i class="fa fa-university"></i> DATOS INSTITUCIONALES</b></h6>
                                <hr style="margin-top: 0px">
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label><i class="fa fa-"></i> Institución de Educación Superior</label>
                                    <select name="universidad" id="universidadfilter" class="select2 form-control form-control-lg universidadfilter" style="width: 100%">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group" style="display: none" id="universidadtext1">
                                    <label>Escriba su Institución de Educación Superior</label>
                                     <input type='text' name='universidadtext' id="id_universidadtext" class='form-control'/>
                                    <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Correo de la Institución de Educación Superior </label>
                                    <input type='text' name='emailuniversidad' id="id_emailuniversidad"  class='form-control' />
                                    <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Nombre de contacto de la Institución de Educación Superior</label>
                                    <input type='text' name='nombrecontacto' id="id_nombrecontacto"   class='form-control'/>
                                    <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label>Telefono de contacto de la Institución de Educación Superior</label>
                                        <input type='text' name='telefonocontacto' id="id_telefonocontacto" class='form-control'/>
                                        <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-8 col-sm-8 col-xs-6 pr-0">
                                <div class="form-group">
                                    <label>Ingrese su puntaje obtenido: </label>
                                    <input class="form-control mb-2"  type="number" name="puntajeobtenido" id="puntajeobtenido" placeholder="0" style="width: 100%; margin-right: 0px !important;"/>
                                    <b style="color: red;font-size: 16px">
                                    <div class="help-text"></div>
                                    Nota: Recuerda que debes ingresar el mismo puntaje del comprobante del cupo obtenido
                                    a través del Examen Ser Bachiller o Examen de Acceso a la Educación Superior
                                    (EAES)</b>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-4 col-xs-6 pl-1" style="margin-top: 32px">
                                <div>
                                    <a href="https://certificados.senescyt.gob.ec/#/login" target="_blank" class="btn btn-success" ><i class="fa fa-eye"></i> Ver Comprobante</a>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12">
                                  <div class="form-group">
                                    <label>Selecione la carrera a cambiarse: </label>
                                    <br>
                                    <select name="carreras" id="carrerasfilter" class="select2 form-control carrerasfilter" style="width: 65%">
                                    </select>
                                      <a data-toggle="modal" data-target="#modalcarrerascambio" class="btn btn-success"><i
                                                class="fa fa-eye"></i> Ver Carreras</a>
                                    <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12">
                                <div class="form-group">
                                    <b style="color: red; font-size: 16px">
                                    Nota: Los documentos se tienen que subir en formato pdf y su tamaño menor a 2Mb.</b>
                                    <table class='table table-responsive-mini  table-bordered'>
                                        <thead>
                                            <tr>
                                                <th style="text-align: center;  width: 10%">Formato</th>
                                                <th style="text-align: left; width: 65%" >Requisito</th>
                                                <th style="text-align: center; width: 25%">Seleccionar</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for req in apertura.todos_requisitos %}
                                            <tr>
                                                <td style="text-align: center;width: 130px">
                                                    {% if req.archivo %}
                                                        <a href="/media/{{ req.archivo }}" target="_blank" title="Descargar Formato"
                                                           class="btn btn-primary btn-mini p-1"><i class="fa fa-download"></i>
                                                            </a>
                                                    {% endif %}
                                                </td>
                                                <td style="text-align: left;">{{ req.nombre }}
                                                    {% if req.opcional %}<b>( Opcional )</b>{% endif %}
                                                 <br>
                                                    <b class="text-primary">{{ req.leyenda|default_if_none:'' }}</b>
                                                </td>
                                                <td style="text-align: center; width: 10%">
                                                    {% if req.multiple %}
{#                                                        <a href="javascript:void(0);" onclick="cargarmodaldocumentos('{{ req.id }}','CARGAR ARCHIVOS',true)" class="btn btn-outline-info"><i class="fa fa-cloud-upload"></i> Seleccionar</a>#}
                                                        <table id="tbrequisitos{{ req.id }}" class="table table-bordered" style="border-top: 3px solid #efd41b">
                                                            <thead>
{#                                                                <tr>#}
{#                                                                    <th>Requisito</th>#}
{#                                                                    <th>Seleccionar</th>#}
{#                                                                    <th>Accion</th>#}
{#                                                                </tr>#}
                                                            </thead>
                                                            <tbody>

                                                            </tbody>
                                                            <tfoot>
                                                                <tr>
                                                                    <th></th>
                                                                    <th style="text-align: center; width: 10px">
                                                                            {% if req.essilabo %}
                                                                                 <a onclick="btnAddarchivo('{{ req.id }}','{{ req.nombre_input }}')"
                                                                                   class="btn btn-primary btn-mini tooltips"
                                                                                   data-placement="top"
                                                                                   data-original-title="Agregar">
                                                                                    <i class="fa fa-plus-circle"></i></a><br>
                                                                            {% else %}
                                                                                 <a onclick="btnAddarchivo1('{{ req.id }}','{{ req.nombre_input }}')"
                                                                                       class="btn btn-primary btn-mini tooltips"
                                                                                       data-placement="top"
                                                                                       data-original-title="Agregar">
                                                                                        <i class="fa fa-plus-circle"></i></a><br>
                                                                            {% endif %}
                                                                    </th>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    {% else %}
                                                            <input type="file" accept=".pdf" class="filepdf"
                                                                    {% if req.multiple %}name="doc_{{ req.nombre_input }}[]" multiple{% else %}name="doc_{{ req.nombre_input }}"{% endif %}>
                                                    {% endif %}

                                                </td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="2">NO EXISTEN REGISTROS</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                    <div class="help-text"></div>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12">
                                <div class="text-right">
                                    <a id="registro_bt" class="btn btn-success"> <i class="icon-arrow-right "></i>Enviar Solicitud</a>
                                </div>
                            </div>
                            <br>
                        </form>
                    {% else %}
                        <div class="well" id='loginform'>
                            {{ mensaje }}
                        </div>
                    {% endif %}
               </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center" id="sinperiodo" hidden>
         <div class="col-lg-10 col-sm-12">
            <div class="card card-info card-outline">
                <div class="card-body">
                    <h4><b><i class="fa fa-university" style="color: #179aaf"></i> {{ mensaje }}</b></h4>
                </div>
            </div>
         </div>
    </div>

    <div class="row justify-content-center listsolicitud">

    </div>
    <div class="row justify-content-center seguimiento">

    </div>
{% endblock %}
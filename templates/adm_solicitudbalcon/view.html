{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}
    <style>
        .btn-outline-secondary:hover {
            background-color: #5c596d;
            border-color: #5c596d;
        }
        .check-line{
            box-shadow: rgb(47, 150, 180) 0px 0px 0px 11px inset;
            border-color: rgb(47, 150, 180);
            background-color: rgb(47, 150, 180);
            transition: border 0.4s ease 0s,
            box-shadow 0.4s ease 0s, background-color 1.2s ease 0s;
        }
    </style>
    <script type="text/javascript">
        var lista = [];
        $(function () {
            {% if devueltos %}
                $("#dev_button").removeClass('btn-outline-secondary').addClass('btn-secondary').attr('title', 'Activado')
                $("#devueltos").prop('checked', true)
            {%  endif %}
            $('select').select2({width: '100%'})
            $(".asignaproceso").click(function () {
                $("#itempanelprocesos").modal({backdrop: 'static', width: '500px'}).modal('show');
            });

            $(".cerrar_proceso").click(function () {
                $("#itempanelprocesos").modal({backdrop: 'static', width: '500px'}).modal('show');
            });

            $("#cerrar").click(function () {
                $("#itemspanel3").modal("hide");
                return false;
            });
            $("#cerrartotal").click(function () {
                $("#itemspaneltotal").modal("hide");
                return false;
            });

            $(".enviardepa").click(function () {
                var btn = $(this)
                var id = $(this).attr('ids');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_solicitudbalcon",
                    data: {'action': 'enviardepa', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            {#aqui se oculta el boton#}
                            btn.hide()
                            Swal.fire({
                                toast: true,
                                position: 'top-end',
                                type: 'success',
                                title: 'SOLICITUD EN PROCESO',
                                showConfirmButton: false,
                                timer: 3500
                            })
                            location.reload();

                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });

            });

            $("select:not(.noselect2)").select2({minimumResultsForSearch: 20});

            $(".select2hidden").each(function () {
                    var id = $(this).attr("id");
                    $("#" + id + "_select2").html('<option>' + $(this).attr("descripcion") + '</option>').trigger('change');});

            $('#masivo').click(function () {
                bloqueointerface();
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: "/adm_solicitudbalcon",
                    data: {'action': 'respondermasivo'},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result) {
                            $('.panelbody3').html(data.data);
                            $("#itemspanel3").modal({backdrop: 'static', width: '900'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $('#masivototal').click(function () {
                bloqueointerface();
                $.ajax({
                    cache: false,
                    type: "GET",
                    url: "/adm_solicitudbalcon",
                    data: {'action': 'respondermasivototal'},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result) {
                            $('.panelbodytotal').html(data.data);
                            $("#itemspaneltotal").modal({backdrop: 'static', width: '900'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $('#guardar').click(function () {
                var estado = $('#estado').val()
                var opcion = $('#opcion').val()
                var materia = $('#materia').val()
                var observacion = $('#observacion').val()
                bloqueointerface();
                $.ajax({
                    cache: false,
                    type: "POST",
                    url: "/adm_solicitudbalcon",
                    data: {
                        'action': 'respondermasivo',
                        'estado': estado,
                        'opcion': opcion,
                        'materia': materia,
                        'observacion': observacion
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#itemspanel3").modal("hide");

                            location.reload();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $('#guardartotal').click(function () {
                var estado = $('#estado').val()
                var servicio = $('#servicio').val()
                var estadoselect = $('#estadoselect').val()
                var observacion = $('#observacion').val()
                bloqueointerface();
                $.ajax({
                    cache: false,
                    type: "POST",
                    url: "/adm_solicitudbalcon",
                    data: {
                        'action': 'respondermasivototal',
                        'estado': estado,
                        'estadoselect': estadoselect,
                        'servicio': servicio,
                        'observacion': observacion
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#itemspaneltotal").modal("hide");

                            location.reload();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

            $("#reportefiltros").click(function () {
                var estados_solicitud = $("#estados_solicitud").val();
                var tipos_solicitud = $("#tipos_solicitud").val();
                var agentes_solicitud = $("#agentes_solicitud").val();
                var orden_temporal = $("#orden_temporal").val();
                var desde = $("#desde").val();
                var hasta = $("#hasta").val();
                openwindow('POST', '/adm_solicitudbalcon', {
                    action: 'reportefiltros',
                    est: estados_solicitud,
                    tip: tipos_solicitud,
                    ag: agentes_solicitud,
                    orden: orden_temporal,
                    desde: desde,
                    hasta: hasta
                }, '_blank');
            });

            $("#todos").click(function () {
                if ($(this).is(":checked")) {
                    $(".seleccionado").prop('checked', true);
                } else {
                    $(".seleccionado").prop('checked', false);
                }
            });

            $("#reasignarmasivo2").click(function () {
                lista = [];
                $(".seleccionado:checkbox:checked").each(function () {
                    lista.push($(this).attr('ids'));
                });
                if (lista.length > 0) {
                    bloqueointerface();
                    $.ajax({
                        cache: false,
                        type: "GET",
                        url: "/adm_solicitudbalcon",
                        data: {'action': 'reasignarmasivo2'},
                        error: function () {
                            $.unblockUI();
                            mensajeDanger("Error al enviar los datos.");
                        },
                        success: function (data) {
                            $.unblockUI();
                            if (data.result) {
                                $('.panelbodymasivo').html(data.data);
                                $("#reasigmasivo").modal({backdrop: 'static', width: '600px'}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            mensajeDanger("Error de conexión.");
                        },
                        dataType: "json"
                    });


                } else {
                    mensajeDanger("Seleccione un estudiante.");
                }
            });


            $("#cerrarmasivo").click(function () {
                $("#reasigmasivo").modal("hide");
                return false;
            });

            $("#gestionarmasivo").click(function () {
                lista = [];
                $(".seleccionado:checkbox:checked").each(function () {
                    lista.push($(this).attr('ids'));
                });
                if (lista.length > 0) {
                    bloqueointerface();
                    $.ajax({
                        cache: false,
                        type: "GET",
                        url: "/adm_solicitudbalcon",
                        data: {'action': 'gestionarmasivo'},
                        error: function () {
                            $.unblockUI();
                            mensajeDanger("Error al enviar los datos.");
                        },
                        success: function (data) {
                            $.unblockUI();
                            if (data.result) {
                                $('.panelbodymasivores').html(data.data);
                                $("#gestmasivo").modal({backdrop: 'static', width: '600px'}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            mensajeDanger("Error de conexión.");
                        },
                        dataType: "json"
                    });


                } else {
                    mensajeDanger("Seleccione un estudiante.");
                }
            });

            $("#cerrargesmasivo").click(function () {
                $("#gestmasivo").modal("hide");
                return false;
            });

           });

        function formModal(id, text, action, footer = true) {
            bloqueointerface();
            $('.panelbody').empty();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        if (footer === true) {
                            $('#footermodal').hide();
                        }
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(text);
                        $("#itemspanel").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                       NotificationJG.error(data.mensaje);
                    }
                },
                error: function (data) {
                    NotificationJG.error(data.mensaje);
                },
                dataType: "json"
            });
        }


        function formModal2(id, text, action, servicio) {
            $('#ModalSub').modal('hide')
            $('#itemspanel').modal('hide')
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `/adm_solicitudbalcon`,
                data: {
                    'action': action,
                    'id': id,
                    'servicio': servicio
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody2').html(data.data);
                        $('#itemspanel2 .paneltitle2').html(text);
                        $("#itemspanel2").modal({backdrop: 'static', width: '1000'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function Devueltos() {
            var check = $("#devueltos").is(':checked');
            if (check) {
                $("#devueltos").prop('checked', false)
                $("#dev_button").removeClass('btn-secondary').addClass('btn-outline-secondary').attr('title', 'Desactivado')
            } else {
                $("#dev_button").removeClass('btn-outline-secondary').addClass('btn-secondary').attr('title', 'Activado')
                $("#devueltos").prop('checked', true)

            }
        }

    </script>
    <script src="/static/adicionalesjs/formquestionb4.js?0.24"></script>
    <link rel="stylesheet" href="/static/css/bloques.css">
    <link href="/static/switchery/switchery.min.css" rel="stylesheet">
    <script src="/static/switchery/switchery.min.js"></script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block marcaaguabackground %}backgrounmarcaagua{% endblock %}
{% block canvas %}

    <div class="modal fade static" id="gestmasivo" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="w-modal" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-solicitud"></i> <b class="paneltitle">GESTIONAR MASIVO</b></h4>
                </div>
                <div class="modal-body">
                    <form id="form2" class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbodymasivores">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success btn-guardargesmasivo" id="guardargesmasivo"><i class="fa fa-save"></i> Guardar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-danger btn-cerrargesmasivo" id="cerrargesmasivo">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel2" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="w-modal" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-solicitud"></i> <b class="paneltitle2">FORMULARIO MODAL</b></h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbody2">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="w-modal" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-solicitud"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbody">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal">
                    <a href="javascript:;" class="btn btn-default" data-bs-dismiss="modal"><i
                            class="fa fa-window-close"></i>
                        Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel3" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="w-modal" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-solicitud"></i> <b class="paneltitle">RESPONDER MASIVO</b></h4>
                </div>
                <div class="modal-body">
                    <form id="form2" class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbody3">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success" id="guardar"><i class="fa fa-save"></i> Guardar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-danger" id="cerrar">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspaneltotal" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="w-modal" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-solicitud"></i> <b class="paneltitle">RESPONDER MASIVO</b></h4>
                </div>
                <div class="modal-body">
                    <form id="formtotal" class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbodytotal">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success" id="guardartotal"><i class="fa fa-save"></i> Guardar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-danger" id="cerrartotal">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="reasigmasivo" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" id="w-modal" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-solicitud"></i> <b class="paneltitle">REASIGNAR MASIVO</b></h4>
                </div>
                <div class="modal-body">
                    <form id="form2" class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbodymasivo">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success btn-guardarmasivo" id="guardarmasivo"><i class="fa fa-save"></i> Guardar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-danger btn-cerrarmasivo" id="cerrarmasivo">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title|lower|capfirst }}</h3>
                <h6>Listado de solicitudes de balcón de servicios.</h6>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <form method="GET">
            <div class="form-row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xxl-5">
                <div class="col pe-2 pb-2">
                    <div class="contenedor">
                        <div class="principal" style="width: 75%">
                            <select name="estados" id="estados_solicitud" style="width: 100%" class="noselect2">
                                <option value="">Buscar por Estados</option>
                                {% for tc in estadossol %}
                                    <option {% if tc.0 == estados %}selected{% endif %} value="{{ tc.0 }}">{{ tc.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="sidebar" style="width: 25%">
                            <input type="checkbox" name="devueltos" id="devueltos" style="display: none">
                            <a href="javascript:void(0);" onclick="Devueltos()" class="btn btn-mini btn-outline-secondary fs-6" style="width: 100%" title="Solo solicitudes devueltas" data-bs-toggle="tooltip" id="dev_button"><i class="fa fa-user"></i> <i class="fa fa-arrows-alt-h"></i> <i class="fa fa-user"></i></a>
                        </div>
                    </div>
                </div>
                <div class="col pe-2 pb-2">
                    <select name="tipo" id="tipos_solicitud" style="width: 100%" class="noselect2">
                        <option value="">Buscar por Tipo</option>
                        {% for tc in tiposol %}
                            <option {% if tc.0 == tipo %}selected{% endif %} value="{{ tc.0 }}">{{ tc.1 }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% if agente.admin or user.is_superuser %}
                    <div class="col pe-2 pb-2">
                        <select name="agente" id="agentes_solicitud" style="width: 100%" class="noselect2">
                            <option value="">Buscar por Agente</option>
                            {% for tc in listagentes %}
                                <option {% if tc.pk == idagente %}selected{% endif %}
                                        value="{{ tc.pk }}">{{ tc.persona }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col pe-2 pb-2">
                        <select name="direccion" id="direccion" style="width: 100%" class="noselect2">
                            <option value="">Buscar por Departamento</option>
                            {% for tc in listdirecciones %}
                                <option {% if tc.pk == direccionid %}selected{% endif %}
                                        value="{{ tc.pk }}">{{ tc.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}
                <div class="col pe-2 pb-2">
                    <input class='searchinput' style="margin-left: 0px" type='date' id='desde' value='{{ desde }}'
                           autocomplete="off" name="desde"
                           placeholder="Desde"/>
                </div>
                <div class="col pe-2 pb-2">
                    <input class='searchinput' style="margin-left: 0px" type='date' id='hasta' value='{{ hasta }}'
                           autocomplete="off" name="hasta"
                           placeholder="Hasta"/>
                </div>
                <div class="col pe-2 pb-2">
                    <div class="input-group text-left">
                        <input class='searchinput form-control' type='text' id='responsable' value='{{ responsable }}'
                               autocomplete="off" name="responsable"
                               placeholder="Buscar por responsable (Cedula o Nombres)"/>
                    </div>
                </div>
                <div class="col pe-2 pb-2">
                    <div class="contenedor">
                        <div class="principal" style="width: 100%">
                            <select name="ordentemporal" id="orden_temporal" style="width: 100%" class="noselect2">
                                <option value="" {% if not orden %} selected {% endif %}>Ordenar Por</option>
                                <option value="masreciente" {% if orden == 'masreciente' %} selected {% endif %}>Más Reciente</option>
                                <option value="masantiguo" {% if orden == 'masantiguo' %} selected {% endif %}>Más Antiguo</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col pe-2 pb-2">
                    <div class="contenedor">
                        <div class="principal" style="width: 100%">
                            <select name="proceso" id="proceso" style="width: 100%" class="noselect2">
                                 <option value="">Seleccionar Proceso</option>
                                    {% for pro in listproceso %}
                                        <option {% if pro.pk == procesoid %}selected{% endif %} value="{{ pro.pk }}">{{ pro.nombre }}</option>
                                    {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col pe-2 pb-2">
                    <div class="contenedor">
                        <div class="principal" style="width: 100%">
                            <select name="coordinacion" id="coordinacion" style="width: 100%" class="noselect2">
                                 <option value="">Seleccionar coordinacion</option>
                                    {% for coor in listcoodinacion %}
                                        <option {% if coor.pk == coordinacionid %}selected{% endif %} value="{{ coor.pk }}">{{ coor.nombre }}</option>
                                    {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col pe-2 pb-2">
                    <div class="contenedor">
                        <div class="principal" style="width: 50%">
                            <div class="form-check form-switch">
                                <input class="form-check-input" name="externo" type="checkbox" value="1" id="externo" {% if externo == '1' %}checked{% endif %}>
                                <label class="tu" title="Solicitante es externo" for="externo_true">Es Externo?</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col pe-2 pb-2">
                    <div class="input-group text-left">
                        <input class='searchinput form-control' type='text' id='searchinput' value='{{ search }}'
                               autocomplete="off" name="s"
                               placeholder="Buscar por cédula, apellidos, nombres, descripción"/>
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="submit" id="button-addon2"><i
                                    class="fa fa-search"></i></button>
                            {% if url_vars %}
                                <a href="{{ request.path }}" id='allresults' class='btn btn-default'><span
                                        class="fa fa-refresh "></span>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="col-12 pb-2">

            <div class="btn-group" style="text-align: left">
                <div class="dropdown">
                    <button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Respuestas masivas <i class="fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" id="reasignarmasivo2"><i
                                    class="fa fa-user-circle dropdown-item-icon"></i>Reasignar</a>
                        </li>
                        <li>
                            <a class="dropdown-item" id="gestionarmasivo"><i
                                    class="fa fa-cogs dropdown-item-icon"></i>Gestionar </a>
                        </li>
                        {% if agente and agente.admin == True %}
                        <li>
                            <a href="javascript:;" id="masivo" class='dropdown-item'><i class="fa fa-send dropdown-item-icon"></i> Responder admisión</a>
                        </li>
                        <li>
                            <a href="javascript:;" id="masivototal" class='dropdown-item'><i class="fa fa-send dropdown-item-icon"></i> Responder </a>
                        </li>
                        {% endif %}

                    </ul>
                </div>
            </div>
            {% if agente and agente.admin == True %}
            <a onclick="formModal('0','SELECCIONAR PROCESO','viewprocesos', true)"
               href="javascript:void(0);" class='btn btn-success'><i class="fa fa-plus"></i> Adicionar Solicitud</a>
            {% endif %}
            <a class="btn btn-success" href="?export_to_excel=1{{ url_vars }}" target="_blank"><i
                    class="fa fa-file-excel-o"></i> Reporte (Según lo filtrado)</a>
            {#                <div class="btn-group" style="text-align: left">#}
            {#                    <div class="dropdown">#}
            {#                     <button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">#}
            {#                        Reportes <i class="fa fa-angle-down"></i>#}
            {#                    </button>#}
            {#                    <ul class="dropdown-menu">#}
            {#                        <li>#}
            {#                        </li>#}
            {#                    <li>#}
            {#                        <a href="/adm_solicitudbalcon?action=descargasolicitudes"><i class="fa fa-file-excel-o"></i>#}
            {#                            ReporteTotal</a>#}
            {#                    </li>#}
            {#                    </ul>#}
            {#                </div>#}
            {#                </div>#}
        </div>
        <div class="card">
            <div class='card-body rounded-3 border-dark-info'>
                    <span class="label label-info"
                          style="margin-bottom: 12px; font-size: 12px;">Total de Solicitudes: {{ totalcount }}</span>
                <table class=' table table_primary tabla_responsive'>
                    <thead class="table-light">
                    <tr>
                        <th style="text-align: center">
                        <input type="checkbox" id="todos"></th>
                        <th style="text-align: center; vertical-align: middle">Solicitante</th>
                        <th style="text-align: center; vertical-align: middle">Detalles</th>
                        <th style="text-align: center; vertical-align: middle">Proceso</th>
                        <th style="text-align: center; vertical-align: middle">Dirección</th>
                        <th style="text-align: center;vertical-align: middle">Estado</th>
                        <th style="text-align: center; vertical-align: middle">Agente</th>
                        <th style="text-align: center; vertical-align: middle">Responsable</th>
                        <th style="text-align: center;vertical-align: middle"><i class="fa fa-cogs"></i></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for solicitud in solicitudes %}
                        <tr>
                            <td style="text-align: center">
                                <input type="checkbox" class="seleccionado"
                                       ids="{{ solicitud.id }}"></td>
                            <td style="text-align: left; vertical-align: middle" class="text-secondary p-2 w-15">
                                <small>
                                    <p>
                                        <i class="fa fa-user"></i> {{ solicitud.solicitante.nombre_completo_minus }}
                                    </p>
                                    <p><i class="fa fa-share"></i> {{ solicitud.perfil|lower|capfirst }}</p>
                                    <p><i class="fa fa-address-card"></i> {{ solicitud.solicitante.identificacion }}</p>
                                    {% if solicitud.perfil.externo %}
                                        <p><i class="fa fa-phone"></i> {{ solicitud.perfil.persona.telefono }}</p>
                                    {% else %}
                                        {#                                <p>#}
                                        {#                                    <i class="fa fa-user"></i> {{ solicitud.solicitante.nombre_completo_minus }} | {{ solicitud.perfil|lower|capfirst }}#}
                                        {#                                {% if solicitud.perfil.es_estudiante %}#}
                                        {#                                    <a class="btn btn-mini btn-info"><i class="fa fa-search-plus"></i> Ver Información</a>#}
                                        {#                                {% endif %}#}
                                        {#                                </p>#}
                                        <p style="line-height: 14px"><i class="fa fa-book"></i> {{ solicitud.perfil.inscripcion.carrera|lower|capfirst }}</p>
                                    {% endif %}
                                    {#                                <div><b>nivel: </b>{{ solicitud.perfil.mi_nivel }}</div>#}
                                </small>
                            </td>
                            <td style="text-align: left; vertical-align: middle" class="w-20">
                                <div class="accordion" id="detalles_{{ solicitud.id }}">
                                    <div class="accordion-item">
                                        <h4 class="accordion-header" id="headingTwo">
                                            <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo{{ solicitud.id }}" aria-expanded="false" aria-controls="collapseTwo">
                                                <i class="fa fa-envelope dropdown-item-icon"></i>Solicitud
                                            </button>
                                        </h4>
                                        <div id="collapseTwo{{ solicitud.id }}" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#detalles_{{ solicitud.id }}">
                                            <div class="accordion-body p-2">
                                                <small>
                                                    <div><b>Tipo: </b>{{ solicitud.tiposolicitud }}</div>
                                                    <div><b>Código: </b>{{ solicitud.get_codigo }}</div>
                                                    <div><b>Fecha: </b>{{ solicitud.fecha_creacion|date:'Y-m-d G:i' }}</div>
                                                    <div><b>Registrado por: </b>{{ solicitud.usuario_creacion.username }}</div>
                                                    {% if  solicitud.archivo %}
                                                        <div><b>Archivo: </b>
                                                            {% if not solicitud.typefile == '.pdf' %}
                                                                <a data-fancybox="image{{ solicitud.id }}" class="btn tu" title="Ver solicitud" data-bs-toggle="tooltip" href="/media/{{ solicitud.archivo }}" data-width="2048" data-height="1365">
                                                                    <img style="margin-top: 2px; width: 25px"
                                                                         src="/static/images/image.png"/>
                                                                </a>
                                                            {% else %}
                                                                <a data-fancybox="iframe{{ solicitud.id }}" title="Ver archivo" data-bs-toggle="tooltip" href="/media/{{ solicitud.archivo }}" data-width="2048" data-height="1365">
                                                                    <i class="fa fa-file-pdf-o text-danger fs-4"></i>
                                                                </a>
                                                            {% endif %}
                                                        </div>
                                                    {% endif %}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h4 class="accordion-header" id="headingOne{{ solicitud.id }}">
                                            <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne{{ solicitud.id }}" aria-expanded="false" aria-controls="collapseOne">
                                                <i class="fa fa-pencil-alt dropdown-item-icon"></i> Descripción
                                            </button>
                                        </h4>
                                        <div id="collapseOne{{ solicitud.id }}" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#detalles_{{ solicitud.id }}">
                                            <div class="accordion-body p-2">
                                                <small>
                                                    {{ solicitud.descripcion|lower|capfirst }}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    {% if solicitud.requisitossolicitud_set.all %}
                                        <div class="accordion-item">
                                            <h4 class="accordion-header" id="headingThree">
                                                <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree{{ solicitud.id }}" aria-expanded="false" aria-controls="collapseThree">
                                                    <i class="fa fa-file-text dropdown-item-icon"></i>Requisitos
                                                </button>
                                            </h4>
                                            <div id="collapseThree{{ solicitud.id }}" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#detalles_{{ solicitud.id }}">
                                                <div class="accordion-body p-2">
                                                    <small>
                                                        {% for doc in solicitud.requisitossolicitud_set.all %}
                                                            <a data-fancybox="iframe{{ doc.id }}" title="Ver documento" data-bs-toggle="tooltip" href="/media/{{ doc.archivo }}" data-width="2048" data-height="1365">
                                                                <img style="margin-top: 2px;" src="/static/images/pdf.png"/></a>
                                                        {% endfor %}
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </td>
                            <td style="text-align: center; vertical-align: middle" class="fs-6">
                                {% if not solicitud.detalle %}
                                    <a onclick="formModal('{{ solicitud.id }}','ASIGNAR PROCESO','addprocesosol')"
                                       href="javascript:void(0);"
                                       class="btn btn-success btn-mini">
                                        <i class="fa fa-cog fa-spin"></i>
                                    </a>
                                {% else %}
                                    {{ solicitud.ver_servicio.servicio|default_if_none:'NO TIENE PROCESO' }}
                                    {% if  not solicitud.tiene_departamento and solicitud.estado == 1 %}
                                        <br><a href="javascript:void(0);" class="btn btn-success btn-mini enviardepa"
                                               ids="{{ solicitud.id }}" title="Enviar a dirección">
                                        Enviar
                                        <i class="fa fa-home "></i>
                                    </a>
                                    {% endif %}

                                {% endif %}
                            </td>
                            <td style="text-align: center; vertical-align: middle" class="fs-6">
                                {% if solicitud.traer_departamento %}
                                    {{ solicitud.traer_departamento }}
                                {% endif %}
                            </td>
                            <td style="text-align: center; vertical-align: middle">
                                {#                            {% if not solicitud.get_cerrado %}#}
                                <b class="text-{{ solicitud.color_estado }}"
                                         data-original-title="Estado">{{ solicitud.get_estado_display|lower|capfirst }}</b>
                                {#                            {% endif %}#}
                            </td>
                            <td style="text-align: left; vertical-align: middle" class="fs-6">
                                {% if solicitud.agente %}
{#                                    {{ solicitud.agente.persona.usuario.username }}<br>#}
{#                                    <i class="fa fa-address-card"></i> {{ solicitud.agente.persona.cedula }}<br>#}
                                    <i class="fa fa-user"></i> {{ solicitud.agente.persona.nombre_completo_minus }}<br>
{#                                    <a href="mailto:{{ solicitud.agente.persona.emailinst }}" target="_blank">{{ solicitud.agente.persona.emailinst }}</a>#}
                                {% endif %}
                            </td>
                            <td style="text-align: left; vertical-align: middle" class="fs-6">
                                {% if solicitud.ver_servicio.asignadorecibe %}
{#                                    <i class="fa fa-user"></i>  {{ solicitud.ver_servicio.asignadorecibe.usuario.username }}<br>#}
{#                                    <i class="fa fa-address-card"></i> {{ solicitud.ver_servicio.asignadorecibe.cedula }}<br>#}
                                    <i class="fa fa-user"></i>  {{ solicitud.ver_servicio.asignadorecibe.nombre_completo_minus }}<br>
{#                                    <i class="fa fa-envelope"></i> <a href="mailto:{{ solicitud.ver_servicio.asignadorecibe.emailinst }}" target="_blank">{{ solicitud.ver_servicio.asignadorecibe.emailinst }}</a>#}
                                    <br>
                                    {#                                {% with devuelto=solicitud|args:persona.id|call:'sol_devuelta' %}#}
                                    {% if solicitud.devuelto %}
                                        <small class="badge bg-secondary" title="Solicitud devuelta" data-bs-toggle="tooltip" style="cursor: pointer; font-size: 10px"><i class="fa fa-user"></i> <i class="fa fa-arrows-alt-h"></i> <i class="fa fa-user"></i> </small>
                                    {% endif %}
                                    {#                                {% endwith %}#}
                                {% endif %}
                            </td>

                            <td style="text-align: center; vertical-align: middle">
                                <div class="dropdown dropstart">
                                    <a href="javascript:void(0);"
                                       class="btn-icon btn btn-ghost btn-sm rounded-circle"
                                       data-bs-toggle="dropdown" data-offset="-140"
                                       aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </a>
                                    <ul class="dropdown-menu" x-placement="right-start">
                                        {#                                    {% if not solicitud.agente %}#}
                                        {#                                        <li>#}
                                        {#                                            <a onclick="formModal('{{ solicitud.id }}','ASIGNAR AGENTE','addagente')"#}
                                        {#                                               href="javascript:void(0);"><span#}
                                        {#                                                    class="fa fa-user-circle"></span> Adicionar agente</a>#}
                                        {#                                        </li>#}
                                        {#                                    {% endif %}#}


                                        {% if solicitud.estado == 1 or solicitud.estado == 3 %}

                                            {% if solicitud.estado == 3 %}
                                                <li>
                                                    <a onclick="formModal('{{ solicitud.id }}','REASIGNAR','reasignar')"
                                                       href="javascript:void(0);" class="dropdown-item"><span
                                                            class="fa fa-user-circle dropdown-item-icon"></span>
                                                        Reasignar</a>
                                                </li>

                                                <li>
                                                    <a onclick="formModal('{{ solicitud.id }}','REASIGNAR','reasignarinterno')"
                                                       href="javascript:void(0);" class="dropdown-item"><span
                                                            class="fa fa-user-circle dropdown-item-icon"></span> Reasignar
                                                        Interno</a>
                                                </li>

                                                <li>
                                                    <a onclick="formModal('{{ solicitud.id }}','RESOLVER SOLICITUD','resolver')"
                                                       href="javascript:void(0);" class="dropdown-item"><span
                                                            class="fa fa-folder dropdown-item-icon"></span> Resolver</a>
                                                </li>
                                            {% endif %}
                                            {% if not solicitud.estado == 1 %}
                                                <li>
                                                    <a onclick="formModal('{{ solicitud.id }}','CERRAR SOLICITUD','cerrar')"
                                                       href="javascript:void(0);" class="dropdown-item"><span
                                                            class="fa fa-sign-out dropdown-item-icon"></span> Cerrar</a>
                                                </li>
                                            {% endif %}
                                            <li>
                                                <a onclick="formModal('{{ solicitud.id }}','RECHAZAR SOLICITUD','rechazar')"
                                                   href="javascript:void(0);" class="dropdown-item"><span
                                                        class="fa fa-times-circle dropdown-item-icon"></span> Rechazar</a>
                                            </li>



                                        {% endif %}
                                        <li>
                                            <a onclick="formModal('{{ solicitud.id }}','GESTIONAR ','gestionar')"
                                               href="javascript:void(0);" class="dropdown-item"><span
                                                    class="fa fa-cogs dropdown-item-icon"></span> Gestionar</a>
                                        </li>
                                        {% if solicitud.detalle %}
                                            <li>
                                                <a onclick="formModal('{{ solicitud.id }}','VER SEGUIMIENTO','verproceso', false)"
                                                   href="javascript:void(0);" class="dropdown-item"><span
                                                        class="fa fa-comments dropdown-item-icon"></span> Seguimiento</a>
                                            </li>

                                            {% if solicitud.estado == 1 %}

                                                <li>
                                                    <a onclick="formModal('{{ solicitud.id }}','CAMBIAR PROCESO','cambiaprocesosol')"
                                                       href="javascript:void(0)" class="dropdown-item">
                                                        <span class="fa fa-newspaper-o dropdown-item-icon"></span> Cambiar
                                                        proceso
                                                    </a>
                                                </li>
                                                {% if solicitud.tipo == 1 %}
                                                    <li>
                                                        <a onclick="formModal('{{ solicitud.id }}','RESPUESTA RAPIDA','addrespuestarapida')"
                                                           href="javascript:void(0);" class="dropdown-item"><span
                                                                class="fa fa-newspaper-o dropdown-item-icon"></span>
                                                            Respuesta rápida</a>
                                                    </li>

                                                {% endif %}

                                            {% endif %}

                                        {% endif %}
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <td colspan="15" class="text-center">NO EXISTEN REGISTROS</td>
                    {% endfor %}
                    </tbody>
                </table>
                {% include 'paginacionb4.html' %}
            </div>
        </div>
    </div>




{% endblock %}
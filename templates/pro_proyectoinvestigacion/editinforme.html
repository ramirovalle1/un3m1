{% extends "base.html" %}
{% load humanize %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src="/static/ckeditor/ckeditor-init.js?v=1.0.1" data-ckeditor-basepath="/static/ckeditor/ckeditor/" id="ckeditor-init-script"></script>
    <script type="text/javascript" src="/static/ckeditor/ckeditor/ckeditor.js?v=1.0.1"></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>
    <link rel="stylesheet" href="/static/css/stylesfc.css">
    <script type="text/javascript">
        $(document).on('select2:opening.disabled', ':disabled', function() { return false; });

        $(function() {
            $('[data-bs-toggle="tooltip"]').on('click', function () {
                $(this).tooltip('hide');
            });

            let nf_evidencia = secuenciaevidencia = {{ totalevidencias }};
            let nf_actividad = secuenciaactividad = {{ totalactividades }};
            let fechaactual = '{{ fecha|date:"Y-m-d" }}';

            let pminimoe = pmaximoe = "";
            let efechae = false;
            let finicioe = "";
            let ffine = "";
            let idfilaedit = "";

            lista_items1 = [];
            lista_items2 = [];
            lista_items3 = []; //Actividades eliminadas
            lista_items4 = []; //Evidencias eliminadas

            $("#tipoinforme, #actividades_aux").addClass("validate[required]");

            $('[data-bs-toggle="tooltip"]').tooltip();

            $('[data-bs-toggle="tooltip"]').on('click', function () {
                $(this).tooltip('hide');
            });

            $("select").select2({minimumResultsForSearch: 5 });

            configurarChkEditor = function (nombreCampo, nombreCampo2, obligatorio){
                CKEDITOR.replace(nombreCampo, {
                    language: 'es',
                    width: '100%',
                    height: 200,
                    resize_enabled: false,
                    toolbarGroups: [
                        { name: 'styles' },
                        { name: 'basicstyles' },
                        { name: 'undo' },
                        { name: 'listindentalign',  groups: [ 'list', 'indent', 'align' ] },
                        { name: 'links' },
                        { name: 'insert' },
                        { name: 'tools' },
                        { name: 'mode' }
                    ],
                    removeButtons: 'Image,Flash'
                });

                if(obligatorio) $("#"+nombreCampo+"_aux").addClass("validate[required]");
            };

            configurarChkEditor('conclusion', 'conclusion', true);
            configurarChkEditor('recomendacion', 'recomendacion', true);

            CKEDITOR.instances['conclusion'].on('change', function() {
                if(CKEDITOR.instances['conclusion'].getData().length > 0)
                    $("#conclusion_aux").val("OK");
                else
                    $("#conclusion_aux").val("");
            });

            CKEDITOR.instances['recomendacion'].on('change', function() {
                if(CKEDITOR.instances['recomendacion'].getData().length > 0)
                    $("#recomendacion_aux").val("OK");
                else
                    $("#recomendacion_aux").val("");
            });

            $("#porcentajeactualedit").blur(function(){
                numerico($(this), 0, 0, 2);

                if(parseFloat($("#porcentajeactualedit").val()) == parseFloat($("#ponderacionedit").val()))
                    $("#estadoedit").val("FINALIZADA");
                else
                    $("#estadoedit").val("EN EJECUCIÓN");
            });

            $("#cantidadhoraedit").blur(function(){
                numerico($(this), 1, 500, 0);
            });

            $(".agregaactividad").click(function() {
                let idp = $(this).attr('idp');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'agregaractividadinforme', 'idp': idp},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyactividad").html(data.data);
                            $(".paneltitleactividad").html(data.title);
                            $("#itemspanelactividad").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            });

            $(".agregaractividaddetalle").click(function() {
                $("#frmActividadInforme").validationEngine('attach',{ scroll: false });
                let valido = $("#frmActividadInforme").validationEngine('validate', { scroll: false });

                if(valido){
                    objetivo = $("#objetivo").find('option:selected').text();
                    idactividad = $("#actividad").val();
                    actividad = $("#actividad").find('option:selected').text();

                    if(!actividadRepetida(idactividad)) {
                        nf_actividad += 1;
                        secuenciaactividad += 1;

                        $("#actividades_aux").val("SI");

                        borrar_fila_default_actividad();

                        ponderacion = $("#ponderacion").val();
                        fechainicio = $("#fechainicio").val();
                        fechafin = $("#fechafin").val();
                        cantidadhora = $("#cantidadhora").val();
                        avanceanterior = $("#porcentajeanterior").val();
                        avance = $("#porcentajeactual").val();
                        estado = $("#estado").val();
                        entregable = $("#entregable").val().trim();
                        codigos_personas = $("#responsable").val();
                        nombres_personas = $('#responsable option:selected').toArray().map(item => item.text);

                        fechainicio = fechainicio.substring(8,10) + "-" + fechainicio.substring(5,7) + "-" + fechainicio.substring(0, 4);
                        fechafin = fechafin.substring(8,10) + "-" + fechafin.substring(5,7) + "-" + fechafin.substring(0, 4);

                        responsable = "";
                        for(i=0; i<nombres_personas.length; i++){
                            responsable = responsable + '<span class="label label-info">'+nombres_personas[i]+'</span>';
                        }

                        idsresponsables =  codigos_personas.join(",");
                        observacion = $("#observacion").val().trim();
                        fechaeditada = $("#fechaeditada").val();

                        nueva = '<tr class="detalleactividades" id="filaactividad_' + nf_actividad.toString() + '" idreg="0" ida="' + idactividad + '" objetivo="' + objetivo +'" actividad="'+actividad+'" ponderacion="'+ponderacion+'" fechainicio="'+fechainicio+'" fechafin="'+fechafin+'" cantidadhora="'+cantidadhora+'" avance="'+avance+'" estado="'+estado+'" responsables="'+idsresponsables+'" entregable="'+entregable+'" observacion="'+observacion+'" avanceanterior="'+avanceanterior+'" fechaeditada="'+fechaeditada+'">' +
                            '<td style="text-align: right">' + secuenciaactividad.toString() + '</td>' +
                            '<td style="text-align: justify">' + actividad + '<br>' + responsable + '</td>' +
                            '<td style="text-align: right">' + ponderacion + '</td>' +
                            '<td style="text-align: center">' + fechainicio + '</td>' +
                            '<td style="text-align: center">' + fechafin + '</td>' +
                            '<td style="text-align: center">' + cantidadhora + '</td>' +
                            '<td style="text-align: right">' + avance + '</td>' +
                            '<td style="text-align: center">' + estado + '</td>' +
                            '<td style="text-align: justify">' + entregable + '</td>' +
                            '<td style="text-align: justify">' + observacion + '</td>' +
                            '<td><a href="javascript:;" class="btn btn-tini btn-info editaractividad" idreg="0" idf="' + nf_actividad.toString() + '" data-bs-toggle="tooltip" data-bs-placement="top" title="Editar"><i class="fa fa-edit"></i></a>'+
                            '<td><a href="javascript:;" class="btn btn-tini btn-danger eliminaritem_actividad" idreg="0" idf="' + nf_actividad.toString() + '" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar fila"><i class="fa fa-remove"></i></a></td>';

                        $("#detalle_actividades").append(nueva);
                        $("#detalle_actividades").find(".editaractividad").tooltip();
                        $("#detalle_actividades").find(".eliminaritem_actividad").tooltip();
                        $(".editaractividad").unbind("click.editaractividad");
                        $(".editaractividad").bind("click.editaractividad", editarActividad);
                        $(".eliminaritem_actividad").unbind("click.eliminaritem_actividad");
                        $(".eliminaritem_actividad").bind("click.eliminaritem_actividad", eliminarItem_actividad);
                        $('#itemspanelactividad').modal('hide');

                        actualizar_lista_actividad();
                    }
                    else{
                        mensajeWarningSwal("Atención!!!", "La actividad: <b>" + actividad + "</b>, ya ha sido agregada al detalle");
                    }
                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }

            });

            agregar_fila_default_actividad = function (){
                let filadefault = '<tr id="fila_default_actividad">'+
                              '<td colspan="12" style="text-align: center">NO EXISTEN DETALLES DE ACTIVIDADES</td>'
                              '</tr>';
                $("#detalle_actividades").append(filadefault);
                $("#actividades_aux").val("");
            };

            borrar_fila_default_actividad = function (){
                $("#fila_default_actividad").remove();
            };

            actividadRepetida = function (idactividad){
                let repetido = false;
                $(".detalleactividades").each(function() {
                    if(idactividad == $(this).attr('ida')){
                        repetido = true;
                        return false;
                    }
                });

                return repetido;
            };

            editarActividad = function() {
                ida = $(this).attr('idreg');
                idfilaedit = $(this).attr('idf');

                $(".paneltitleeditactividad").html("Editar Actividad del informe");

                //Obtengo la fila actual de la tabla
                let filaTabla=$("#filaactividad_"+idfilaedit);
                //Obtengo texto de los atributos de esa fila
                //tituloactividad = filaTabla.find("td:eq(1)").text();
                tituloobjetivo = filaTabla.attr("objetivo");
                tituloactividad = filaTabla.attr("actividad");
                ponderacion = filaTabla.attr("ponderacion");
                fechainicio = filaTabla.attr("fechainicio");
                fechafin = filaTabla.attr("fechafin");
                cantidadhora = filaTabla.attr("cantidadhora");
                avance = filaTabla.attr("avance");
                estado = filaTabla.attr("estado");
                responsables = filaTabla.attr("responsables");
                entregable = filaTabla.attr("entregable");
                observacion = filaTabla.attr("observacion");
                avanceanterior = filaTabla.attr("avanceanterior");
                fechainicio = fechainicio.substring(6, 10) + "-" + fechainicio.substring(3,5) + "-" + fechainicio.substring(0, 2);
                fechafin = fechafin.substring(6, 10) + "-" + fechafin.substring(3,5) + "-" + fechafin.substring(0, 2);
                finicioe = fechainicio;
                ffine = fechafin;
                pminimoe = avanceanterior;
                pmaximoe = ponderacion;

                $("#tituloobjetivo").html(tituloobjetivo);
                $("#tituloactividad").html(tituloactividad);
                $("#fechainicioedit").val(fechainicio);
                $("#fechafinedit").val(fechafin);
                $("#cantidadhoraedit").val(cantidadhora);
                $("#ponderacionedit").val(ponderacion);
                $("#porcentajeactualedit").val(avance);
                $("#entregableedit").val(entregable);
                $("#estadoedit").val(estado);
                $("#observacionedit").val(observacion);
                $("#porcentajeanterioredit").val(avanceanterior);

                $('#responsableedit option').prop('selected', false);
                $('#responsableedit').trigger('change');

                $.each(responsables.split(","), function(i,e){
                    $("#responsableedit option[value='" + e + "']").prop("selected", true);
                });

                $("#responsableedit").trigger('change');

                habilitarCamposEditActividad();

                $("#itemspaneleditactividad").modal({backdrop:'static'}).modal('show');
            };

            habilitarCamposEditActividad = function (){
                $("#porcentajeactualedit").prop('disabled', false);
                $("#cantidadhoraedit").prop('disabled', false);
                $("#observacionedit").prop('disabled', false);
                $("#entregableedit").prop('disabled', false);
                $("#responsableedit").prop('disabled', false);

                if(parseFloat(pminimoe) == 0)
                    pminimoe = "0.01";

                $("#porcentajeactualedit").addClass("validate[required, min["+pminimoe+"], max["+pmaximoe+"]");
                $("#cantidadhoraedit").addClass("validate[required], min[1], max[500]");
                $("#responsableedit, #entregableedit, #fechainicioedit, #fechafinedit").addClass("validate[required]");
                $("#btneditarfechae").show();
                $("#btncanceleditfechae").hide();
            };

            $(".editarfechase").click(function() {
                efechae = true;
                habilitarCamposFechaEdit();
                $("#observacionedit").addClass("validate[required]");
                $("#fechaeditadaedit").val("S");
            });

            $(".cancelaredicionfechase").click(function() {
                efechae = false;
                inhabilitarCamposFechaEdit();
                $("#observacionedit").removeClass("validate[required]");
                $("#fechaeditadaedit").val("N");
            });

            $(".seleccionartodosedit").click(function (){
                $('#responsableedit option').prop('selected', true);
                $('#responsableedit').trigger('change');
            });

            habilitarCamposFechaEdit = function (){
                $("#fechainicioedit").prop('disabled', false).css('cursor', 'text').css('background-color', '#FFFFFF');
                $("#fechafinedit").prop('disabled', false).css('cursor', 'text').css('background-color', '#FFFFFF');
                $("#btneditarfechae").hide();
                $("#btncanceleditfechae").show();
            };

            inhabilitarCamposFechaEdit = function (){
                $("#fechainicioedit").prop('disabled', true).css('cursor', 'not-allowed').css('background-color', '#ECF0F1');
                $("#fechafinedit").prop('disabled', true).css('cursor', 'not-allowed').css('background-color', '#ECF0F1');
                $("#fechainicioedit").val(finicioe);
                $("#fechafinedit").val(ffine);
                $("#btneditarfechae").show();
                $("#btncanceleditfechae").hide();
            };

            $(".actualizaractividaddetalle").click(function() {
                $("#frmEditActividadInforme").validationEngine('attach',{ scroll: false });
                let valido = $("#frmEditActividadInforme").validationEngine('validate', { scroll: false });

                if(valido){
                    fechainicio = $("#fechainicioedit").val();
                    fechafin = $("#fechafinedit").val();
                    cantidadhora = $("#cantidadhoraedit").val();
                    avance = $("#porcentajeactualedit").val();
                    estado = $("#estadoedit").val();
                    entregable = $("#entregableedit").val().trim();
                    observacion = $("#observacionedit").val().trim();
                    fechaeditada = $("#fechaeditadaedit").val();
                    codigos_personas = $("#responsableedit").val();
                    nombres_personas = $('#responsableedit option:selected').toArray().map(item => item.text);
                    idsresponsables =  codigos_personas.join(",");

                    fechainicio = fechainicio.substring(8,10) + "-" + fechainicio.substring(5,7) + "-" + fechainicio.substring(0, 4);
                    fechafin = fechafin.substring(8,10) + "-" + fechafin.substring(5,7) + "-" + fechafin.substring(0, 4);

                    responsable = "";
                    for(i=0; i<nombres_personas.length; i++){
                        responsable = responsable + '<span class="label label-info">'+nombres_personas[i]+'</span>';
                    }

                    //Obtengo la fila actual de la tabla
                    var filaTabla=$("#filaactividad_"+idfilaedit);
                    //Edito los atributos de la fila
                    filaTabla.attr('fechainicio', fechainicio);
                    filaTabla.attr('fechafin', fechafin);
                    filaTabla.attr('cantidadhora', cantidadhora);
                    filaTabla.attr('avance', avance);
                    filaTabla.attr('estado', estado);
                    filaTabla.attr('entregable', entregable);
                    filaTabla.attr('responsables', idsresponsables);
                    filaTabla.attr('observacion', observacion);
                    filaTabla.attr('fechaeditada', fechaeditada);

                    //Edito el texto o contenido html de las celdas
                    filaTabla.find("td:eq(1)").html("");
                    filaTabla.find("td:eq(1)").html(filaTabla.attr('actividad')+"<br>"+responsable);
                    filaTabla.find("td:eq(3)").text(fechainicio);
                    filaTabla.find("td:eq(4)").text(fechafin);
                    filaTabla.find("td:eq(5)").text(cantidadhora);
                    filaTabla.find("td:eq(6)").text(avance);
                    filaTabla.find("td:eq(7)").text(estado);
                    filaTabla.find("td:eq(8)").text(entregable);
                    filaTabla.find("td:eq(9)").text(observacion);

                    actualizar_lista_actividad();

                    $("#porcentajeactualedit").removeClass("validate[required, min["+pminimoe+"], max["+pmaximoe+"]");
                    $("#observacionedit").removeClass("validate[required]");

                    $('#itemspaneleditactividad').modal('hide');
                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }

            });


            eliminarItem_actividad = function() {
                let id = $(this).attr("idf");
                $(this).tooltip('hide');
                let idreg = $(this).attr("idreg");

                $("#filaactividad_"+id).remove();

                if(idreg != '0'){
                    let item = {
                        idreg: idreg
                    };
                    lista_items3.push(item);
                }

                secuenciaactividad = 0;
                $("#tbdetallectividades tbody tr").each(function (index) {
                    secuenciaactividad ++;
                    $(this).children("td").each(function (index2) {
                        if(index2 == 0)
                            $(this).html(secuenciaactividad.toString());
                    });
                });

                if(secuenciaactividad == 0)
                    agregar_fila_default_actividad();

                actualizar_lista_actividad();
            };

            actualizar_lista_actividad = function (){
                lista_items1 = [];

                $(".detalleactividades").each(function(){
                    idreg = $(this).attr('idreg');
                    ida = $(this).attr('ida');
                    fechainicio = $(this).attr('fechainicio');
                    fechafin = $(this).attr('fechafin');
                    cantidadhora = $(this).attr('cantidadhora');
                    avance = $(this).attr('avance');
                    estado = $(this).attr('estado');
                    entregable = $(this).attr('entregable');
                    responsables = $(this).attr('responsables');
                    observacion = $(this).attr('observacion');
                    fechaeditada = $(this).attr('fechaeditada');

                    let item = {
                        idreg: idreg,
                        ida: ida,
                        fechainicio: fechainicio,
                        fechafin: fechafin,
                        cantidadhora: cantidadhora,
                        avance: avance,
                        estado: estado,
                        entregable: entregable,
                        responsables: responsables,
                        observacion: observacion,
                        fechaeditada: fechaeditada
                    };
                    lista_items1.push(item);
                });
            };

            $(".agregaevidencia").click(function() {
                if(datos_evidencia_completo()){
                    nf_evidencia += 1;
                    secuenciaevidencia += 1;

                    borrar_fila_default_evidencia();

                    nueva = '<tr class="detalleevidencias" id="filaevidencia_' + nf_evidencia.toString() + '">' +
                        '<td style="text-align: right">'+secuenciaevidencia.toString()+'</td>'+
                        '<td> <input type="hidden" id="idregistro[]" name="idregistro[]" value="0"> <input type="hidden" id="nfila_evidencia[]" name="nfila_evidencia[]" value="'+nf_evidencia.toString()+'">  <input autocomplete="off" class="descripcion" style="text-align: left; width: 100%; text-transform: none" maxlength="250" id="descripcion_evidencia'+nf_evidencia.toString()+'" name="descripcion_evidencia[]" type="text" value="" > <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>' +
                        '<td>&nbsp;</td>'+
                        '<td style="text-align: center"><label class="btn btn-default"><i class="fa fa-cloud-upload" aria-hidden="true"></i> Seleccionar <span id="bgaevidencia_'+nf_evidencia.toString()+'" class="badge">0</span><input type="file" style="color: transparent" class="archivosevidencia" idf="'+nf_evidencia.toString()+'" id="archivo_evidencia[]" name="archivo_evidencia[]" hidden>   </label> <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="archivoselecc'+nf_evidencia.toString()+'" value="">  <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>' +
                        '<td style="text-align: center"><input type="date" class="fecha" id="fecha_genera'+nf_evidencia.toString()+'" name="fecha_genera[]" value="'+fechaactual+'" /> <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>'+
                        '<td><input autocomplete="off" class="pagina" style="text-align: left; width: 100%; text-transform: none" maxlength="150" id="numero_pagina'+nf_evidencia.toString()+'" name="numero_pagina[]" type="text" value="" > <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>' +
                        '<td><a href="javascript:;" class="btn btn-tini btn-danger eliminaritem_evidencia" idreg="0" idf="' + nf_evidencia.toString() + '" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar fila"><i class="fa fa-remove"></i></a></td>';

                    $("#detalle_evidencias").append(nueva);
                    $("#detalle_evidencias").find(".eliminaritem_evidencia").tooltip();
                    $("#descripcion_evidencia"+nf_evidencia.toString()).addClass("validate[required]");
                    $("#fecha_genera"+nf_evidencia.toString()).addClass("validate[required]");
                    $("#numero_pagina"+nf_evidencia.toString()).addClass("validate[required]");
                    $("#archivoselecc"+nf_evidencia.toString()).addClass("validate[required]");
                    $(".eliminaritem_evidencia").unbind("click.eliminaritem_evidencia");
                    $(".eliminaritem_evidencia").bind("click.eliminaritem_evidencia", eliminarItem_evidencia);

                    conectar_change_fileinput_evidencia();
                }
            });

            eliminarItem_evidencia = function() {
                let id = $(this).attr("idf");
                $(this).tooltip('hide');
                let idreg = $(this).attr("idreg");

                $("#filaevidencia_"+id).remove();

                if(idreg != '0'){
                    let item = {
                        idreg: idreg
                    };
                    lista_items4.push(item);
                }

                secuenciaevidencia = 0;
                $("#tbdetalleevidencias tbody tr").each(function (index) {
                    secuenciaevidencia ++;
                    $(this).children("td").each(function (index2) {
                        if(index2 == 0)
                            $(this).html(secuenciaevidencia.toString());
                    });
                });

                if(secuenciaevidencia == 0)
                    agregar_fila_default_evidencia();

                actualizar_lista_evidenciaarchivo();
            };

            actualizar_lista_evidenciaarchivo = function (){
                lista_items2 = [];
                cf = 1;
                $('input[name="archivo_evidencia[]"]').each(function() {
                    if($(this).get(0).files.length > 0){
                        let item = {
                            nfila: $(this).attr('idf'),
                            cfila: cf
                        };
                        lista_items2.push(item);
                    }
                    cf ++;
                });
            };

            conectar_change_fileinput_evidencia=function() {
                $(".archivosevidencia").unbind();
                $(".archivosevidencia").change(function () {
                    let id = $(this).get(0).files.length;
                    //alert(id);
                    let idf = $(this).attr('idf');
                    //$("#bgaevidencia_"+idf).html("1");
                    $("#bgaevidencia_"+idf).html(id);

                    if(id > 0)
                        $("#archivoselecc"+idf).val("SI");
                    else
                        $("#archivoselecc"+idf).val("");

                    actualizar_lista_evidenciaarchivo();
                });
            };

            agregar_fila_default_evidencia = function (){
                filadefault = '<tr id="fila_default_evidencia">'+
                              '<td colspan="7" style="text-align: center">NO EXISTEN DETALLES DE EVIDENCIAS</td>'+
                              '</tr>';
                $("#detalle_evidencias").append(filadefault);
            };

            borrar_fila_default_evidencia = function (){
                $("#fila_default_evidencia").remove();
            };

            datos_evidencia_completo = function (){
                var c1e = true, c2e = true, c3e = true;

                $('input[name="descripcion_evidencia[]"]').each(function() {
                    if($(this).val().trim()==''){
                        c1e = false;
                        return false;
                    }
                });

                $('input[name="numero_pagina[]"]').each(function() {
                    if($(this).val().trim()==''){
                        c3e = false;
                        return false;
                    }
                });

                return (c1e && c2e && c3e);
            };

            agregarValidacionDetalleEvidencias = function (){
                $(".descripcion").each(function(){
                    $(this).addClass("validate[required]");
                });

                $(".fecha").each(function(){
                    $(this).addClass("validate[required]");
                });

                $(".pagina").each(function(){
                    $(this).addClass("validate[required]");
                });
            };


            $(".guardar").click(function () {
                envioformularioreg("/pro_proyectoinvestigacion", "editinforme", false);
                return false;
            });

            envioformularioreg = function(url, action, destino){
                let valido;
                let formdata;

                $("#frmEditInforme").validationEngine('attach',{ scroll: false });
                valido = $("#frmEditInforme").validationEngine('validate', { scroll: false });

                if(valido){
                    bloqueointerface();
                    if(action == 'editinforme'){
                        try {
                            for ( instance in CKEDITOR.instances ) {
                                CKEDITOR.instances[instance].updateElement();
                            }
                        } catch (err){
                            console.log(err.message);
                        }
                        formdata = new FormData($("#frmEditInforme")[0]);
                        formdata.append("lista_items1", JSON.stringify(lista_items1));
                        formdata.append("lista_items2", JSON.stringify(lista_items2));
                        formdata.append("lista_items3", JSON.stringify(lista_items3));
                        formdata.append("lista_items4", JSON.stringify(lista_items4));
                    }

                    $.ajax({
                        type: "POST",
                        action: action,
                        url: url,
                        data: formdata,
                        success: function(data) {
                            if(data.result=='ok'){
                                $.unblockUI();
                                let urlDestino = "/pro_proyectoinvestigacion?action=informesproyecto&id={{ proyecto.id|encrypt }}";
                                mensajeSuccessSwal(data.titulo, data.mensaje, urlDestino);
                            }else{
                                $.unblockUI();
                                if(data.swalType == 'warning')
                                    mensajeWarningSwal(data.titulo, data.mensaje);
                                else
                                    mensajeErrorSwal(data.titulo, data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            mensajeErrorSwal("No se puede guardar", "Error al enviar los datos")
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }

            };

            $(".cancelar").click(function () {
                location.href = "/pro_proyectoinvestigacion?id={{ proyecto.id|encrypt }}&action=informesproyecto";
            });

            $(".mostrardistributivo").click(function() {
                let id = $(this).attr('idp');
                let idper = $(this).attr('idper');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'mostrardistributivo', 'id': id, 'idper': idper},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result === 'ok') {
                            $(".panelbodydistributivo").html(data.data);
                            $(".paneltitledistributivo").html(data.title);
                            $("#itemspaneldistributivo").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            });


            $(".editaractividad").unbind("click.editaractividad");
            $(".editaractividad").bind("click.editaractividad", editarActividad);
            $(".eliminaritem_actividad").unbind("click.eliminaritem_actividad");
            $(".eliminaritem_actividad").bind("click.eliminaritem_actividad", eliminarItem_actividad);
            $(".eliminaritem_evidencia").unbind("click.eliminaritem_evidencia");
            $(".eliminaritem_evidencia").bind("click.eliminaritem_evidencia", eliminarItem_evidencia);
            agregarValidacionDetalleEvidencias();
            conectar_change_fileinput_evidencia();
            actualizar_lista_actividad();
            actualizar_lista_evidenciaarchivo();
        });
    </script>
{% endblock %}
{% block atras %}/pro_proyectoinvestigacion?id={{ proyecto.id|encrypt }}&action=informesproyecto{% endblock %}
{% block canvas %}
    {# TITULO PANTALLA #}
    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title }}</h3>
                <h6>Ingrese todos sus datos de forma correcta</h6>
            </div>
        </div>
    </div>
    {# TITULO PANTALLA #}
    <div class="container-fluid">
        {# TABLA DE DATOS #}
        <div class="card mb-4">
            <div class="card-body border-top border-5 rounded-3 border-dark-info">
                <form name="frmEditInforme" id="frmEditInforme">{% csrf_token %}
                    {# CUERPO DEL FORMULARIO #}
                    <input type='hidden' name='action' value='editinforme'/>
                    <input type='hidden' name='id' value='{{ informe.id|encrypt }}'/>
                    <div class="alert alert-info">
                        <b>Periodo Académico Vigente con Horas de Investigación para {{ proyecto.profesor }}:  {% if periodovigente %}<span class="label label-warning">{{ periodovigente.nombre }}</span>  <a href="javascript:;" class='btn btn-success mostrardistributivo' idp="{{ proyecto.id|encrypt }}" idper="{% if periodovigente %}{{ periodovigente.id|encrypt }}{% endif %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Mostrar Distributivo Investigación Integrantes"><span class="fa fa-list" ></span> Mostrar Distributivo Integrantes</a>{% else %}<span class="label label-important">NINGUNO</span>{% endif %}</b>
                    </div>
                    <div id="separator2_encabezado" style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span id="separator2title_encabezado" style="padding:0 10px; background: white;">Encabezado del Informe</span></h6>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <table class="table table-bordered table-striped">
                                <tbody>
                                    <tr>
                                        <td style="width: 10%;"><strong>Tipo de informe:</strong></td>
                                        <td>
                                            <select id="tipoinforme" name="tipoinforme" style="width: 90%;">
                                                <option value="">---------</option>
                                                {% for tipo in tiposinformes %}
                                                    <option value="{{ tipo.id }}" {% if informe.tipo == tipo.id %}selected{% endif %}>{{ tipo.descripcion }}</option>
                                                {% endfor %}
                                            </select>
                                            <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                        </td>
                                        <td colspan="6">&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 10%;"><strong>Número:</strong></td>
                                        <td>{{ numero }}</td>
                                        <td style="width: 10%;"><strong>Fecha Emisión:</strong></td>
                                        <td>{{ fecha|date:"d-m-Y" }}</td>
                                        <td style="width: 10%;"><strong>Para:</strong></td>
                                        <td>{{ proyecto.apruebainforme }}</td>
                                        <td style="width: 10%;"><strong>De:</strong></td>
                                        <td>{{ proyecto.profesor }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 10%;"><strong>Objeto:</strong></td>
                                        <td colspan="7" style="text-align: justify">Reportar los avances del proyecto {{ proyecto.titulo }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span  style="padding:0 10px; background: white;">1. Datos Generales (Perfil del proyecto)</span></h6>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <table class="table table-bordered table-striped">
                                <tbody>
                                    <tr>
                                        <td style="width: 15%;"><strong>Título:</strong></td>
                                        <td colspan="3" style="text-align: justify">{{ proyecto.titulo }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 15%;"><strong>Código:</strong></td>
                                        <td style="text-align: justify">{{ proyecto.codigo }}</td>
                                        <td style="width: 15%;"><strong>Presupuesto:</strong></td>
                                        <td style="text-align: justify">$ {{ proyecto.presupuesto|floatformat:2|intcomma }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 15%;"><strong>Línea de Investigación:</strong></td>
                                        <td style="text-align: justify">{{ proyecto.lineainvestigacion.nombre }}</td>
                                        <td style="width: 15%;"><strong>Sub-líneas de Investigación:</strong></td>
                                        <td>
                                            {% for sublinea in proyecto.sublineainvestigacion.all %}
                                               {{ forloop.counter }}. {{ sublinea.nombre }}<br>
                                            {% endfor %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width: 15%;"><strong>Objetivo General:</strong></td>
                                        <td colspan="3" style="text-align: justify">{{ proyecto.objetivogeneral|safe }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 15%;"><strong>Fecha de inicio:</strong></td>
                                        <td style="text-align: justify">{{ fechainicio }}</td>
                                        <td style="width: 15%;"><strong>Fecha estimada de cierre:</strong></td>
                                        <td style="text-align: justify">{{ fechafinestimada }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 15%;"><strong>Integrantes:</strong></td>
                                        <td colspan="3">
                                            {% for integrante in integrantes %}
                                                {{ integrante.persona.nombre_completo_inverso }}, {{ integrante.get_funcion_display }}<br>
                                            {% endfor %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span  style="padding:0 10px; background: white;">2. Antecedentes</span></h6>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <table class="table table-bordered table-striped">
                                <tbody>
                                    <tr>
                                        <td><strong>2.1</strong></td>
                                        <td style="text-align: justify">
                                            Mediante {{ resolucionaprueba.numero }} de fecha {{ fecharesolucion }} se dispone lo siguiente:
                                            {{ resolucionaprueba.resuelve|safe }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>2.2</strong></td>
                                        <td style="text-align: justify">
                                            Con fecha {{ fechanotificacion }}, la Dirección de Investigación y Posgrado notifica a
                                            {{ proyecto.profesor }}, que el proyecto {{ proyecto.titulo }}
                                            ha sido aprobado para su ejecución, tomando como fecha de inicio el mes de {{ mesinicio }},
                                            por lo que debe suscribir el contrato correspondiente.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>2.3</strong></td>
                                        <td style="text-align: justify">
                                            El equipo investigador estará conformado por:
                                            <br>
                                            <b>Director: </b>{{ proyecto.profesor }}
                                            {% if codirector %}
                                                <br>
                                                <b>Co-director:</b>
                                                {% for codirector in codirector %}
                                                    {{ codirector.persona.nombre_completo_inverso }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                            {% if investigadores %}
                                                <br>
                                                <b>Investigadores asociados:</b>
                                                {% for investigador in investigadores %}
                                                    {{ investigador.persona.nombre_completo_inverso }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                            {% if asistentes %}
                                                <br>
                                                <b>Asistentes de investigación:</b>
                                                {% for asistente in asistentes %}
                                                    {{ asistente.persona.nombre_completo_inverso }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                            {% if colaboradores %}
                                                <br>
                                                <b>Investigadores colaboradores:</b>
                                                {% for colaborador in colaboradores %}
                                                    {{ colaborador.persona.nombre_completo_inverso }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span  style="padding:0 10px; background: white;">3. Motivación Técnica (Administrativa, financiera o académica)</span></h6>
                    </div>
                    <div id="separator2_cronograma" style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left;"><span id="separator2title_cronograma" style="padding:0 10px;">3.1 Actividades Realizadas</span></h6>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <table class="table table-bordered table-striped" id="tbdetallectividades">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 3%; text-align: center;">#</th>
                                        <th style="width: 31%; text-align: center">Actividad/Responsable</th>
                                        <th style="width: 7%; text-align: center">Ponderación (%)</th>
                                        <th style="width: 7%; text-align: center">Fecha Inicio</th>
                                        <th style="width: 7%; text-align: center">Fecha Fin</th>
                                        <th style="width: 7%; text-align: center">Horas</th>
                                        <th style="width: 7%; text-align: center">Avance (%)</th>
                                        <th style="width: 8%; text-align: center">Estado</th>
                                        <th style="width: 12%; text-align: center">Entregable Esperado</th>
                                        <th style="width: 14%; text-align: center">Observaciones</th>
                                        <th style="width: 3%;">&nbsp;</th>
                                        <th style="width: 3%"><a href="javascript:;" id="btnagregaractividad" idp="{{ proyecto.id|encrypt }}" class="btn btn-success btn-mini agregaactividad" data-bs-toggle="tooltip" data-bs-placement="top" title="Agregar Actividad"><i class="fa fa-plus"></i> </a></th>
                                    </tr>
                                </thead>
                                <tbody id="detalle_actividades">
                                    {% for detalle in actividades %}
                                        <tr class="detalleactividades" id="filaactividad_{{ forloop.counter }}" idreg="{{ detalle.id }}" ida="{{ detalle.actividad.id }}" objetivo="{{ detalle.actividad.objetivo.descripcion }}" actividad="{{ detalle.actividad.actividad }}" ponderacion="{{ detalle.actividad.ponderacion }}" fechainicio="{{ detalle.fechainicio|date:"d-m-Y" }}" fechafin="{{ detalle.fechafin|date:"d-m-Y" }}" cantidadhora="{{ detalle.cantidadhora }}" avance="{{ detalle.porcentajeejecucion }}" estado="{{ detalle.get_estado_display }}" responsables="{% for responsable in detalle.responsable.all %}{% if forloop.counter > 1 %},{% endif %}{{ responsable.id }}{% endfor %}" entregable="{{ detalle.entregable }}" observacion="{{ detalle.observacion }}" avanceanterior="{{ detalle.actividad.ultimo_porcentaje_ejecucion_asignado }}" fechaeditada="N">
                                            <td style="text-align: right">{{ forloop.counter }}</td>
                                            <td style="text-align: justify">{{ detalle.actividad.actividad }}<br>{% for responsable in detalle.responsable.all %}<span class="label label-info">{{ responsable }}</span>{% endfor %}</td>
                                            <td style="text-align: right">{{ detalle.actividad.ponderacion }}</td>
                                            <td style="text-align: center">{{ detalle.fechainicio|date:"d-m-Y" }}</td>
                                            <td style="text-align: center">{{ detalle.fechafin|date:"d-m-Y" }}</td>
                                            <td style="text-align: center">{{ detalle.cantidadhora }}</td>
                                            <td style="text-align: right">{{ detalle.porcentajeejecucion }}</td>
                                            <td style="text-align: center">{{ detalle.get_estado_display }}</td>
                                            <td style="text-align: justify">{{ detalle.entregable }}</td>
                                            <td style="text-align: justify">{{ detalle.observacion }}</td>
                                            <td><a href="javascript:;" class="btn btn-tini btn-info editaractividad" idreg="{{ detalle.id }}" idf="{{ forloop.counter }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Editar"><i class="fa fa-edit"></i></a>
                                            <td><a href="javascript:;" class="btn btn-tini btn-danger eliminaritem_actividad" idreg="{{ detalle.id }}" idf="{{ forloop.counter }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar fila"><i class="fa fa-remove"></i></a></td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="actividades_aux" value="OK">
                            <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                        </div>
                    </div>

                    <div style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span  style="padding:0 10px; background: white;">4. Conclusiones</span></h6>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <div class="input-group">
                                <div class="label-text col-md-2 col-sm-2 col-12"  style="display: table;height: 30px;">
                                    <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                                        <label for="conclusion" style="padding-right: 10px;">Conclusiones:</label>
                                    </div>
                                </div>
                                <div class="control-group col-md-10 col-sm-10 col-12" style="float: left; width: 100">
                                    <textarea name="conclusion" id="conclusion" rows="4">{{ informe.conclusion }}</textarea>
                                    <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="conclusion_aux" value="OK">
                                    <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span  style="padding:0 10px; background: white;">5. Recomendaciones</span></h6>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <div class="input-group">
                                <div class="label-text col-md-2 col-sm-2 col-12"  style="display: table;height: 30px;">
                                    <div style="display: table-cell; vertical-align: middle; line-height: 18px">
                                        <label for="recomendacion" style="padding-right: 10px;">Recomendaciones:</label>
                                    </div>
                                </div>
                                <div class="control-group col-md-10 col-sm-10 col-12" style="float: left; width: 100">
                                    <textarea name="recomendacion" id="recomendacion" rows="4">{{ informe.recomendacion }}</textarea>
                                    <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="recomendacion_aux" value="OK">
                                    <div class="help-text" style="color: #dc1414;font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="width: 100%; height: max-content; display: inline-block">
                        <h6 style="width:100%; text-align:left; border-bottom: 1px solid #98a3ab; line-height:0.1em; margin:10px 0 20px;"><span  style="padding:0 10px; background: white;">6. Anexos</span></h6>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 px-4">
                            <table class="table table-bordered table-striped" id="tbdetalleevidencias">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 3%; text-align: center;">#</th>
                                        <th style="width: 49%; text-align: center;">Descripción</th>
                                        <th style="width: 5%; text-align: center;">...</th>
                                        <th style="width: 15%; text-align: center;">Archivo</th>
                                        <th style="width: 15%; text-align: center;">Fecha Generación</th>
                                        <th style="width: 10%; text-align: center;"># Páginas</th>
                                        <th style="width: 3%"><a href="javascript:;" id="btnagregarformato" class="btn btn-success btn-mini agregaevidencia" data-bs-toggle="tooltip" data-bs-placement="top" title="Agregar Evidencia"><i class="fa fa-plus"></i> </a></th>
                                    </tr>
                                </thead>
                                <tbody id="detalle_evidencias">
                                    {% for evidencia in evidencias %}
                                        <tr class="detalleevidencias" id="filaevidencia_{{ forloop.counter }}">
                                            <td style="text-align: right">{{ forloop.counter }}</td>
                                            <td> <input type="hidden" id="idregistro[]" name="idregistro[]" value="{{ evidencia.id }}"> <input type="hidden" id="nfila_evidencia[]" name="nfila_evidencia[]" value="{{ forloop.counter }}">  <input autocomplete="off" class="descripcion" style="text-align: left; width: 100%; text-transform: none" maxlength="250" id="descripcion_evidencia{{ forloop.counter }}" name="descripcion_evidencia[]" type="text" value="{{ evidencia.descripcion }}" > <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>
                                            <td style="text-align: center;">
                                                <a href="{{ evidencia.archivo.url }}" class="btn btn-mini btn-info" data-width="2048" data-height="1380" data-fancybox="evidencia{{ forloop.counter }}" data-caption="Anexo: {{ evidencia.descripcion }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Ver Archivo"><i class="fa fa-eye"></i> </a>

                                                <!-- <a target="_blank" href="{{ evidencia.archivo.url }}" class="btn btn-mini btn-info" data-bs-toggle="tooltip" data-bs-placement="top" title="Descargar Archivo"><i class="fa fa-download"></i> </a>  -->
                                            </td>
                                            <td style="text-align: center;"><label class="btn btn-default"><i class="fa fa-cloud-upload" aria-hidden="true"></i> Seleccionar <span id="bgaevidencia_{{ forloop.counter }}" class="badge">0</span><input type="file" style="color: transparent" class="archivosevidencia" idf="{{ forloop.counter }}" id="archivo_evidencia[]" name="archivo_evidencia[]" hidden>   </label> <input style="visibility: hidden; width: 0px; height: 0px; " type="text" id="archivoselecc{{ forloop.counter }}" value="">  <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>
                                            <td style="text-align: center"><input type="date" class="fecha" id="fecha_genera{{ forloop.counter }}" name="fecha_genera[]" value="{{ evidencia.fecha|date:"Y-m-d" }}" style="cursor:text; background-color: #FFFFFF"/> <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>
                                            <td><input autocomplete="off" class="pagina" style="text-align: left; width: 100%; text-transform: none" maxlength="150" id="numero_pagina{{ forloop.counter }}" name="numero_pagina[]" type="text" value="{{ evidencia.numeropagina }}" > <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div> </td>
                                            <td><a href="javascript:;" class="btn btn-tini btn-danger eliminaritem_evidencia" idreg="{{ evidencia.id }}" idf="{{ forloop.counter }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar fila"><i class="fa fa-remove"></i></a></td>
                                        </tr>
                                    {% empty %}
                                        <tr id="fila_default_evidencia">
                                            <td colspan="7" style="text-align: center">NO EXISTEN DETALLES DE EVIDENCIAS</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {# CUERPO DEL FORMULARIO #}
                    {# FILA DE LOS BOTONES #}
                    <div class="row">
                        <div class="col-sm-12 px-4" style="text-align: right; float: left; width: 100%">
                            <a href="javascript:;" class="btn btn-success guardar"> Guardar</a>
                            <a href="javascript:;" class="btn btn-danger cancelar"> Cancelar</a>
                        </div>
                    </div>
                    {# FILA DE LOS BOTONES #}
                </form>
            </div>
        </div>
        {# TABLA DE DATOS #}
    </div>

    <div class="modal fade static"  id="itemspanelactividad" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-plus"></i>&nbsp;<span class="paneltitleactividad">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodyactividad">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-success agregaractividaddetalle"> Agregar</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static"  id="itemspaneleditactividad" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-edit"></i>&nbsp;<span class="paneltitleeditactividad">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodyeditactividad">
                    <form id="frmEditActividadInforme" style="width: 100%; margin-bottom: 0px;padding-left: 0px;padding-top: 0px; padding-right: 0px; padding-bottom: 0px">
                        <input type='hidden' name='fechaeditadaedit' value='N'/>
                        <div class="alert alert-info">
                            <b>Periodo Académico Vigente con Horas de Investigación para {{ proyecto.profesor }}:  {% if periodovigente %}<span class="label label-warning">{{ periodovigente.nombre }}</span>{% else %}<span class="label label-important">NINGUNO</span>{% endif %}</b>
                        </div>
                        <table class="table table-bordered">
                            <tr>
                                <td style="width: 20%;"><b>Objetivo:</b></td>
                                <td style="width: 80%;" colspan="3">
                                    <span id="tituloobjetivo"></span>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 20%;"><b>Actividad:</b></td>
                                <td style="width: 80%;" colspan="3">
                                    <span id="tituloactividad"></span>
                                </td>
                            </tr>
                            <tr id="filafechaedit">
                                <td style="width: 20%;">
                                    <b>Fecha Inicio:</b> <a href="javascript:;" id="btneditarfechae" class="btn btn-info btn-mini editarfechase" data-bs-toggle="tooltip" data-bs-placement="top" title="Editar fechas"><i class="fa fa-edit"></i> </a>
                                    <a href="javascript:;" id="btncanceleditfechae" class="btn btn-danger btn-mini cancelaredicionfechase" data-bs-toggle="tooltip" data-bs-placement="top" title="Deshacer edición de fechas"><i class="fa fa-undo"></i> </a>
                                </td>
                                <td style="width: 30%;">
                                    <input type="date" id="fechainicioedit" name="fechainicioedit" value="" style="width: 98%;" disabled/>
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                                <td style="width: 20%;"><b>Fecha Fin:</b></td>
                                <td style="width: 30%;">
                                    <input type="date" id="fechafinedit" name="fechafinedit" value="" style="width: 98%;" disabled/>
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 20%;"><b>Cantidad Horas:</b></td>
                                <td style="width: 30%;">
                                    <input type="text" maxlength="5" autocomplete="off" id="cantidadhoraedit" name="cantidadhoraedit" value="" style="width: 98%; text-align: right" disabled>
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                                <td colspan="2">&nbsp;</td>
                            </tr>
                            <tr>
                                <td style="width: 20%;"><b>Ponderación %:</b></td>
                                <td style="width: 30%;">
                                    <input type="text" maxlength="5" autocomplete="off" id="ponderacionedit" name="ponderacionedit" value="" style="width: 98%; text-align: right" disabled>
                                </td>
                                <td style="width: 20%;"><b>Avance Anterior %:</b></td>
                                <td style="width: 30%;">
                                    <input type="text" maxlength="5" autocomplete="off" id="porcentajeanterioredit" name="porcentajeanterioredit" value="" style="width: 98%; text-align: right" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 20%;"><b>Avance Actual %:</b></td>
                                <td style="width: 30%;">
                                    <input type="text" maxlength="5" autocomplete="off" id="porcentajeactualedit" name="porcentajeactualedit" value="" style="width: 98%; text-align: right" disabled>
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                                <td style="width: 20%;"><b>Estado:</b></td>
                                <td style="width: 30%;">
                                    <input type="text" maxlength="5" autocomplete="off" id="estadoedit" name="estadoedit" value="" style="width: 98%;" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Entregables:</b></td>
                                <td colspan="3">
                                    <input type="text" maxlength="250" autocomplete="off" id="entregableedit" name="entregableedit" value="" style="width: 99%; text-transform: none">
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Responsables:</b><a href="javascript:;" id="btnseleccionartodoedit" class="btn btn-info btn-mini seleccionartodosedit" data-bs-toggle="tooltip" data-bs-placement="top" title="Seleccionar todos"><i class="fa fa-check-square"></i> </a>
                                </td>
                                <td colspan="3">
                                    <select id="responsableedit" multiple name="responsableedit" style="width: 99%">
                                        {% for integrante in integrantes %}
                                            <option value="{{ integrante.persona.id }}">{{ integrante.persona }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Observaciones:</b></td>
                                <td colspan="3">
                                    <textarea style="width: 99%; text-transform: none;" cols="40" id="observacionedit" name="observacionedit" rows="3" disabled></textarea>
                                    <div class="help-text" style="color: #dc1414; font-size: xx-small; margin-bottom: 0;"> </div>
                                </td>
                            </tr>
                        </table>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-success actualizaractividaddetalle"> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static"  id="itemspaneldistributivo" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-list"></i>&nbsp;<span class="paneltitledistributivo">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodydistributivo">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

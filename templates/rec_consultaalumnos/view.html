{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src="/static/js/bootstrap-filestyle.min.js?v=1.0.0"> </script>
    <script type="text/javascript" src='/static/js/select2.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/select2.css?v=1.0.0"/>

    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="/static/js/jquery.fancybox.pack.js?v=1.0.0"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

    <link href="/static/picons-thin/style.css" rel="stylesheet">
    <link href="/static/widget_ppp.css" rel="stylesheet"/>

    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0'></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>

    <style>
        .divider-line {
            border-top: 1px solid lightgrey;
            height: 2px;
            width: auto;
            padding: 1px;
            margin: 5px 10px 5px 10px;
        }

        {#.select2-container--default .select2-results > .select2-results__options  {#}
        {#    max-height: 500px !important;#}
        {#    max-width: 100% !important;#}
        {# }#}
        {#.select2 .select2-container .select2-container--default .select2-container--below .select2-container--focus {#}
        {#    width: 90% !important;#}
        {# }#}
        {#.select2 {#}
        {#    max-width: 100%;#}
        {# }#}
    </style>

    <script type="text/javascript">
        $(function() {

            $("select").select2({minimumResultsForSearch: 1});
            $("#fecha_desde, #fecha_hasta").datepicker({format: "yyyy-mm-dd"}).on('changeDate', function (ev) {
                $(this).datepicker('hide');
            });

            $("#periodos").select2();
            $("#carreras").select2();

            $("#aniorepposgrado").select2();
            $("#mesrepposgrado").select2();
            $("#tipocategoria").select2();


            $("#tiporeporteanual").select2({minimumResultsForSearch: 5 });

            var anioreporte = '{{ anio }}';

            $("#id_tipo, #id_archivo, #id_motivo, #anioreporte").addClass("validate[required]");

            $("#reporte_anual").find(".selectorfecha").datepicker({format:"yyyy-mm-dd"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#reporte_cartera").find(".selectorfecha").datepicker({format:"yyyy-mm-dd"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });

            mostrarProgramasCostoCero = function (){
                $("#itemspanelprogramassincosto").modal({backdrop:'static', width: 1000, height: 450}).modal('show');
            };

            $('#tiporeporteanual').change(function() {
                if(parseInt($(this).val()) == 1)
                {
                    $("#fila_anio").show();
                    $("#fila_fechas").hide();
                }else{
                    $("#fila_anio").hide();
                    $("#fila_fechas").show();
                }
            });

            $('#tiporeporteanual').val('1').trigger('change');

            $('#anioreporte').blur(function(){
                digitos($(this));
                if($(this).val().trim() == '')
                    $(this).val(anioreporte);
            });

            var request;
            var lista = [];
            {#            $("#estudiantes").change(function(){#}
            {#                var elemento = $(this);#}
            {#                var id = parseInt(elemento.val());#}
            {#                var periodo = parseInt($("#periodos").val());#}
            {#                var carrera = parseInt($("#carreras").val());#}
            {#                $("#segmento").empty();#}
            {#                if (id){#}
            {#                    bloqueointerface();#}
            {#                    $.ajax({#}
            {#                        type: "POST",#}
            {#                        url: "/rec_consultaalumnos",#}
            {#                        data: {"action": "segmento", "id": id, "periodo": periodo, "carrera": carrera },#}
            {#                        success: function(data) {#}
            {#                            $.unblockUI();#}
            {#                            if (data.result=='ok'){#}
            {#                                $("#segmento").html(data.data);#}
            {#                                $('.reportedirecto').unbind();#}
            {#                                conectar_reporte();#}
            {#                            } else {#}
            {#                                elemento.val(0);#}
            {#                                $("#estudiantes").val(0);#}
            {#                            }#}
            {#                        },#}
            {#                        error: function() {#}
            {#                            $.unblockUI();#}
            {#                            elemento.val(0);#}
            {#                            $("#carreras").val(0);#}
            {#                            $("#estudiantes").val(0);#}
            {#                            smoke.alert("Error de conexión.");#}
            {#                        },#}
            {#                        dataType: "json"#}
            {#                    });#}
            {#                }#}
            {#            });#}


            $("#periodos").change(function () {
                var elemento = $(this);
                var id = parseInt(elemento.val());
                $("#carreras").html('').append('<option selected="selected" value="">---------</option>');
                $("#segmento").empty();
                if (id > 0){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "periodo_carrera", "id": id},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                for (x=0; x < data.lista.length; x++){
                                    elemento = data.lista[x];
                                    $("#carreras").append('<option value="'+elemento[0]+'">'+elemento[1]+'</option>');
                                }
                            } else {
                                elemento.val(0);
                                $("#carreras").val(0);
                                $("#carreras").select2();
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            elemento.val(0);
                            $("#carreras").val(0);
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                }
            });

            conectar_control = function () {
                $("#todos").unbind();
                $("#todos").click(function () {
                    if ($(this).is(":checked")){
                        $(".seleccionado").prop('checked', true);
                    }else{
                        $(".seleccionado").prop('checked', false);
                    }
                });
                $("#todos1").unbind();
                $("#todos1").click(function () {
                    if ($(this).is(":checked")){
                        $(".selectormat").prop('checked', true);
                    }else{
                        $(".selectormat").prop('checked', false);
                    }
                });
            };

            conectar_control_bloqueo = function () {
                $("#todos_bloqueo").unbind();
                $("#todos_bloqueo").click(function () {
                    if ($(this).is(":checked")){
                        $(".seleccionado_bloqueo").prop('checked', true);
                    }else{
                        $(".seleccionado_bloqueo").prop('checked', false);
                    }
                });
            };

            conectar_notificar = function () {
                $("#notificar").unbind();
                $("#notificar").click(function () {
                    var lista = [];
                    $(".seleccionado:checkbox:checked").each(function(){
                        lista.push($(this).attr('ida'));
                    });
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "notificar_deuda", "lista": JSON.stringify(lista)},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                smoke.alert('Se han generado correos de notificación');
                                {#$(".seleccionado").prop('checked', false);#}
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                });
                $(".bloquear1").unbind();

                $(".bloquear1").click(function () {
                    var idcarrera = $(this).attr("carrera");
                    var idperiodo = $(this).attr("periodo");
                    var ancho = '800px';
                    var alto = '450px';
                    if (idcarrera){
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/rec_consultaalumnos",
                            data: {"action": "bloquear", "idcarrera": idcarrera, "idperiodo": idperiodo},
                            success: function(data) {
                                $.unblockUI();
                                if (data.result=='ok'){
                                    $("#afinidadbody").html(data.data);
                                    $("#itemspanel3").modal({backdrop:'static', width: 800, height: 450}).modal('show');
                                } else {
                                    $("#itemspanel3").modal("hide");
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión.");
                                $("#afinidad").hide();
                            },
                            dataType: "json"
                        });
                    }
                });

                $("#itemspanel3_adicionar").unbind();
                $("#itemspanel3_adicionar").click(function () {
                    $(".seleccionado_bloqueo:checkbox:checked").each(function(){
                        lista.push([$(this).attr('ida_bloqueo'),true]);
                    });
                    $(".seleccionado_bloqueo:checkbox:not(:checked)").each(function(){
                        lista.push([$(this).attr('ida_bloqueo'),false]);
                    });
                    $("#itemspanel3").modal('hide');

                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "bloqueo_matricula", "lista": JSON.stringify(lista)},
                        success: function(data) {
                            {#                            $.unblockUI();#}
                            if (data.result=='ok'){
                                $("#carreras").trigger("change");
                                $.unblockUI();
                            } else {
                                smoke.alert(data.mensaje, function(e){
                                    $("#itemspanel3").modal({backdrop:'static', width: 800, height: 450}).modal('show');
                                }, {
                                    ok: "ok",
                                    classname: "custom-class"
                                });
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión.", function(e){
                                $("#itemspanel3").modal({backdrop:'static', width: 800, height: 450}).modal('show');
                            }, {
                                ok: "ok",
                                classname: "custom-class"
                            });
                        },
                        dataType: "json"
                    });
                });
            };

            $("#carreras").change(function () {
                var elemento = $(this);
                var periodo = parseInt($("#periodos").val());
                var id = parseInt(elemento.val());
                var desde = $("#desde").val();
                var hasta = $("#hasta").val();
                var search = $("#search").val();

                $("#segmento").empty();
                if (id > 0){
                    bloqueointerface();


                    //$("#segmento").html("<strong>Espere un momento mientras se muestran los resultados...</strong>");

                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "segmento", "carrera": id, "periodo": periodo, "desde":desde, "hasta":hasta, "search":search},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                $("#segmento").html(data.data);
                                $('.reportedirecto').unbind();
                                conectar_reporte();
                                tooltips();
                                conectar_control();
                                conectar_notificar();
                                conectar_control_novedad();
                            } else {
                                elemento.val(0);
                                $("#segmento").empty();
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            elemento.val(0);
                            $("#segmento").empty();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                }
            });
            $('#desde').change(function () {
                var desde = $("#desde").val();
                var hasta = $("#hasta").val();
                if (!(desde === "" || hasta === "")){
                    var fechaDesde = new Date(desde);
                    var fechaHasta = new Date(hasta);
                    if (fechaDesde <= fechaHasta){
                        $("#carreras").change();
                    }
                }
            });

            $('#hasta').change(function () {
                var desde = $("#desde").val();
                var hasta = $("#hasta").val();
                if (!(desde === "" || hasta === "")){
                    var fechaDesde = new Date(desde);
                    var fechaHasta = new Date(hasta);
                    if (fechaDesde <= fechaHasta){
                        $("#carreras").change();
                    }
                }
            });

            $("#search").blur(function () {
                var search = $("#search").val();
                $("#carreras").change();
            });

            $("#carreras, #periodos").val(0);

            $("#adicionar_rubro").click(function(){
                var codigomatricula = $('#idmatricula').val();
                var listavisto = '';
                var listanovisto = '';
                $('.selectormat').each(function() {
                    if ($(this).is(":checked")){
                        listavisto += $(this).val() + ",";
                    }else{
                        listanovisto += $(this).val() + ",";
                    }
                });
                $.ajax({
                    type: "POST",
                    url: "/rec_consultaalumnos",
                    data: {'action': 'asignarrubro', 'listavisto': listavisto,'listanovisto': listanovisto, 'codigomatricula': codigomatricula },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            actualizapage();
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    dataType: "json"
                });
            });

            actualizapage = function(){
                var elemento = $("#carreras").val();
                var periodo = parseInt($("#periodos").val());
                var id = parseInt(elemento);
                $('#modalrespuestas').modal('hide');

                $("#segmento").empty();
                if (id > 0){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "segmento", "carrera": id, "periodo": periodo},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                $("#segmento").html(data.data);
                                $('.reportedirecto').unbind();
                                conectar_reporte();
                                tooltips();
                                conectar_control();
                                conectar_notificar();
                            } else {
                                $("#carreras").val(0);
                                $("#segmento").empty();
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            $("#carreras").val(0);
                            $("#segmento").empty();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                }
            };

            $(".reportegeneral").click(function () {
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/rec_consultaalumnos",
                    data: {"action": "reporte_general" },
                    success: function(data) {
                        $.unblockUI();
                        if (data.result=='ok'){
                            location.href = data.archivo;
                        } else {
                            smoke.alert(data.mensaje, function(e){
                                {#$("#itemspanel2").modal({backdrop:'static', width: '400'}).modal('show');#}
                                d = 0
                            }, {
                                ok: "ok",
                                classname: "custom-class"
                            });
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.", function(e){
                            {#$("#itemspanel2").modal({backdrop:'static', width: '400'}).modal('show');#}
                            d = 0
                        }, {
                            ok: "ok",
                            classname: "custom-class"
                        });
                    },
                    dataType: "json"
                });


            });

            $(".reporteanual").click(function () {
                $("#itemspanel2").modal({backdrop:'static', width: '450'}).modal('show');
            });

            $("#itemspanel_cerrar_2").click(function () {
                $("#itemspanel2").modal('hide');
            });

            $("#itemspanel_cerrar").click(function () {
                $("#itemspanel").modal('hide');
            });

            $("#itemspanel_adicionar_2").click(function () {
                if(datos_reporte_anual_completo()){
                    var tiporeporte = $("#tiporeporteanual").val();
                    var anio = $("#anioreporte").val();
                    var desde = $("#fechadesde").val();
                    var hasta = $("#fechahasta").val();
                    $("#itemspanel2").modal('hide');
                    // $.unblockUI();
                    porcentajesreporteanual(tiporeporte, anio, desde, hasta);
                }
            });

            datos_reporte_anual_completo = function (){
                var validacion = true;

                if($("#tiporeporteanual").val() == '1'){
                    if(parseInt($("#anioreporte").val()) < 2001){
                        smoke.alert("El año debe ser mayor o igual a 2001");
                        return false;
                    }
                }
                else{
                    var anio1 = parseInt($("#fechadesde").val().substring(0, 4));
                    var anio2 = parseInt($("#fechahasta").val().substring(0, 4));
                    if(anio1 != anio2){
                        smoke.alert("Los años de las fechas deben ser iguales");
                        return false;
                    }
                }

                return validacion;
            };

            $(".bloquear1").click(function () {
                var idcarrera = $(this).attr("carrera");
                var idperiodo = $(this).attr("periodo");
                var ancho = '800px';
                var alto = '450px';
                if (idcarrera){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "bloquear", "idcarrera": idcarrera, "idperiodo": idperiodo},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                $("#afinidadbody").html(data.data);
                                $("#itemspanel3").modal({backdrop:'static', width: 800, height: 450}).modal('show');
                            } else {
                                $("#itemspanel3").modal("hide");
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                            $("#afinidad").hide();
                        },
                        dataType: "json"
                    });
                }
            });


            $('#id_tipo').change(function (){
                if ($('#id_tipo').val() != 1){
                    $("#id_tipodescuento").prop('disabled', true);
                    $("#id_porcentajedescuento").prop('disabled', true);
                    $("#id_tipodescuento").val("");
                    $("#id_porcentajedescuento").val("");

                }else{
                    $("#id_tipodescuento").prop('disabled', false);
                    $("#id_porcentajedescuento").prop('disabled', false);
                }

                {#if($('#id_tipo').val() == 2){#}
                {#    $("#id_tipo option[value=1]").attr('disabled','disabled');#}
                {#    $("#id_tipo option[value=3]").attr('disabled','disabled');#}
                {#    $("#id_tipo option[value=2]").removeAttr('disabled');#}
                {# }else{#}
                {#    $("#id_tipo option[value=2]").attr('disabled','disabled');#}
                {#    $("#id_tipo option[value=1]").removeAttr('disabled');#}
                {#    $("#id_tipo option[value=3]").removeAttr('disabled');#}
                {# }#}
            });

            $("#itemspanel_adicionar").click(function () {
                if(datosnovedadcompletos()){
                    $("#action").val('novedad_matricula');
                    var formdata = new FormData($("#form2")[0]);
                    $("#itemspanel").modal('hide');
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: formdata,
                        success: function (data) {
                            ////$.unblockUI();
                            if (data.result == 'ok') {
                                ////$.unblockUI();
                                smoke.alert(data.mensaje);
                                $("#carreras").trigger("change");
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje, function (e) {
                                    $("#itemspanel").modal({backdrop: 'static', width: '700'}).modal('show');
                                }, {
                                    ok: "ok",
                                    classname: "custom-class"
                                });
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            $.unblockUI();
                            smoke.alert("Error de conexión. " + errorThrown, function (e) {
                                $("#itemspanel").modal({backdrop: 'static', width: '700'}).modal('show');
                            }, {
                                ok: "ok",
                                classname: "custom-class"
                            });
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }
            });

            $("#itemspanel_editar").click(function () {
                if(datosnovedadcompletos()){
                    $("#action").val('editnovedad_matricula');
                    var formdata = new FormData($("#form2")[0]);
                    $("#itemspanel").modal('hide');
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: formdata,
                        success: function (data) {
                            //$.unblockUI();
                            if (data.result == 'ok') {
                                bloqueointerface();
                                smoke.alert(data.mensaje);
                                $("#carreras").trigger("change");
                                ////$.unblockUI();
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje, function (e) {
                                    $("#itemspanel").modal({backdrop: 'static', width: '700'}).modal('show');
                                }, {
                                    ok: "ok",
                                    classname: "custom-class"
                                });
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            $.unblockUI();
                            smoke.alert("Error de conexión. " + errorThrown, function (e) {
                                $("#itemspanel").modal({backdrop: 'static', width: '700'}).modal('show');
                            }, {
                                ok: "ok",
                                classname: "custom-class"
                            });
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }

            });

            $("#itemspanelporcentaje_adicionarRESPALDO").click(function (){
                lista = [];

                anio = $("#anioporcentaje").val();
                tiporeporte = $("#tiporeporteanual").val();
                desde = $("#fechadesde").val();
                hasta = $("#fechahasta").val();


                $(".porcentajes").each(function () {
                    var idp = $(this).attr('pid');
                    var idc = $(this).attr('cid');
                    var porc = $(this).val();

                    var item = {
                        periodo: idp,
                        carrera: idc,
                        porcentaje: porc
                    };

                    lista.push(item);
                });

                if (lista){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "reporte_anual", "tiporeporte": tiporeporte, "anio": anio, "desde": desde, "hasta": hasta, "listaporcentaje": JSON.stringify(lista)},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                location.href = data.archivo;
                                $("#itemspanelporcentaje").modal('hide');
                            } else {
                                smoke.alert(data.mensaje, function(e){
                                    $("#itemspanelporcentaje").modal({backdrop:'static', width: '400'}).modal('show');
                                }, {
                                    ok: "ok",
                                    classname: "custom-class"
                                });
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión.", function(e){
                                //$("#itemspanelporcentaje").modal({backdrop:'static', width: '400'}).modal('show');
                                $("#itemspanelporcentaje").modal({backdrop:'static', width: 1000, height: 450}).modal('show');
                            }, {
                                ok: "ok",
                                classname: "custom-class"
                            });
                        },
                        dataType: "json"
                    });
                }
            });

            $("#itemspanelporcentaje_adicionar").click(function (){
                lista = [];

                anio = $("#anioporcentaje").val();
                tiporeporte = $("#tiporeporteanual").val();
                desde = $("#fechadesde").val();
                hasta = $("#fechahasta").val();


                $(".porcentajes").each(function () {
                    var idp = $(this).attr('pid');
                    var idc = $(this).attr('cid');
                    var porc = $(this).val();

                    var item = {
                        periodo: idp,
                        carrera: idc,
                        porcentaje: porc
                    };

                    lista.push(item);
                });

                if (lista){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "reporte_anual_background", "tiporeporte": tiporeporte, "anio": anio, "desde": desde, "hasta": hasta, "listaporcentaje": JSON.stringify(lista)},
                        success: function(data) {
                            $.unblockUI();

                            if (data.result == 'ok') {
                                $("#itemspanelporcentaje").modal('hide');
                                $('#btnNotificacionTareas').html(data.btn_notificaciones);
                                mensajeSuccess(data.mensaje);
                            } else {
                                $.unblockUI();
                                mensajeErrorSwal("No se puede consultar", data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            mensajeErrorSwal("No se puede consultar", "Error de conexión")
                        },
                        dataType: "json"
                    });
                }
            });

            $("#itemspanelporcentaje_cerrar").click(function () {
                $("#itemspanelporcentaje").modal('hide');
            });

            porcentajesreporteanual = function(tiporeporte, anio, desde, hasta){
                if (tiporeporte){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": "porcentajereporte", "tiporeporte": tiporeporte, "anio": anio, "desde": desde, "hasta": hasta},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                $("#bodyporcentaje").html(data.data);
                                $("#itemspanelporcentaje").modal({backdrop:'static', width: 1000, height: 450}).modal('show');
                            } else {
                                $("#itemspanelporcentaje").modal("hide");
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                            $("#itemspanelporcentaje").hide();
                        },
                        dataType: "json"
                    });
                }
            };

            datosnovedadcompletos = function(){
                if($("#id_motivo").val().trim()==""){
                    smoke.alert("Ingrese el motivo de la novedad");
                    return false;
                }
                if($("#id_tipo").val()==1){
                    if($("#id_tipodescuento").val()==0){
                        smoke.alert("Seleccione tipo de descuento");
                        return false;
                    }
                    else
                    if($("#id_porcentajedescuento").val()==""){
                        smoke.alert("Ingrese el porcentaje de descuento");
                        return false;
                    }
                    else
                    if(parseFloat($("#id_porcentajedescuento").val()) < 5 || parseFloat($("#id_porcentajedescuento").val()) > 100){
                        smoke.alert("El porcentaje de descuento debe estar entre 5 y 100");
                        return false;
                    }
                }
                return true;
            };

            conectar_control_novedad = function () {
                $(".itemsadicionar").unbind();
                $(".calcular_descuento").unbind();
                $(".itemsadicionar").click(function () {
                    var idmatricula = $(this).attr('idma');
                    var esretiro = $(this).attr('er');

                    vaciarformulario(esretiro);
                    $("#alertaingreso").hide();
                    $("#incompleto").hide();
                    $("#incompletovalores").hide();
                    $("#itemspanel_editar").hide();
                    $("#itemspanel_adicionar").show();
                    $("#idmatricula1").val(idmatricula);

                    $("#itemspanel").modal({backdrop: 'static', width: '700'}).modal('show');
                    {#                    $("#itemspanel_adicionar").attr({'idmatricula': idmatricula});#}
                    return false;
                });
                $(".calcular_descuento").click(function () {
                    var idmatricula = $(this).attr('idma');
                    var tipo = $(this).attr('tipo');
                    smoke.confirm("¿Está seguro de realizar proceso de calculo de descuento.?", function(e){
                        if (e){
                            bloqueointerface();
                            $.post("/rec_consultaalumnos", {"action":tipo, "idmatricula": idmatricula}, function(data) {
                                if (data.result=='ok') {
                                    smoke.alert("ok");
                                    $("#carreras").trigger("change");
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            }, "json");
                        }
                    }, {
                        ok: "SI,SEGURO",
                        cancel: "NO,CANCELAR",
                        classname: "custom-class",
                        reverseButtons: true
                    });
                });

                $(".editaritemseditar").unbind();
                $(".editaritemseditar").click(function () {
                    var idnovedad = $(this).attr('idnov');
                    var esretiro = $(this).attr('er');
                    vaciarformulario(esretiro);
                    $("#idnovedad").val(idnovedad);
                    $("#alertaingreso").hide();
                    $("#incompleto").hide();
                    $("#incompletovalores").hide();
                    $("#itemspanel_adicionar").hide();
                    $("#itemspanel_editar").show();
                    $.post("/rec_consultaalumnos", {'action': 'consulnovedad_matricula', 'idnovedad': idnovedad}, function(data) {
                        if (data) {

                            $("#id_tipo").val(data.tipo).trigger('change');

                            $("#id_motivo").val(data.motivo)
                            if (data.tipo == 1){
                                $("#id_tipodescuento").val(data.tipodescuento)
                                $("#id_porcentajedescuento").val(data.porcentajedescuento)
                                $("#id_tipodescuento").prop('disabled', false);
                                $("#id_porcentajedescuento").prop('disabled', false);
                            }else{
                                $("#id_tipodescuento").val("");
                                $("#id_porcentajedescuento").val("");
                                $("#id_tipodescuento").prop('disabled', true);
                                $("#id_porcentajedescuento").prop('disabled', true);
                            }
                        }
                    }, 'json');

                    $("#itemspanel").modal({backdrop: 'static', width: '700'}).modal('show');
                    {#                    $("#itemspanel_adicionar").attr({'idmatricula': idmatricula});#}
                    return false;
                });
            };

            vaciarformulario = function (esretiro) {
                $("#id_tipo").val(1).trigger('change');
                $("#id_motivo").val("");
                $("#id_porcentajedescuento").val("");
                $(":file").filestyle('clear');
                $("#idnovedad").val(0);

                if(esretiro == 'S'){
                    $("#id_tipo").val(2).trigger('change');
                }
            };

            $("#itemspanel3_cerrar").click(function () {
                $("#itemspanel3").modal('hide');
            });

            tipo_formulario($("#form2"));
            $(":file").filestyle({"input": false});

            $("#fechafin, #fechainicio").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#exportar").click(function () {
                $("#ficherofacturamodal").modal({'width': '400px'}).modal('show');
                $("#panelfichero").hide();
            });


            $("#ficherofacturamodal .btn-cerrar").click(function () {
                $("#ficherofacturamodal").modal('hide');
            });

            $("#ficheromodal .btn-cerrar").click(function () {
                $("#ficheromodal").modal('hide');
            });

            $("#ficherofacturamodal .btn-generar").click(function () {
                var fechai = $("#fechainicio").val();
                var fechaf = $("#fechafin").val();
                bloqueointerface();
                $("#ficherofacturamodal").modal("hide");
                if (fechai <= fechaf) {
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {'action': 'reporte_detallado_general', 'fechaf': fechaf, 'fechai': fechai},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $("#enlacefichero").attr({'href': data.archivo});
                                $("#enlaceficheronombre").html('Archivo: ' + data.archivo);
                                $("#ficheromodal").modal({'width': '200'}).modal("show");
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión.");
                        },
                        dataType: "json"
                    });
                } else{
                    $.unblockUI();
                    Swal.fire({
                        /*                  icon: 'error',*/
                        title: 'Oops...',
                        type: 'error',
                        text: 'La fecha de inicio debe ser menor a la fecha de corte!',
                    }).then((result) => {
                        $("#fechainicio").val('')
                        $("#fechafin").val('')
                        $("#ficherofacturamodal").modal({'width': '400px'}).modal('show');
                    })
                }


            });

            $("#enlacefichero").click(function () {
                $("#ficherofacturamodal").modal('hide');
            });

            $("#itemspanelvalidardocumentocompromiso .guardar").click(function () {
                /*if(!datosrevisiondocumentoscompletos())
                    return false;
                */
                envioformularioreg("/rec_consultaalumnos","validardocumentocompromiso", false);
            });

            envioformularioreg = function(url, action, destino){
                if(action == 'validardocumentocompromiso')
                    valido = datosrevisiondocumentoscompletos();

                if (valido){
                    bloqueointerface();
                    if(action == 'validardocumentocompromiso')
                        var formdata = new FormData($("#formulario1")[0]);

                    $.ajax({
                        type: "POST",
                        action : action,
                        url: url,
                        data:  formdata,
                        success: function(data) {
                            //alert(data.result);
                            if (data.result == 'ok') {
                                if(action == 'validardocumentocompromiso') {
                                    $.unblockUI();
                                    $('#itemspanelvalidardocumentocompromiso').modal('hide');
                                    //location.href = "/adm_convalidacionpractica";
                                }
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error al enviar los datos.");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }
            };


            datosrevisiondocumentoscompletos = function (){
                var validacion = true;

                $('select[name="estadodocumento[]"]').each(function() {
                    valor = parseInt($(this).val());
                    idc = $(this).attr('id');

                    if(valor == 3){
                        obse = $("#obsereg_"+idc).val().trim();
                        if(obse == ''){
                            smoke.alert("Ingrese las observaciones para los documentos RECHAZADOS.");
                            validacion = false;
                            return false;
                        }
                    }
                    else if(valor == 0){
                        smoke.alert("Seleccione el estado para cada uno de los documentos.");
                        validacion = false;
                        return false;
                    }
                });

                if(validacion){
                    if($("#estadocompromiso").val() == '4'){
                        if($("#observacion").val().trim()=='')
                        {
                            smoke.alert("Ingrese las observaciones.");
                            validacion = false;
                            return false;
                        }
                    }
                }


                return validacion;
            };

            $(".reportedetallemensual").click(function () {
                $("#itemspanelreporteposgrado .paneltitlereporteposgrado").html($(this).attr('titulo'));
                $("#tiporeporteposgrado").val($(this).attr('tiporeporte'));
                $("#aniorepposgrado").val(0).trigger('change');
                $("#mesrepposgrado").val(0).trigger('change');
                $("#itemspanelreporteposgrado").modal({backdrop:'static', width: '550'}).modal('show');
            });

            $("#itemspanelreporteposgrado .btn-cerrar").click(function () {
                $("#itemspanelreporteposgrado").modal('hide');
            });

            $("#itemspanelreporteposgrado .btn-procesar").click(function () {
                if(datosCompletosReporte()){
                    var tiporeporte = parseInt($("#tiporeporteposgrado").val());
                    var anio = $("#aniorepposgrado").val();
                    var mes = $("#mesrepposgrado").val();

                    if(tiporeporte == 1)
                        accion = "reporte_detalle_movimientos_mensuales";
                    else if(tiporeporte == 2)
                        accion = "reporte_vencimiento_mensual";
                    else if(tiporeporte == 3)
                        accion = "reporte_pago_mensual";
                    else if(tiporeporte == 4)
                        accion = "reporte_resumen_mensual";
                    else if(tiporeporte == 5)
                        accion = "reporte_edad_cartera_vencida";
                    else if(tiporeporte == 6)
                        accion = "reporte_proyeccion_cobros";
                    else
                        accion = "reporte_indice_cartera";

                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/rec_consultaalumnos",
                        data: {"action": accion, "anio": anio, "mes": mes},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result=='ok'){
                                location.href = data.archivo;
                                $("#itemspanelreporteposgrado").modal('hide');
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión");
                        },
                        dataType: "json"
                    });
                }
            });

            datosCompletosReporte = function (){
                var validacion = true;

                if($("#aniorepposgrado").val()=='0'){
                    smoke.alert("Seleccione el año");
                    return false;
                }

                if($("#mesrepposgrado").val()=='0'){
                    smoke.alert("Seleccione el mes");
                    return false;
                }
                return validacion;
            }

            $("#itemspanelprogramassincosto .btn-cerrar").click(function () {
                $("#itemspanelprogramassincosto").modal('hide');
            });

            $(".reportecarteravencidageneral").click(function () {
                $("#itemspanelreportecartera .paneltitlereportecartera").html($(this).attr('titulo'));
                $("#fila_fecha_cobro").hide();
                $("#fila_categoria").hide();
                $("#tiporeportecartera").val($(this).attr('tiporeporte'));
                $("#itemspanelreportecartera").modal({backdrop:'static', width: '600'}).modal('show');
            });

            $(".reportecarteravencidageneralcategoria").click(function () {
                $("#itemspanelreportecartera .paneltitlereportecartera").html($(this).attr('titulo'));
                $("#fila_fecha_cobro").hide();
                $("#fila_categoria").show();
                $("#tipocategoria").val('').trigger('change');
                $("#tiporeportecartera").val($(this).attr('tiporeporte'));
                $("#itemspanelreportecartera").modal({backdrop:'static', width: '600'}).modal('show');
            });

            $(".reportecarteravencidageneralcobros").click(function () {
                $("#itemspanelreportecartera .paneltitlereportecartera").html($(this).attr('titulo'));
                $("#fila_fecha_cobro").show();
                $("#fila_categoria").hide();
                $("#tiporeportecartera").val($(this).attr('tiporeporte'));
                $("#itemspanelreportecartera").modal({backdrop:'static', width: '700'}).modal('show');
            });

            $("#itemspanelreportecartera .procesarRESPALDO").click(function () {
                var tiporeporte = $("#tiporeportecartera").val();
                var fechacartera = $("#fechacartera").val();
                var fechacobro = $("#fechacobro").val();
                var categoria = $("#tipocategoria").val();

                if(tiporeporte == 'CARTERARUBRO')
                    accion = "reporte_cartera_vencida_general_rubro_version_final";
                else if(tiporeporte == 'CARTERACATEGORIA')
                    accion = "reporte_cartera_vencida_general_rubro_por_categoria_version_final";
                else
                    accion = "reporte_cartera_vencida_general_vs_cobros_rubro_version_final";

                if(datosCompletosReporteCartera(tiporeporte)) {
                    bloqueointerface();
                    $.ajax({
                        type: "GET",
                        url: "/rec_consultaalumnos",
                        data: {"action": accion, "fechacartera": fechacartera, "fechacobro": fechacobro, "categoria": categoria},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                location.href = data.archivo;
                                $("#itemspanelreportecartera").modal('hide');
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error de conexión");
                        },
                        dataType: "json"
                    });
                }
            });

            $("#itemspanelreportecartera .procesar").click(function () {
                var tiporeporte = $("#tiporeportecartera").val();
                var fechacartera = $("#fechacartera").val();
                var fechacobro = $("#fechacobro").val();
                var categoria = $("#tipocategoria").val();

                if(tiporeporte == 'CARTERARUBRO')
                    accion = "reporte_cartera_vencida_general_rubro_version_final_background";
                else if(tiporeporte == 'CARTERACATEGORIA')
                    accion = "reporte_cartera_vencida_general_rubro_por_categoria_version_final";
                else
                    accion = "reporte_cartera_vencida_general_vs_cobros_rubro_version_final_background";

                if(datosCompletosReporteCartera(tiporeporte)) {
                    bloqueointerface();
                    $.ajax({
                        type: "GET",
                        url: "/rec_consultaalumnos",
                        data: {"action": accion, "fechacartera": fechacartera, "fechacobro": fechacobro, "categoria": categoria},
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                if(accion == "reporte_cartera_vencida_general_rubro_version_final_background"  || accion == "reporte_cartera_vencida_general_vs_cobros_rubro_version_final_background"){
                                    $("#itemspanelreportecartera").modal('hide');

                                    $('#btnNotificacionTareas').html(data.btn_notificaciones);
                                    mensajeSuccess(data.mensaje)
                                }else{
                                    location.href = data.archivo;
                                    $("#itemspanelreportecartera").modal('hide');
                                }
                            } else {
                                $.unblockUI();
                                mensajeErrorSwal("No se puede consultar", data.mensaje);
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            mensajeErrorSwal("No se puede consultar", "Error de conexión")
                        },
                        dataType: "json"
                    });
                }
            });

            $("#itemspanelreportecartera .cerrar").click(function () {
                $("#itemspanelreportecartera").modal('hide');
            });

            datosCompletosReporteCartera = function (tiporeporte){
                var c1e = true;

                if(tiporeporte == 'CARTERACATEGORIA'){
                    if($("#tipocategoria").val() ==''){
                        mensajeWarningSwal("Atención!!!", "Seleccione la categoría");
                        c1e = false;
                        return false;
                    }
                }

                return c1e;
            };

            $(".reporteretiradosacp").click(function() {
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/rec_consultaalumnos",
                    data: {"action": "reporte_retirados_acp"},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result=='ok'){
                            location.href = data.archivo;
                        } else {
                            $.unblockUI();
                            if(data.swalType == 'warning')
                                mensajeWarningSwal(data.titulo, data.mensaje);
                            else
                                mensajeErrorSwal(data.titulo, data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos");
                    },
                    dataType: "json"
                });
            });

            {% if programassincosto %}
                mostrarProgramasCostoCero();
            {% endif %}

            $("#fechafin2").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });

            $("#exportar2").click(function () {
                $("#ficherofacturamodal2").modal({'width': '400px'}).modal('show');
            });

            $('#descargar_reporte_detallado').click(function () {
                var fechaf = $("#fechafin2").val();
                {#window.location.href = '/adm_criteriosactividadesdocente?action=reportetutoria&estado='+estado+'&fdesde='+fdesde+'&fhasta='+fhasta#}
                openwindow('POST', '/rec_consultaalumnos', {action: 'reporte_detallado_general', 'fechaf': fechaf}, '_blank');

                $('#ficherofacturamodal2').modal('hide');
            });

            $('.reporte_cartera_vencida_deudores').click(function () {
                $('#fecha_desde').val('')
                $('#fecha_hasta').val('')
                $('#modal_reportes2').modal({backdrop: 'static', width: '450px'}).modal('show');
                $('#cohorte_group2').fadeIn();

                $('#id_cohorte2').empty().append('<option value="0">TODAS LAS CARRERAS CON DEUDORES</option>').val(0).trigger("change");

                $.ajax({
                    type: "GET",
                    url: `{{ request.path }}`,
                    data: {'action': 'cargar_carreras_ofer'},
                    success: function (data) {
                        if (data.result == 'ok') {
                            for (elemento in data.lista) {
                                $('#id_cohorte2').append('<option value="' + data.lista[elemento].id + '">' + data.lista[elemento].id + ' - ' + data.lista[elemento].nombre + '</option>');
                            }
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        smoke.alert("Error de conexion.");
                    },
                    dataType: "json"
                });

            });

            $('#descargar_reporte_cartera_deudores').click(function () {
                var carrera = $('#id_cohorte2').val();
                var fdesde = $('#fecha_desde').val();
                var fhasta = $('#fecha_hasta').val();

                openwindow('GET', '/rec_consultaalumnos', {
                    action: 'reportecarteravencida',
                    'carrera': carrera,
                    'desde': fdesde,
                    'hasta': fhasta
                }, '_blank');

                $('#modal_reportes2').modal('hide');
            });
        });

        function formModal(id, text, action) {
            var codigoperiodo = $("#periodos").val();
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': codigoperiodo,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbodymatricula').html(data.data);
                        $('#itemspanelmatricula .paneltitlematricula').html(text);
                        $("#itemspanelmatricula").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }
    </script>
    <script src="/static/adicionalesjs/formquestion.js?0.24"></script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    <div class="modal fade static" id="itemspanelmatricula" style="display: none;">
        <div class="modal-header">
            <h4><i class="fa fa-list"></i> <b class="paneltitlematricula">FORMULARIO MODAL</b></h4>
        </div>
        <div class="modal-body">
            <form class="form-horizontal form-modal" autocomplete="off" method="post"
                  enctype="multipart/form-data" action="{{ request.path }}">
                {% csrf_token %}
                <div class="row-fluid panelbodymatricula">
                </div>
            </form>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <h4>{{ title }} </h4>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div class="btn-group">
                <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">&nbsp;Reportes<span class="caret"></span></a>
                <ul class="dropdown-menu pull-left">
                    <li><a href="javascript:;" class="reporteanual"><span class="fa fa-print"></span> Presupuesto Anual</a></li>
                    <li><a href="/rec_consultaalumnos?action=reporte_general"> <i class='fa fa-print'></i> Presupuesto General</a></li>
                    <li><a href="/rec_consultaalumnos?action=reporte_cobranzas_general"> <i class='fa fa-print'></i> Resumen Cobranzas</a></li>
                    <li><a href="/rec_consultaalumnos?action=reporte_beca_general"><i class="fa fa-file-excel-o "></i> Reporte Becas General</a></li>
                    <li><a href="/rec_consultaalumnos?action=reporte_retirado_general"><i class="fa fa-file-excel-o "></i> Reporte Retirados General</a></li>
                    <li><a href="/rec_consultaalumnos?action=reporte_detallado_docentes"><i class="fa fa-file-excel-o "></i> Listado de docentes</a></li>
                    <li><a href="javascript:;" id="exportar"><i class="fa fa-file-excel-o "></i> Reporte Detallado General</a></li>
                    {#                    {% if persona.id == 25304  %}#}
                    <div class="divider-line"></div>
                    <li><a href="javascript:;" class="reportecarteravencidageneral" titulo="Reporte de Cartera vencida general (Detalle Rubros)" tiporeporte="CARTERARUBRO"><span class="fa fa-file-excel-o"></span> Cartera Vencida General (Detalle Rubros)</a></li>
                    <li><a href="javascript:;" class="reportecarteravencidageneralcategoria" titulo="Reporte de Coactiva por Categoría" tiporeporte="CARTERACATEGORIA"><span class="fa fa-file-excel-o"></span> Coactiva por Categoría</a></li>
                    <li><a href="javascript:;" class="reportecarteravencidageneralcobros" titulo="Reporte de Cartera vencida general vs cobros (Detalle Rubros)" tiporeporte="COBRORUBRO"><span class="fa fa-file-excel-o"></span> Cartera Vencida General vs Cobros (Detalle Rubros)</a></li>
                    <li>
                        <a class="reporte_cartera_vencida_deudores" href="javascript:;">
                            <i class="fa fa-file-excel-o"></i> Cartera vencida (Detalle deudores)</a>
                    </li>
                    <div class="divider-line"></div>
                    <li><a href="javascript:;" class="reporteretiradosacp"><span class="fa fa-file-excel-o"></span> Maestrantes Retirados (ACP)</a></li>
                    <li><a href="/rec_consultaalumnos?action=reportematriculadosmaestrias"><i class="fa fa-file-excel-o "></i> Reporte de matriculados maestrías (listado) </a></li>
                    <li><a href="/rec_consultaalumnos?action=reportematriculadosmaestrias_cantidades"><i class="fa fa-file-excel-o "></i> Reporte de matriculados maestrías (cantidades) </a></li>

{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="1" titulo="Detalle Movimientos Mensuales"><span class="fa fa-file-excel-o"></span> Detalle Movimientos Mensuales</a></li>#}
{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="2" titulo="Vencimientos Mensuales"><span class="fa fa-file-excel-o"></span> Vencimientos Mensuales</a></li>#}
{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="3" titulo="Pagos Mensuales"><span class="fa fa-file-excel-o"></span> Pagos Mensuales</a></li>#}
{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="4" titulo="Resumen Mensual de Movimientos"><span class="fa fa-file-excel-o"></span> Resumen Mensual de Movimientos</a></li>#}
{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="5" titulo="Edad Cartera Vencida"><span class="fa fa-file-excel-o"></span> Edad Cartera Vencida</a></li>#}
{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="6" titulo="Proyección de Cobros"><span class="fa fa-file-excel-o"></span> Proyección de Cobros</a></li>#}
{#                    <li><a href="javascript:;" class="reportedetallemensual" tiporeporte="7" titulo="Índice de Cartera vencida"><span class="fa fa-file-excel-o"></span> Índice de Cartera vencida</a></li>#}

                    {#                    {% endif %}#}
                </ul>
            </div>
            <a href="/rec_consultaalumnos?action=listadopostulacionesmaestrias" class='btn btn-success bloqueo_pantalla'><i class="fa fa-list "></i> Configuración de financiamiento maestrías</a>
            {#            {% if perms.sga.puede_agregar_valor_maestria %}#}
            <a href="/rec_consultaalumnos?action=configuracionvalores" class='btn btn-default'><i class="fa fa-cogs "></i> Configuración valores maestrias</a>
            {#            {% endif %}#}
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <a onclick="formModal('0','ADICIONAR INSCRIPCIÓN','addmatriculadonovigente')"
               href="javascript:void(0);" class="btn btn-success"><i class="fa fa-plus"></i> Adicionar</a>
            <form class="form-search">
                <div class="date-fields-container span12" style="display: flex;">
                        <!-- Desde -->
                        <fieldset style="flex: 1; margin-right: 10px;">
                            <div>
                                <div class="controls">
                                    <i class="fa fa-calendar tu" title="Desde"></i> Desde:
                                    <div class="input-group mb-2">
                                        <input type='date' id='desde' value='{{ desde }}' autocomplete="off" name="desde" placeholder="Desde"
                                               style="width: 100%"/>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <!-- Hasta -->
                        <fieldset style="flex: 1;margin-right: 10px;">
                            <div>
                                <div class="controls">
                                    <i class="fa fa-calendar tu" title="Hasta"></i> Hasta:
                                    <div class="input-group mb-2">
                                        <input type='date' id='hasta' value='{{ desde }}' autocomplete="off" name="hasta" placeholder="Hasta"
                                               style="width: 100%"/>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset style="flex: 1;">
                            <div>
                                <div class="controls">
                                    <i class="fa fa-search tu" title="Search"></i> Búsqueda:
                                    <div class="input-group mb-2">
                                        <input type='text' id='search' value='{{ search }}' autocomplete="off" name="search" placeholder="Buscar por cédula, pasaporte, nombre, apellidos..."
                                               style="width: 100%"/>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                <fieldset>
                    <label class="control-label">Per&iacute;odo</label>
                    <div class="controls">
                        <select id="periodos">
                            <option value="">-----</option>
                            {% for p in periodos %}
                                <option value="{{ p.id }}" {% if pid == p.id %}selected{% endif %}>{{ p }}</option>
                            {% endfor %}
                        </select><br>
                    </div>
                </fieldset>
                <fieldset>
                    <label class="control-label">Carrera</label>
                    <div class="controls">
                        <select id="carreras">
                            <option value="">-----</option>
                        </select>
                    </div>
                </fieldset>
                {#                <fieldset class="control-group nomargins">#}
                {#                    <label class="control-label">Estudiante</label>#}
                {#                    <div class="controls">#}
                {#                        <select id="estudiantes">#}
                {#                            <option value="">-----</option>#}
                {#                        </select>#}
                {#                    </div>#}
                {#                </fieldset>#}
            </form>
        </div>
        <div class="row-fluid">
            <div class="span12" id="segmento">
                {#                AQUI VA LA TABLA DE CONSULTA#}
            </div>
        </div>
        <div class="modal fade static" id="modalrespuestas" style="display: none;">
            <div class="modal-header">
                <div style="text-align: right"></div>
                <h4 id="paneltitle"></h4>
                <table style="background-color: transparent" width="100%" border="0">
                    <tbody><tr class="">
                        <td style="width: 80%"><h3 class="paneltitle">Adicionar Rubro Matrícula</h3></td>
                        <td><a href="javascript:;" id="add_cancelpre" class="btn btn-danger btn-mini pull-right"><i class="fa fa-remove"></i></a></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-body panelbody">
                <div class="alert alert-info incompletoaddrespuestas" style="display: none;">
                    <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                </div>
                <div class="well" style="margin-bottom: 3px;padding: 10px;" id="nombrepersona">
                    cg
                </div>
                <div style="overflow:scroll; height:350px;"><input type="hidden" id="idmatricula" name="idmatricula" value="0">
                    <table class='table table-bordered' cellpadding="0" cellspacing="0" id="tablerespuestas">
                        <thead>
                        <tr>
                            <th width="25px" style="text-align: center; font-weight: bold;">Matricula<input type="checkbox" id="todos1"></th>
                            <th width="600px" style="text-align: center; font-weight: bold;">Rubro</th>
                            <th width="100px" style="text-align: center; font-weight: bold;">Valor</th>
                            <th width="100px" style="text-align: center; font-weight: bold;">Emitido</th>
                            <th width="100px" style="text-align: center; font-weight: bold;">Vence</th>
                            <th width="100px" style="text-align: center; font-weight: bold;">Cancelado</th>
                        </tr>
                        </thead>
                        <tbody id="idbodyrespuestas">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <p style="text-align: right; margin-bottom: 0">
                    <a href="javascript:;" id="adicionar_rubro" class='btn btn-success'> Guardar</a>
                </p>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel2" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Reporte Presupuesto Anual</h3>
        </div>
        <div class="modal-body panelbody">
            <div class=ow-fluid">
                <form id="form3" style="width: 100%; margin-bottom: 0px;padding-left: 0px;padding-top: 0px; padding-right: 0px; padding-bottom: 0px">
                    <table class="table table-bordered" id="reporte_anual" >
                        <tbody>
                        <tr>
                            <td>Tipo de Reporte:</td>
                            <td colspan="3">
                                <select id="tiporeporteanual" name="tiporeporteanual" style="width: 95%">
                                    {#                                        <option value="" selected>---------</option>#}
                                    <option value="1" selected>ANUAL</option>
                                    <option value="2">RANGO DE FECHAS</option>
                                </select>
                            </td>
                        </tr>
                        <tr id="fila_anio">
                            <td>Año:</td>
                            <td colspan="4"><input style="width: 95%;" type="text" id="anioreporte" value="{{ anio }}"></td>
                        </tr>
                        <tr id="fila_fechas">
                            <td width="25%">Desde:</td>
                            <td width="25%"><input type="text" class="selectorfecha" id="fechadesde" name="fechahasta" value="{{ fecha|date:'Y-m-d' }}" readonly style="cursor:text; background-color: #FFFFFF;"/></td>
                            <td width="25%">Hasta:</td>
                            <td width="25%"><input type="text" class="selectorfecha" id="fechahasta" name="fechahasta" value="{{ fecha|date:'Y-m-d' }}" readonly style="cursor:text; background-color: #FFFFFF;"/></td>
                        </tr>
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="itemspanel_adicionar_2"><i class="fa fa-check"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel_cerrar_2"><i class="fa fa-close"></i> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelreportecartera" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitlereportecartera">Reporte Presupuesto Anual</h3>
        </div>
        <div class="modal-body panelbody">
            <div class=ow-fluid">
{#                <form id="form3" style="width: 100%; margin-bottom: 0px;padding-left: 0px;padding-top: 0px; padding-right: 0px; padding-bottom: 0px">#}
                    <table class="table table-bordered" id="reporte_cartera" >
                        <tbody>
                        <tr id="fila_fecha_cartera">
                            <td width="40%">Fecha Corte Cartera:<input type="hidden" id="tiporeportecartera" name="tiporeportecartera" value=""></td>
                            <td width="60%"><input type="text" class="selectorfecha" id="fechacartera" name="fechacartera" value="{{ fecha|date:'Y-m-d' }}" readonly style="cursor:text; background-color: #FFFFFF;"/></td>
                        </tr>
                        <tr id="fila_fecha_cobro">
                            <td width="40%">Fecha Corte Cobros:</td>
                            <td width="60%"><input type="text" class="selectorfecha" id="fechacobro" name="fechacobro" value="{{ fecha|date:'Y-m-d' }}" readonly style="cursor:text; background-color: #FFFFFF;"/></td>
                        </tr>
                        <tr id="fila_categoria">
                            <td width="40%">Categoría:</td>
                            <td width="60%">
                                <select id="tipocategoria" name="tipocategoria" style="width: 95%">
                                    <option value="" selected>---------</option>
                                    <option value="D" selected>CATEGORÍA D</option>
                                    <option value="E">CATEGORÍA E</option>
                                    <option value="D Y E">CATEGORÍA D Y E</option>
                                </select>
                            </td>
                        </tr>
                        </tbody>
                    </table>
{#                </form>#}
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success procesar" id="itemspanel_adicionar_21"><i class="fa fa-check"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-info cerrar" id="itemspanel_cerrar_22"><i class="fa fa-close"></i> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Novedad Matricula</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="row-fluid">
                <form id="form2" class="form-horizontal form-modal" style="width: 670px; margin-bottom: 0">
                    <input type='hidden' name='action' id="action" value='novedad_matricula'/>
                    <input type='hidden' name='idmatricula1' id='idmatricula1' value=''/>
                    <input type='hidden' name='idnovedad' id='idnovedad' value='0'/>
                    {% for field in form2 %}
                        {% if field.field.widget.attrs.separator %}
                            <div style="width: 100%; height: 1px; float: left;"></div>
                        {% endif %}
                        <fieldset id="fieldset_{{ field.name }}" class="control-group nomargins" style="min-height:35px; float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}" >
                            <div class="control-label label-text" {% if field.field.widget.attrs.labelwidth %}labelwidth="{{ field.field.widget.attrs.labelwidth }}"{% endif %} style="display: table;height: 30px;">
                                <div style="display: table-cell; vertical-align: middle; line-height: 11px">
                                    <label for="id_{{ field.name }}" style="padding-right: 20px">{{ field.label }}</label>
                                </div>
                            </div>
                            <div class="control" style="float: left; width: {% if field.field.widget.attrs.controlwidth %}{{ field.field.widget.attrs.controlwidth }}{% else %}0{% endif %}">
                                {% if field.field.widget.attrs.select2search %}
                                    <select id="id_{{ field.name }}_select2" {% if field.field.widget.attrs.disabled %}disabled=""{% endif %} >
                                        <option value="0" selected="selected">---------</option>
                                    </select>
                                    <input name="{{ field.name }}" id="id_{{ field.name }}" value="{{ field.value }}" hidden="hidden" {% if field.field.widget.attrs.descripcion %}descripcion="{{ field.field.widget.attrs.descripcion }}"{% endif %} class="select2hidden">
                                {% else %}
                                    {{ field }}
                                {% endif %}
                                <p class="help-text" style="font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px">{{ field.help_text }} </p>
                            </div>
                        </fieldset>
                    {% endfor %}
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="itemspanel_adicionar"><i class="fa fa-plus"></i> Guardar</a>
            <a href="javascript:;" class="btn btn-success" id="itemspanel_editar"><i class="fa fa-plus"></i> Actualizar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel_cerrar"> Cerrar</a>
        </div>
    </div>
    <div class="modal static" id="itemspanel3" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Bloqueo Matricula</h3>
        </div>
        <div class="modal-body" id="afinidadbody">
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="itemspanel3_adicionar"><i class="fa fa-plus"></i> Guardar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanel3_cerrar"> Cerrar</a>
        </div>
    </div>

    <div class="modal static" id="itemspanelporcentaje" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Presupuesto General</h3>
        </div>
        <div class="modal-body" id="bodyporcentaje">
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="itemspanelporcentaje_adicionar"><i class="fa fa-print"></i> Generar</a>
            <a href="javascript:;" class="btn btn-info" id="itemspanelporcentaje_cerrar"><i class="fa fa-close"></i> Cerrar</a>
        </div>
    </div>

    <div class="modal static" id="itemspanelcalculosdescuento" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Cálculos por Descuento aplicado</h3>
        </div>
        <div class="modal-body" id="bodycalculosdescuento">
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-info" id="itemspanelcalculosdescuento_cerrar"><i class="fa fa-close"></i> Cerrar</a>
        </div>
    </div>


    <div class="modal fade static" id="ficherofacturamodal" style="display: none;">
        <div class="modal-header">
            <h4>Descargar archivo</h4>
        </div>
        <div class="modal-body" id="cerrarpanelpanelbody">
            <div class="row-fluid">
                <div style="margin-bottom: 5px; float: left">
                    Fecha Inicio: <input type="text" id="fechainicio" class="selectorfecha" value="{{ fecha|date:'d-m-Y' }}">
                </div>
                <div style="margin-bottom: 5px; margin-left: 15px; float: left">
                    Fecha Corte: <input type="text" id="fechafin" class="selectorfecha" value="{{ fecha|date:'d-m-Y' }}">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-generar btn-success">Generar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelvalidardocumentocompromiso" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlevalidardocumentocompromiso">Revisar y Validar Justificativo</h4></td>
                    <td><a href="javascript:;" id="cerrar2" title="Cerrar" class="btn btn-danger btn-mini pull-right"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyvalidardocumentocompromiso">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success guardar" id="guardar"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger" id="cerrar"> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" data-keyboard="false" id="itemspanelreporteposgrado" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitlereporteposgrado">Reporte Presupuesto Anual</h4>
        </div>
        <div class="modal-body panelbody">
            <div class=ow-fluid">
                <form id="formReportePosgrado" style="width: 100%; margin-bottom: 0px;padding-left: 0px;padding-top: 0px; padding-right: 0px; padding-bottom: 0px">
                    <table class="table table-bordered" id="reporte_posgrado" >
                        <tbody>
                        <tr>
                            <td style="width: 15%;">Año:<input type="hidden" id="tiporeporteposgrado" name="tiporeporteposgrado" value=""> </td>
                            <td style="width: 35%;">
                                <select id="aniorepposgrado" name="aniorepposgrado" style="width: 95%">
                                    <option value="0" selected>---------</option>
                                    {% for anio in aniosreporte %}
                                        <option value="{{ anio }}">{{ anio }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td style="width: 15%;">Mes:</td>
                            <td style="width: 35%;">
                                <select id="mesrepposgrado" name="mesrepposgrado" style="width: 95%">
                                    <option value="0" selected>---------</option>
                                    {% for mes in mesesreporte %}
                                        <option value="{{ mes.0 }}">{{ mes.1|upper }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-procesar btn-success"><i class="fa fa-check"></i> Procesar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-info"><i class="fa fa-close"></i> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" data-keyboard="false" id="itemspanelprogramassincosto" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitleprogramassincosto">Programas de Maestría sin Costo configurado</h4>
        </div>
        <div class="modal-body panelbody">
            <div style="text-align: justify" class="alert alert-error" role="alert">
                <strong>Existen programas de maestría que no tienen configurado el costo por periodo académico</strong>
            </div>
            <div class=ow-fluid">
                <table class="table table-bordered table-striped table-condensed table-hover table-even-widths" id="tbprogramas">
                    <thead>
                        <th style="width: 35%; text-align: center;">Programa</th>
                        <th style="width: 35%; text-align: center;">Periodo</th>
                        <th style="width: 15%; text-align: center;">Fecha inicio</th>
                        <th style="width: 15%; text-align: center;">Fecha fin</th>
                    </thead>
                    <tbody>
                        {% for programa in programassincosto %}
                            <tr>
                                <td style="text-align: justify">{{ programa.0 }}</td>
                                <td style="text-align: justify">{{ programa.1 }}</td>
                                <td style="text-align: center">{{ programa.2|date:"Y-m-d" }}</td>
                                <td style="text-align: center">{{ programa.3|date:"Y-m-d" }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar btn-info"><i class="fa fa-close"></i> Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="ficherofacturamodal2" style="display: none;">
        <div class="modal-header">
            <h4>Descargar archivo</h4>
        </div>
        <div class="modal-body" id="cerrarpanelpanelbody2">
            <div class="row-fluid">
                {#                <div style="margin-bottom: 5px; float: left">#}
                {#                    Fecha Desde: <input type="text" id="fechainicio" class="selectorfecha" value="{{ fecha|date:'d-m-Y' }}">#}
                {#                </div>#}
                <div style="margin-bottom: 5px; margin-left: 15px; float: left">
                    Fecha Corte: <input type="text" id="fechafin2" class="selectorfecha" value="{{ fecha|date:'d-m-Y' }}">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a class="btn btn-info " id="descargar_reporte_detallado"><i class="fa fa-plus"></i> Descargar Reporte</a>
{#            <a href="javascript:;" class="btn btn-success" id="descargar_reporte_detallado">Generar</a>#}
            <a href="javascript:;" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-window-close"></i>Cerrar</a>

            {#            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>#}
        </div>
    </div>

    <div class="modal fade static" data-keyboard="false" id="itemspanelrubrosadicionales" style="display: none;">
        <div class="modal-header">
            <h4 class="paneltitlerubrosadicionales">Rubros Adicionales</h4>
        </div>
        <div class="modal-body panelbodyrubrosadicionales">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="modal fade static" id="modal_reportes2" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Reporte de Cartera vencida (Detalle deudores)</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="row-fluid">
                <div class="span12">
                    <div class="form-group" id="cohorte_group2">
                        <label for="id_cohorte2"><b>Carrera:</b></label>
                        <select name="cohortes" class="form-control select2-hidden-accessible"
                                id="id_cohorte2" multiple="" tabindex="-1" aria-hidden="true" style="width: 100%">
                            {#                            <option value="0">TODOS</option>#}
                        </select>
                    </div>

                    <div class="form-group mt-3" id="fechas_group2">
                        <div class="span6">
                            <label for="fecha_desde"><b>Fecha inicio:</b></label>
                            <input class="form-control " type="text" name="fecha_desde" id="fecha_desde"
                                   placeholder="Fecha Inicio"></div>
                        <div class="span6">
                            <label for="fecha_hasta"><b>Fecha Fin:</b></label>
                            <input class="form-control" type="text" name="fecha_hasta" id="fecha_hasta"
                                   placeholder="Fecha Fin">
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a class="btn btn-info" id="descargar_reporte_cartera_deudores"><i class="fa fa-plus"></i> Descargar</a></td>
                    <td><a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>

{% endblock %}

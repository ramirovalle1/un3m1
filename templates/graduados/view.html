{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}
    <link href="/static/widget_ppp.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <style type="text/css">
        .table-borderless td {
            border: 0;
        }
        .offcanvas-header {
            background-color: #1c3247;
            height: 68px;
            align-items: center;
            border-bottom: 10px solid #FE9900 ;
        }

        #offcanvasRightLabel {
            font-size: 15px;
            color: white;
            font-family: 'Arial',
            sans-serif;
            padding-top: 12px;
        }

        a h4 {
            padding-left: 20px; padding-bottom: 15px; padding-top: 15px
        }

        a h4:hover,
        .accordion-button:hover{
            background-color: #D6EAF8;
        }

        .accordion-button{
            background-color: #fff;
        }

        .btn-close {
            background: transparent url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3E%3Cpath d='M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z'/%3E%3C/svg%3E") 50%/.75rem auto no-repeat !important;
            border: 0;
            border-radius: .25rem;
            box-sizing: content-box;
            color: #fff;
            height: .75rem;
            opacity: 1;
            font-weight: bold;
            padding: .25em;
            width: .75rem
        }

    </style>
    <style type="text/css">
        .searchinput {
        {% if search %}
            max-width: 220px !important;
        {% else %}
            max-width: 250px !important;
        {% endif %}
            min-width: 100px !important;
        }

        .radio label,
        .checkbox label {
            display: inline-block;
            cursor: pointer;
            color: #0074D9;
            position: relative;
            padding: 5px 15px 5px 51px;
            font-size: 1em;
            border-radius: 5px;
            -webkit-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
        }

        .radio label:hover,
        .checkbox label:hover {
            background: rgba(255, 65, 54, 0.1);
        }

        .radio label:before,
        .checkbox label:before {
            content: "";
            display: inline-block;
            width: 17px;
            height: 17px;
            position: absolute;
            left: 15px;
            border-radius: 50%;
            background: none;
            border: 3px solid #0074D9;
        }

        input[type="radio"] {
            display: none;
        }

        input[type="radio"]:checked + label:before {
            display: none;
        }

        input[type="radio"]:checked + label {
            padding: 5px 15px;
            background: #0074D9;
            border-radius: 2px;
            color: #fff;
        }

        .checkbox label:before {
            border-radius: 3px;
        }

        .checkbox input[type="checkbox"] {
            display: none;
        }

        .checkbox input[type="checkbox"]:checked + label:before {
            display: none;
        }

        .checkbox input[type="checkbox"]:checked + label {
            background: #0074D9;
            color: #fff;
            padding: 5px 15px;
        }
    </style>
    <script type="text/javascript">

        var busqueda = function (page/*=undefined*/) {
            var term = $("#searchinput").val().toUpperCase().trim();
            var idc = $("#carrera_list").val();
            var ida = $("#anio_list").val();
            var idg = $('[name="filter_sexo"]:checked').val();
            page = typeof page == 'undefined' ? 1 : page;
            if (term.length > 0) {
                bloqueointerface();
                location.href = `/graduados?s=${term}&idc=${idc}&ida=${ida}&idg=${idg}&page=${page}`;
            } else {
                bloqueointerface();
                location.href = `/graduados?&idc=${idc}&ida=${ida}&idg=${idg}&page=${page}`;
            }
            return false;
        };

        function formModal2(id, text, action) {
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {

                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody').html(data.data);
                        $('#itemspanel .paneltitle').html(text);
                        $("#itemspanel").modal({backdrop: 'static', width: '200'}).modal('show');
                    } else {
                        debugger;
                        alertaSuccess(data.mensaje);
                    }
                },
                error: function (data) {
                    $.unblockUI();
                    alertaDanger("Error de conexion");
                },
                dataType: "json"
            });
        }

        $(function () {
            var h =$(window).height() - 332;
            var table = $('#tablegraduado').DataTable({
                "sPaginationType": "full_numbers",
                "sDom": 'T<"clear">lfrtip',
                "paging":   false,
                "ordering": false,
                "info":     false,
                "searching": false,
                "language": {
                    "zeroRecords": "NO HAY GRADUADOS"
                },
                {#                "scrollY": h,#}
                "order": [[ 2, 'asc' ]],
                "columnDefs": [{ "visible": false,"targets": 2 },{
                    width: "300px",
                    targets: 0
                }],
                "drawCallback": function ( settings ) {
                    var api = this.api();
                    var rows = api.rows( {page:'current'} ).nodes();
                    var last=null;
                    api.column(2, {page:'current'} ).data().each( function ( group, i ) {
                        if ( last !== group ) {
                            $(rows).eq( i ).before(
                                '<tr class="group"><td colspan="13" height="30" bgcolor="#f1f1f1"><strong>'+group+'</strong></td></tr>'
                            );
                            last = group
                        }
                    });
                    $('[data-toggle="tooltip"]').tooltip();
                }
            });

            $("select").select2({with: "100%", minimumResultsForSearch: 10});

            $('[name="filter_sexo"]').change(function () {
                busqueda();
            });


            $("#search").click(function () {
                busqueda();
            });

            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });

            $("#carrera_list, #anio_list").change(function () {
                busqueda();
            });
            /*$("#carrera_list").change(function () {
                bloqueointerface();
                var id = $(this).val();
                if($('#idgent').val()&& $('#idanit').val()&& id>0){
                    var idgent=$('#idgent').val();
                    var idanit=$('#idanit').val();
                    location.href = "/graduados?idcar="+id+"&idgen="+idgent+"&idanio="+idanit;
                }else{
                    if($('#idgent').val()&& id>0) {
                        var idgent = $('#idgent').val();
                        location.href = "/graduados?idcar=" + id + "&idgen=" + idgent;
                    }else{
                        if($('#idanit').val()&& id>0) {
                            var idanit = $('#idanit').val();
                            location.href = "/graduados?idcar=" + id + "&idanio=" + idanit;
                        }else{
                            if (id>0){
                                location.href = "/graduados?idcar="+id;
                            }else{
                                if($('#idgent').val()&&$('#idanit').val()){
                                    var idgent = $('#idgent').val();
                                    var idanit = $('#idanit').val();
                                    location.href = "/graduados?idgen=" + idgent + "&idanio=" + idanit;
                                }else{
                                    if($('#idgent').val()){
                                        var idgent = $('#idgent').val();
                                        location.href = "/graduados?idgen=" + idgent ;
                                    }else{
                                        if($('#idanit').val()){
                                            var idanit = $('#idanit').val();
                                            location.href = "/graduados?idanio=" + idanit;
                                        }else{
                                            location.href = "/graduados";
                                        }
                                    }

                                }
                            }
                        }
                    }
                }
            });
            $("#sexo_list").change(function () {
                bloqueointerface();
                var id = $(this).val();
                if($('#idcart').val()&& $('#idanit').val()&& id>0){
                    var idcart=$('#idcart').val();
                    var idanit=$('#idanit').val();
                    location.href = "/graduados?idcar="+idcart+"&idgen="+id+"&idanio="+idanit;
                }else{
                    if($('#idcart').val()&& id>0) {
                        var idcart = $('#idcart').val();
                        location.href = "/graduados?idcar=" + idcart + "&idgen=" + id;
                    }else{
                        if($('#idanit').val()&& id>0) {
                            var idanit = $('#idanit').val();
                            location.href = "/graduados?idgen=" + id + "&idanio=" + idanit;
                        }else{
                            if (id>0){
                                location.href = "/graduados?idgen="+id;
                            }else{
                                if($('#idanit').val()&&$('#idcart').val()){
                                    var idcart = $('#idcart').val();
                                    var idanit = $('#idanit').val();
                                    location.href = "/graduados?idcar=" + idcart + "&idanio=" + idanit;
                                }else{
                                    if($('#idcart').val()){
                                        var idcart = $('#idcart').val();
                                        location.href = "/graduados?idcar=" + idcart ;
                                    }else{
                                        if($('#idanit').val()){
                                            var idanit = $('#idanit').val();
                                            location.href = "/graduados?idanio=" + idanit;
                                        }else{
                                            location.href = "/graduados";
                                        }
                                    }

                                }
                            }
                        }
                    }
                }
            });
            $("#anio_list").change(function () {
                bloqueointerface();
                var id = $(this).val();
                if($('#idcart').val()&& $('#idgent').val()&& id>0){
                    var idcart=$('#idcart').val();
                    var idgent=$('#idgent').val();
                    location.href = "/graduados?idcar="+idcart+"&idgen="+idgent+"&idanio="+id;
                }else{
                    if($('#idcart').val()&& id>0) {
                        var idcart = $('#idcart').val();
                        location.href = "/graduados?idcar=" + idcart + "&idanio=" + id;
                    }else{
                        if($('#idgent').val()&& id>0) {
                            var idgent = $('#idgent').val();
                            location.href = "/graduados?idgen=" + idgent + "&idanio=" + id;
                        }else{
                            if (id>0){
                                location.href = "/graduados?idanio="+id;
                            }else{
                                if($('#idgent').val()&&$('#idcart').val()){
                                    var idcart = $('#idcart').val();
                                    var idgent = $('#idgent').val();
                                    location.href = "/graduados?idcar=" + idcart + "&idgen=" + idgent;
                                }else{
                                    if($('#idcart').val()){
                                        var idcart = $('#idcart').val();
                                        location.href = "/graduados?idcar=" + idcart ;
                                    }else{
                                        if($('#idgent').val()){
                                            var idgent = $('#idgent').val();
                                            location.href = "/graduados?idgen=" + idgent;
                                        }else{
                                            location.href = "/graduados";
                                        }
                                    }

                                }
                            }
                        }
                    }
                }
            });*/
            $("#id_fechainirural, #id_fechafinrural").addClass("validate[required]").datepicker({format: "yyyy-mm-dd"}).on('changeDate', function (ev) {
                $(this).datepicker('hide');
            })
            $(".modal_rural").click(function () {
                console.log("entro")
                $("#id_fechaini").val('');
                $("#id_fechafin").val('');
                $("#idoperativoadd").val('');
                $("#idoperativoadd").val(5);
                if ($("#carrera_list option:selected").val() == 0) {
                    alertaWarning("Seleccione carrera");

                    return false;
                }
                var carrera = $("#carrera_list option:selected").text();
                $(".carreraindicador").html(carrera);
                $("#alertaingresoaddindicadorrural").hide();
                $("#itemspaneladdacionesrural .incompletoaddindicadorrural").hide();
                $("#itemspaneladdacionesrural .incompletovaloresaddindicadorrural").hide();
                $("#generar_reporterural").show();
                $("#guardar").hide();
                $("#modaladdindicadoresrural").modal({backdrop: 'static', width: '250px'}).modal('show');
            });
            $("#generar_reporterural").click(function () {
                console.log("reporte")
                var id_fini = $("#id_fechainirural").val();
                var id_ffin = $("#id_fechafinrural").val();
                var carrera_list = $("#carrera_list").val();
                openwindow('GET', '/graduados', {action: 'excelgraduadosrural', fechainicio: id_fini, fechafin: id_ffin, carrera: carrera_list}, '_blank');
                $("#modaladdindicadoresrural").modal("hide");
            });
            $("#cerrarindicadoresaddrural").click(function () {
                $("#modaladdindicadoresrural .incompletoaddindicadoresrural").hide();
                $("#modaladdindicadoresrural .incompletovaloindicadoresrural").hide();
                $("#modaladdindicadoresrural").modal("hide");
            });
            $("#id_fechaini, #id_fechafin, #id_fechainidip, #id_fechafindip").addClass("validate[required]").datepicker({format: "yyyy-mm-dd"}).on('changeDate', function (ev) {
                $(this).datepicker('hide');
            })
            $(".modal_autoregistro").click(function () {
                console.log("entro")
                $("#id_fechaini").val('');
                $("#id_fechafin").val('');
                $("#idoperativoadd").val('');
                $("#idoperativoadd").val(5);
                if ($("#carrera_list option:selected").val() == 0) {

                    //smoke.alert("Seleccione carrera");
                    alertaWarning("Seleccione carrera");
                    return false;
                }
                var carrera = $("#carrera_list option:selected").text();
                $(".carreraindicador").html(carrera);
                $("#alertaingresoaddindicador").hide();
                $("#itemspaneladdaciones .incompletoaddindicador").hide();
                $("#itemspaneladdaciones .incompletovaloresaddindicador").hide();
                $("#generar_reporte").show();
                $("#guardar").hide();
                $("#modaladdindicadores").modal({backdrop: 'static', width: '250px'}).modal('show');
            });

            $(".modal_autoregistrodip").click(function () {
                console.log("entro")
                $("#id_fechainidip").val('');
                $("#id_fechafindip").val('');
                $("#idoperativoadd").val('');
                $("#idoperativoadd").val(5);
                if ($("#carrera_list option:selected").val() == 0) {
                    alertaWarning("Seleccione carrera");
                    return false;
                }
                var carrera = $("#carrera_list option:selected").text();
                $(".carreraindicador").html(carrera);
                $("#alertaingresoaddindicador").hide();
                $("#itemspaneladdaciones .incompletoaddindicador").hide();
                $("#itemspaneladdaciones .incompletovaloresaddindicador").hide();
                $("#generar_reportedip").show();
                $("#guardar").hide();
                $("#modaladdindicadoresdip").modal({backdrop: 'static', width: '250px'}).modal('show');
            });

            $("#generar_reporte").click(function () {
                var id_fini = $("#id_fechaini").val();
                var id_ffin = $("#id_fechafin").val();
                var cmbgenero = $("#cmbgenero").val();
                var carrera_list = $("#carrera_list").val();
                openwindow('GET', '/graduados', {action: 'excelgraduados', fechainicio: id_fini, cmbgenero: cmbgenero, fechafin: id_ffin, carrera: carrera_list}, '_blank');
                $("#modaladdindicadores").modal("hide");
            });

            $("#generar_reportedip").click(function () {
                alert('reporte');
                var id_fini = $("#id_fechainidip").val();
                var id_ffin = $("#id_fechafindip").val();
                var val_duracion = $("#id_duracion").val();
                var carrera_list = $("#carrera_list").val();
                openwindow('GET', '/graduados', {action: 'excelgraduadosdip', fechainicio: id_fini, fechafin: id_ffin,duracion:val_duracion, carrera: carrera_list}, '_blank');
                $("#modaladdindicadoresdip").modal("hide");
            });

            $("#generar_reportegraduadosposgrado").click(function () {
                var carrera_list = $("#carrera_list").val();
                openwindow('GET', '/graduados', {action: 'excelgraduadosposgrado', id: carrera_list}, '_blank');
            });

            $("#cerrarindicadoresadd").click(function () {
                $("#modaladdindicadores .incompletoaddindicadores").hide();
                $("#modaladdindicadores .incompletovaloindicadores").hide();
                $("#modaladdindicadores").modal("hide");
            });

            $("#cerrarindicadoresadd_dip").click(function () {
                $("#modaladdindicadoresdip .incompletoaddindicadores").hide();
                $("#modaladdindicadoresdip .incompletovaloindicadores").hide();
                $("#modaladdindicadoresdip").modal("hide");
            });

            $(".actafacultad").click(function () {
                $('#id_actafacultad').val(0).trigger("change");
                bloqueointerface();
                var idg = $(this).attr('idg');
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'graduadopersona', 'id': idg},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al enviar los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            $("#idg").val(idg);
                            if (data.idaf) {
                                $('#id_actafacultad').val(data.idaf).trigger("change");
                            }
                            $('#id_actafacultad').addClass("validate[required]");
                            $("#id_estudiante").val(data.estudiante);
                            $("#citamodal").modal({backdrop: 'static', width: '1200px',height: "400px"}).modal('show');
                        } else {
                            alertaDanger(data.mensaje);
                        }
                    }
                });
            });

            $('#cerrarcitamodal').click(function () {
                $('#citamodal').modal('hide');
            });

            $("#id_actafacultad").change(function () {
                $('#mensaje').hide();
            });

            $('#citamodal_run').click(function () {
                var idaf = $('#id_actafacultad').val();
                var idg = $("#idg").val();
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'addactafacultad', 'idaf': idaf, 'idg': idg},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al enviar los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            location.reload();
                            $('#citamodal').modal('hide');
                            return false;
                        } else {
                            $.unblockUI();
                            alertaDanger(data.mensaje);
                        }
                    }
                });
                return false;
            });
            $(".eliminarsubdecano").click(function () {
                var idg = $(this).attr('idg');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'delsubdecano', 'id': idg},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al enviar los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            $.unblockUI();
                            location.reload();
                        } else {
                            alertaDanger(data.mensaje);
                        }
                    }
                });
                return false;
            });
            $(".eliminarreprdocentep").click(function () {
                var idg = $(this).attr('idg');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'delrepresentantedocente', 'id': idg},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al enviar los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            $.unblockUI();
                            location.reload();
                        } else {
                            alertaDanger(data.mensaje);
                        }
                    }
                });
                return false;
            });

            $(".eliminarreprestudiantil").click(function () {
                var idg = $(this).attr('idg');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'delrepresentanteestudiantil', 'id': idg},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al enviar los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            $.unblockUI();
                            location.reload();
                        } else {
                            alertaDanger(data.mensaje);
                        }
                    }
                });
                return false;
            });

            $("#action_min").click(function () {
                $("#panel_filter .panel-body").hide();
                $("#action_min").hide();
                $("#action_max").show();
            });
            $("#action_max").click(function () {
                $("#panel_filter .panel-body").show();
                $("#action_min").show();
                $("#action_max").hide();
            });

            {% if not search and not ids and idc == 0 and idg == 0 and ida == 0 %}
                $("#action_min").trigger("click");
            {% else %}
                $("#action_max").trigger("click");
            {% endif %}

            $(".action_page").click(function () {
                var page = $(this).attr('page');
                busqueda(page);
            });
            $(".action_clean").click(function () {
                $('#searchinput').val("");
                busqueda();
            });
            $(".editposgrado").click(function () {
                $('#codigograduado').val($(this).attr('idgra'));
                $('#idnumeroacta').val($(this).attr('idnumero'));
                $("#modaladddetalle").modal({backdrop: 'static', width: '600px'}).modal('show');
            });

            $("#cancel_cancelardetalle").click(function () {
                $('#modaladddetalle').modal('hide');
            });

            $("#boton_adicionardetalle").click(function () {
                var codigograduado = $('#codigograduado').val();
                var idnumeroacta = $('#idnumeroacta').val();
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'editarnumeroacta', 'id': codigograduado, 'idnumeroacta': idnumeroacta},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al editar.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            location.reload();
                            $("#modaladddetalle").modal({backdrop: 'static', width: '600px'}).modal('show');
                        } else {
                            $.unblockUI();
                            alertaDanger(data.mensaje);
                        }
                    }
                });

            });

            $("#boton_notoficacionaprobada").click(function () {
                var idgraduadoposgrado = $('#idgraduadoposgrado').val();
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/graduados",
                    data: {'action': 'notificar_certificado', 'id': idgraduadoposgrado},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al obtener los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            $("#modalnotoficacion").modal({backdrop: 'static', width: '600px'}).modal('hide');
                            $.unblockUI();
                            location.reload();
                            alertaDanger(data.mensaje);
                        } else {
                            $.unblockUI();
                            alertaDanger(data.mensaje);
                        }
                    }
                });

            });

            $("#boton_notoficacionaprobadamasivo").click(function () {
                $('#modalnotoficacionmasivo').modal('hide');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/graduados",
                    data: {'action': 'reporte_generar_masivo'},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            {#$("#modalnotoficacionmasivo").modal({backdrop: 'static', width: '600px'}).modal('hide');#}
                            $.unblockUI();
                            location.reload();
                            alertaDanger(data.mensaje);
                        } else {
                            $.unblockUI();
                            alertaDanger(data.mensaje);
                        }
                    },
                    dataType: "json"
                });

            });

            $("#boton_notoficacionaprobadamasivowebpush").click(function () {
                $('#modalnotoficacionmasivowebpush').modal('hide');
                {#bloqueointerface();#}
                $.ajax({
                    type: "GET",
                    url: "/graduados",
                    data: {'action': 'reporte_generar_masivo_webpush'},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            {#$('.id_sincrinozar').addClass("fa-spin");#}
                            $('#btnNotificacionTareas').html(data.btn_notificaciones);
                            {#location.reload();#}
                            mensajeSuccess(data.mensaje)
                        } else {
                            $.unblockUI();
                            mensajeWarning(data.mensaje);
                            {#$('.id_sincrinozar').removeClass("fa-spin");#}
                        }
                    },
                    dataType: "json"
                });

            })


            // sólo notificar las insignias de forma masiva
            $("#boton_solonotificacionaprobadamasivo").click(function () {
                $('#modalsolonotificacionmasivo').modal('hide');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/graduados",
                    data: {'action': 'notificar_insignia_masivo'},
                    error: function () {
                        $.unblockUI();
                        alertaDanger("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            {#$("#modalnotoficacionmasivo").modal({backdrop: 'static', width: '600px'}).modal('hide');#}
                            $.unblockUI();
                            location.reload();
                            alertaDanger(data.mensaje);
                        } else {
                            $.unblockUI();
                            alertaDanger(data.mensaje);
                        }
                    },
                    dataType: "json"
                });

            });

            $("#cancel_notoficacioncancela").click(function () {
                $('#modalnotoficacion').modal('hide');
            });

            $("#cancel_notoficacioncancelamasivo").click(function () {
                $('#modalnotoficacionmasivo').modal('hide');
            });

            $("#cancel_notoficacioncancelamasivowebpush").click(function () {
                $('#modalnotoficacionmasivowebpush').modal('hide');
            });

            $("#cancel_solonotificacioncancelamasivo").click(function () {
                $('#modalsolonotificacionmasivo').modal('hide');
            });

            $(".certificado_view_pdf").click(function () {
                var id = $(this).attr('idi');
                {#debugger;#}
                openwindow('POST', '/graduados', {
                    action: 'reporte_certificadoprevio',
                    'id': id
                }, '_blank');
                {#aqui#}
                {#var id = $(this).attr('idi');#}
                {#bloqueointerface();#}
                {#debugger;#}
                {#$.ajax({#}
                {#    type: "POST",#}
                {#    url: "/graduados",#}
                {#    data: {'action': 'reporte_certificadoprevio', 'id': id},#}
                {#    error: function () {#}
                {#        $.unblockUI();#}
                {#        smoke.alert("Error al obtener los datos.");#}
                {#    },#}
                {#    success: function (data) {#}
                {#        if (data.result == "ok") {#}
                {#            $.unblockUI();#}
                {#            smoke.alert('Vista previa de Título generado');#}
                {#        } else {#}
                {#            $.unblockUI();#}
                {#            smoke.alert(data.mensaje);#}
                {#        }#}
                {#    }});#}
            });

        });

        {#function vistaprevia(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfacta', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function actagradoposgrado(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfactagradpoposgrado', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function vistapreviaex(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfactaexcomplexivo', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function vistapreviasusten(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfactasustentacion', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function vistapreviarubri(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfrubricasustentacion', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function vistaborrador(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfactaborrador', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function vistaborradorex(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfactaborradorexcom', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function vistarecord(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfactarecord', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        function vistarecordexcom(idinscripcion) {
            openwindow('POST', '/graduados', {action: 'pdfactarecordexcomp', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');
        }

        function mostrarenvio(idgraduado) {
            $('#idgraduadoposgrado').val(idgraduado);
            bloqueointerface();
            $("#modalnotoficacion").modal({backdrop: 'static', width: '600px'}).modal('show');
            $.unblockUI();
        }

        function mostrarenviomasivo() {
            bloqueointerface();
            $("#modalnotoficacionmasivo").modal({backdrop: 'static', width: '600px'}).modal('show');
            $.unblockUI();
        }

        function mostrarenviomasivowebpush() {
            bloqueointerface();
            $("#modalnotoficacionmasivowebpush").modal({backdrop: 'static', width: '600px'}).modal('show');
            $.unblockUI();
        }

        //notificar insignia masivo
        function solonotificacionmasivo() {
            bloqueointerface();
            $("#modalsolonotificacionmasivo").modal({backdrop: 'static', width: '600px'}).modal('show');
            $.unblockUI();
        }

        function generarcertificadosinnotificar(idinscrito) {
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/graduados",
                data: {'action': 'reporte_certificado', 'id': idinscrito},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {
                        $.unblockUI();
                        location.reload();
                        alertaSuccess(data.mensaje);
                    } else {
                        alertaSuccess(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    alertaDanger("Error al obtener los datos");
                },
                dataType: "json"
            });
        }

        {#function vistitulacion(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfcalificaciontitulacion', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function visexamencomplexivo(idinscripcion) {#}
        {#    openwindow('POST', '/graduados', {action: 'pdfcalificacionexamencomplexivo', id: idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#        function reportexcel(idinscripcion){#}
        {#            id_fini = $("#id_fini").val()#}
        {#            id_ffin = $("#id_ffin").val()#}
        {#            openwindow('GET' ,'/sistemasag', {action:'excelencuestados',idperiodo:{{ periodoencuesta.id }},fechainicio:id_fini,fechafin:id_ffin,x:1}, '_blank');#}
        {#        }#}

        function exportar_reportegraduados2() {
            $.ajax({
                type: "GET",
                url: "{{ request.path }}",
                data: {'action': 'reportegraduados2'},
                success: function(data) {
                    data.result ? mensajeSuccess(data.mensaje) : mensajeWarning(data.mensaje);
                },
                error: function() {
                    mensajeErrorSwal("Error de conexión.");
                },
                dataType: "json"
            });
        }
    </script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}

    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title }}</h3>

            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class='row'>
            <div class="btn-group">

                <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"
                        data-bs-toggle="dropdown" aria-expanded="false"> Acciones <span
                        class="fa fa-angle-down"></span></button>

                <ul class="dropdown-menu">
                    <li><a href="/graduados?action=listadoactasgrado" class="dropdown-item tu"><i class="fa fa-list"></i> Firmar actas</a></li>
                    <li><a href="javascript:void(0);" onclick="exportar_reportegraduados2()" class="dropdown-item tu"><i class="fa fa-list"></i> Alumnos Graduados</a></li>

                    <li><a href="javascript:;" class="dropdown-item btn-form" id="generar_reportegraduadosposgrado"><i class="fa fa-file-excel-o"></i> Graduados posgrado</a></li>

                    <li><a class="dropdown-item tu"
                           onclick="formModal2('{{ persona.id }}','IMPORTAR FECHA DE REFRENDACIÓN POSGRADO','importarrefrendacionpos')"
                    > <span class="fa fa-upload"></span> Importar fecha refrendación posgrado
                    </a></li>

                    <li><a  class="dropdown-item tu" onclick="mostrarenviomasivowebpush()"><i class="fa fa-spinner id_sincrinozar"></i> Generar títulos posgrado </a></li>

                    <li><a  class="dropdown-item tu" onclick="solonotificacionmasivo()"><i class="fa fa-envelope"></i> Notificar títulos posgrado</a></li>
                    {%  if puede_ver_opcion %}
                        <li><a  class="dropdown-item tu" onclick="mostrarenviomasivo()"><i class="fa fa-spinner"></i> Generar títulos e insignias posgrado</a></li>
                    {% endif %}
                </ul>
                <button class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" href="#"
                        aria-expanded="false"> Reportes <span
                        class="fa fa-angle-down"></span></button>
                <ul class="dropdown-menu">
                    <li><a href='javascript:;' class="dropdown-item modal_autoregistro tu"><i class="fa fa-file-excel"></i>   Autoregistro de Títulos</a></li>

                    <li><a href='javascript:;' class="dropdown-item modal_rural tu"><i class="fa fa-file-excel"></i> Reportes rurales</a></li>

                    <li><a href='javascript:;'  class="dropdown-item modal_autoregistrodip tu"><i class="fa fa-file-excel"></i>   Autoregistro de Títulos Posgrado</a></li>

                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-lg-3 col-sm-6">
                <b>Sexo:</b>
                <form class="form-search">

                    {% if sexo %}

                        <div class="radio">
                            <input type="radio" id="filter_sexo_all" name="filter_sexo" value="0" {% if idg == 0 %}checked="checked"{% endif %}>
                            <label class="tu" title="Ambos" for="filter_sexo_all"><i class="fa fa-venus-double"></i></label>
                            {% for s in sexo %}
                                <input type="radio" id="filter_sexo_{{ s.id }}" name="filter_sexo" value="{{ s.id }}" {% if idg == s.id %}checked="checked"{% endif %}>
                                <label class="tu" title="{{ s.nombre }}" for="filter_sexo_{{ s.id }}"><span class="label label-default"><i class="fa {% if s.id == 1 %}fa-female{% else %}fa-male{% endif %}"></i></span></label>
                            {% endfor %}
                        </div>

                    {% endif %}
                </form>
            </div>
            <div class="col-12 col-lg-1 col-sm-6">
                {% if anios %}
                    <b>Años:</b><br>
                    <form class="form-search" >
                        <select id="anio_list" style="width: 100%">
                            <option value="0" {% if ida == 0 %}selected{% endif %}>Todos los Años</option>
                            {% for a in anios %}
                                <option {% if ida == a %}selected{% endif %} value="{{ a }}">{{ a }}</option>
                            {% endfor %}
                        </select>
                    </form>
                {% endif %}
            </div>
            <div class="col-12 col-lg-4 col-sm-6">
                <b>Carreras:</b><br>
                <form class="form-search">
                    <select id="carrera_list" style="width: 100%">
                        <option value="0" {% if idc == 0 %}selected{% endif %}>Todas las Carreras</option>
                        {% for c in carreras %}
                            <option {% if idc == c.id %}selected{% endif %} value="{{ c.id }}">{{ c }}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>
            <div class="col-12 col-lg-4 col-sm-6">
                <b>Buscar:</b>
                <br>
                <form class="form-search" onsubmit="return busqueda()" style="width:100%">
                    <div class="input-group mb-1">
                        <input type="text" id="searchinput" class="form-control"
                               placeholder="Buscar por apellidos..." aria-label="Buscar"
                               name="s" >
                        <div class="input-group-append">
                            <a href="javascript:;" class="btn btn-primary" type="button" id="search">
                                <i class="fa fa-search"></i>
                            </a>
                            {% if search %}
                                <a href="javascript:;" class='btn btn-mini btn-inverse tu action_clean' title="Limpiar"><span class="fa fa-remove"></span></a>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-md-3 " style="--bs-gutter-x: 0.5rem;">
            {% for graduado in graduados %}
                <div class='col'>
                    <div class='card-body card h-100'>
                        <div class='d-flex bd-highlight mb-0'>
                            <div class="p-0" style="text-align: center">
                                <span class='avatar avatar-lg'>
                                    {% if graduado.inscripcion.persona.foto.foto %}
                                        <img src="https://sga.unemi.edu.ec{{ graduado.inscripcion.persona.foto.foto.url }}" class="rounded-circle">
                                    {% else %}
                                        {% if graduado.inscripcion.persona.sexo_id == 1 %}
                                            <img src="/static/images/iconos/mujer.png" class="rounded-circle">
                                        {% else %}
                                            <img src="/static/images/iconos/hombre.png" class="rounded-circle">
                                        {% endif %}
                                    {% endif %}
                                </span>
                            </div>

                            <div class='p-1'>
                                <h6 class="mb-0">
                                    <span class="fa fa-id-badge" aria-hidden="true"></span>
                                    {% if graduado.inscripcion.persona.cedula %}
                                        {{ graduado.inscripcion.persona.cedula }}
                                    {% else %}
                                        {{ graduado.inscripcion.persona.pasaporte }}
                                    {% endif %}
                                    <br>
                                    <span class="label label-default"></span> {{ graduado.inscripcion.persona }}
                                </h6>
                            </div>
                            <div class="ms-auto p-1">
                                <div class="text-center">
                                    <button class="text-center btn btn-default btn-reiniciar-acordeones" type="button"
                                            data-bs-toggle="offcanvas"
                                            data-bs-target="#offcanvasRight_{{ graduado.id }}"
                                            aria-controls="offcanvasRight"><i class="fa fa-ellipsis-v"></i>
                                    </button>
                                </div>
                                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight_{{ graduado.id }}"
                                     aria-labelledby="offcanvasRightLabel">
                                    <div class="offcanvas-header">
                                        <h2 id="offcanvasRightLabel"><span style="margin-right: 10px;"><i
                                                class="fas fa-user"></i></span>
                                            {{ graduado.inscripcion.persona }}</h2>
                                        <button type="button" class="btn-close text-reset"
                                                data-bs-dismiss="offcanvas" aria-label="Close"></button>
                                    </div>
                                    <div class="offcanvas-body" style="padding-top: 1rem; padding-bottom: 1rem">
                                        {% if graduado.inscripcion.coordinacion.id == 7 %}
                                            <a data-bs-dismiss="offcanvas" class="editposgrado" idgra="{{ graduado.id }}" idnumero="{{ graduado.numeroactagrado }}" href="javascript:;">
                                                <h4 class="mb-0"><i class="fa fa-edit"></i> Editar</h4></a>

                                            <a data-bs-dismiss="offcanvas" href="javascript:;" onclick="generarcertificadosinnotificar('{{ graduado.id }}')">
                                                <h4 class="mb-0"><i class="fa fa-certificate"></i> Generar título</h4></a>

                                            {% if graduado.rutapdftitulo and graduado.urlhtmltitulo and graduado.namehtmltitulo %}
                                                <a data-bs-dismiss="offcanvas" href='#' onclick="mostrarenvio({{ graduado.id }})">
                                                    <h4 class="mb-0"><i class="fa fa-envelope"></i> Notificar título</h4></a>
                                            {% endif %}

                                            <a data-bs-dismiss="offcanvas" class="certificado_view_pdf" title="Título"  href="javascript:;" idi="{{ graduado.id }}">
                                                <h4 class="mb-0"><i class="fa fa-envelope"></i> Vista previa Título</h4></a>

                                        {% else %}
                                            {% if not graduado.materiatitulacion %}
                                                {% if perms.sga.puede_adicionar_graduado %}
                                                    <a data-bs-dismiss="offcanvas" href="/graduados?action=edit&id={{ graduado.id }}">
                                                        <h4 class="mb-0"><i class="fa fa-edit"></i> Editar</h4></a>
                                                {% endif %}
                                            {% else %}
                                                {% if perms.sga.puede_adicionar_graduado %}
                                                    <a data-bs-dismiss="offcanvas" href="/graduados?action=editintegracioncurricular&id={{ graduado.id }}">
                                                        <h4 class="mb-0"><i class="fa fa-edit"></i> Editar</h4></a>

                                                {% endif %}
                                            {% endif %}
                                            <a data-bs-dismiss="offcanvas" href="/inscripciones?id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}">
                                                <h4 class="mb-0"><i class="fa fa-user"></i> Inscripci&oacute;n</h4></a>

                                            <a data-bs-dismiss="offcanvas" href="/graduados?action=actualizar&id={{ graduado.inscripcion.id }}">
                                                <h4 class="mb-0"><i class="fa fa-refresh"></i> Actualizar nota de egreso</h4></a>

                                            {% if not graduado.materiatitulacion %}
                                                {% if perms.sga.puede_adicionar_graduado %}
                                                    <a data-bs-dismiss="offcanvas" href="/graduados?action=examencomplexivo&id={{ graduado.id }}">
                                                        <h4 class="mb-0"><i class="fa fa-edit"></i> Examen Complexivo</h4></a>
                                                {% endif %}
                                            {% endif %}

                                            <a data-bs-dismiss="offcanvas"  href='javascript:;' class="actafacultad tu" idg="{{ graduado.id }}">
                                                <h4 class="mb-0"><i class="fa fa-check"></i> Facultad Historica</h4></a>

                                            <a data-bs-dismiss="offcanvas" href="/inscripciones?action=record&id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}">
                                                <h4 class="mb-0"><i class="fa fa-list"></i> Registro Acad&eacute;mico</h4></a>

                                            <a data-bs-dismiss="offcanvas" href="/seguimiento?action=trabajo&id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}">
                                                <h4 class="mb-0"><i class="fa fa-tags"></i> Seguimiento Laboral</h4></a>

                                            <a data-bs-dismiss="offcanvas" href="/seguimiento?action=estudio&id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}">
                                                <h4 class="mb-0"><i class="fa fa-list-alt"></i> Seguimiento Estudios</h4></a>

                                            <a data-bs-dismiss="offcanvas" class="confirmacionmodal" href="javascript:;" nhref="/graduados?action=resetear&id={{ graduado.inscripcion.id }}">
                                                <h4 class="mb-0"><i class="fa fa-key"></i> Resetear Clave Usuario</h4></a>

                                            {% if persona.usuario.is_superuser and not graduado.inscripcion.persona.usuario.is_superuser %}
                                                <a data-bs-dismiss="offcanvas"  href='/cu?id={{ graduado.inscripcion.persona.usuario.id }}'>
                                                    <h4 class="mb-0"><i class="fa fa-user"></i> Entrar como este usuario</h4></a>
                                            {% endif %}

                                            {% if perms.sga.puede_adicionar_graduado %}
                                                <a data-bs-dismiss="offcanvas" class="eliminacionmodal" href="javascript:;" nhref="/graduados?action=del&id={{ graduado.id }}">
                                                    <h4 class="mb-0"><i class="fa fa-trash"></i> Eliminar</h4></a>
                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado and graduado.subdecano %}
                                                <a data-bs-dismiss="offcanvas"  class="eliminarsubdecano" href="javascript:;" idg="{{ graduado.id }}">
                                                    <h4 class="mb-0"><i class="fa fa-remove"></i> Eliminar subdecano</h4></a>
                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado and graduado.representantedocente %}
                                                <a data-bs-dismiss="offcanvas" class="eliminarreprdocentep" href="javascript:;" idg="{{ graduado.id }}">
                                                    <h4 class="mb-0"><i class="fa fa-remove"></i> Eliminar representante principal de docente</h4></a>

                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado and graduado.representanteestudiantil %}
                                                <a data-bs-dismiss="offcanvas" class="eliminarreprestudiantil" href="javascript:;" idg="{{ graduado.id }}">
                                                    <h4 class="mb-0"><i class="fa fa-remove"></i> Eliminar representante principal estudiantil</h4></a>
                                            {% endif %}

                                        {% endif %}
                                        <a data-bs-dismiss="offcanvas" class="" href="/graduados?action=listadoactasgraduados&id={{ graduado.pk }}" target="_blank">
                                            <h4 class="mb-0"><i class="fa fa-print"></i> Visualizar Actas</h4></a>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown" >
                                <div class="dropdown dropleft">
                                    <ul class="dropdown-menu" >
                                        {% if graduado.inscripcion.coordinacion.id == 7 %}
                                            <li class="dropdown-item"><a class="list-group-item editposgrado" idgra="{{ graduado.id }}" idnumero="{{ graduado.numeroactagrado }}" href="javascript:;"><span class="fa fa-pencil fa fa-edit"></span> Editar</a></li>
                                            <li class="dropdown-item"><a href="javascript:;" onclick="generarcertificadosinnotificar('{{ graduado.id }}')"><span class="fa fa-certificate"></span> Generar título</a></li>
                                            {% if graduado.rutapdftitulo and graduado.urlhtmltitulo and graduado.namehtmltitulo %}
                                                <li class="dropdown-item"><a href='#' onclick="mostrarenvio({{ graduado.id }})"><span class="fa fa-envelope"></span> Notificar título</a></li>
                                            {% endif %}
                                            <li class="dropdown-item"><a class="certificado_view_pdf" title="Título"
                                                                         href="javascript:;" idi="{{ graduado.id }}"><span
                                                    class="fa fa-print"></span> Vista previa Título</a>
                                            </li>
                                        {% else %}
                                            {% if not graduado.materiatitulacion %}
                                                {% if perms.sga.puede_adicionar_graduado %}
                                                    <li class="dropdown-item"><a href="/graduados?action=edit&id={{ graduado.id }}"><span class="fa fa-pencil fa fa-edit"></span> Editar </a></li>
                                                {% endif %}
                                            {% else %}
                                                {% if perms.sga.puede_adicionar_graduado %}
                                                    <li class="dropdown-item"><a href="/graduados?action=editintegracioncurricular&id={{ graduado.id }}"><span class="fa fa-pencil fa fa-edit"></span> Editar</a></li>
                                                {% endif %}
                                            {% endif %}
                                            <li class="dropdown-item"><a href="/inscripciones?id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}"><span class="fa fa-user "></span> Inscripci&oacute;n</a></li>
                                            <li class="dropdown-item"><a href="/graduados?action=actualizar&id={{ graduado.inscripcion.id }}"><span class="fa fa-refresh "></span> Actualizar nota de egreso</a></li>
                                            {% if not graduado.materiatitulacion %}
                                                {% if perms.sga.puede_adicionar_graduado %}
                                                    <li class="dropdown-item"><a href="/graduados?action=examencomplexivo&id={{ graduado.id }}"><span class="fa fa-edit "></span> Examen Complexivo</a></li>
                                                {% endif %}
                                            {% endif %}
                                            <li class="dropdown-item"><a href='javascript:;' class="actafacultad tu" idg="{{ graduado.id }}"><i class="fa fa-check"></i> Facultad Historica</a></li>
                                            <li class="dropdown-item"><a href="/inscripciones?action=record&id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}"><span class="fa fa-list "></span> Registro Acad&eacute;mico</a></li>
                                            <li class="dropdown-item"><a href="/seguimiento?action=trabajo&id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}"><i class="fa fa-tags"></i> Seguimiento Laboral</a></li>
                                            <li class="dropdown-item"><a href="/seguimiento?action=estudio&id={{ graduado.inscripcion.id }}&ret={{ request.get_full_path }}"><i class="fa fa-list"></i> Seguimiento Estudios</a></li>

                                            {% if graduado.inscripcion.tieneactasustentacion %}
                                            {% endif %}
                                            {% if graduado.examencomplexivo %}
                                            {% else %}
                                            {% endif %}
                                            {% if graduado.examencomplexivo %}
                                            {% else %}
                                            {% endif %}
                                            {% if graduado.examencomplexivo %}
                                            {% else %}
                                            {% endif %}
                                            <li class="dropdown-item"><a class="confirmacionmodal" href="javascript:;" nhref="/graduados?action=resetear&id={{ graduado.inscripcion.id }}"><i class="fa fa-key"></i> Resetear Clave Usuario</a></li>
                                            {% if persona.usuario.is_superuser %}
                                                <li class="dropdown-item"><a href='/cu?id={{ graduado.inscripcion.persona.usuario.id }}'><i class='fa fa-user'></i> Entrar como este usuario</a></li>
                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado %}
                                                <li class="dropdown-item"><a class="eliminacionmodal" href="javascript:;" nhref="/graduados?action=del&id={{ graduado.id }}"><span class="fa fa-remove "></span> Eliminar</a></li>
                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado and graduado.subdecano %}
                                                <li class="dropdown-item"><a class="eliminarsubdecano" href="javascript:;" idg="{{ graduado.id }}"><span class="fa fa-remove "></span> Eliminar subdecano</a></li>
                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado and graduado.representantedocente %}
                                                <li class="dropdown-item"><a class="eliminarreprdocentep" href="javascript:;" idg="{{ graduado.id }}"><span class="fa fa-remove "></span> Eliminar representante principal de docente</a></li>
                                            {% endif %}
                                            {% if perms.sga.puede_adicionar_graduado and graduado.representanteestudiantil %}
                                                <li class="dropdown-item"><a class="eliminarreprestudiantil" href="javascript:;" idg="{{ graduado.id }}"><span class="fa fa-remove "></span> Eliminar representante principal estudiantil</a></li>
                                            {% endif %}
                                        {% endif %}
                                        <li class="dropdown-item"><a class="" href="/graduados?action=listadoactasgraduados&id={{ graduado.pk }}" target="_blank"><span class="fa fa-print "></span> Visualizar Actas</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class='ms-0'>
                                <p class="mb-0 text-muted">
                                    <span class="fa fa-envelope"></span> <a href="mailto:{{ graduado.inscripcion.persona.email }}">{{ graduado.inscripcion.persona.email }}</a>
                                    {% if graduado.inscripcion.persona.telefono %}
                                        |{{ graduado.inscripcion.persona.telefono }}
                                        <a style="padding-bottom: 0px;padding-left: 3px;padding-right: 3px;padding-top: 0px" href='https://web.whatsapp.com/send?l=en&phone=+593{{ graduado.inscripcion.persona.telefono }}&text=Hola {{ graduado.inscripcion.persona }}'
                                           target="_blank" class="btn btn-mini btn-success tu"
                                           title="Enviar mensaje por whatsapp">
                                            <i class="fa fa-whatsapp"></i>
                                        </a>
                                    {% endif %}
                                </p>
                                <p class="mb-0" style="font-size: 12px;color: #1C3247">
                                    <strong>
                                        {{ graduado.inscripcion.carrera }}<br>
                                        {% if graduado.actafacultad %}
                                            <span class="label label-info tu" style="font-size: 10px" title="Facultad historica">{{ graduado.actafacultad }}</span>
                                        {% endif %}
                                    </strong>
                                </p>
                            </div>
                        </div>
                        <div class=' border-top py-1'>
                            <div class='ms-0'>
                                <table  class="table table-borderless" style="margin-top: 0px;margin-bottom: 0px">
                                    {% if graduado.fechaactagrado %}
                                        <tr>
                                            <td style="width: 300px;padding: 0px"><b style="font-size: 12px">ACTA DE GRADO:</b></td>
                                            <td style="width: 200px;padding: 0px;font-size: 12px">{{ graduado.fechaactagrado|date:"d-m-Y" }}</td>
                                        </tr>
                                    {% endif %}
                                    <tr>
                                        <td style="width: 300px;padding: 0px;"><b style="font-size: 12px">FECHA DE GRADUACIÓN: </b></td>
                                        <td style="width: 200px;padding: 0px;font-size: 12px">{{ graduado.fechagraduado|date:"d-m-Y" }}</td>
                                    </tr>
                                    {% if graduado.inscripcion.coordinacion.id == 7 %}
                                        <tr>
                                            <td style="width: 300px;padding: 0px;"> <b>Refrendación: </b></td>
                                            <td style="width: 200px;padding: 0px;">
                                                {% if graduado.fecharefrendacion %}
                                                    {{ graduado.fecharefrendacion|date:"d-m-Y" }}
                                                {% else %}
                                                    No se ha registrado. <br>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endif %}
                                    <tr>
                                        <td style="width: 300px;padding: 0px;"><b style="font-size: 12px">REGISTRO SENESCYT: </b></td>
                                        <td style="width: 200px;padding: 0px;font-size: 12px">{{ graduado.registro }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class=' border-top py-1'>
                            <div class='ms-0'>
                                <table  class="table table-borderless" style="margin-top: 0px;margin-bottom: 0px">
                                    <tr>
                                        <td style="width: 300px;padding: 0px;"><b style="font-size: 12px">NOTA EGRESO:</b></td>
                                        <td style="width: 200px;padding: 0px;font-size: 12px">{{ graduado.notafinal|floatformat:2 }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 300px;padding: 0px;"><b style="font-size: 12px">NOTA TRABAJO TITULACIÓN: </b></td>
                                        <td style="width: 200px;padding: 0px;font-size: 12px">{{ graduado.promediotitulacion|floatformat:2 }}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 300px;padding: 0px;"><b style="font-size: 12px">NOTA GRADO: </b></td>
                                        <td style="width: 200px;padding: 0px;font-size: 12px">{{ graduado.notagraduacion|floatformat:2 }}</td>
                                    </tr>
                                    {% if graduado.inscripcion.exonerado_practias %}
                                        <tr>
                                            <td style="padding: 0px;" colspan="2">
                                                <div class="text-success active" style="font-size: 13px"><strong> Exon. Práct. y Vinc. Nro. UNEMI VICE.ACAD. -2013-563-OF</strong></div>
                                            </td>
                                        </tr>
                                    {% endif %}
                                    <tr>
                                        <td style="padding: 0px;" colspan="2">
                                            <span class="badge {% if graduado.estadograduado %}bg-success{% else %}bg-warning{% endif %}">{% if graduado.estadograduado %}GRADUADO{% else %}PENDIENTE{% endif %}</span>
                                            {% if graduado.inscripcion.tieneactasustentacion %}
                                                <span class="badge bg-info">TIENE ACTA SUSTENTACIÓN</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
{#                        <div class=' border-top py-1'>#}
{#                            <div class='ms-0'>#}
{#                                <span class="text-warning"><strong> ACTAS FIRMADAS 1/3</strong></span>#}
{#                            </div>#}
{#                        </div>#}
                        <div class="accordion" id="detalles_{{ graduado.id }}">
                            <div class="accordion-item">
                                <h4 class="accordion-header" id="headingOne">
                                    <button class="accordion-button py-2 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne{{ graduado.id }}" aria-expanded="false" aria-controls="collapseOne">
                                        <i class="fa fa-list dropdown-item-icon" aria-hidden="true"></i>Detalle
                                    </button>
                                </h4>
                                <div id="collapseOne{{ graduado.id }}" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#detalles_{{ graduado.id }}" style="">
                                    <div class="accordion-body p-2">
                                        <table  class="table table-borderless" style="margin-top: 0px;margin-bottom: 0px">
                                            <tr>
                                                <td style="padding: 0px;"><b style="font-size: 12px">PASANTÍA:</b></td>
                                                <td style="padding: 0px;font-size: 12px">{{ graduado.pasantias }}</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 0px;"><b style="font-size: 12px">PRÁCTICAS PRE-PROFESIONALES: </b></td>
                                                <td style="padding: 0px;font-size: 12px">{{ graduado.practicas }}</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 0px;"><b style="font-size: 12px">VINCULACIÓN: </b></td>
                                                <td style="padding: 0px;font-size: 12px">{{ graduado.vinculacion }}</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 0px;"><b style="font-size: 12px">EXÁMEN COMPLEXIVO: </b></td>
                                                <td style="padding: 0px;font-size: 12px">
                                                    {% if graduado.examencomplexivo %}
                                                        <i class="fa fa-check"></i>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 0px;"><b style="font-size: 12px">TÍTULO: </b></td>
                                                <td style="padding: 0px;font-size: 12px">
                                                    {% if graduado.rutapdftitulo and graduado.urlhtmltitulo %}
                                                        <a target="_blank" href="{{ graduado.rutapdftitulo.url }}?v={{ version }}" class="btn btn-success btn-mini"><i class="fa fa-arrow-down"></i> Descargar</a>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="card-footer border-top-0">
            {% include 'paginacionb4.html' %}
        </div>
    </div>

    {#    modal generar titulo#}
    <div class="modal fade static" id="modalnotoficacion" style="display: none;">
        <div class="modal-header">
            <h4 id="paneltitle">Notificar Título</h4>
            {#        <h4 id="idnombrespostulante"></h4>#}
        </div>
        <div class="modal-body notoficacionbody">
            {#        <div class="alert alert-danger">#}
            {#            <h4 class="alert-heading">ALERTA</h4>#}
            {#            Al dar clic en Aceptar, se eliminará la inscripción en la cual aplicó.#}
            {#        </div>#}
            <p style="margin-top: 16px;">¿Está seguro(a) que desea enviar email adjunto el título?</p>
            <input type="hidden" id="idgraduadoposgrado" name="idgraduadoposgrado">
        </div>
        <div class="modal-footer">
            <p style="text-align: right; margin-bottom: 0">
                <a href="javascript:;" id="boton_notoficacionaprobada" class='btn btn-success'> Enviar email</a>
                <a href="javascript:;" id="cancel_notoficacioncancela" class='btn btn-default'> Cancelar</a>
            </p>
        </div>
    </div>

    {#    modal sólo generar titulo MASIVO #}
    <div class="modal fade static" id="modalnotoficacionmasivo" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">Generar Títulos e Insignias masivo</h4>
                    {#        <h4 id="idnombrespostulante"></h4>#}
                </div>
                <div class="modal-body notoficacionbody">
                    <p style="margin-top: 16px;">¿Está seguro(a) que desea generar insignias y títulos masivo?.
                        <br>
                        <b>Nota: </b>Sólo se generará el título de los graduados que poseen fecha de refrendación y máximo 500 cada vez.</p>
                    <input type="hidden" id="idgraduadoposgradomasivo" name="idgraduadoposgrado">
                </div>
                <div class="modal-footer">
                    <p style="text-align: right; margin-bottom: 0">
                        <a href="javascript:;" id="boton_notoficacionaprobadamasivo" class='btn btn-success'> Generar Títulos masivo</a>
                        <a href="javascript:;" id="cancel_notoficacioncancelamasivo" class='btn btn-default'> Cancelar</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modalnotoficacionmasivowebpush" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">Generar títulos/insignias posgrado masivo</h4>
                    {#        <h4 id="idnombrespostulante"></h4>#}
                </div>
                <div class="modal-body notoficacionbody">
                    <p style="margin-top: 16px;">¿Está seguro(a) que desea generar insignias y títulos posgrado masivo?.
                        <br>
                        <b>Nota: </b>Sólo se generará el título de los graduados que poseen fecha de refrendación.</p>
                    <input type="hidden" id="idgraduadoposgradomasivo" name="idgraduadoposgrado">
                </div>
                <div class="modal-footer">
                    <p style="text-align: right; margin-bottom: 0">
                        <a href="javascript:;" id="boton_notoficacionaprobadamasivowebpush" class='btn btn-success'> Generar títulos masivo</a>
                        <a href="javascript:;" id="cancel_notoficacioncancelamasivowebpush" class='btn btn-default'> Cancelar</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modalsolonotificacionmasivo" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">Notificar insignias/títulos masivo</h4>
                    {#        <h4 id="idnombrespostulante"></h4>#}
                </div>
                <div class="modal-body notoficacionbody">
                    <p style="margin-top: 16px;">¿Está seguro(a) que desea notificar las insignias/títulos de forma masiva?.
                        <br>
                        <b>Nota: </b>Sólo se notificará a los graduados que se les generó la insignia/título y no se hayan notificado.</p>
                    <input type="hidden" id="idgraduadoposgradomasivo" name="idgraduadoposgrado">
                </div>
                <div class="modal-footer">
                    <p style="text-align: right; margin-bottom: 0">
                        <a href="javascript:;" id="boton_solonotificacionaprobadamasivo" class='btn btn-success'> Notificar títulos masivo</a>
                        <a href="javascript:;" id="cancel_solonotificacioncancelamasivo" class='btn btn-default'> Cancelar</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modaladdindicadoresrural" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Reporte rural</h3>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info incompletoaddindicadoresrural" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovaloresaddindicadoresrural" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresoaddindicadoresrural" style="display: none;"> FECHAS YA FUERON INGRESADAS</div>
                    <div class="row-fluid">
                        <form id="formulario3" class='form-vertical' action="" method="POST">
                            <b><span class="carreraindicador"> </span></b><br>
                            Fecha Inicio.:<br><input type="text" name="id_fechainirural" id="id_fechainirural" placeholder="Fecha Inicio">
                            <br>Fecha Fin.:<br><input type="text" name="id_fechafinrural" id="id_fechafinrural" placeholder="Fecha Fin">
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-warning" id="generar_reporterural"><i class="fa fa-table"></i> Generar Reporte</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarindicadoresaddrural">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modaladdindicadores" tabindex="-1" aria-labelledby="detalleactivomodalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Auto Registro Títulos</h3>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info incompletoaddindicadores" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovaloresaddindicadores" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresoaddindicadores" style="display: none;"> FECHAS YA FUERON INGRESADAS</div>
                    <div class="row-fluid">
                        <form id="formulario2"  action="" method="POST">
                            <span class="carreraindicador"> </span>
                            <div class="mb-3">
                                <label>Fecha Inicio.:</label>
                                <input class="form-control" type="text" name="id_fechaini" id="id_fechaini" placeholder="Fecha Inicio">
                            </div>
                            <div class="mb-3">
                                <label>Fecha Fin.:</label>
                                <input class="form-control" type="text" name="id_fechafin" id="id_fechafin" placeholder="Fecha Fin">
                            </div>
                            <div class="mb-3">
                                <label>Género:</label>
                                <select class="form-control" id="cmbgenero" name="cmbgenero" style="width: 100%">
                                    <option value="2">HOMBRE</option>
                                    <option value="1">MUJER</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-warning" id="generar_reporte"><i class="fa fa-table"></i> Generar Reporte</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarindicadoresadd">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modaladdindicadoresdip" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle">Auto Registro Títulos Posgrado</h3>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info incompletoaddindicadoresdip" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovaloresaddindicadoresdip" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresoaddindicadoresdip" style="display: none;"> FECHAS YA FUERON INGRESADAS</div>
                    <div class="row-fluid">
                        <form id="formulario2" class='form-vertical' action="" method="POST">
                            <b><span class="carreraindicador"> </span></b><br>
                            Fecha Inicio.:<br><input type="text" name="id_fechainidip" id="id_fechainidip" placeholder="Fecha Inicio">
                            <br>Fecha Fin.:<br><input type="text" name="id_fechafindip" id="id_fechafindip" placeholder="Fecha Fin">
                            <br>Duración.:<br><input type="number" name="duracion" id="id_duracion"  min="1" max ="10"  placeholder="Duración">
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-warning" id="generar_reportedip"><i class="fa fa-table"></i> Generar Reporte</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrarindicadoresadd_dip">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="citamodal" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">Seleccionar facultad</h4>
                </div>
                <div class="modal-body">
                    <form id="formulario1" class='form-horizontal'>
                        {% for field in form2 %}
                            <fieldset class="control-group nomargins">
                                <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                                <div class="controls">
                                    {{ field }}
                                </div>
                            </fieldset>
                        {% endfor %}
                    </form>
                    <div class="alert alert-danger" id="mensaje" style="display:none; text-align: center;font-size: 12px"><b>Seleccione una facultad</b></div>
                </div>
                <div class="modal-footer">
                    <input type='hidden' id="idg" name='idg' value='0'/>
                    <a href="javascript:;" id="citamodal_run" class="btn btn-success">Adicionar</a>
                    <a href="javascript:;" id="cerrarcitamodal" class="btn">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modaladddetalle" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="paneltitle">Número de folio</h4>
                </div>
                <div class="modal-body" style="overflow: scroll;">
                    # folio: <input type="text" id="idnumeroacta" name="idnumeroacta">
                    <input type="hidden" id="codigograduado" name="codigograduado" value="0">
                </div>
                <div class="modal-footer">
                    <p style="text-align: right; margin-bottom: 0">
                        <a href="javascript:;" id="boton_adicionardetalle" class='btn btn-success'> Guardar</a>
                        <a href="javascript:;" id="cancel_cancelardetalle" class='btn btn-default'> Cancelar</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel" >
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-lg">
                    <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>

                    </button>

                </div>
                <div class="modal-body">
                    <form class="form-horizontal form-modal formModalclass" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row-fluid panelbody">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

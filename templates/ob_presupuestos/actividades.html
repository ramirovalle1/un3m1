{% extends "basebs.html" %}
{% load humanize %}
{% block heading %}
    <script>
        $(function() {


            $("#search").click(function() {
                var term = $("#searchinput").val().toUpperCase();
                location.href = "/ob_presupuestos?s="+term;
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    $("#search").trigger("click");
                }
            });

            $('#searchinput').focus();



            $('#addactividad').click(function(){
                $('#nombreactividad').val('');
                $('#guardarmodalactividad').attr({'ida': 0});
                $('#modalactividad').modal('show');
            });

            $('.editactividad').click(function(){
                $('#nombreactividad').val($(this).attr('texto'));
                $('#guardarmodalactividad').attr({'ida': $(this).attr('ida')});
                $('#modalactividad').modal('show');
            });


            $('#cerrarmodalactividad').click(function(){
                $('#modalactividad').modal('hide');
            });

            $('.delactividad').unbind();
            $('.delactividad').click(function(){
                var id = $(this).attr('ida');
                smoke.confirm("Desea eliminar?", function(e){
                    if (e){
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'deleteactividad', 'id': id },
                            success: function(data) {
                                if (data.result == 'ok') {
                                    $('#filaactividad_'+id).remove();
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                                $('#presupuestototal').html(data.presupuestototal);
                                $('#contenidoitems').html('');
                                $('#contenidogrupos').html('');

                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }else{

                    }
                }, {
                    ok: "Si",
                    cancel: "No",
                    classname: "custom-class",
                    reverseButtons: true
                });

            });

            $('#guardarmodalactividad').click(function(){
                var valor = $('#nombreactividad').val().trim();
                var ida = parseInt($('#guardarmodalactividad').attr('ida'));
                if(ida > 0){
                    if (valor.length > 0){
                        $('#modalactividad').modal('hide');
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'editactividad', 'id': ida, 'valor': valor },
                            success: function(data) {
                                if (data.result == 'ok') {
                                    location.href=location.href;
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }
                }else{
                    if (valor.length > 0){
                        $('#modalactividad').modal('hide');
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'addactividad', 'idp': {{ presupuesto.id }}, 'valor': valor },
                            success: function(data) {
                                if (data.result == 'ok') {
                                    location.href=location.href;
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }
                }
            });

            conectar_controles_grupos=function(){
                $('.addgrupo').unbind();
                $('.addgrupo').click(function(){
                    var id = $(this).attr('ida');
                    $('#guardarmodalactividadgrupo').attr({'ida': id});
                    $('#nombregrupo').val('');
                    $('#guardarmodalactividadgrupo').attr({'idg': 0});
                    $('#nombreactividadgrupo').html($(this).attr('texto'));
                    $('#modalactividadgrupo').modal('show');
                });

                $('.delgrupo').unbind();
                $('.delgrupo').click(function(){
                    var id = $(this).attr('idg');
                    smoke.confirm("Desea eliminar?", function(e){
                        if (e){
                            $.ajax({
                                type: "POST",
                                url: "/ob_presupuestos",
                                data: {'action': 'delgrupo', 'id': id },
                                success: function(data) {
                                    if (data.result == 'ok') {
                                        $('#filagrupo_'+id).remove();
                                    } else {
                                        $.unblockUI();
                                        smoke.alert(data.mensaje);
                                    }
                                    $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                    $('#presupuestototal').html(data.presupuestototal);
                                    $('#contenidoitems').html('');
                                },
                                error: function() {
                                    $.unblockUI();
                                    smoke.alert("Error de conexión");
                                },
                                dataType: "json"
                            });
                        }else{

                        }
                    }, {
                        ok: "Si",
                        cancel: "No",
                        classname: "custom-class",
                        reverseButtons: true
                    });

                });
            };

            editargrupos=function(){
                $('.editgrupo').unbind();
                $('.editgrupo').click(function(){
                    $('#nombregrupo').val($(this).attr('texto'));
                    $('#guardarmodalactividadgrupo').attr({'idg': $(this).attr('idg')});
                    $('#modalactividadgrupo').modal('show');
                });
            };

            $('#cerrarmodalactividadgrupo').click(function(){
                $('#modalactividadgrupo').modal('hide');
            });

            $('.grupos').click(function(){
                var ida = $(this).attr('ida');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/ob_presupuestos",
                    data: {'action': 'grupos', 'id': ida},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $('#contenidogrupos').html(data.plantilla);
                            conectar_controles_grupos();
                            editargrupos();
                            conectar_controles();
                            items();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión");
                    },
                    dataType: "json"
                });
            });

            $('#guardarmodalactividadgrupo').click(function(){
                var ida = $(this).attr('ida');
                $('#modalactividadgrupo').modal('hide');
                var valor = $('#nombregrupo').val().trim();
                var idg = parseInt($('#guardarmodalactividadgrupo').attr('idg'));
                if(idg > 0){
                    if (valor.length > 0){
                        $('#modalactividadgrupo').modal('hide');
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'editgrupo', 'idg': idg, 'valor': valor},
                            success: function(data) {
                                if (data.result == 'ok') {
                                    $('#grupodescripcion_'+idg).html(valor);

                                } else {
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }
                }else{
                    if (valor.length > 0){
                        $('#modalactividad').modal('hide');
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'addgrupo', 'ida': ida, 'valor': valor },
                            success: function(data) {
                                $.unblockUI();
                                if (data.result == 'ok'){
                                    $('#contenidogrupos').html(data.plantilla);
                                    $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                    $('#presupuestototal').html(data.presupuestototal);
                                    conectar_controles_grupos();
                                    editardetrecurso();
                                    conectar_controles_adddetrecurso();

                                    editargrupos();
                                    conectar_controles();
                                    items();
                                } else {
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }
                }
            });

            $("#modaldetrecurso .btn-cerrar").click(function() {
                $("#modaldetrecurso").modal("hide");
                return false;
            });

            $("#modalitemsdetrecurso .btn-cerrar").click(function() {
                $("#modalitemsdetrecurso").modal("hide");
                return false;
            });

            $("#modalcronorecurso .btn-cerrar").click(function() {
                $("#modalcronorecurso").modal("hide");
                return false;
            });


            function carga_por_tipo (tipo) {
                if (tipo == 1){
                    $("#th_unidadmedida, #th_cantidadreferencia, #th_preciomaterialunitario, #th_tarifareferencia, #th_jornadareferencia, #th_costohorareferencia").removeAttr('hidden');
                    $("#td_unidadmedida, #td_cantidadreferencia, #td_preciomaterialunitario, #td_tarifareferencia, #td_jornadareferencia, #td_costohorareferencia").removeAttr('hidden');
                }
                if (tipo == 2){
                    $("#th_unidadmedida, #th_preciomaterialunitario, #th_jornadareferencia").attr({'hidden': ''});
                    $("#th_tarifareferencia, #th_costohorareferencia, #th_rendimientoreferencia").removeAttr('hidden');

                    $("#td_unidadmedida, #td_preciomaterialunitario, #td_jornadareferencia").attr({'hidden': ''});
                    $("#td_tarifareferencia, #td_costohorareferencia, #td_rendimientoreferencia").removeAttr('hidden');
                }
                if (tipo == 3){
                    $("#th_unidadmedida, #th_preciomaterialunitario, #th_tarifareferencia").attr({'hidden': ''});
                    $("#th_cantidadreferencia, #th_jornadareferencia, #th_costohorareferencia, #th_rendimientoreferencia").removeAttr('hidden');

                    $("#td_unidadmedida, #td_preciomaterialunitario, #td_tarifareferencia").attr({'hidden': ''});
                    $("#td_cantidadreferencia, #td_jornadareferencia, #td_costohorareferencia, #td_rendimientoreferencia").removeAttr('hidden');
                }
                if (tipo == 4){
                    $("#th_tarifareferencia, #th_jornadareferencia, #th_costohorareferencia, #th_rendimientoreferencia").attr({'hidden': ''});
                    $("#th_unidadmedida, #th_preciomaterialunitario").removeAttr('hidden');

                    $("#td_tarifareferencia, #td_jornadareferencia, #td_costohorareferencia, #td_rendimientoreferencia").attr({'hidden': ''});
                    $("#td_unidadmedida, #td_preciomaterialunitario").removeAttr('hidden');
                }
                if (tipo == 5){
                    $("#th_preciomaterialunitario, #th_jornadareferencia, #th_costohorareferencia, #th_rendimientoreferencia").attr({'hidden': ''});
                    $("#th_unidadmedida, #th_tarifareferencia").removeAttr('hidden');

                    $("#td_preciomaterialunitario, #td_jornadareferencia, #td_costohorareferencia, #td_rendimientoreferencia").attr({'hidden': ''});
                    $("#td_unidadmedida, #td_tarifareferencia").removeAttr('hidden');
                }

            };

            $('#op_tiporecurso').on('change' , function() {
                carga_por_tipo($(this).val());
            }).change();


            $("#id_cantidadreferencia, #id_tarifareferencia , #id_jornadareferencia, #id_preciomaterialunitario, #id_rendimientoreferencia, #id_otroindirecto").blur(function () {
                numerico($(this), 0, 0, 4);
                var tipo = $('#op_tiporecurso').val();
                if( tipo == 2){
                    $('#id_costohorareferencia').val(   (parseFloat($('#id_cantidadreferencia').val())*parseFloat($('#id_tarifareferencia').val())).toFixed(4) );
                    $('#id_costoreferencia').val(   (parseFloat($('#id_costohorareferencia').val())*parseFloat($('#id_rendimientoreferencia').val())).toFixed(4) );
                }

                if(tipo == 3){
                    $('#id_costohorareferencia').val(   (parseFloat($('#id_cantidadreferencia').val())*parseFloat($('#id_jornadareferencia').val())).toFixed(4) );
                    $('#id_costoreferencia').val(   (parseFloat($('#id_costohorareferencia').val())*parseFloat($('#id_rendimientoreferencia').val())).toFixed(4) );
                }

                if(tipo == 4){
                    $('#id_costoreferencia').val(   (parseFloat($('#id_cantidadreferencia').val())*parseFloat($('#id_preciomaterialunitario').val())).toFixed(4) );
                }

                if(tipo == 5){
                    $('#id_costoreferencia').val((parseFloat($('#id_cantidadreferencia').val()) * parseFloat($('#id_tarifareferencia').val())).toFixed(4));
                }

            });


            editardetrecurso=function(){
                $('.editdetrecurso').unbind();
                $('.editdetrecurso').click(function(){
                    var iddr = $(this).attr('iddr');
                    var tip = $('#detrecursotipo_'+iddr).attr('idtip');
                    var desc = $('#detrecursodescripcion_'+iddr).html();
                    var uni = $('#detrecursounidadmedida_'+iddr).attr('iduni');
                    var prec = $('#detrecursopreciomaterialunitario_'+iddr).html();
                    var tarif = $('#detrecursotarifareferencia_'+iddr).html();
                    var jorn = $('#detrecursojornadareferencia_'+iddr).html();
                    var costohora = $('#detrecursocostohorareferencia_'+iddr).html();
                    var rend = $('#detrecursorendimientoreferencia_'+iddr).html();
                    var cant = $('#detrecursocantidadreferencia_'+iddr).html();
                    var otroindi = $('#detrecursootroindirecto_'+iddr).html();
                    var cost = $('#detrecursocostoreferencia_'+iddr).html();
                    //limpia primero
                    $('#op_tiporecurso').val('');
                    $('#id_descripcion').val('');
                    $('#op_unidadmedida').val('');
                    $('#id_cantidadreferencia').val('1.00');
                    $('#id_preciomaterialunitario').val('0.0000');
                    $('#id_tarifareferencia').val('0.0000');
                    $('#id_jornadareferencia').val('0.0000');
                    $('#id_costohorareferencia').val('0.0000');
                    $('#id_rendimientoreferencia').val('0.0000');
                    $('#id_otroindirecto').val('0.0000');
                    $('#id_costoreferencia').val('0.0000');
                    //luego carga

                    $('#op_tiporecurso').val(tip);
                    $('#id_descripcion').val(desc);
                    $('#op_unidadmedida').val(uni);
                    $('#id_cantidadreferencia').val(cant);
                    $('#id_preciomaterialunitario').val(prec);
                    $('#id_tarifareferencia').val(tarif);
                    $('#id_jornadareferencia').val(jorn);
                    $('#id_costohorareferencia').val(costohora);
                    $('#id_rendimientoreferencia').val(rend);
                    $('#id_otroindirecto').val(otroindi);
                    $('#id_costoreferencia').val(cost);
                    $('#adicionar_detrecurso_ing').hide();
                    $('#guardar_detrecurso_ing').show();
                    carga_por_tipo(tip);
                    $('#modalitemsdetrecurso').modal({backdrop:'static', width: '1200'}).modal('show');
                    $('#guardar_detrecurso_ing').attr({'iddr': iddr});

                });

                $(".filterable tr:has(td)").each(function(){
                    var t = $(this).text().toLowerCase();
                    $("<td class='indexColumn'></td>").hide().text(t).appendTo(this);
                });

                $("#FilterTextBox").keyup(function(){
                    var s = $(this).val().toLowerCase().split(" ");
                    $(".filterable tr:hidden").show();
                    $.each(s, function(){
                        $(".filterable tr:visible .indexColumn:not(:contains('" + this + "'))").parent().hide();
                    });
                    $(".filterable3 tr:hidden").show();
                });


                $('#guardar_detrecurso_ing').unbind();
                $("#guardar_detrecurso_ing").click(function () {
                    var iddr = $(this).attr('iddr');
                    var tip = parseInt($('#op_tiporecurso').val());
                    var des = $('#id_descripcion').val();
                    var unid = parseInt($('#op_unidadmedida').val());
                    var cant = $('#id_cantidadreferencia').val();
                    var prec = $('#id_preciomaterialunitario').val();
                    var tarif = $('#id_tarifareferencia').val();
                    var jorn = $('#id_jornadareferencia').val();
                    var rend = $('#id_rendimientoreferencia').val();
                    var otroindi = $('#id_otroindirecto').val();
                    if( tip == 2){
                        jorn = '0.0000';
                        prec = '0.0000';
                    }
                    if(tip == 3){
                        tarif = '0.0000';
                        prec = '0.0000';
                    }
                    if(tip == 4){
                        tarif = '0.0000';
                        jorn = '0.0000';
                        rend = '0.0000';
                    }
                    if(tip == 5){
                        prec = '0.0000';
                        jorn = '0.0000';
                        rend = '0.0000';
                    }
                    bloqueointerface();
                    $('#modalitemsdetrecurso').modal('hide');
                    $.ajax({
                        type: "POST",
                        url: "/ob_presupuestos",
                        data: {'action': 'editdetrecurso', 'iddr': iddr, 'des': des, 'tip': tip, 'unid': unid, 'cant': cant, 'prec': prec, 'tarif': tarif, 'jorn': jorn, 'rend': rend, 'otroindi': otroindi },
                        success: function(data) {
                            $.unblockUI();
                            if (data.result == 'ok'){
                                $('#contenidoitemsdetrecurso').html(data.plantilla);
                                $('#recursodescripcion_'+data.recursoid).html(data.recursodescripcion);
                                $('#recursounidadmedida_'+data.recursoid).html(data.recursounidadmedida);
                                $('#recursocostoequipos_'+data.recursoid).html(data.recursocostoequipos);
                                $('#recursocostosmanoobra_'+data.recursoid).html(data.recursocostosmanoobra);
                                $('#recursocostomateriales_'+data.recursoid).html(data.recursocostomateriales);
                                $('#recursocostotransporte_'+data.recursoid).html(data.recursocostotransporte);
                                $('#recursocostootros_'+data.recursoid).html(data.recursocostootros);
                                $('#recursocostototal_'+data.recursoid).html(data.recursocostototal);
                                $('#recursoindirectoutilidad_'+data.recursoid).html(data.recursoindirectoutilidad);
                                $('#recursovalor_'+data.recursoid).html(data.recursovalor);
                                $('#recursopreciounitario_'+data.recursoid).html(data.recursopreciounitario);
                                $('#recursototal_prgramado_'+data.recursoid).html('0.00');
                                $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                                $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                $('#presupuestototal').html(data.presupuestototal);
                                editardetrecurso();
                                conectar_controles_adddetrecurso();
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión");
                        },
                        dataType: "json"
                    });
                });
            };

            conectar_controles_adddetrecurso=function() {
                $('#adicionar_detrecurso').unbind();
                $('#adicionar_detrecurso').click(function () {
                    var idr = $(this).attr('idr');
                    $('#adicionar_detrecurso_ing').attr({'idr': idr});
                    //limpia primero
                    $('#op_tiporecurso').val('');
                    $('#id_descripcion').val('');
                    $('#op_unidadmedida').val('');
                    $('#id_cantidadreferencia').val('1.00');
                    $('#id_preciomaterialunitario').val('0.0000');
                    $('#id_tarifareferencia').val('0.0000');
                    $('#id_jornadareferencia').val('0.0000');
                    $('#id_costohorareferencia').val('0.0000');
                    $('#id_rendimientoreferencia').val('0.0000');
                    $('#id_otroindirecto').val('0.0000');
                    $('#id_costoreferencia').val('0.0000');
                    $('#adicionar_detrecurso_ing').show();
                    $('#guardar_detrecurso_ing').hide();
                    $('#modalitemsdetrecurso').modal({backdrop:'static', width: '1000'}).modal('show');
                });

                $("#op_unidadmedida, #id_descripcion, #op_tiporecurso").addClass("validate[required]");
                $("#id_cantidadreferencia, #id_costoreferencia, #id_valorreferencia").blur(function () {
                    numerico($(this), 0, 0, 2);
                    $('#id_valorreferencia').val(   (parseFloat($('#id_cantidadreferencia').val())*parseFloat($('#id_costoreferencia').val())).toFixed(2) );
                });

                $('.delitemdetrecurso').unbind();
                $('.delitemdetrecurso').click(function(){
                    var id = $(this).attr('iddr');
                    smoke.confirm("Desea eliminar?", function(e){
                        if (e){
                            $.ajax({
                                type: "POST",
                                url: "/ob_presupuestos",
                                data: {'action': 'delitemdetrecurso', 'id': id },
                                success: function(data) {
                                    if (data.result == 'ok') {
                                        $('#recursodescripcion_'+data.recursoid).html(data.recursodescripcion);
                                        $('#recursounidadmedida_'+data.recursoid).html(data.recursounidadmedida);
                                        $('#recursocostoequipos_'+data.recursoid).html(data.recursocostoequipos);
                                        $('#recursocostosmanoobra_'+data.recursoid).html(data.recursocostosmanoobra);
                                        $('#recursocostomateriales_'+data.recursoid).html(data.recursocostomateriales);
                                        $('#recursocostotransporte_'+data.recursoid).html(data.recursocostotransporte);
                                        $('#recursocostootros_'+data.recursoid).html(data.recursocostootros);
                                        $('#recursocostototal_'+data.recursoid).html(data.recursocostototal);
                                        $('#recursoindirectoutilidad_'+data.recursoid).html(data.recursoindirectoutilidad);
                                        $('#recursovalor_'+data.recursoid).html(data.recursovalor);
                                        $('#recursototal_prgramado_'+data.recursoid).html('0.00');
                                        $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                                        $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                        $('#presupuestototal').html(data.presupuestototal);
                                        $('#filaitemdetrecurso_'+id).remove();
                                    } else {
                                        $.unblockUI();
                                        smoke.alert(data.mensaje);
                                    }
                                },
                                error: function() {
                                    $.unblockUI();
                                    smoke.alert("Error de conexión");
                                },
                                dataType: "json"
                            });
                        }else{

                        }
                    }, {
                        ok: "Si",
                        cancel: "No",
                        classname: "custom-class",
                        reverseButtons: true
                    });

                });

                //Consulta los anexos de recurso para mostrarlos en el campo Codigo Anexos del Modal Adicionar
                buscar_recurso = function(query, process) {
                    var tp = $('#op_tiporecurso').val();
                    $.get("/reportes", {'action': 'data', 'model': 'AnexoRecurso:tipoanexo='+tp, 'p': 1, 'q': query, 's': 10}, function(data) {
                        if (data.result=='ok') {
                            $("#id_descripcion").get(0).results = data.results;
                            listing = [];
                            for (var i in data.results) {
                                var dato = data.results[i];
                                listing.push(dato.name);
                            }
                            process(listing);
                        }
                    }, "json");
                };

                //Actualiza los valores en el formulario Modal de Agregar
                updater_recurso = function(item) {
                    var results = $("#id_descripcion").get(0).results;
                    var tp = $('#op_tiporecurso').val();
                    var datos;
                    for (var i in results) {
                        datos = results[i];
                        if (item==datos.name) {
                            $("#id_descripcion").val(datos.alias[0]).attr("idanex", datos.id);
                            if (tp == 2){
                                $("#id_tarifareferencia").val(datos.alias[3]);
                            }
                            if (tp == 3){
                                $("#id_jornadareferencia").val(datos.alias[4]);
                            }
                            if (tp == 4){
                                $("#id_preciomaterialunitario").val(datos.alias[5]);
                            }
                            {#                        $("#descripcionrecurso").val(datos.alias[2]);#}
                            // Esto es lo que devuelve la funcion flexbox_alias(self): de la Clase NomencladorPresupuesto. Segun orden
                            return datos.alias[1];//Devuelvo recurso a la caja de texto
                        }
                    }
                    return item;
                };

                //Filtro de una lista de valores que se encuentren en la tabla de la BD
                $("#id_descripcion").typeahead({source: buscar_recurso, updater: updater_recurso}).change(function(){
                    {#                $("#recurso").val("").removeAttr('idr');#}
                });

                $('#adicionar_detrecurso_ing').unbind();
                $("#adicionar_detrecurso_ing").click(function () {
                    var idr = $(this).attr('idr');
                    var tip = parseInt($('#op_tiporecurso').val());
                    var des = $('#id_descripcion').val();
                    var unid = parseInt($('#op_unidadmedida').val());
                    var cant = $('#id_cantidadreferencia').val();
                    var prec = $('#id_preciomaterialunitario').val();
                    var tarif = $('#id_tarifareferencia').val();
                    var jorn = $('#id_jornadareferencia').val();
                    var rend = $('#id_rendimientoreferencia').val();
                    var otroindi = $('#id_otroindirecto').val();
                    bloqueointerface();
                    $('#modalitemsdetrecurso').modal('hide');
                    $.ajax({
                        type: "POST",
                        url: "/ob_presupuestos",
                        data: {'action': 'adddetrecurso', 'idr': idr, 'des': des, 'tip': tip, 'unid': unid, 'cant': cant, 'prec': prec, 'tarif': tarif, 'jorn': jorn, 'rend': rend, 'otroindi': otroindi },
                        success: function(data) {
                            $.unblockUI();
                            if (data.result == 'ok'){
                                $('#contenidoitemsdetrecurso').html(data.plantilla);
                                $('#recursodescripcion_'+data.recursoid).html(data.recursodescripcion);
                                $('#recursounidadmedida_'+data.recursoid).html(data.recursounidadmedida);
                                $('#recursocostoequipos_'+data.recursoid).html(data.recursocostoequipos);
                                $('#recursocostosmanoobra_'+data.recursoid).html(data.recursocostosmanoobra);
                                $('#recursocostomateriales_'+data.recursoid).html(data.recursocostomateriales);
                                $('#recursocostotransporte_'+data.recursoid).html(data.recursocostotransporte);
                                $('#recursocostootros_'+data.recursoid).html(data.recursocostootros);
                                $('#recursocostototal_'+data.recursoid).html(data.recursocostototal);
                                $('#recursovalor_'+data.recursoid).html(data.recursovalor);
                                $('#recursopreciounitario_'+data.recursoid).html(data.recursopreciounitario);
                                $('#recursototal_prgramado_'+data.recursoid).html('0.00');
                                $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                                $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                $('#presupuestototal').html(data.presupuestototal);
                                conectar_controles();
                                editardetrecurso();

                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión");
                        },
                        dataType: "json"
                    });
                });

            };

            planificador=function(){
                $('.valorcronrecurso').unbind();
                $('.valorcronrecurso').blur(function () {
                    var elemento = $(this);
                    numerico(elemento, 0, 0, 2);
                    var va = elemento.attr('va');
                    var idr = elemento.attr('idr');
                    var mes = elemento.attr('mes');
                    var valor = elemento.val();
                    if (parseFloat(valor)!=parseFloat(va)){
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'addcronorecurso', 'idr': idr, 'mes': mes, 'valor': valor },
                            success: function(data) {
                                if (data.result == 'ok'){
                                    if (data.superavalor == 1){
                                        elemento.css({"background-color":"lightsalmon"});
                                        elemento.val(va);
                                    }
                                    else {
                                        elemento.attr({'va': valor});
                                        elemento.css({"background-color":"white"});
                                        $('#recursototal_prgramado_'+idr).html(data.total_recursos);
                                    }
                                } else {
                                    elemento.val(va);
                                    elemento.css({"background-color":"lightred"});
                                }
                            },
                            error: function() {
                                elemento.val(va);
                                elemento.css({"background-color":"lightred"});
                            },
                            dataType: "json"
                        });
                    }
                });
            };

            conectar_controles=function() {
                $('#addrecurso').unbind();
                $('#addrecurso').click(function () {
                    var id = $(this).attr('idg');
                    $('#adicionar_recurso').attr({'idg': id});
                    $("#recurso").val("");
                    $('#modalitems').modal('show');
                });

                $('.delrecurso').unbind();
                $('.delrecurso').click(function(){
                    var id = $(this).attr('idr');
                    smoke.confirm("Desea eliminar?", function(e){
                        if (e){
                            $.ajax({
                                type: "POST",
                                url: "/ob_presupuestos",
                                data: {'action': 'delrecurso', 'id': id },
                                success: function(data) {
                                    if (data.result == 'ok') {
                                        $('#recursovalor_'+id).html(data.valor);
                                        $('#recursocantidad_'+id).html(data.cantidad);
                                        $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                                        $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                        $('#presupuestototal').html(data.presupuestototal);
                                        $('#filarecurso_'+id).remove();
                                    } else {
                                        $.unblockUI();
                                        smoke.alert(data.mensaje);
                                    }
                                },
                                error: function() {
                                    $.unblockUI();
                                    smoke.alert("Error de conexión");
                                },
                                dataType: "json"
                            });
                        }else{

                        }
                    }, {
                        ok: "Si",
                        cancel: "No",
                        classname: "custom-class",
                        reverseButtons: true
                    });

                });

                $('.cronorecurso').unbind();
                $('.cronorecurso').click(function () {
                    var id = $(this).attr('idr');
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/ob_presupuestos",
                        data: {'action': 'cronorecurso', 'id': id},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $('#contenidocronorecurso').html(data.plantilla);
                                $('#modalcronorecurso').modal({backdrop:'static', width: '300'}).modal('show');
                                planificador();
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión");
                        },
                        dataType: "json"
                    });
                });

                $('.detrecurso').unbind();
                $('.detrecurso').click(function () {
                    var id = $(this).attr('idr');
                    $("#FilterTextBox").val('');
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/ob_presupuestos",
                        data: {'action': 'itemsdetrecurso', 'idr': id},
                        success: function(data) {
                            $.unblockUI();
                            if (data.result == 'ok') {
                                $('#contenidoitemsdetrecurso').html(data.plantilla);
                                $('#modaldetrecurso').modal({backdrop:'static', width: '1000'}).modal('show');
                                {#                                aqui #}
                                $('#adicionar_detrecurso').attr({'idr':id});
                                $('#op_tiporecurso').empty();
                                $('#op_unidadmedida').empty();

                                for (var i in data.opciones) {
                                    var dato = data.opciones[i];
                                    $('#op_tiporecurso').append($('<option>', {
                                        value: dato[0],
                                        text: dato[1]
                                    }));
                                }

                                for (var i in data.unidad_medida) {
                                    var dato = data.unidad_medida[i];
                                    $('#op_unidadmedida').append($('<option>', {
                                        value: dato[0],
                                        text: dato[1]
                                    }));
                                }
                                conectar_controles_adddetrecurso();
                                editardetrecurso();
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error de conexión");
                        },
                        dataType: "json"
                    });
                });



                $('.cantidadrecurso').unbind();
                $('.cantidadrecurso').blur(function () {
                    var id = $(this).attr('idr');
                    var va = $(this).attr('va');
                    numerico($(this), 0, 0, 2);
                    var valor = $(this).val();
                    var elemento = $(this);
                    if(parseFloat(valor)!=parseFloat(va)){
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'editcantidarecurso', 'idr': id, 'cantidad': valor },
                            success: function(data) {
                                $.unblockUI();
                                if (data.result == 'ok'){
                                    elemento.attr({'va': valor});
                                    $('#recursovalor_'+id).html(data.valor);
                                    $('#recursocantidad_'+id).html(data.cantidad);
                                    $('#recursototal_prgramado_'+id).html('0.00');
                                    $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                                    $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                    $('#presupuestototal').html(data.presupuestototal);
                                    elemento.css({"background-color":"white"});
                                } else {
                                    elemento.val(va);
                                    elemento.css({"background-color":"lightsalmon"});
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                elemento.val(va);
                                elemento.css({"background-color":"lightsalmon"});
                            },
                            dataType: "json"
                        });

                    }
                });

            };


            items = function(){$('.items').click(function(){
                var id = $(this).attr('idg');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/ob_presupuestos",
                    data: {'action': 'items', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $('#contenidoitems').html(data.plantilla);
                            conectar_controles();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión");
                    },
                    dataType: "json"
                });
            });};

            $('#cerrarmodal').click(function(){
                $('#modalitems').modal('hide');
            });

            $('#guardarmodal').click(function(){
                $('#modalaitems').modal('hide');
                {#                var valor = $('#nombreitems').val().trim();#}
                var valor = $('#nombrerecurso').val().trim();
                var id = parseInt($('#guardarmodal').attr('id'));
                if(id > 0){
                    if (valor.length > 0){
                        $('#modalitems').modal('hide');
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'editrecurso', 'id': id, 'valor': valor},
                            success: function(data) {
                                if (data.result == 'ok') {
                                    $('#recursodescripcion_'+idg).html(valor);

                                } else {
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }
                }else{
                    if (valor.length > 0){
                        $('#modalitems').modal('hide');
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/ob_presupuestos",
                            data: {'action': 'addrecurso', 'id': id, 'valor': valor },
                            success: function(data) {
                                $.unblockUI();
                                if (data.result == 'ok'){
                                    $('#contenidoitems').html(data.plantilla);
                                    $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                                    $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                                    $('#presupuestototal').html(data.presupuestototal);
                                    conectar_controles();

                                } else {
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error de conexión");
                            },
                            dataType: "json"
                        });
                    }
                }
            });

            //Clic en Boton Adicionar en detalle del Formulario
            $("#itemsadicionar").click(function(){
                $("#repetido, #incompleto").hide();
                $("#recurso, #medidarecurso").val("");
                $("#recurso").removeAttr("idr");
                $("#modalitems").modal({backdrop:'static', width: '700'}).modal('show');
                return false;
            });

            //Consulta los riesgos de trabajo para mostrarlos en el campo Codigo Riesgo del Modal Adicionar
            buscar_recurso = function(query, process) {
                $.get("/reportes", {'action': 'data', 'model': 'NomencladorPresupuesto', 'p': 1, 'q': query, 's': 10}, function(data) {
                    if (data.result=='ok') {
                        $("#recurso").get(0).results = data.results;
                        listing = [];
                        for (var i in data.results) {
                            var dato = data.results[i];
                            listing.push(dato.name);
                        }
                        process(listing);
                    }
                }, "json");
            };

            //Actualiza los valores en el formulario Modal de Agregar
            updater_recurso = function(item) {
                var results = $("#recurso").get(0).results;
                var datos;
                for (var i in results) {
                    datos = results[i];
                    if (item==datos.name) {
                        $("#recurso").val(datos.alias[0]).attr("idr", datos.id);
                        {#                        $("#descripcionrecurso").val(datos.alias[2]);#}
                        // Esto es lo que devuelve la funcion flexbox_alias(self): de la Clase NomencladorPresupuesto. Segun orden
                        return datos.alias[1];//Devuelvo recurso a la caja de texto
                    }
                }
                return item;
            };

            //Filtro de una lista de valores que se encuentren en la tabla de la BD
            $("#recurso").typeahead({source: buscar_recurso, updater: updater_recurso}).change(function(){
                {#                $("#recurso").val("").removeAttr('idr');#}
            });

            actualizar_lista = function(){
                var lista = "";
                $(".eliminaritem").each(function(){
                    var elemento = $(this);
                    var id = elemento.attr('idr');//Id
                    var texto = elemento.attr('texto');//Medida
                    var acciond = elemento.attr('acciond');//detalle
                    var valor = texto.replace(":", "").replace(";", "");
                    lista+=(id+":"+valor+":"+acciond+";");
                });
                lista = lista.substring(0, lista.length - 1);
                $("#listariesgo").val(lista);
            };

            conectar_eliminar = function() {
                $(".eliminaritem").unbind();
                $(".eliminaritem").click(function () {
                    var id = $(this).attr('idr');
                    $('#elemto_' + id).remove();
                    if ($(".eliminaritem").length == 0){
                        $("#itemsbody").html("<tr><td colspan='4'>NO VALORES REGISTRADOS</td></tr>");
                    }
                    actualizar_lista();
                });
            };

            $("#modalitems .btn-cerrar").click(function() {
                $("#modalitems").modal("hide");
                return false;
            });

            $("#adicionar_recurso").click(function () {
                var idg = $(this).attr('idg');
                var idr = parseInt($('#recurso').attr('idr'));
                bloqueointerface();
                $('#modalitems').modal('hide');
                $.ajax({
                    type: "POST",
                    url: "/ob_presupuestos",
                    data: {'action': 'addrecurso', 'idg': idg, 'idr': idr },
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok'){
                            $('#contenidoitems').html(data.plantilla);
                            $('#grupovalor_'+data.grupoid).html(data.grupovalor);
                            $('#actividadvalor_'+data.actividadid).html(data.actividadvalor);
                            $('#presupuestototal').html(data.presupuestototal);
                            conectar_controles();

                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión");
                    },
                    dataType: "json"
                });
            });




        });
    </script>
{% endblock %}
{% block atras %}/ob_presupuestos{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4>
            <h5>Presupuesto: {{ presupuesto }}</h5>
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>
            {% if presupuesto.esta_diseno  %}
                <a href="javascript:;" id="addactividad" class='btn btn-success'><span class="fa fa-plus " ></span> Adicionar</a>
            {% endif %}
            <a class="btn btn-mini btn-warning tu" href="/ob_presupuestos?action=reporte&id={{ presupuesto.id }}"><i class="fa fa-table"></i> Reporte Presupuesto</a>
        </div>
    </div>
    <div class="row-fluid">
        <div class='span6'>
            <table class='table table-bordered'>
                <thead>
                <tr>
                    <th colspan="3" style="text-align: center">ACTIVIDADES</th>
                </tr>
                <tr>
                    <th>Descripci&oacute;n</th>
                    <th style="width: 100px; text-align: center">Valor</th>
                    <th style="width: 80px;"></th>
                </tr>
                </thead>
                <tbody>
                {% for actividad in actividades %}
                    <tr id="filaactividad_{{ actividad.id }}">
                        <td>{{ actividad.descripcion }}</td>
                        <td id="actividadvalor_{{ actividad.id }}" style="text-align: right">$ {{ actividad.valor|floatformat:2}}</td>
                        <td style="text-align: center">
                            {% if presupuesto.esta_diseno  %}
                                <a class="btn btn-mini btn-info tu editactividad" ida="{{ actividad.id }}" texto="{{ actividad.descripcion }}" title="Editar"><i class="fa fa-edit"></i></a>
                                <a class="btn btn-danger btn-mini tu delactividad" ida="{{ actividad.id }}"><i class="fa fa-remove"></i></a>
                            {% endif %}
                            <a class="btn btn-mini btn-success tu grupos" ida="{{ actividad.id }}" texto="{{ actividad.descripcion }}" title="Grupos"><i class="fa fa-list"></i></a>
                        </td>
                    </tr>
                {% endfor %}
                <tr>
                    <td style="text-align: right" >TOTAL</td>
                    <td id="presupuestototal" style="text-align: right">$ {{ presupuesto.valor|floatformat:2 }}</td>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class='span6'>
            <table class='table table-bordered' id="contenidogrupos">
                <thead>
                <tr>
                    <th colspan="3" style="text-align: center">DETALLE ACTIVIDAD</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td colspan="3">ACTIVIDAD NO SELECCIONADA</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row-fluid">
        <div class='span12'>
            <table class='table table-bordered' id="contenidoitems">
                <thead>
                <tr>
                    <th colspan="3" style="text-align: center">DETALLE</th>
                </tr>
                </thead>
                <tbody id="itemsbody" class="datatable">
                <tr>
                    <td colspan="3">NO VALORES REGISTRADOS</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="modal fade static" id="modalactividad">
        <div class="modal-header">
            <h4>Actividad</h4>
        </div>
        <div class="modal-body">
            <textarea id="nombreactividad" class="input-block-level" style="text-transform: uppercase"></textarea>
        </div>
        <div class="modal-footer">
            <a  href="javascript:;" id="guardarmodalactividad" class="btn btn-cerrar btn-info">Guardar</a>
            <a  href="javascript:;" id="cerrarmodalactividad" class="btn btn-cerrar btn-danger">Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="modalactividadgrupo">
        <div class="modal-header">
            <h4>Grupo</h4>
        </div>
        <div class="modal-body">
            <h6 id="nombreactividadgrupo"></h6>
            <textarea id="nombregrupo" class="input-block-level" style="text-transform: uppercase"></textarea>
        </div>
        <div class="modal-footer">
            <a  href="javascript:;" id="guardarmodalactividadgrupo" class="btn btn-cerrar btn-info">Guardar</a>
            <a  href="javascript:;" id="cerrarmodalactividadgrupo" class="btn btn-cerrar btn-danger">Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="modalitems" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Recursos</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-info" id="incompleto" style="display: none;">
                <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
            </div>
            <div class="alert alert-info" id="repetido" style="display: none;">
                <i class="fa fa-info-sign"></i> El Recurso ya ha sido agregado al detalle
            </div>
            Recurso
            <input type="text" id="recurso" class="input-block-level">
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="adicionar_recurso"><i class="fa fa-plus"></i> Adicionar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="modaldetrecurso" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Detalle de Recursos</h3>
        </div>
        <div class="modal-body panelbody">
            <input type="search" style="text-transform: uppercase; margin-bottom: 0px" class="input-block-level" id="FilterTextBox" name="FilterTextBox">
            <p></p>
            <div style="height: 400px; overflow-y: scroll;" id="contenidoitemsdetrecurso">

            </div>
            {% if presupuesto.esta_diseno  %}
                <a class="btn btn-mini btn-success" id="adicionar_detrecurso"  idr="{{ recurso.id }}" ><i class="fa fa-plus"></i> Adicionar</a>
            {% endif %}
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="modalitemsdetrecurso" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Recursos</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="row-fluid">
                <div class="alert alert-info" id="incompleto" style="display: none;">
                    <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                </div>
                <div class="alert alert-info" id="repetido" style="display: none;">
                    <i class="fa fa-info-sign"></i> El Recurso ya ha sido agregado al detalle
                </div>
                <table class='table table-bordered'>
                    <thead>
                    <tr>
                        <th style="width: 120px; text-align: center">Tipo</th>
                        <th style="width: 70px; text-align: center" id="th_rendimientoreferencia">Rendimiento</th>
                        <th >Descripcion</th>
                        <th style="width: 120px; text-align: center" id="th_unidadmedida">Unidad de Medida</th>
                        <th style="width: 70px; text-align: center">Cantidad</th>
                        <th style="width: 70px; text-align: center"  id="th_preciomaterialunitario">Precio Unt</th>
                        <th style="width: 70px; text-align: center"  id="th_tarifareferencia">Tarifa</th>
                        <th style="width: 70px; text-align: center" id="th_jornadareferencia">Jornada</th>
                        <th style="width: 70px; text-align: center" id="th_costohorareferencia">Costo Hora</th>
                        <th style="width: 70px; text-align: center">Otro Indirecto</th>
                        <th style="width: 70px; text-align: center">Costo</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <select id="op_tiporecurso" style="width: 80px" name="op_tiporecurso" class="selector" style="float: left; width: 120px;" >
                                <option selected="selected" value="">---------</option>
                            </select>
                        </td>
                        <td id="td_rendimientoreferencia"><input id="id_rendimientoreferencia" style="width: 80px" class="imp-moneda" type="text" name="rendimientoreferencia" value="0.0000"></td>
                        <td><input type="text" maxlength="250" id="id_descripcion" style="width: 100%; text-transform: uppercase "></td>
                        <td id="td_unidadmedida">
                            <select id="op_unidadmedida" class="selector" style="float: left; width: 120px;">
                                <option selected="selected" value="">---------</option>
                            </select>
                        </td>
                        <td id="td_preciomaterialunitario"><input id="id_preciomaterialunitario" style="width: 80px" class="imp-moneda" type="text" name="preciomaterialunitario" value="0.0000"></td>
                        <td><input type="text" value="1.00" style="width: 80px" class="imp-moneda" id="id_cantidadreferencia"></td>
                        <td id="td_tarifareferencia"><input id="id_tarifareferencia" style="width: 80px" class="imp-moneda" type="text" name="tarifareferencia" value="0.0000"></td>
                        <td id="td_jornadareferencia"><input id="id_jornadareferencia" style="width: 80px" class="imp-moneda" type="text" name="jornadareferencia" value="0.0000"></td>
                        <td id="td_costohorareferencia"><input id="id_costohorareferencia" style="width: 80px" class="imp-moneda" type="text" value="0.0000" name="costohorareferencia" readonly="True" disabled="True"></td>
                        <td><input id="id_otroindirecto" style="width: 80px" class="imp-moneda" type="text" name="otroindirecto" value="0.0000" ></td>
                        <td><input type="text" value="0.00" style="width: 80px" class="imp-moneda" id="id_costoreferencia" readonly="True" disabled="True"></td>

                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="adicionar_detrecurso_ing"><i class="fa fa-plus"></i> Adicionar</a>
            <a href="javascript:;" class="btn btn-success" id="guardar_detrecurso_ing"><i class="fa fa-plus"></i> Guardar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="modalcronorecurso" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Planificacion</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-info" id="superavalor" style="display: none;">
                <i class="fa fa-info-sign"></i> Valor superada al recurso: se recomienda $ <div id="valorrecomendado"></div>
            </div>
            <div style="height: 400px; overflow-y: scroll;">
                <table class='table table-bordered' id="contenidocronorecurso">
                    <thead>
                    <tr>
                        <th colspan="3" style="text-align: center">DETALLE</th>
                    </tr>
                    </thead>
                    <tbody id="itemsbody" class="datatable">
                    <tr>
                        <td colspan="3">NO VALORES REGISTRADOS</td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>

{% endblock %}
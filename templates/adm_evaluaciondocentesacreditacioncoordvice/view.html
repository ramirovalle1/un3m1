{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <script>



        $(function() {
            $("#id_fecha").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            addactividad = function(profesor,periodo) {
                $('#id_aplicardirectivo').prop('checked', false);
                $("#itemspaneltemas").modal({backdrop:'static', width: '400px'}).modal('show');
                $("#idprofesor").val(profesor);
                $("#idperiodo").val(periodo);

            };

            deleteactividad = function(idfechaprofe) {
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacioncoordvice",
                    data: {'action': 'delfechadocente', 'id': idfechaprofe, 'idfacu': {{ codifacu.id }} },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            $('#leyendafechas').html(data.apellido1+' '+data.apellido2+' '+data.nombres);
                            $('#codigofecha').val(data.codigofecha);
                            $("#deldirectivo").prop('checked', false);
                            $('#selectdeleteparesfechas').modal({'width': 800}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            };
            $("#adicionarycerraractividad").click(function() {
                var fecha = $("#id_fecha").val();
                var horaini = $("#id_horainicio").val();
                var horafin = $("#id_horafin").val();
                var idperiodo = $("#idperiodo").val();
                var idprofesor = $("#idprofesor").val();
                var lugar = $("#id_lugar").val();
                var apdirec = $("#id_aplicardirectivo").is(':checked');
                if (fecha== '' || horaini == ''){$("#itemspaneltemas .incompletotemas").show();return false;}
                $("#itemspaneltemas").modal("hide");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacioncoordvice",
                    data: {'action': 'addfechas', 'fecha': fecha, 'horaini': horaini, 'horafin': horafin, 'lugar': lugar, 'idperiodo': idperiodo, 'idprofesor': idprofesor, 'idfacu': {{ codifacu.id }}, 'apdirec': apdirec},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            $('#nombreactividad'+data.profesor).html('Fecha:'+data.fecha+'<br>Hora Inicio:'+data.hinicio+'<br>Hora Fin:'+data.hfin+'<br>Lugar: '+data.lugar+'<br><b>Creación:</b> '+data.creacion+'<br><a href="javascript:;" class="btn btn-tini btn-danger eliminarobj tu"  onclick="deleteactividad('+data.idfechasdocentes+')" title="Eliminar"><i class="fa fa-remove"></i></a>');
                            tooltips();
                            {#                            conectar_controlestemas();#}
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });
            $("#cerrartemas").click(function() {
                $("#itemspaneltemas .incompletotemas").hide();
                $("#itemspaneltemas .incompletovalotemas").hide();
                $("#itemspaneltemas").modal("hide");
            });

            $("#facu").change(function(){
                bloqueointerface();
                location.href='adm_evaluaciondocentesacreditacioncoordvice?action=consultacoordinacion&idfacu='+$(this).val();
            });
            $("#guardar").click(function() {
                var lista = actualizar_lista();
                var idcoordinacion = $('#idcoordinacion').val();
                var datos = {};
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacioncoordvice",
                    data: {'action': 'asignarevaluacionpar', 'listaprofesores': lista, 'idfacu': {{ codifacu.id }} },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos.");
                    },
                    success: function (data) {
                        if (data.result == "ok") {
                            location.href = 'adm_evaluaciondocentesacreditacioncoordvice';
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });

            actualizar_lista = function(){
                var lista = '';
                $('.selector').each(function() {
                    if ($(this).is(":checked")){
                        var idp = $(this).attr('idp');
                        var idc = $(this).attr('idc');
                        var elementos = $("tr[id^='evaluadorpersona_" + idp + "_" + idc + "']");
                        if (elementos.length > 0){
                            var evaluadores = '';
                            elementos.each(function(){
                                var ide = $(this).attr('idpe');
                                var actividades = '';
                                var elementosactividades = $('#actividad_' + idp + '_' + ide + ' span');
                                elementosactividades.each(function(){
                                    actividades += $(this).attr('ida') + "-";
                                });
                                if (actividades.length > 0){
                                    actividades = actividades.substring(0, actividades.length-1);
                                }

                                evaluadores += ide+ '=' + actividades + ":";
                            });
                            if (evaluadores.length > 0){
                                evaluadores = evaluadores.substring(0, evaluadores.length-1);
                            }
                            lista += idp + ',' + idc + ',' + evaluadores + '#';
                        }
                    }
                });
                if (lista.length > 0){
                    lista = lista.substring(0, lista.length-1);
                }
                return lista;
            };

            $('.selector').click(function(){
                var idp = $(this).attr('idp');
                var idc = $(this).attr('idc');
                if ($(this).is(":checked")) {
                    $('#addparbtn_'+idp+'_'+idc).show();
                } else {
                    $('#addparbtn_'+idp+'_'+idc).hide();
                }
            });

            verificarbotones = function(){
                $('.selector').each(function(){
                    var idp = $(this).attr('idp');
                    var idc = $(this).attr('idc');
                    if ($(this).is(":checked")) {
                        $('#addparbtn_'+idp+'_'+idc).show();
                    } else {
                        $('#addparbtn_'+idp+'_'+idc).hide();
                    }
                });
            };

            adicionaractividad = function(){
                $('.adicionaractividad').click(function(){
                    var idact = $(this).attr('idact');
                    var idp = $(this).attr('idp');
                    var ide = $(this).attr('ide');
                    $('#selectactividad_run').attr({'idp': idp, 'ide': ide});
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/adm_evaluaciondocentesacreditacioncoordvice",
                        data: {'action': 'listaactividades', 'id': idp, 'idfacu': {{ codifacu.id }}, 'idact': idact },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error al obtener los datos.");
                        },
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == "ok") {
                                $('#selectactividadlista').html(data.data);
                                $('#selectactividad').modal({'width': 800}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        }
                    });
                });
            };

            $('#selectpar_close').click(function(){
                $('#selectpar').modal('hide');
            });

            $('.addpar').click(function(){
                var idp = $(this).attr('idp');
                var idc = $(this).attr('idc');
                $('.selectorpar').each(function(){
                    $(this).prop('checked', false);
                });
                $(".filterable2 tr:hidden").show();
                $("#todos").prop('checked', false);
                $('#selectpar').modal({'width': 800}).modal('show');
                $('#selectpar_run').attr({'idp': idp, 'idc': idc});
                $('#FilterTextBox2').val('');
            });

            $('#selectactividad_close').click(function(){
                $('#selectactividad').modal('hide');
            });

            $('#selectactividad_run').click(function(){
                var idp = $(this).attr('idp');
                var ide = $(this).attr('ide');
                var bandera = 0;
                var idcoor = {{ codifacu.id }};
                var evaluadorest = '';
                $('.actividad').each(function(){
                    if ($(this).is(":checked")){
                        var ida = $(this).attr('ida');
                        evaluadorest += ida+ ":";
                        bandera = 1;

                    }
                });
                if(bandera==1) {
                    $('#actividad_'+idp+'_'+ide).empty();
                    $('#selectactividad').modal('hide');
                    lista = idp + ',' + ide + ',' + idcoor + ',' + evaluadorest;
                    lista = lista.substring(0, lista.length - 1);
                    $.ajax({
                        type: "POST",
                        url: "/adm_evaluaciondocentesacreditacioncoordvice",
                        data: {'action': 'addpar', 'listaprofe': lista, 'idfacu': idcoor},
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error al obtener los datos.");
                        },
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == "ok") {
                                $('#numactividad'+idp).html(data.mensajeactividades);
                                $('.actividad').each(function () {
                                    if ($(this).is(":checked")) {
                                        var ida = $(this).attr('ida');
                                        $('#actividad_' + idp + '_' + ide).append('<span class="smaller" ida="' + ida + '"> - ' + $('#nombreactividad_' + ida).html() + '</span><br>');
                                        evaluadorest += ida + ":";
                                    }
                                });
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        }
                    });
                }else {smoke.alert("Debe seleccionar actividades.");
                    return false}

            });

            $('#selectpar_run').click(function(){
                var idc = $(this).attr('idc');
                var idp = $(this).attr('idp');
                if ($("#todos").is(":checked")){
                    $('.selector').each(function(){
                        var idp = $(this).attr('idp');
                        $('.selectorpar').each(function(){
                            if ($(this).is(":checked")){
                                var idpe = $(this).attr('idpe');
                                var existe = document.getElementById('evaluadorpersona_' + idp + '_' + idc + '_'+ idpe);
                                if (!existe){
                                    $('#addparbtn_'+idp+'_'+idc).show();
                                    $('#miseleccionado_' + idp + '_' + idc).append('<tr id="evaluadorpersona_' + idp + '_' + idc + '_'+ idpe +'" idpe="' + idpe + '" >' +
                                        '<td style="width: 300px">' + $('#nombreseleccionado_' + idpe ).html()+'</td>' +
                                        '<td id="actividad_' + idp + '_'+ idpe +'"></td>' +
                                        '<td style="text-align: center; width: 50px">' +
                                        '<a class="btn btn-tini btn-info tu adicionaractividad" title="Actividades" ide="' + idpe + '" idp="' + idp + '"><i class="fa fa-list"></i></a> ' +
                                        '<a class="btn btn-tini btn-danger tu eliminarevaluador" idr="evaluadorpersona_' + idp + '_' + idc + '_'+ idpe +'" title="Eliminar" ide="' + idpe + '" idp="' + idp + '"><i class="fa fa-remove"></i></a>' +
                                        '</td>' +
                                        '</tr>')
                                }
                            }
                        });
                    });
                    $('.selector').attr('checked', true);
                } else {
                    $('.selectorpar').each(function(){
                        if ($(this).is(":checked")){
                            var idpe = $(this).attr('idpe');
                            var existe = document.getElementById('evaluadorpersona_' + idp + '_' + idc + '_'+ idpe);
                            if (!existe){
                                $('#miseleccionado_' + idp + '_' + idc).append('<tr id="evaluadorpersona_' + idp + '_' + idc + '_'+ idpe +'" idpe="' + idpe + '" >' +
                                    '<td style="width: 300px">' + $('#nombreseleccionado_' + idpe ).html()+'</td>' +
                                    '<td id="actividad_' + idp + '_'+ idpe +'"></td>' +
                                    '<td style="text-align: center; width: 50px">' +
                                    '<a class="btn btn-tini btn-info tu adicionaractividad" title="Actividades" ide="' + idpe + '" idp="' + idp + '" idact="evaluadoractpersona_' + idp + '_' + idc + '_'+ idpe +'""><i class="fa fa-list"></i></a> ' +
                                    '<a class="btn btn-tini btn-danger tu eliminarevaluador" idr="evaluadorpersona_' + idp + '_' + idc + '_'+ idpe +'" title="Eliminar" ide="' + idpe + '" idp="' + idp + '"><i class="fa fa-remove"></i></a>' +
                                    '</td>' +
                                    '</tr>')
                            }
                        }
                    });
                }
                $('#selectpar').modal('hide');
                conectarcontroles();
            });


            $("#eliminacionmodal_formbutton").click(function(){
                $('#selectdelete').modal('hide');
                var nomelimina = ''
                nomelimina = 'evaluadorpersona_'+ $('#idpersona').val()+'_'+$('#idcoordinacion').val()+'_'+$('#idevaluador').val()
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacioncoordvice",
                    data: {'action': 'eliminarasigpares', 'evaluado': $('#idpersona').val(),'idfacu': $('#idcoordinacion').val(),'evaluador': $('#idevaluador').val()},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            $('#numactividad'+$('#idpersona').val()).html(data.mensajeactividad);
                            $('#'+nomelimina).remove();
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });

            $("#eliminacionmodal_formbuttonfechadoc").click(function(){
                $('#selectdeleteparesfechas').modal('hide');
                var codigofecha = $("#codigofecha").val();
                var deldirectivo = $("#deldirectivo").is(':checked');
                $.ajax({
                    type: "POST",
                    url: "/adm_evaluaciondocentesacreditacioncoordvice",
                    data: {'action': 'eliminarfechadocente', 'codigofecha': codigofecha,'idfacu': $('#idcoordinacion').val(), 'deldirectivo':deldirectivo},
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al obtener los datos.");
                    },
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == "ok") {
                            $('#nombreactividad'+data.idprofesor).html('<a href="javascript:;" id="itemsadicionartema" class="btn btn-tini btn-success" onclick="addactividad('+data.idprofesor+','+data.idperiodo+')"><i class="fa fa-plus"></i></a>');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });

            $("#eliminacionmodal_cancel").click(function(){
                $('#selectdelete').modal('hide');
            });
            $("#eliminacionmodal_cancelfechadoc").click(function(){
                $('#selectdeleteparesfechas').modal('hide');
            });

            conectarcontroles = function(){
                $(".eliminarevaluador").unbind();
                $(".adicionaractividad").unbind();

                adicionaractividad();
                $(".eliminarevaluador").click(function(){
                    var iditem = $(this).attr('idr');
                    var coor = iditem.split("_");
                    coor=coor[2];
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/adm_evaluaciondocentesacreditacioncoordvice",
                        data: {'action': 'listadelpar', 'id': iditem, 'idfacu': coor },
                        error: function () {
                            $.unblockUI();
                            smoke.alert("Error al obtener los datos.");
                        },
                        success: function (data) {
                            $.unblockUI();
                            if (data.result == "ok") {
                                $('#leyenda').html(data.evaluador)
                                $('#idpersona').val(data.idevaluado)
                                $('#idcoordinacion').val(data.idcoordinacion)
                                $('#idevaluador').val(data.idevaluador)
                                $('#selectdelete').modal({'width': 800}).modal('show');
                            } else {
                                smoke.alert(data.mensaje);
                            }
                        }
                    });


                });

                tooltips();
            };

            verificarbotones();
            conectarcontroles();

            $(".filterable tr:has(td)").each(function(){
                var t = $(this).text().toLowerCase();
                $("<td class='indexColumn'></td>").hide().text(t).appendTo(this);
            });
            $("#FilterTextBox").keyup(function(){
                var s = $(this).val().toLowerCase().split(" ");
                $(".filterable tr:hidden").show();
                $.each(s, function(){
                    $(".filterable tr:visible .indexColumn:not(:contains('" + this + "'))").parent().hide();
                });
                $(".filterable3 tr:hidden").show();
            });

            $(".filterable2 tr:has(td)").each(function(){
                var t = $(this).text().toLowerCase();
                $("<td class='indexColumn'></td>").hide().text(t).appendTo(this);
            });
            $("#FilterTextBox2").keyup(function(){
                var s = $(this).val().toLowerCase().split(" ");
                $(".filterable2 tr:hidden").show();
                $.each(s, function(){
                    $(".filterable2 tr:visible .indexColumn:not(:contains('" + this + "'))").parent().hide();
                });
            });

            $("#instrumentos").change(function(){
                bloqueointerface();
                location.href = 'adm_evaluaciondocentesacreditacioncoordvice';
            });

            $(".imprimirinforme").click(function () {
                openwindow('POST' ,'/adm_evaluaciondocentesacreditacioncoordvice', {'action': 'reporteparevaluacion', 'idfacu': {{ codifacu.id }} },'_blank');
            });

            $("#add_cancel").click(function(){
                $('#itemspanel').modal('hide');
                $(".incompletoaddpreguntas").hide();
            });

            horainicio = $(".selectorhora");
            horainicio.timepicker({minuteStep: 1,appendWidgetTo: 'body', showSeconds: false, showMeridian: false, defaultTime: 'current'});
            fechainicio = $(".selectorfechainicio");
            fechainicio.datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){
                actualiza_fechainicio($(this));
            });

        });
    </script>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4>
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>
            <div class="btn-group ">
                <a class="btn dropdown-toggle " data-toggle="dropdown" href="#"> Reportes <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a class="imprimirinforme" href="javascript:;"><span class="fa fa-table"></span> Pares para evaluación de los profesores</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>
            <div>
                <select id="facu" name="facu" style="width: 100%">
                    {% for facultades in facultad %}
                        <option value="{{ facultades.id }}" {% if codifacu.id == facultades.id %} selected="selected"{% endif %}>{{ facultades.nombre }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="idcoordinacion" name="idcoordinacion" value="{{ codifacu.id }}">
                <input type="search" style="text-transform: uppercase; margin-bottom: 0px" class="input-block-level" id="FilterTextBox" name="FilterTextBox">
                <table class="table table-bordered filterable">
                    <thead>
                    <tr>
                        <th style="width: 30px"></th>
                        <th style="width: 300px;">Profesor a evaluar</th>
                        <th style="width: 150px">Coordinaci&oacute;n/Categorizaci&oacute;n</th>
                        <th style="width: 150px">Fecha</th>
                        <th>Par evaluador</th>
                    </tr>
                    </thead>
                    <tbody >
                    {% for profesor in listahoras %}
                        <tr>
                            <td style="text-align: center;">
                                {% with profesorseleccionado=proceso|args:profesor.distributivo__profesor|call:'profesor_seleccionado_parsin' evaluado=proceso|args:profesor.distributivo__profesor|call:'profesor_evaluado_parsin' %}
                                    <input type="checkbox" id="evaluado_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}" idp="{{ profesor.distributivo__profesor }}" idc="{{ coordinacion.id }}" class="selector" evaluadores='' {% if profesorseleccionado %}checked{% endif %} {% if notfinalizo %}disabled="disabled" {% endif %} {% if evaluado %}disabled="disabled" {% endif %}>
                                {% endwith %}
                            </td>
                            <td>
                                {{ profesor.distributivo__profesor__persona__apellido1 }}  {{ profesor.distributivo__profesor__persona__apellido2 }}  {{ profesor.distributivo__profesor__persona__nombres }} <br>{{ coordinacion.nombre }}<br>
                                {% with actividadesactiva=proceso.periodo|args:profesor.distributivo__profesor|call:'actividadesactivas' %}
                                    <label class="label label-info" id="numactividad{{ profesor.distributivo__profesor }}">{{ actividadesactiva }}</label>
                                {% endwith %}
                            </td>
                            <td>{{ profesor.distributivo__coordinacion__alias }}<br>{% if profesor.distributivo__profesor__categoria__nombre %}{{ profesor.distributivo__profesor__categoria__nombre }}<br>{% endif %}</td>
                            <td>
                                <table class="cell">
                                    <div id="nombreactividad{{ profesor.distributivo__profesor }}">
                                        {% with profesoresfechas=coordinacion|args:profesor.distributivo__profesor__id|args:proceso.periodo.id|args:profesor.distributivo__coordinacion_id|call:'docente_fechaspares' %}
                                            {% if profesoresfechas %}
                                                {% for fechaprofe in profesoresfechas %}
                                                    Fecha: {{ fechaprofe.fecha|date:"Y-m-d" }}<br>
                                                    Hora Inicio: {{ fechaprofe.horainicio|time:"G:i" }}<br>
                                                    Hora Fin: {{ fechaprofe.horafin|time:"G:i" }}<br>
                                                    Lugar: {{ fechaprofe.lugar }}<br>
                                                    {% if fechaprofe.usuario_creacion %}<b>Creación: </b>{{ fechaprofe.usuario_creacion }}<br>{% endif %}
                                                    {% if fechaprofe.usuario_modificacion %}<b>Modificación: </b>{{ fechaprofe.usuario_modificacion }}<br>{% endif %}
                                                    {#                                                    {% if finalizo %}#}
                                                    <a href="javascript:;" class="btn btn-tini btn-danger eliminarobj tu"  onclick="deleteactividad({{ fechaprofe.id }})"  idact="'+data.idprofesor+'" title="Eliminar"><i class="fa fa-remove"></i></a>
                                                    {#                                                    {% endif %}#}
                                                {% endfor %}
                                            {% else %}
                                                {#                                                {% if finalizo %}#}
                                                <a href="javascript:;" id="itemsadicionartema" class="btn btn-tini btn-success" onclick="addactividad({{ profesor.distributivo__profesor }},{{ idperiodo }})"><i class="fa fa-plus"></i></a>
                                                {#                                                {% endif %}#}
                                            {% endif %}
                                        {% endwith %}

                                    </div>
                                </table>
                            </td>
                            <td>
                                <div id="addparbtn_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}">
                                    <table class="table table-condensed filterable3" id="addpartabla_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}">
                                        <tbody id="miseleccionado_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}">
{#                                        {%  if periodo.id < 90 %}#}
                                            {% with evaluadoresseleccionados=proceso|args:profesor.distributivo__profesor|call:'evaluadores_seleccionados_partotal' %}
                                                {% if evaluadoresseleccionados %}
                                                    {% for detalle in evaluadoresseleccionados %}
                                                        <tr id="evaluadorpersona_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}_{{ detalle.evaluador.id }}" idpe="{{ detalle.evaluador.id }}">
                                                            <td style="width: 300px">{{ detalle.evaluador }}<br>
                                                                {% if detalle.usuario_creacion %}<b>Creación: </b>{{ detalle.usuario_creacion }}<br>{% endif %}
                                                                {% if detalle.usuario_modificacion %}<b>Modificación: </b>{{ detalle.usuario_modificacion }}<br>{% endif %}
                                                            </td>
                                                            <td id="actividad_{{ profesor.distributivo__profesor }}_{{ detalle.evaluador.id }}">
                                                                {% for actividad in detalle.mis_actividades %}
                                                                    <span class="smaller" ida="{{ actividad.detalledistributivo.id }}">
                                                                    - {{ actividad.detalledistributivo.nombre }}
                                                                        {% if actividad.usuario_creacion %}<b>Creación: </b>{{ actividad.usuario_creacion }}{% endif %}
                                                                        {% if actividad.usuario_modificacion %}<b>Modificación: </b>{{ actividad.usuario_modificacion }}{% endif %}
                                                                </span>{% if not forloop.last %}<br>{% endif %}
                                                                {% endfor %}
                                                            </td>
                                                            {#                                                        {% if finalizo %}#}
                                                            <td style="text-align: center; width: 50px">
                                                                {% with evaluado=proceso|args:profesor.distributivo__profesor|args:detalle.evaluador|args:coordinacion|call:'evaluado_por_par' %}
                                                                    {#                                                                    {% if not evaluado or persona.usuario.is_superuser %}#}
                                                                    {% if not evaluado %}
                                                                        <a class="tu btn btn-info btn-tini adicionaractividad" title="Actividades" ide="{{ detalle.evaluador.id }}" idp="{{ profesor.distributivo__profesor }}" idact="evaluadoractpersona_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}_{{ detalle.evaluador.id }}"><i class="fa fa-list"></i></a>
                                                                        <a class="btn btn-tini btn-danger tu eliminarevaluador" idr="evaluadorpersona_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}_{{ detalle.evaluador.id }}" title="Eliminar" ><i class="fa fa-remove"></i></a>
                                                                    {% endif %}
                                                                {% endwith %}
                                                            </td>
                                                            {#                                                        {% endif %}#}
                                                        </tr>
                                                    {% endfor %}
                                                {% endif %}
                                            {% endwith %}
{#                                        {% else %}#}
{#                                            {% with evaluadoresseleccionados=proceso|args:profesor.distributivo__profesor|args:coordinacion.id|call:'evaluadores_seleccionados_partotal_coordinacion' %}#}
{#                                                {% if evaluadoresseleccionados %}#}
{#                                                    {% for detalle in evaluadoresseleccionados %}#}
{#                                                        <tr id="evaluadorpersona_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}_{{ detalle.evaluador.id }}" idpe="{{ detalle.evaluador.id }}">#}
{#                                                            <td style="width: 300px">{{ detalle.evaluador }}<br>#}
{#                                                                {% if detalle.usuario_creacion %}<b>Creación: </b>{{ detalle.usuario_creacion }}<br>{% endif %}#}
{#                                                                {% if detalle.usuario_modificacion %}<b>Modificación: </b>{{ detalle.usuario_modificacion }}<br>{% endif %}#}
{#                                                            </td>#}
{#                                                            <td id="actividad_{{ profesor.distributivo__profesor }}_{{ detalle.evaluador.id }}">#}
{#                                                                {% for actividad in detalle.mis_actividades %}#}
{#                                                                    <span class="smaller" ida="{{ actividad.detalledistributivo.id }}">#}
{#                                                                    - {{ actividad.detalledistributivo.nombre }}#}
{#                                                                        {% if actividad.usuario_creacion %}<b>Creación: </b>{{ actividad.usuario_creacion }}{% endif %}#}
{#                                                                        {% if actividad.usuario_modificacion %}<b>Modificación: </b>{{ actividad.usuario_modificacion }}{% endif %}#}
{#                                                                </span>{% if not forloop.last %}<br>{% endif %}#}
{#                                                                {% endfor %}#}
{#                                                            </td>#}
                                                            {#                                                        {% if finalizo %}#}
{#                                                            <td style="text-align: center; width: 50px">#}
{#                                                                {% with evaluado=proceso|args:profesor.distributivo__profesor|args:detalle.evaluador|args:coordinacion|call:'evaluado_por_par' %}#}
                                                                    {#                                                                    {% if not evaluado or persona.usuario.is_superuser %}#}
{#                                                                    {% if not evaluado %}#}
{#                                                                        <a class="tu btn btn-info btn-tini adicionaractividad" title="Actividades" ide="{{ detalle.evaluador.id }}" idp="{{ profesor.distributivo__profesor }}" idact="evaluadoractpersona_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}_{{ detalle.evaluador.id }}"><i class="fa fa-list"></i></a>#}
{#                                                                        <a class="btn btn-tini btn-danger tu eliminarevaluador" idr="evaluadorpersona_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}_{{ detalle.evaluador.id }}" title="Eliminar" ><i class="fa fa-remove"></i></a>#}
{#                                                                    {% endif %}#}
{#                                                                {% endwith %}#}
{#                                                            </td>#}
                                                            {#                                                        {% endif %}#}
{#                                                        </tr>#}
{#                                                    {% endfor %}#}
{#                                                {% endif %}#}
{#                                            {% endwith %}#}
{#                                        {% endif %}#}
                                        </tbody>
                                    </table>
                                    {#                                    {% if finalizo %}#}
                                    <a class="btn btn-tini btn-success addpar" id="addpar_{{ profesor.distributivo__profesor }}_{{ coordinacion.id }}" idp="{{ profesor.distributivo__profesor }}" idc="{{ coordinacion.id }}"><i class="fa fa-plus"></i> Seleccionar</a>
                                    {#                                    {% endif %}#}
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {#        {% if not finalizo %}#}
        {#            <div class='row-fluid'>#}
        {#                <div class='span12'>#}
        {#                    <a class="btn btn-success" href="javascript:;" id="guardar">Guardar</a>#}
        {#                </div>#}
        {#            </div>#}
        {#        {% endif %}#}
        <div class="modal fade static" id="selectpar" style="display: none;">
            <div class="modal-header">
                <h4 id="paneltitle">Seleccionar Par</h4>
            </div>
            <div class="modal-body" id="selectpar-body">
                <div style="height: 300px; overflow-y: scroll">
                    <input type="search" style="text-transform: uppercase; margin-bottom: 0px" class="input-block-level" id="FilterTextBox2" name="FilterTextBox2">
                    <table class="table table-bordered filterable2">
                        <thead>
                        <tr>
                            <th style="width: 50px;"></th>
                            <th>Par</th>
                            <th>Coordinacion</th>
                            <th>Grupos</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for distributivo in profesoresevaluadores %}
                            <tr id="fila_{{ distributivo.profesor.persona.id }}" class="fila">
                                <td style="text-align: center">
                                    <input type="checkbox" class="selectorpar" idpe="{{ distributivo.profesor.persona.id }}"/>
                                </td>
                                <td id="nombreseleccionado_{{ distributivo.profesor.persona.id }}">
                                    {{ distributivo.profesor.persona }}
                                    {% if not distributivo.tablaponderacion %}
                                        <br/><span class="label label-warning">No tiene asignada tabla de ponderación.</span>
                                    {% endif %}
                                </td>
                                <td>{{ distributivo.coordinacion.alias|default_if_none:"" }}</td>
                                <td>
                                    {% for grupo in distributivo.profesor.persona.grupos %}
                                        {{ grupo }}{% if not forloop.last %},{% endif %}
                                    {% endfor %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <div style="float: left; vertical-align: middle">
                    <input type="checkbox" id="todos"> Adicionar a todos
                </div>
                <div style="float: right">
                    <a id="selectpar_run" class="btn btn-success">Seleccionar</a>
                    <a id="selectpar_close" class="btn">Cerrar</a>
                </div>
            </div>
        </div>
        <div class="modal fade static" id="selectactividad" style="display: none;">
            <div class="modal-header">
                <h4 id="paneltitle">Seleccionar actividades</h4>
            </div>
            <div class="modal-body" id="selectpar-body">
                <div style="height: 300px; overflow-y: scroll">
                    <table class="table table-bordered filterable2">
                        <thead>
                        <tr>
                            <th style="width: 50px;"></th>
                            <th>Actividad</th>
                            <th style="width: 150px">Criterio</th>
                            <th style="width: 10px"></th>
                        </tr>
                        </thead>
                        <tbody id="selectactividadlista">

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <div style="float: right">
                    <a id="selectactividad_run" class="btn btn-success">Guardar</a>
                    <a id="selectactividad_close" class="btn">Cerrar</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="selectdelete" style="min-height: 60px">
        <div class="modal-header">
            <h4 id="paneltitle">Eliminar asignación de pares</h4>
        </div>
        <div class="modal-body" id="selectdeletepar-body">
            <input type='hidden' id="idpersona" name="idpersona" value=""/>
            <input type='hidden' id="idcoordinacion" name="idcoordinacion" value=""/>
            <input type='hidden' id="idevaluador" name="idevaluador" value=""/>
            <p style="margin-top: 10px;">Esta seguro(a) que desea eliminar: <b id="leyenda"></b></p>
        </div>
        <div class="modal-footer">
            <p style="text-align: right; margin-bottom: 0">
                <a href="javascript:;" id="eliminacionmodal_formbutton" class='btn btn-danger btn-form'> {% block botonlabel %}Eliminar{% endblock %}</a>
                <a href="javascript:;" id="eliminacionmodal_cancel" class="btn btn-info"> Cerrar</a>
            </p>
        </div>
        <div>

            <div class="modal fade static" id="itemspaneltemas" style="display: none;">
                <div class="modal-header">
                    <h3 class="paneltitle">Adicionar fecha</h3>
                </div>
                <div class="modal-body panelbody">
                    <div class="alert alert-info incompletotemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
                    </div>
                    <div class="alert alert-danger" id="incompletovalorestemas" style="display: none;">
                        <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la fecha/hora HASTA
                    </div>
                    <div class="alert alert-danger" id="alertaingresotemas" style="display: none;"> NO TIENE ACTIVIDADES</div>
                    <div class="row-fluid">
                        <form id="formulario2" class='form-vertical' action="" method="POST" >
                            {% for field in form %}
                                {% if field.field.widget.attrs.separator %}
                                    <div style="width: 100%; height: 1px; float: left;"></div>
                                {% endif %}
                                <fieldset id="fieldset_{{ field.name }}" class="control-group nomargins" style="min-height:35px; float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}" >
                                    <div class="control-label label-text" {% if field.field.widget.attrs.labelwidth %}labelwidth="{{ field.field.widget.attrs.labelwidth }}"{% endif %} style="display: table;height: 30px;">
                                        <div style="display: table-cell; vertical-align: middle; line-height: 11px">
                                            <label for="id_{{ field.name }}" style="padding-right: 20px">{{ field.label }}</label>
                                        </div>
                                    </div>
                                    <div class="control" style="float: left; width: {% if field.field.widget.attrs.controlwidth %}{{ field.field.widget.attrs.controlwidth }}{% else %}100%{% endif %}">
                                        {% if field.field.widget.attrs.select2search %}
                                            <select id="id_{{ field.name }}_select2" {% if field.field.widget.attrs.disabled %}disabled=""{% endif %} >
                                                <option value="0" selected="selected">---------</option>
                                            </select>
                                            <input name="{{ field.name }}" id="id_{{ field.name }}" value="{{ field.value }}" hidden="hidden" {% if field.field.widget.attrs.descripcion %}descripcion="{{ field.field.widget.attrs.descripcion }}"{% endif %} class="select2hidden">
                                        {% else %}
                                            {{ field }}
                                        {% endif %}
                                        <p class="help-text" style="font-size: xx-small; margin-bottom: 0; height: 13px; line-height: 13px">{{ field.help_text }} </p>
                                    </div>
                                </fieldset>
                            {% endfor %}
                            <input type="hidden" id="idprofesor" name="idprofesor">
                            <input type="hidden" id="idperiodo" name="idperiodo">
                        </form>
                        {#                <form id="formulario2" class='form-vertical' action="" method="POST" >#}
                        {#                    {{ form }}#}
                        {#                    <input type="hidden" name="codturno" id="codturno" value="0">#}
                        {#                    <input type="hidden" name="coddia" id="coddia" value="0">#}
                        {#                </form>#}
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="javascript:;" class="btn btn-success" id="adicionarycerraractividad"><i class="fa fa-plus"></i> Adicionar</a>
                    <a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrartemas">Cerrar</a>
                </div>
            </div>
            <div class="modal fade static" id="selectdeleteparesfechas" style="min-height: 60px">
                <div class="modal-header">
                    <h4 id="paneltitle">Eliminar fechas de docente </h4>
                </div>
                <div class="modal-body" id="selectdeletepar-body">
                    <input type="hidden" name="codigofecha" id="codigofecha" value="0">
                    <p style="margin-top: 10px;">Esta seguro(a) que desea eliminar: <b id="leyendafechas"></b></p>
                    <p style="margin-top: 10px;">Eliminar tambien la fecha, lugar y hora en Directivo? <input type="checkbox" id="deldirectivo"></p>
                </div>
                <div class="modal-footer">
                    <p style="text-align: right; margin-bottom: 0">
                        <a href="javascript:;" id="eliminacionmodal_formbuttonfechadoc" class='btn btn-danger btn-form'> Eliminar</a>
                        <a href="javascript:;" id="eliminacionmodal_cancelfechadoc" class="btn btn-info"> Cerrar</a>
                    </p>
                </div>
            </div>

{% endblock %}
{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <style type="text/css">
        .icon-success {
            color: #5CB85C;
        }
        .icon-critical {
            color: red;
        }
    </style>
    <style type="text/css">
        /*COLORES
        $aqua: #7FDBFF
        $blue: #0074D9
        $navy: #001F3F
        $teal: #39CCCC
        $green: #2ECC40
        $olive: #3D9970
        $lime: #01FF70
        // Warm
        $yellow: #FFDC00
        $orange: #FF851B
        $red:    #FF4136
        $fuchsia: #F012BE
        $purple: #B10DC9
        $maroon: #85144B
        // Gray Scale
        $white: #fff
        $silver: #ddd
        $gray:  #aaa
        $black: #111*/
        .modal-header {
            padding: 9px 15px;
            border-bottom: 1px solid #ddd;
            background-color: #eaf5e2;
            color: #3f572c;
            border-radius: 6px 6px 0 0;
        }


        .radio label,
        .checkbox label {
            display: inline-block;
            cursor: pointer;
            color: #0074D9;
            position: relative;
            padding: 5px 15px 5px 51px;
            font-size: 1em;
            border-radius: 5px;
            -webkit-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease; }
        .radio label:hover,
        .checkbox label:hover {
            background: rgba(255, 65, 54, 0.1); }
        .radio label:before,
        .checkbox label:before {
            content: "";
            display: inline-block;
            width: 17px;
            height: 17px;
            position: absolute;
            left: 15px;
            border-radius: 50%;
            background: none;
            border: 3px solid #0074D9; }
        input[type="radio"] {
            display: none; }
        input[type="radio"]:checked + label:before {
            display: none; }
        input[type="radio"]:checked + label {
            padding: 5px 15px;
            background: #0074D9;
            border-radius: 2px;
            color: #fff; }
        .checkbox label:before {
            border-radius: 3px; }
        .checkbox input[type="checkbox"] {
            display: none; }
        .checkbox input[type="checkbox"]:checked + label:before {
            display: none; }
        .checkbox input[type="checkbox"]:checked + label {
            background: #0074D9;
            color: #fff;
            padding: 5px 15px; }
    </style>
    <script type="text/javascript">
        var materiasseleccionadas = [];
        var paralelosseleccionadas = [];
        {#var nivelesseleccionadas = [];#}
        var materiasseleccionadasPracticas = [];
        var asignatura = 0;
        var materiaseleccion = 0;
        var materiasmaximas = 0;
        var position = 0;
        var porciento_perdida_parcial_gratuidad = {{ porciento_perdida_parcial_gratuidad }};
        var total_materias_nivel = {{ total_materias_nivel }};
        var total_materias_pendientes_malla = {{ total_materias_pendientes_malla }};

        var descripcionrubroarancel = '';
        var valorrubroarancel = '';
        var rtlv = '{{ validartodo }}';

        {#$(function() {#}
        $(document).ready(function() {
            $("#listadotercera").val("");

            materiasmaximas = parseInt($('#id_materiasmaximas').attr('val'));

            actualizarfuncion = function(){
                var elemento;

                var iti = $(this).attr('iti');
                var codasignaturamalla = $(this).attr('codasignaturamalla');
                {#alert(codasignaturamalla)#}

                var asg = $(this).attr('ida');
                var mat = $(this).attr('idd');

                if(iti>0){
                    $('.recorrebotones').each(function(){
                        var coditinerario = $(this).attr('coditinerario');
                        var codmateriamalla = $(this).attr('codmateriamalla');
                        if (coditinerario>0){
                            if(coditinerario != iti){
                                $("#idasimalla"+codmateriamalla).hide();
                            }
                        }
                    });
                }
                var idnivel = $(this).attr('idnivel');
                var codpar = $(this).attr('codparalelo');
                {#                var estado = $(this).attr('estado');#}
                var item = {
                    idparalelo: codpar,
                    idnivel: idnivel,
                    idmateria: mat,
                    idasig: asg

                };
                paralelosseleccionadas.push(item);
                {#paralelosseleccionadas.push(codpar)#}
                materiasseleccionadas.push(mat);
                {#nivelesseleccionadas.push(idnivel);#}
                {#alert(nivelesseleccionadas)#}
                {#$("#materias, #matricular").modal('hide');#}
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/alu_automatricula",
                    data: {'action': 'conflictohorario', 'mismaterias': JSON.stringify(materiasseleccionadas), 'mispracticas': JSON.stringify(materiasseleccionadasPracticas), 'idm': mat, 'rtlv': rtlv},
                    success: function(data) {
                        //alert("Test");
                        $.unblockUI();
                        if (data.result == 'ok') {
                            if (data.datos.matprac){
                                eliminar(mat);

                                //$("#panelcontentpractica").html("<h4>"+data.datos.asignatura+"</h4><br><table class='table table-bordered table-striped' cellpadding='0' cellspacing='0'><tr><th>Horario</th><th style='width:30px;'>Disp.</th><th style='width:80px;'></th></tr><tbody id='tbody'></tbody></table>");
                                $("#panelcontentpractica").html("<h4>"+data.datos.asignatura+"</h4><br><table class='table table-bordered table-striped' cellpadding='0' cellspacing='0'><tr><th>Horario</th><th style='width:80px;'></th></tr><tbody id='tbody'></tbody></table>");
                                if (data.datos.disponibles > 0) {
                                    var presencupo = true;
                                    if (data.datos.tipomateria==2){
                                        if (data.datos.notvalihorcup){
                                            presencupo = false;
                                        }
                                    }
                                    for (var ini in data.datos.horarios) {
                                        var horario = data.datos.horarios[ini];
                                        var cupo= horario[2];
                                        if (!presencupo){
                                            cupo= "";
                                        }
                                        //$("#panelcontentpractica #tbody").append("<tr><td>" + horario[0] + "</td><td style='text-align: center'>" + cupo + "</td><td style='text-align: center'><a href='javascript:;' idp='" + horario[1] + "' idc='" + asg +"_"+ mat +"_"+ data.nivel +"_"+ horario[3] + "' class='btn btn-mini btn-info btn-mio selectmatpract'>Seleccionar</a></td></tr>");
                                        $("#panelcontentpractica #tbody").append("<tr><td>" + horario[0] + "<td style='text-align: center'><a href='javascript:;' idp='" + horario[1] + "' idc='" + asg +"_"+ mat +"_"+ data.nivel +"_"+ horario[3] + "' class='btn btn-mini btn-info btn-mio selectmatpract'>Seleccionar</a></td></tr>");
                                    }
                                    $('.selectmatpract').unbind('click.actualizarpractica');
                                    $('.selectmatpract').bind('click.actualizarpractica', actualizarpractica);
                                }
                                else{
                                    if(data.datos.abiertas > 0){
                                        //$("#panelcontentpractica #tbody").append("<tr><td colspan='3' style='text-align: center; color:#FF0000;'>NO EXISTEN CUPOS DISPONIBLES</td></tr>");
                                        $("#panelcontentpractica #tbody").append("<tr><td colspan='3' style='text-align: center; color:#FF0000;'>NO EXISTEN HORARIOS DE PRACTICAS</td></tr>");
                                    } else {
                                        $("#panelcontentpractica #tbody").append("<tr><td colspan='3' style='text-align: center'>NO EXISTEN PRACTICAS PROGRAMADAS</td></tr>");
                                    }
                                }
                                $(".materiasseleccionpracticamodal").modal({backdrop: 'static',width: '600px'}).modal('show');
                            }
                            else{
                                adicionar(asg, mat, data.nivel, '0', '0', codpar);
                                cerrarmodals()
                            }
                        } else {
                            eliminar(mat);
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        $("#materias, #matricular").modal('hide');
                        eliminar(mat);
                        smoke.alert("Error al enviar los datos.");
                    },
                    dataType: "json"
                });
            };

            actualizarpractica = function () {
                //alert("Practica");
                var elemento;
                var pm = $(this).attr('idp');
                var cade = $(this).attr('idc');
                var res  = cade.split("_");
                materiasseleccionadasPracticas.push([pm, res[3]]);
                materiasseleccionadas.push(res[1]);
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/alu_automatricula",
                    data: {'action': 'conflictohorario','rtlv': rtlv, 'mismaterias': JSON.stringify(materiasseleccionadas), 'mispracticas':JSON.stringify(materiasseleccionadasPracticas)},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            adicionar(res[0], res[1], res[2], pm,  res[3], 0);
                            $(".materiasseleccionpracticamodal").modal('hide');
                            cerrarmodals()
                        } else {
                            eliminarpractica(pm, res[3]);
                            eliminar(res[1]);
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        $(".materiasseleccionpracticamodal").modal('hide');
                        eliminarpractica(pm, res[3]);
                        eliminar(res[1]);
                        smoke.alert("Error al enviar los datos.");
                    },
                    dataType: "json"
                });
            };

            conectar_controles = function () {
                $(".selectmatpract").unbind();
                $(".selectmatpract").click(function () {
                    actualizarpractica()
                });
            };

            adicionar = function (asg, mat, nivel, pm, pa, codpar) {
                elemento =  $("[idd="+asg+"]");
                elemento.html('REMOVER');
                elemento.removeClass('btn-info');
                elemento.addClass('btn-danger');
                elemento.attr('ids',mat);
                elemento.attr('idpar',codpar);
                elemento.attr('idp',pm);
                elemento.attr('idpa',pa);
                materiaseleccion = materiasseleccionadas.length;
                $("#id_seleccionadas").html(materiaseleccion);
                $("#id_nivel").html(nivel);
                contarmaterias(nivel)
            };

            eliminar = function (mat) {
                for(var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                    if(materiasseleccionadas[i] === mat) {
                        materiasseleccionadas.splice(i, 1);
                    }
                }
            };

            eliminarparalelo = function (mat, matpar) {
                for(var i = materiasseleccionadas.length - 1; i >= 0; i--) {
                    if(materiasseleccionadas[i] === mat) {
                        {#paralelosseleccionadas.splice(i, 1);#}
                        for (j=0;j<paralelosseleccionadas.length;j++){
                            if (mat == paralelosseleccionadas[j]['idmateria']){
                                paralelosseleccionadas.splice(j,1)
                            }
                        }



                    }
                }
                {#for(var i = paralelosseleccionadas.length - 1; i >= 0; i--) {#}
                {#    if(paralelosseleccionadas[i] === matpar) {#}
                {#        paralelosseleccionadas.splice(i, 1);#}
                {#    }#}
                {# }#}
            };

            eliminarpractica = function (pm, pa) {
                for(var i = materiasseleccionadasPracticas.length - 1; i >= 0; i--) {
                    if(materiasseleccionadasPracticas[i][0] === pm && materiasseleccionadasPracticas[i][1] == pa) {
                        materiasseleccionadasPracticas.splice(i, 1);
                    }
                }
            };

            contarmaterias = function (nivel) {
                var contar = 0;
                var contar_materia_seleccionada = 0;
                {#                                    {% if tiene_reprobada %}#}
                {#                                        $(".nivelm").each(function( index,e ) {#}
                {#                                            if (($(e).attr("nivel")) == data.nivel){#}
                {#                                                contar = contar + 1#}
                {#                                            }#}
                {#                                        });#}
                {#                                    {% else %}#}
                $(".materia").each(function( index,e ) {
                    if (($(e).attr("nivel")) == nivel){
                        contar = contar + 1
                    }
                });
                $(".predecesores").each(function( index,e ) {
                    if (($(e).attr("nivel")) == nivel){
                        contar = contar + 1
                    }
                });
                {#                                    {% endif %}#}
                $(".materia").each(function( index,e ) {
                    if (($(e).attr("nivel")) == nivel){
                        if ($(e).html()=='REMOVER'){
                            contar_materia_seleccionada = contar_materia_seleccionada + 1
                        }
                    }
                });
                $("#id_materias_nivel_aperturadas").html(contar);
                $("#id_materias_seleccionadas_nivel_aperturadas").html(contar_materia_seleccionada);
            };

            $('.materia').click(function () {
                console.log("entra click materia");
                {#alert("Clic en seleccionar materia");#}

                var pm;
                var pa;
                var mat;
                var idnivel;
                var matpar;
                var tipoeje;
                position = $(this).attr("id");
                tipoeje = $(this).attr('tipomateria');

                //alert("Aqui es donde solo selecciona 1 materia si es 3 vez");

                if (materiaseleccion < materiasmaximas){
                    //alert("Es menor a");
                    if ($(this).attr('ids')){
                        $(this).removeClass('btn-danger');
                        $(this).addClass('btn-info');
                        mat = $(this).attr('ids');
                        $(this).removeAttr('ids');
                        matpar = $(this).attr('idpar');
                        $(this).removeAttr('idpar');
                        pm = $(this).attr('idp');
                        pa = $(this).attr('idpa');
                        idnivel = $(this).attr('nivel');
                        $(this).removeAttr('idpa');
                        $(this).html('SELECCIONAR');
                        eliminarparalelo(mat, matpar);
                        eliminar(mat);
                        eliminarpractica(pm, pa);
                        {#alert(idnivel)#}
                        materiaseleccion = materiasseleccionadas.length;
                        $("#id_seleccionadas").html(materiaseleccion);

                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/alu_automatricula",
                            data: {'action': 'conflictohorario_aux', 'mismaterias': JSON.stringify(materiasseleccionadas)},
                            success: function(data) {
                                $.unblockUI();
                                if (data.result == 'ok') {
                                    $("#id_nivel").html(data.nivel);
                                    contarmaterias(data.nivel)
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error al enviar los datos.");
                            },
                            dataType: "json"
                        });
                        {#PARA MOSTRAR TODOS LOS BOTONES ITINERARIOS EN CASO QUE NO HAYA SELECCIONADO NI UNO#}
                        var cuentaremover = 0
                        $('.recorrebotones').each(function(){
                            var codasignatura = $(this).attr('codasignatura');
                            var coditinerario = $(this).attr('coditinerario');
                            var codmateriamalla = $(this).attr('codmateriamalla');
                            if (coditinerario>0){
                                if ($("#"+codasignatura).html() == 'REMOVER'){
                                    cuentaremover = 1
                                }
                            }
                        });
                        if (cuentaremover == 0){
                            $('.recorrebotones').each(function(){
                                var codasignatura = $(this).attr('codasignatura');
                                var coditinerario = $(this).attr('coditinerario');
                                var codmateriamalla = $(this).attr('codmateriamalla');
                                if (coditinerario>0){
                                    $("#idasimalla"+codmateriamalla).show();
                                }
                            });
                        }
                    } else {
                        iti = $(this).attr('iti');
                        asignatura = $(this).attr('idd');
                        asignaturamalla = $(this).attr('idam');
                        estado = $(this).attr('estado');
                        var idnivel = $(this).attr('nivel');
                        var paralelo = '';
                        for (i=0;i<paralelosseleccionadas.length;i++){
                            if (idnivel == paralelosseleccionadas[i]['idnivel']) {
                                paralelo = paralelosseleccionadas[i]['idparalelo'];
                            }
                        }
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/alu_automatricula",
                            data: {'action': 'materiasabiertas', 'ida': asignatura, 'idam': asignaturamalla, 'paralelosseleccionadas': paralelo, 'nivel': {{ nivel.id }}, 'id': {{ inscripcion.id }} },
                            success: function(data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();
                                    $("#materias #tbody").html('');
                                    //$("#materias #panelcontent").html("<h4>"+data.asignatura+"</h4><br><table class='table table-bordered table-striped' cellpadding='0' cellspacing='0'><tr><th style='width:250px;'>Carrera/Paralelo</th><th>Horario</th><th style='width:100px;'>Sección</th><th style='width:80px;'>Inicio/Fin</th><th style='width:30px;'>Disp.</th><th style='width:30px;'>Cupo.</th><th style='width:80px;'></th></tr><tbody id='tbody'></tbody></table>");
                                    $("#materias #panelcontent").html("<h4>"+data.asignatura+"</h4><br><table class='table table-bordered table-striped' cellpadding='0' cellspacing='0'><tr><th style='width:250px;'>Carrera/Paralelo</th><th>Horario</th><th style='width:100px;'>Sección</th><th style='width:80px;'>Inicio/Fin</th><th style='width:80px;'></th></tr><tbody id='tbody'></tbody></table>");
                                    if (data.disponibles > 0){
                                        //alert("Data Disponivbles > 0");
                                        for (var i in data.materias){
                                            materia = data.materias[i];
                                            {#                                            $("#materias #tbody").append("<tr><td>"+materia.coordcarrera+" / <br> "+  materia.carrera +" / <br> "+  materia.paralelo +"</td><td>"+materia.profesor+"<br>["+materia.identificacion+"]<br>"+materia.horario+"</td><td>"+materia.session+"<br>"+materia.sede+"</td><td style='text-align: center'>"+materia.inicio+"<br>"+materia.fin+"</td><td style='text-align: center'>"+materia.cupo+"</td><td style='text-align: center'>"+materia.matriculados+"</td><td style='text-align: center'><a href='javascript:;' eje='"+tipoeje+"' ida='"+data.idd+"' idd='"+materia.id+"' estado='"+ estado +"' class='btn btn-mini btn-info btn-mio selectmat'>Seleccionar</a></td></tr>");#}
                                            var span = "";
                                            var cupo = materia.cupo;
                                            if (materia.tipomateria == 1){
                                                span = " <span class='label'>PRESENCIAL</span>"
                                            } else {
                                                span = " <span class='label label-inverse'>VIRTUAL</span>";
                                                {#if (materia.novalhorcup){#}
                                                {#    cupo = ""#}
                                                {# } #}
                                            }
                                            if (materia.teopract == 2) {
                                                span += " <span class='label label-warning tu' title='Teórica/Práctica'>TP</span>"
                                            }
                                            {#alert(paralelosseleccionadas)#}
                                            if(rtlv == '1')
                                                //$("#materias #tbody").append("<tr><td>"+  materia.carrera +" / <br> "+  materia.paralelo +"     "+ span +"</td><td>"+materia.horario+"</td><td>"+materia.session+"</td><td style='text-align: center'>"+materia.inicio+"<br>"+materia.fin+"</td><td style='text-align: center'>"+cupo+"</td><td style='text-align: center'><a href='javascript:;' eje='"+tipoeje+"' ida='"+data.idd+"' idnivel="+idnivel+" idd='"+materia.id+"' iti='"+iti+"' codasignaturamalla='"+asignaturamalla+"' codparalelo='"+materia.paralelo+"' estado='"+ estado +"' class='btn btn-mini btn-info btn-mio selectmat'>Seleccionar</a></td></tr>");
                                                $("#materias #tbody").append("<tr><td>"+  materia.carrera +" / <br> "+  materia.paralelo +"     "+ span +"</td><td>"+materia.horario+"</td><td>"+materia.session+"</td><td style='text-align: center'>"+materia.inicio+"<br>"+materia.fin+"</td><td style='text-align: center'><a href='javascript:;' eje='"+tipoeje+"' ida='"+data.idd+"' idnivel="+idnivel+" idd='"+materia.id+"' iti='"+iti+"' codasignaturamalla='"+asignaturamalla+"' codparalelo='"+materia.paralelo+"' estado='"+ estado +"' class='btn btn-mini btn-info btn-mio selectmat'>Seleccionar</a></td></tr>");
                                            else
                                                //$("#materias #tbody").append("<tr><td>"+  materia.carrera +" / <br> "+  materia.paralelo +"     "+ span +"</td><td>"+materia.horario+"</td><td>"+materia.session+"</td><td style='text-align: center'>"+materia.inicio+"<br>"+materia.fin+"</td><td style='text-align: center'><i class='fa fa-check icon-success'></i></td><td style='text-align: center'>"+cupo+"</td><td style='text-align: center'><a href='javascript:;' eje='"+tipoeje+"' idnivel="+idnivel+" ida='"+data.idd+"' idd='"+materia.id+"' iti='"+iti+"' codasignaturamalla='"+asignaturamalla+"'  codparalelo='"+materia.paralelo+"' estado='"+ estado +"' class='btn btn-mini btn-info btn-mio selectmat'>Seleccionar</a></td></tr>");
                                                $("#materias #tbody").append("<tr><td>"+  materia.carrera +" / <br> "+  materia.paralelo +"     "+ span +"</td><td>"+materia.horario+"</td><td>"+materia.session+"</td><td style='text-align: center'>"+materia.inicio+"<br>"+materia.fin+"</td><td style='text-align: center'><i class='fa fa-check icon-success'></i></td><td style='text-align: center'><a href='javascript:;' eje='"+tipoeje+"' idnivel="+idnivel+" ida='"+data.idd+"' idd='"+materia.id+"' iti='"+iti+"' codasignaturamalla='"+asignaturamalla+"'  codparalelo='"+materia.paralelo+"' estado='"+ estado +"' class='btn btn-mini btn-info btn-mio selectmat'>Seleccionar</a></td></tr>");
                                        }
                                        $('.selectmat').unbind('click.actualizarfuncion');
                                        $('.selectmat').bind('click.actualizarfuncion', actualizarfuncion);
                                    } else {
                                        if(data.abiertas > 0){
                                            if(!data.puede_seleccionar){
                                                $("#materias #tbody").append("<tr><td colspan='7' style='text-align: center; color:#FF0000;'>SOLO PUEDE SELECCIONAR MATERIAS POR 3ERA VEZ</td></tr>");
                                            }
                                            else
                                            if (data.notienehorario){
                                                $("#materias #tbody").append("<tr><td colspan='7' style='text-align: center; color:#FF0000;'>NO EXISTEN CUPOS DISPONIBLES</td></tr>");
                                            }
                                            else {
                                                $("#materias #tbody").append("<tr><td colspan='7' style='text-align: center; color:#FF0000;'>NO EXISTEN CUPOS DISPONIBLES</td></tr>");
                                            }
                                        } else {
                                            //alert(data.estaabierta);
                                            if(!data.estaabierta){
                                                $("#materias #tbody").append("<tr><td colspan='7' style='text-align: center; color:#FF0000;'>MATERIA NO ESTÁ ABIERTA,CONTACTAR A SU DIRECTOR/A DE CARRERA</td></tr>");
                                            }
                                            else
                                            if (data.notienehorario){
                                                $("#materias #tbody").append("<tr><td colspan='7' style='text-align: center; color:#FF0000;'>NO TIENE HORARIO</td></tr>");
                                            }
                                            else {
                                                $("#materias #tbody").append("<tr><td colspan='7' style='text-align: center'>NO EXISTEN MATERIAS PROGRAMADAS</td></tr>");
                                            }
                                        }
                                    }
                                    //$("#materias").modal('show');
                                    $("#materias").modal({backdrop:'static'}).modal('show');
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function() {
                                $.unblockUI();
                                smoke.alert("Error al enviar los datos.");
                            },
                            dataType: "json"
                        });
                    }
                } else {
                    $("#alertas #confmattxt").html('').append("<p>No puede seleccionar mas de la cantidad maxima de materias.</p>");
                    $("#alertas").modal('show');
                }
            });

            $('#btnmatricular').click(function () {
                //alert("Hola");

                position = $(this).attr("id");
                extra = '';
                extra2 = '';
                var contador = 0;
                if (materiasseleccionadas.length > 0){
                    var terceras = $('#listadotercera').val();
                    {#alert(terceras.split(",").length)#}
                    if (terceras.length > 0)
                    {
                        {#for (i=0;i<paralelosseleccionadas.length;i++){#}
                        {#    if (idnivel == paralelosseleccionadas[i]['idnivel']) {#}
                        {#        paralelo = paralelosseleccionadas[i]['idparalelo'];#}
                        {#    }#}
                        {# }#}
                        var t = terceras.split(",");
                        for (j1=0;j1<t.length;j1++){
                            for (j=0;j<paralelosseleccionadas.length;j++){
                                {#alert(t[j1]+"_"+paralelosseleccionadas[j])#}
                                if (t[j1] == paralelosseleccionadas[j]['idasig']) {
                                    contador +=1;
                                }
                            }
                        }
                        {#var t = terceras.split(",");#}
                        {#for (j1=0;j1<t.length;j1++){#}
                        {#    for (j=0;j<materiasseleccionadas.length;j++){#}
                        {#        alert(t[j1]+"_"+materiasseleccionadas[j])#}
                        {#        if (t[j1] == materiasseleccionadas[j]) {#}
                        {#            contador +=1;#}
                        {#        }#}
                        {#    }#}
                        {# }#}
                        if (contador < terceras.split(",").length) {
                            smoke.alert("Tiene asignaturas de matrículas por tercera vez pendiente por seleccionar.");
                            return false;
                        }
                    }

                    var cobro = 0;
                    {% if utiliza_gratuidades  %}
                        var nivel = $("#id_nivel").html();
                        var materias_nivel = $("#id_materias_nivel_aperturadas").html();
                        var materias_nivel_seleccionadas = $("#id_materias_seleccionadas_nivel_aperturadas").html();
                        var porcentaje_seleccionadas = Math.round(((materias_nivel * porciento_perdida_parcial_gratuidad)/100),0);
                        cobro = 0;
                        {% if not inscripcion.persona.tiene_otro_titulo %}
                            {% if inscripcion.estado_gratuidad == 1 or inscripcion.estado_gratuidad == 2 %}
                                if (materias_nivel_seleccionadas < porcentaje_seleccionadas){
                                    extra = "<p class='alert alert-danger' style='text-align: justify'>  Con base al Art.7 del Reglamento para garantizar el cumplimiento de la gratuidad emitido por el Concejo de Educaci&oacute;n Superior (CES) y en relaci&oacute;n al Art.5 del Reglamento interno para garantizar el ejercicio del derecho a la gratuidad en la Universidad Estatal de Milagro. Usted se ha matriculado en menos del {{ porciento_perdida_parcial_gratuidad|floatformat:0 }}% de las asignaturas correspondientes en su nivel del plan de estudios, por lo tanto no cumple para considerarse como ESTUDIANTE REGULAR. Deber&aacute; cancelar el valor correspondiente entre matr&iacute;cula y arancel</p>";
                                    cobro = 1;
                                }
                                else {
                                    {% if inscripcion.estado_gratuidad == 2 %}
                                        extra = "<p class='alert alert-danger' style='text-align: justify'>Con base al Art.5 del Reglamento para garantizar el cumplimiento de la gratuidad emitido por el Concejo de Educaci&oacute;n Superior (CES) y en relaci&oacute;n a los Arts. 6, 7 y 12 del Reglamento interno para garantizar el ejercicio del derecho a la gratuidad en la Universidad Estatal de Milagro. Su estado es P&Eacute;RDIDA PARCIAL DE LA GRATUIDAD y tendr&aacute; que cancelar el valor correspondiente entre matr&iacute;cula y arancel.</p>";
                                        cobro = 2;
                                    {% else %}
                                        extra = "<p class='alert alert-success' style='text-align: justify'>Ha seleccionado correctamente las asignatura de su nivel.</p>";
                                        cobro = 2;
                                    {% endif %}
                                }
                            {% else %}
                                extra = "<p class='alert alert-danger' style='text-align: justify'>Con base al Art.11 del Reglamento para garantizar el cumplimiento de la gratuidad emitido por el Concejo de Educaci&oacute;n Superior (CES) y en relaci&oacute;n al Art.11 del Reglamento interno para garantizar el ejercicio del derecho a la gratuidad en la Universidad Estatal de Milagro. Usted supera el 30% de las asignaturas reprobadas correspondientes al plan de estudios  como indica la Ley. Su estado es P&Eacute;RDIDA DEFINITIVA DE LA GRATUIDAD. A partir de este momento todas las asignaturas, cursos o sus equivalentes hasta la culminaci&oacute;n de su carrera, cancelar&aacute; los valores respectivos a matr&iacute;culas y aranceles.</p>";
                                cobro = 3;
                            {% endif %}
                        {% else %}
                            extra = "<p class='alert alert-danger' style='text-align: justify'>Con base al Art.5 tercer literal del Reglamento para garantizar el cumplimiento de la gratuidad emitido por el Concejo de Educaci&oacute;n Superior (CES) y en relaci&oacute;n al Art.4 segundo literal del Reglamento interno para garantizar el ejercicio del derecho a la gratuidad en la Universidad Estatal de Milagro. Por concepto de gratuidad se cubrir&aacute; un sola carrera por estudiante, usted mantiene X carreras financiadas por el Estado. Por la cual, se generar&aacute;n los valores respectivos por matr&iacute;cula y aranceles de las segundas o m&aacute;s carreras que no gocen de la gratuidad</p>";
                            cobro = 3;
                        {% endif %}
                        $("#cobro").val(cobro);
                        if (materias_nivel_seleccionadas < porcentaje_seleccionadas){
                            $("#tipo_matricula").val("2");
                        }
                        else{
                            $("#tipo_matricula").val("1");
                        }
                        extra2 = "<p>Una vez confirmada la matriculacion, podr&aacute; consultar los rubros a pagar, a trav&eacute;s del m&oacute;dulo Mis Finanzas </p>";
                    {% endif %}
                    {% if inscripcion.coordinacion.id != 7 %}
                        var $ul_terminos = $('[element="terminos-aceptacion-matricula"]', $('#el-templates')).clone();
                        $("#matricular #confmattxt").html(extra+"<div>"+$ul_terminos.html()+"</div><p>Al confirmar, usted se estar&iacute;a matriculando en <b>"+materiasseleccionadas.length+"</b> materia(s).</p>");
                        var h = $(window).height() - 150;
                        //console.log(h);
                        $("#matricular").modal({backdrop:'static', width: '80%',  height: h}).modal('show');
                    {% else %}
                        $("#matricular #confmattxt").html(extra+"<p>Al confirmar, usted se estar&iacute;a matriculando en <b>"+materiasseleccionadas.length+"</b> materia(s).</p>");
                        var h = $(window).height() - 150;
                        //console.log(h);
                        $("#matricular").modal({backdrop:'static', width: '50%',  height: h}).modal('show');
                    {% endif %}
                    //console.log($ul_terminos.html());


                }
                else {
                    $("#alertas #confmattxt").html("<p>Debe seleccionar al menos 1 materia</p>");
                    $("#alertas").modal({backdrop:'static'}).modal('show');
                }
            });

            $('.btn-cerrar').click(function () {
                cerrarmodals();
            });

            cerrarmodals = function () {
                $("#materias").modal('hide');
                $("#matricular").modal('hide');
                $("#alertas").modal('hide');
                $("#matricularmensajespanel").modal('hide');
            };

            $('.btn-cerrar2').click(function () {
                if(parseFloat($("#totalpagar").val())==0){
                    bloqueointerface();
                    location.href = '/';
                }else{
                    cerrarmodals();
                    $("#diferir #txtdiferirvalor").html("<p>¿Desea diferir el valor de <strong>$ "+valorrubroarancel+"</strong> del rubro <strong>"+descripcionrubroarancel+"</strong> a 3 meses?</p>");
                    $("#diferir").modal({backdrop:'static'}).modal('show');
                }
            });

            $('.btn-sidiferir').click(function () {
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/alu_automatricula",
                    data: {'action': 'diferirarancel','phase': $("#phase").val()},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $("#diferir #txtdiferirvalor").html("<p style='color: green'>El proceso ha sido realizado correctamente. Consulte los valores en Módulo Mis Finanzas</p>");
                            $("#btnsinodiferir").css('display', 'none');
                            $("#btnsaceptar").css('display', 'block');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                })
            });

            $('.btn-nodiferir').click(function () {
                $("#diferir").modal('hide');
                bloqueointerface();
                location.href = '/';
            });

            $('.btn-aceptardiferir').click(function () {
                $("#diferir").modal('hide');
                bloqueointerface();
                location.href = '/';
            });

            $('.btn-matricular').click(function(){

                {% if inscripcion.coordinacion.id != 7 %}
                    var acepto_terminos = $('[name="acepta-terminos"]', $("#matricular")).is(':checked');
                    if (!acepto_terminos){
                        NotificationJG.warning("Favor acepte los terminos", "Advertencia");
                        return false;
                    }
                    acepta_t = acepto_terminos ? 1 : 0
                {% else %}
                    acepta_t = 1
                {% endif %}
                $("#matricular").modal('hide');
                {#$("#matricularmensajespanel").modal('show').find("#confmattxt").html('').append("<p>Espere por favor.</p>");#}
                $("#matricularmensajespanel").modal({backdrop:'static'}).modal('show').find("#confmattxt").html('').append("<p>Espere por favor.</p>");
                $("#btnfinal1").attr('hidden','hidden');
                $("#btnfinal2").attr('hidden','hidden');
                inscripcion = $("#inscripcion").attr('valor');
                cobro = $("#cobro").val();
                tipo_matricula = $("#tipo_matricula").val();
                semestre = $("#id_nivel").val();
                $.post("/alu_automatricula", {'action': 'matricular', 'rtlv': rtlv, 'acepta_t': acepta_t, 'id': inscripcion, 'semestre': semestre ,'cobro': cobro,'nivel': '{{ nivel.id }}','tipo_matricula': tipo_matricula ,'materias':JSON.stringify(materiasseleccionadas) ,'practicas':JSON.stringify(materiasseleccionadasPracticas)}, function(data) {
                    if (data.result=='ok') {
                        $("#totalpagar").val(data.valorpagar);
                        $("#phase").val(data.phase);
                        descripcionrubroarancel = data.descripcionarancel;
                        valorrubroarancel = data.valorarancel;
                        if (data.valorpagar==0) {
                            $("#matricularmensajespanel").find("#confmattxt").html('').append("<p style='color: green'>Se ha matriculado correctamente.</p>");
                        }
                        else{
                            {#$("#matricularmensajespanel").find("#confmattxt").html('').append("<p style='color: green'>Se ha matriculado correctamente, valor a pagar <strong>$"+data.valorpagar+"</strong>, acercarse a cancelar dentro de 24 horas, de lo contrario su matrícula se eliminará de forma automática.</p>");#}
                            $("#matricularmensajespanel").find("#confmattxt").html('').append("<p style='color: green'>Se ha matriculado correctamente, valor a pagar <strong>$"+data.valorpagar+"</strong>. <br><strong>Nota:</strong> Usted tiene la opción de consultar el rubro generado en el módulo de finanzas</p>");
                        }
                        $("#btnfinal2").removeAttr('hidden').show();
                    } else {
                        $("#matricularmensajespanel").find("#confmattxt").html('').append("<p style='color: red'>"+data.mensaje+"</p>");
                        $("#btnfinal1").removeAttr('hidden').show();
                    }
                }, "json").error(function(){
                    $("#matricularmensajespanel").find("#confmattxt").html('').append("<p style='color: red'>No se pudo grabar la matricula. Intente nuevamente...</p>");
                    $("#btnfinal1").removeAttr('hidden').show();
                });



            });

            $('.predecesores').popover({
                placement : 'left',
                html : true,
                trigger : 'hover', //<--- you need a trigger other than manual
                delay: {
                    show: "500",
                    hide: "100"
                }
            });

            $('.predecesores').on('shown.bs.popover', function() {
                setTimeout(function() {
                    $('.predecesores').popover('hide');
                }, 1000);
            });

            $(".cerrarpanelpractica").click(function () {
                $(".materiasseleccionpracticamodal").modal('hide');
            });

            $('.notificacion').click(function () {
                $("#notificacion").modal({backdrop:'static', width: 500}).modal('show');
            });

            $("#notificacion_cerrar").click(function() {
                $("#notificacion").modal("hide");
            });

            $(".mostrardetalle_view").click(function() {
                {#$("#aprobarcerrar").css('display', 'none');#}
                console.log("eee");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/alu_automatricula",
                    data: {'action': 'verdetalle'},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodydetallepermiso").html(data.data);
                            $("#itemspanel").modal({backdrop:'static', width: '998px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $("#itemspanel .btn-cerrarpanel").click(function() {
                $("#itemspanel").modal("hide");
                return false;
            });

        });
        function tercera(a){
            var lista = $("#listadotercera").val();
            var lista_aux = '';
            if (lista.length == 0){
                $("#listadotercera").val(a);
            }
            else{
                lista_aux = lista + ','+ a
                $("#listadotercera").val(lista_aux);
            }
        }
    </script>

{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}
    {#    {% if utiliza_gratuidades %}#}
    {#        <div class="row-fluid">#}
    {#            <div class="span12">#}
    {#                {% if inscripcion.perdida_total_gratuidad  %}#}
    {#                    <p class="alert alert-danger">Ud. ha reprobado más del {{ porciento_perdida_total_gratuidad|floatformat:0 }}% de las horas correspondientes a las asignaturas con relación a su plan de estudios, por consecuencia ha perdido de manera definitiva su derecho a gratuidad. En el transcurso del período académico se le hará conocer los rubros a cancelar por concepto de arancel y matrícula por cada asignatura seleccionada.</p>#}
    {#                {% endif %}#}
    {#                {% if inscripcion.tiene_asignaturas_reprobadas %}#}
    {#                    <p class="alert alert-info">Recuerde: Si Ud. ha reprobado una o más asignaturas correspondientes a su plan de estudios, ha perdido de manera parcial su derecho a gratuidad. En el transcurso del período académico se le hará conocer los rubros a cancelar por concepto de arancel y matrícula por cada asignatura seleccionada que este reprobada.</p>#}
    {#                {% endif %}#}
    {#            </div>#}
    {#        </div>#}
    {#    {% endif %}#}
    {% if tercera_matricula %}
        <p class="alert alert-danger">Recuerde: que Ud. está aplicando ah una tercera matricula y por tal motivo solo puede seleccionar una sola Materia.</p>
    {% endif %}
    <div id="no-more-tables"><!-- inicio no more tables-->
        <div class='row-fluid'>
            <div class='span8'>
                <h4>{{ title }}</h4>
                <input type="hidden" name="listadotercera" id="listadotercera" value="">
                <table class='table table-bordered table-striped'>
                    <tr>
                        <th><h5 id='inscripcion' valor={{ inscripcion.id }}>Estudiante: {{ inscripcion.id }}</h5></th>
                        <td><h5>{{ inscripcion.persona }}</h5></td>
                    </tr>
                    <tr>
                        <th><h5>Carrera: </h5></th>
                        <td><h5>{{ inscripcion.carrera }}</h5></td>
                    </tr>
                    <tr>
                        <th><h5>Malla: </h5></th>
                        <td><h5>{{ malla }}</h5></td>
                    </tr>
                    <tr>
                        <th><h5> Nivel: </h5></th>
                        <td><h5>{{ nivel }}</h5></td>
                    </tr>
                    {% if inscripcion.numeroitinerario  %}
                        <tr>
                            <th><h5> Itinerario: </h5></th>
                            <td>
                                <label class="label label-warning smaller">ITINERARIO {{ inscripcion.numeroitinerario }}</label>
                            </td>
                        </tr>
                    {% endif %}
                </table>
                {% if validartodo != 0 %}
                    <div class="alert alert-info">
                        <a  href="javascript:;" class="close" data-dismiss="alert">×</a>
                        <h4 class="alert-heading">AVISO</h4>
                        Debes seleccionar las asignaturas en el mismo paralelo para evitar conflictos de horarios.
                    </div>
                {% endif %}
                {% if mensajeterceramatriculamateria %}
                    <div class="alert alert-danger">
                        <h4 class="alert-heading">AVISO</h4>
                        {{ mensajeterceramatriculamateria  }}.
                    </div>
                {% endif %}



                {% if fichasocioeconomicainec %}
                    <span class="label label-warning"><h5>Grupo Socio Económico: {{ fichasocioeconomicainec }}</h5></span>
                {% endif %}
            </div>

            <div class='span4'><br>
                <table class='table table-hover personal-task'>
                    <tbody style="font-weight: bold">
                    <input type='hidden' name='cobro' id="cobro" value=''/>
                    <input type='hidden' name='totalpagar' id="totalpagar" value=''/>
                    <input type='hidden' name='tipo_matricula' id="tipo_matricula" value=''/>
                    <input type='hidden' name='phase' id="phase" value=''/>
                    <tr>
                        <td><i class="fa fa-line-chart"></i> Nivel</td>
                        <td style="text-align: center;" id="id_nivel">0</td>
                    </tr>
                    <tr>
                        <td><i class="fa fa-book"></i> Asignaturas Nivel Aperturadas</td>
                        <td style="text-align: center;" id="id_materias_nivel_aperturadas">0</td>
                    </tr>
                    <tr>
                        <td> <i class="fa fa-list-ul"></i> Asignaturas Seleccionadas Nivel Aperturadas</td>
                        <td style="text-align: center;" id="id_materias_seleccionadas_nivel_aperturadas">0</td>
                    </tr>
                    <tr>
                        <td> <i class="fa fa-hand-o-up"></i> Asignaturas Seleccionadas</td>
                        <td style="text-align: center;" id="id_seleccionadas">0</td>
                    </tr>
                    <tr>
                        <td> <i class="fa fa-list-ol"></i> Totales</td>
                        <td style="text-align: center;" id="id_materiasmaximas" val="{% if not tercera_matricula %}{{ materiasmaximas }}{% else %}1{% endif %}">{% if not tercera_matricula %}{{ materiasmaximas }}{% else %}1{% endif %}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class='row-fluid'>
            <div class='span12'>
                <h4>ASIGNATURAS DE MI MALLA</h4>
                <table class='table table-bordered table-striped' >
                    <thead>
                    <tr style="font-weight: bold">
                        <th>Asignatura</th>
                        <th style="width: 150px;">Nivel</th>
                        <th style="width: 150px;">Eje Formativo</th>
                        <th style="width: 50px; text-align: center;">Cr&eacute;ditos</th>
                        <th style="width: 50px; text-align: center;">Horas</th>
                        <th style="width: 120px; text-align: center;">Disponible</th>
                        <th style="width: 120px; text-align: center;">Estado</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% if materiasmalla  %}
                        {% for materia in materiasmalla %}
                            <tr>
                                <td data-title='Asignatura:'>
                                    {#                                    {{ materia.asignatura }}#}
                                    {#                                    {% if materia.validarequisitograduacion %}#}
                                    {#                                        <span class='label label-info'>Debe cumplir requisito para titulación </span>#}
                                    {#                                    {% endif %}#}
                                    {% with totalrecordasignatura=inscripcion|args:materia.asignatura|call:"total_record_asignatura" estado=inscripcion|args:materia.asignatura|call:"estado_asignatura" %}
                                        {% if totalrecordasignatura > 1  %}
                                            <label class="label label-warning smaller"> {{ totalrecordasignatura }} MAT.</label>
                                            {% if totalrecordasignatura == 2 or totalrecordasignatura == 3  %}
                                                {% if estado != 1 %}
                                                    {% with planificada=nivel|args:materia.asignatura|call:"asignatura_planificada" %}
                                                        {% if planificada %}
                                                            <label class="label label-warning smaller"> {{ materia.asignatura }}</label>
                                                            <script type="text/javascript">
                                                                $(document).ready(function() {
                                                                    tercera({{ materia.asignatura.id }});
                                                                });
                                                            </script>
                                                        {% else %}
                                                            {{ materia.asignatura }}
                                                        {% endif %}
                                                    {% endwith %}
                                                {% else %}
                                                    {{ materia.asignatura }}
                                                {% endif %}
                                            {% else %}
                                                {{ materia.asignatura }}
                                            {% endif %}
                                        {% else %}
                                            {{ materia.asignatura }}
                                        {% endif %}
                                        {% if materia.itinerario  %}
                                            <label class="label label-warning smaller">ITINERARIO {{ materia.itinerario }}</label>
                                        {% endif %}
                                        {% if materia.validarequisitograduacion %}
                                            <span class='label label-info'>Debe cumplir requisito para titulación </span>
                                        {% endif %}
                                    {% endwith %}
                                    {#                                {{ materia.validarequisitograduacion }}#}
                                </td>
                                <td data-title='Nivel:' nivel="{{ materia.nivelmalla_id }}" class="nivelm">{{ materia.nivelmalla }}</td>
                                <td data-title='Eje Formativo:'>{{ materia.ejeformativo }}</td>
                                <td data-title='Créditos:' style="text-align: center;">{{ materia.creditos }}</td>
                                <td data-title='Horas:' style="text-align: center;">{{ materia.horas }}</td>
                                {#                        programada=materia.asignatura|args:nivel.periodo|call:"disponible_periodo"#}
                                {% with  puedetomar=inscripcion|args:materia.asignatura|call:"puede_tomar_materia" estado=inscripcion|args:materia.asignatura|call:"estado_asignatura"  totalmatriculaasignatura=inscripcion|args:materia.asignatura|call:"total_matricula_asignatura" %}
                                    <td data-title='Disponible:' style="text-align: center;" {% if puedetomar %}{% if estado != 1 %}{% if not materia.nivelmalla_id <= semestre %}height="30"{% endif %}{% else %}height="30"{% endif %}{% else %}{% if estado != 1 %}{% if not materia.cantidad_predecesoras  %}height="30"{% endif %}{% else %}height="30"{% endif %}{% endif %}>
                                        <div id="idasimalla{{ materia.id }}" codmateriamalla="{{ materia.id }}" codasignatura="{{ materia.asignatura_id }}" class="recorrebotones" coditinerario="{{ materia.itinerario }}" >
                                            {% if puedetomar %}
                                                {% if estado != 1 %}
                                                    {#                                                {% if materia.nivelmalla_id <= semestre %}#}
                                                    {#                                                                                                    {% with cantidad_materia=materia.asignatura|args:nivel.periodo|args:materia.nivelmalla|args:inscripcion.carrera|args:inscripcion.sesion|call:"cantidad_materia_nivel" %}#}
                                                    {% if totalmatriculaasignatura > 1 and not PUEDE_MATRICULARSE_OTRA_VEZ %}
                                                        <a  href="javascript:;" class="btn btn-info btn-mini notificacion">SELECCIONAR...</a>
                                                    {% else %}
                                                        {% if materia.validarequisitograduacion %}
                                                            {#                                                        {% if requisitosaprobados %}#}
                                                            {#                                                            <a  href="javascript:;" id="{{ materia.asignatura_id }}" idam="{{ materia.id }}" nivel="{{ materia.nivelmalla_id }}" estado="{{ estado }}" idd="{{ materia.asignatura_id }}" tipomateria="{{ materia.ejeformativo_id }}" class="btn btn-info btn-mini materia">SELECCIONAR</a>#}
                                                            {#                                                        {% else %}#}
                                                            <a class="btn btn-mini btn-warning mostrardetalle_view tu" title="Ver Detalle" href="javascript:;" ><i class="fa fa-list"></i></a>
                                                            <a iti="{{ materia.itinerario }}" href="javascript:;" id="{{ materia.asignatura_id }}" idam="{{ materia.id }}" nivel="{{ materia.nivelmalla_id }}" estado="{{ estado }}" idd="{{ materia.asignatura_id }}" tipomateria="{{ materia.ejeformativo_id }}" class="btn btn-info btn-mini materia">SELECCIONAR</a>
                                                            {#                                                        {% endif %}#}
                                                        {% else %}
                                                            {#                                                            {{ inscripcion.itinerario }}-#}
                                                            {#                                                            {{ inscripcion.numeroitinerario }}#}
                                                            {% if inscripcion.numeroitinerario  %}
                                                                {% if inscripcion.numeroitinerario ==  materia.itinerario %}
                                                                    <a iti="{{ materia.itinerario }}" href="javascript:;" id="{{ materia.asignatura_id }}" idam="{{ materia.id }}" nivel="{{ materia.nivelmalla_id }}" estado="{{ estado }}" idd="{{ materia.asignatura_id }}" tipomateria="{{ materia.ejeformativo_id }}" class="btn btn-info btn-mini materia">SELECCIONAR I</a>
                                                                {% elif not materia.itinerario %}
                                                                    <a iti="{{ materia.itinerario }}" href="javascript:;" id="{{ materia.asignatura_id }}" idam="{{ materia.id }}" nivel="{{ materia.nivelmalla_id }}" estado="{{ estado }}" idd="{{ materia.asignatura_id }}" tipomateria="{{ materia.ejeformativo_id }}" class="btn btn-info btn-mini materia">SELECCIONAR.</a>
                                                                {% endif %}
                                                            {% else %}
                                                                <a iti="{{ materia.itinerario }}" href="javascript:;" id="{{ materia.asignatura_id }}" idam="{{ materia.id }}" nivel="{{ materia.nivelmalla_id }}" estado="{{ estado }}" idd="{{ materia.asignatura_id }}" tipomateria="{{ materia.ejeformativo_id }}" class="btn btn-info btn-mini materia">SELECCIONAR.</a>
                                                            {% endif %}



                                                        {% endif %}
                                                    {% endif %}
                                                    {#                                                                                                    {% endwith %}#}
                                                    {#                                                {% endif %}#}
                                                {% endif %}
                                            {% else %}
                                                {% if estado != 1 %}
                                                    {% if materia.cantidad_predecesoras  %}
                                                        <a href="javascript:;" class="smaller predecesores" nivel="{{ materia.nivelmalla_id }}" data-placement="left" rel="popover" data-content="{% for precedencia in materia.lista_predecesoras %}{{ precedencia.predecesora.asignatura.nombre }}{% if not forloop.last %},<br>{% endif %}{% endfor %}" data-original-title="Precedencias"> {{ materia.cantidad_predecesoras }} precedencia{% if materia.cantidad_predecesoras > 1 %}s{% endif %} </a>
                                                    {% endif %}
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                    </td>
                                    {% if estado == 1  %}
                                        <td data-title='Estado:' class='estado' id='1' style="text-align: center;"><span class="label label-success">APROBADA</span></td>
                                    {% elif estado == 2%}
                                        <td data-title='Estado:' class='estado' id='0' style="text-align: center;"><span class="label label-important">REPROBADO</span></td>
                                    {% else %}
                                        {% if inscripcion.numeroitinerario  %}
                                            {% if materia.itinerario %}

                                                {% if inscripcion.numeroitinerario ==  materia.itinerario %}
                                                    <td data-title='Estado:' class='estado' id='0' style="text-align: center;"><span class="label label-warning">PENDIENTE I</span></td>
                                                {% else %}
                                                    <td data-title='Estado:' class='estado' id='0' style="text-align: center;">&nbsp;</td>
                                                {% endif %}
                                            {% else %}
                                                <td data-title='Estado:' class='estado' id='0' style="text-align: center;"><span class="label label-warning">PENDIENTE</span></td>
                                            {% endif %}
                                        {% else %}
                                            <td data-title='Estado:' class='estado' id='0' style="text-align: center;"><span class="label label-warning">PENDIENTE</span></td>
                                        {% endif %}
                                    {% endif %}
                                {% endwith %}
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="7" style="text-align: center">NO TIENE MALLA ASIGNADA</td></tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>

            <div class="row-fluid">
                <div class='span12'>
                    {#                    <h4>MATERIAS DE M&Oacute;DULO</h4>#}
                    {#                    <table class='table table-bordered table-striped'>#}
                    {#                        <thead>#}
                    {#                        <tr>#}
                    {#                            <th>Asignatura</th>#}
                    {#                            <th style="width: 120px; text-align: center;">Disponible</th>#}
                    {#                            <th style="width: 120px; text-align: center;">Estado</th>#}
                    {#                        </tr>#}
                    {#                        </thead>#}
                    {#                        <tbody>#}
                    {#                        {% for modulo in materiasmodulos %}#}
                    {#                            <tr>#}
                    {#                                <td data-title='Asignatura:'>{{ modulo.asignatura }}</td>#}
                    {#                    programada=modulo.asignatura|args:nivel.periodo|call:"disponible_periodo"#}
                    {#                                {% with puedetomar=inscripcion|args:modulo.asignatura|call:"puede_tomar_materia_modulo" estado=inscripcion|args:modulo.asignatura|call:"estado_asignatura" %}#}
                    {#                                    <td data-title='Disponible:' style="text-align: center;" {% if puedetomar %}{% if estado != 1 %}{% else %}height="30"{% endif %}{% else %}height="30"{% endif %}>#}
                    {#                                        {% if puedetomar %}#}
                    {#                                            {% if estado != 1 %}#}
                    {#                                                <a  href="javascript:;" id="{{ modulo.asignatura_id }}" cantidad_materia="0" idam="0" idd="{{ modulo.asignatura_id }}" class="btn btn-info btn-mini materia">SELECCIONAR</a>#}
                    {#                                            {% endif %}#}
                    {#                                        {% endif %}#}
                    {#                                    </td>#}
                    {#                                    {% if estado == 1  %}#}
                    {#                                        <td data-title='Estado:' class='estado' id='1' style="text-align: center;"><span class="label label-success">APROBADA</span></td>#}
                    {#                                    {% elif estado == 2%}#}
                    {#                                        <td data-title='Estado:' class='estado' id='0' style="text-align: center;"><span class="label label-important">REPROBADO</span></td>#}
                    {#                                    {% else %}#}
                    {#                                        <td data-title='Estado:' class='estado' id='0' style="text-align: center;"><span class="label label-warning">PENDIENTE</span></td>#}
                    {#                                    {% endif %}#}
                    {#                                {% endwith %}#}
                    {#                            </tr>#}
                    {#                        {% endfor %}#}
                    {#                        {% if not materiasmodulos %}#}
                    {#                            <tr><td colspan="6">NO TIENE MATERIAS DE M&Oacute;DULOS</td></tr>#}
                    {#                        {% endif %}#}
                    {#                        </tbody>#}
                    {#                    </table>#}
                </div>
                {% if materiasmalla %}
                    <a  href="javascript:;" class="btn btn-info btn-large" id="btnmatricular">MATRICULARSE</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="modal fade static" id="matricular" style="display: none;" data-width="80%" class="modal fade" aria-labelledby="" aria-hidden="true" tabindex="-1" role="dialog"  data-keyboard="false" data-backdrop="static">
        <div class="modal-header">
            <h4>Confirmar matricula</h4>
        </div>
        <div class="modal-body" style="min-height: 60px;">
            <div id='confmattxt'>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" hidden="hidden" class="btn btn-matricular btn-success">Confirmar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-danger">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="diferir" style="display: none;">
        <div class="modal-header">
            <h4>Confirmar diferir Rubro Arancel</h4>
        </div>
        <div class="modal-body" style="min-height: 60px;">
            <div id='txtdiferirvalor'>
            </div>
        </div>
        <div class="modal-footer">
            <div id='btnsinodiferir'>
                <a href="javascript:;" class="btn btn-sidiferir btn-success">Si</a>
                <a href="javascript:;" class="btn btn-nodiferir btn-danger">No</a>
            </div>
            <div id='btnsaceptar' style="display: none">
                <a href="javascript:;" class="btn btn-aceptardiferir btn-info">Aceptar</a>
            </div>
        </div>
    </div>

    <div class="modal fade static materiasseleccionmodal" id="materias" style="display: none;">
        <div class="modal-header">
            <h4>Asignaturas ofertadas</h4>
        </div>
        <div class="modal-body" style="overflow: scroll;">
            <div id="panelcontent">
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar cerrarpanel">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="alertas" style="display: none;">
        <div class="modal-header">
            <h4>Alertas</h4>
        </div>
        <div class="modal-body" style="height: 60px;">
            <div id='confmattxt'>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" data-keyboard="true" data-backdrop="static" id="matricularmensajespanel" >
        <div class="modal-header">
            <h4>Matriculando</h4>
        </div>
        <div class="modal-body" style="height: 70px;">
            <div id='confmattxt'>
            </div>
        </div>
        <div class="modal-footer" id='btnfinal1' hidden="hidden">
            <a href="javascript:;" class="btn btn-cerrar btn-info">Cerrar</a>
        </div>
        <div class="modal-footer" id='btnfinal2' hidden="hidden">
            <a href="javascript:;" class="btn btn-cerrar2 btn-success">Aceptar</a>
        </div>
    </div>

    <div class="modal fade static materiasseleccionpracticamodal" style="display: none;">
        <div class="modal-header">
            <h4>Seleccione el horario de prácticas</h4>
        </div>
        <div class="modal-body" style="overflow: scroll;">
            <div id="panelcontentpractica">
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn cerrarpanelpractica">Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="notificacion" >
        <div class="modal-header">
            <h4>Notificación</h4>
        </div>
        <div class="modal-body" style="overflow: auto;">
            <div id='mensaje_notificacion' style="text-align: justify"><span style="text-align: justify; font-size: 14px">{{ NOTIFICACIÓN_NO_MATRICULARSE_OTRA_VEZ }}</span></div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-info" id="notificacion_cerrar"> Cerrar</a>
        </div>
    </div>
    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Detalle</h3>
        </div>
        <div class="modal-body panelbodydetallepermiso">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrarpanel btn-info">Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>


    <div id="el-templates" style="display:none;">
        <div element="terminos-aceptacion-matricula">
            <div style="color: red"><strong>TÉRMINOS Y CONDICIONES</strong></div>
            <table class="table table-hover personal-task">
                <tbody style="font-weight: bold">
                <tr>
                    <td style="text-align: center; vertical-align: middle">
                        <input type="checkbox" name="acepta-terminos" />
                        <!--<div class="checkbox">
                            <input type="checkbox" class="" name="acepta-terminos">
                            <label for="acepta-terminos"><i class="fa fa-handshake-o"></i></label>
                        </div>-->
                    </td>
                    <td style=" vertical-align: middle">
                        <ul>
                            <li><i class="fa fa-check-circle"></i> Quienes estudien carreras presenciales y semipresenciales tendrá que cumplir con al menos el 70% de asistencia a clases en cada una de sus asignaturas.</li>
                            <li><i class="fa fa-check-circle"></i> Con todas las actividades de aprendizaje planificadas por el docente, cumpliendo con las instrucciones y fechas dispuestas para la actividad.</li>
                            <li><i class="fa fa-check-circle"></i> Participar activamente de las sesiones de clases cuando el profesor lo demande.</li>
                            <li><i class="fa fa-check-circle"></i> Ingresar a su Sistema de Gestión Académico previo a cada clase y acceder a ellas desde el botón zoom colocado en su horario, para registrar su asistencia.</li>
                            <li><i class="fa fa-check-circle"></i> Iniciar sesión en zoom con su correo electrónico institucional, además, de colocar su nombre completo (dos nombres y dos apellidos) al ingresar a la clase.</li>
                            <li><i class="fa fa-check-circle"></i> Activar su cámara y audio en el momento de participar o interactuar en clase o cuando el profesor se lo requiera, en caso de no cumplir el docente lo puede retirar de clases y penalizar con la pérdida de su asistencia</li>
                            <li><i class="fa fa-check-circle"></i> Recibir sus clases en su domicilio u oficina en un espacio adecuado para el efecto, que permita concentrar la totalidad de su atención en las mismas. (Evite tomar sus clases realizando otras acciones como conducir, transitar por la calle o similares que pongan en peligro su integridad física o se puedan considerar como una falta de respeto al espacio del docente).</li>

                        </ul>
                    </td>
                </tr>
            </table>
        </div>
    </div>
{% endblock %}

{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <script src="/static/adicionalesjs/formquestion.js?0.25"></script>
    <style type="text/css">
        textarea {
            width: 1000px;
            height: 1500px;
        }
    </style>
    <script type="text/javascript">
        $(function() {

            {% comment %}var asignaturasMallas = [
                {% for asignaturamalla in asignaturasmallas %}
                    {"horaspresenciales": "{{ asignaturamalla.horaspresenciales }}",
                        "horasautonomas": "{{ asignaturamalla.horasautonomas }}",
                        "id": "{{ asignaturamalla.id|encrypt }}",
                        "asignaturamallaid": "{{ asignaturamalla.id }}",
                        "practicas": {% if asignaturamalla.practicas %}true{% else %}false{% endif %},
                        "rectora": {% if asignaturamalla.rectora %}true{% else %}false{% endif %},
                        "areaconocimiento": "{{ asignaturamalla.areaconocimiento.nombre }}",
                        {#"tipomateria": "{{ asignaturamalla.tipomateria }}",#}
                        "identificacion": "{% if asignaturamalla.identificacion %}{{ asignaturamalla.identificacion }}{% else %}###{% endif %}",
                        "asignatura": "{{ asignaturamalla.nombrecorto }}",
                        "predecesoras": "{{ asignaturamalla.cantidad_predecesoras }}",
                        "nivel": "{{ asignaturamalla.nivelmalla.id|encrypt }}",
                        "eje": "{{ asignaturamalla.ejeformativo.id|encrypt }}",
                        "costo": "{{ asignaturamalla.costo }}",
                        "porccalifi": "{% if asignaturamalla.porcentajecalificacion %}{{ asignaturamalla.porcentajecalificacion }}{% else %} {% endif %} ",
                        "horasaprendizaje": "{{ asignaturamalla.horasaprendizajeingles }}",
                        "horas": "{{ asignaturamalla.horas }}",
                        "creditos": "{{ asignaturamalla.creditos }}",
                        "enuso": {% if asignaturamalla.en_uso %}true{% else %}false{% endif %},
                        "syllabus": "{{ asignaturamalla.syllabus }}",
                        "syllabusaprobados": "{{ asignaturamalla.syllabus_aprobados }}",
                        "numtitulo": "{{ asignaturamalla.contar_asignaturamallatituloafin }}",
                        "opcional": {% if asignaturamalla.opcional %}true{% else %}false{% endif %},
                        "vigente": {% if asignaturamalla.vigente %}true{% else %}false{% endif %},
                        "horaspracticastotales": "{{ asignaturamalla.horaspracticastotales }}",
                        "horaspracticassemanales": "{{ asignaturamalla.horaspracticastotales }}",
                        "corequisito": "{{ asignaturamalla.num_corequisitos }}",
                        "numeroplananal": "{{ asignaturamalla.num_plananalitico }}"}{% if not forloop.last %},{% endif %},

                {% endfor %}
            ];{% endcomment %}

            var asignaturasMallas = [
                {% for asignaturamalla in asignaturasmallas %}
                    {"horasacdtotal": "{{ asignaturamalla.horasacdtotal }}",
                        "horasautonomas": "{{ asignaturamalla.horasautonomas }}",
                        "id": "{{ asignaturamalla.id|encrypt }}",
                        "asignaturamallaid": "{{ asignaturamalla.id }}",
                        "practicas": {% if asignaturamalla.practicas %}true{% else %}false{% endif %},
                        "asignaturapracticas": {% if asignaturamalla.asignaturapracticas %}true{% else %}false{% endif %},
                        "rectora": {% if asignaturamalla.rectora %}true{% else %}false{% endif %},
                        "areaconocimiento": "{{ asignaturamalla.areaconocimiento.nombre }}",
                        {#"tipomateria": "{{ asignaturamalla.tipomateria }}",#}
                        "identificacion": "{% if asignaturamalla.identificacion %}{{ asignaturamalla.identificacion }}{% else %}###{% endif %}",
                        "requisitograduacion": "{% if asignaturamalla.validarequisitograduacion %}Requisitos de ingreso a Unidad de Integración Curricular{% endif %}",
                        "requisitograduacion_valida": {% if asignaturamalla.validarequisitograduacion %}true{% else %}false{% endif %},
                        "asignatura": "{{ asignaturamalla.nombrecorto }} - {{ asignaturamalla.asignatura.id }}",
                        "nombre_asignatura": "{{ asignaturamalla.asignatura.nombre }}",
                        "predecesoras": "{{ asignaturamalla.cantidad_predecesoras }}",
                        "nivel": "{{ asignaturamalla.nivelmalla.id|encrypt }}",
                        "eje": "{{ asignaturamalla.ejeformativo.id|encrypt }}",
                        "costo": "{{ asignaturamalla.costo }}",
                        "porccalifi": "{% if asignaturamalla.porcentajecalificacion %}{{ asignaturamalla.porcentajecalificacion }}{% else %} {% endif %} ",
                        "horasaprendizaje": "{{ asignaturamalla.horasaprendizajeingles }}",
                        "horas": "{{ asignaturamalla.horas }}",
                        "creditos": "{{ asignaturamalla.creditos }}",
                        "enuso": {% if asignaturamalla.en_uso %}true{% else %}false{% endif %},
                        "syllabus": "{{ asignaturamalla.syllabus }}",
                        "syllabusaprobados": "{{ asignaturamalla.syllabus_aprobados }}",
                        "numtitulo": "{{ asignaturamalla.contar_asignaturamallatituloafin }}",
                        "opcional": {% if asignaturamalla.opcional %}true{% else %}false{% endif %},
                        "transversal": {% if asignaturamalla.transversal %}true{% else %}false{% endif %},
                        "vigente": {% if asignaturamalla.vigente %}true{% else %}false{% endif %},
                        "afinidaddoctorado": {% if asignaturamalla.afinidaddoctorado %}true{% else %}false{% endif %},
                        "horasapetotal": "{{ asignaturamalla.horasapetotal }}",
                        "itinerario": "{% if asignaturamalla.itinerario %}{{ asignaturamalla.itinerario }}{% else %}{{ 0 }}{% endif %}",
                        "horaspracticassemanales": "{{ asignaturamalla.horaspracticastotales }}",
                        "corequisito": "{{ asignaturamalla.num_corequisitos }}",
                        "contminimos": "{{ asignaturamalla.num_contminimos }}",
                        "homologadas": "{{ asignaturamalla.num_homologada }}",
                        "modalidad": {% if not asignaturamalla.modalidad %}true{% else %}false{% endif %},
                        "numeroplananal": "{{ asignaturamalla.num_plananalitico }}"}{% if not forloop.last %},{% endif %},


                {% endfor %}
            ];

            findMaterias = function(n, e) {
                var l = [];
                for (i in asignaturasMallas) {
                    var am = asignaturasMallas[i];
                    if (am.nivel==n && am.eje==e) {
                        l.push(am);
                    }
                }
                return l;
            };
            $("#id_horaslaboratorio").change(function(){
                numerico($(this), 0, 0, 0);
            });
            $("#guardar_horas").click(function(){
                var idhoraaprendizaje = $("#id_horaslaboratorio").val();
                var idcodigo = $("#idcodigo").val();
                if (idhoraaprendizaje ==''){
                    smoke.alert("Completar datos.");
                    return false;
                }
                bloqueointerface();
                $.ajax({
                    type:"POST",
                    url:"/mallas",
                    data:{'action': 'addhoraaprendizaje', 'idhoraaprendizaje': idhoraaprendizaje, 'idcodigo': idcodigo},
                    error:function(){
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos.");
                    },
                    success:function(data){
                        {#                        $.unblockUI();#}
                        if (data.result=="ok"){
                            location.reload();
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    }
                });
            });
            $("#cerrarindicadoresadd").click(function() {
                $("#modaladdindicadores .incompletoaddindicadores").hide();
                $("#modaladdindicadores .incompletovaloindicadores").hide();
                $("#modaladdindicadores").modal("hide");
            });


            $(".cell").each(function(cell) {
                var materia;
                var materias;
                var eje;
                var nivel;
                var celda;

                celda = $(this);
                nivel = celda.attr('nivel');
                eje = celda.attr('eje');
                materias = findMaterias(nivel, eje);
                for (i in materias) {
                    materia = materias[i];
                    if (materia.syllabus=='True'){
                        if (materia.syllabusaprobados=='True'){
                            syllabusestado = "btn-info";
                        } else {
                            syllabusestado = "btn-warning";
                        }
                    } else {
                        syllabusestado = "btn-danger";
                    }
                    if (materia.predecesoras > 0){
                        cantidadpredecesoras = "("+materia.predecesoras+")";
                    } else {
                        cantidadpredecesoras = "";
                    }
                    opcional = "No"
                    if (materia.opcional == 'True'){
                        opcional = "Si"
                    }

                    //AQUI ES DONDE SE DIBUJAN LAS CELDAS DE LAS MATERIAS: IVAN SALTOS
                    {% comment %}$(this).append("<tr><td style='height: 100px;'>" +
                        "<div style='width:170px'>" +
                        "<b>" + materia.identificacion + "-" + materia.asignatura+"</b>" +
                        "<br/>" + materia.horas + " Total Hrs., " + materia.creditos+" Cred.<br/>"+
                        materia.horaspresenciales + " Hrs Pre., "+ materia.horasautonomas + " Hrs Aut.<br/>"+
                        materia.horaspracticastotales + " Hrs Pra., "+((materia.opcional)? "<label class='label label-warning tu' title='Opcional'>Opcional</label>":" ") +
                        {%  if malla.carrera.modalidad == 3 %}
                            + materia.porccalifi + " % Calif. Virtual.<br/>"+
                        {% endif %}
                        ((materia.practicas)?" <label class='label label-warning tu' title='Teórico - Práctico'>TP</label>":"") +
                        ((materia.vigente)?"<i class='fa fa-check' style='font-size:24px;color:green' title='Vigente'></i>":"<i class='fa fa-ban' style='font-size:24px;color:red' title='No está vigente'></i>") +
                        ((materia.rectora | materia.practicas | materia.areaconocimiento)?"<br/>":"") +
                        {% if costo_en_malla %}
                            "$"+ materia.costo  + "Cost." +
                        {% endif %}
                        "<div>" +
                        {% if puede_modificar_mallas %}
                            "<a href='/mallas?action=editasign&id="+materia.id+"' class='btn btn-mini btn-info tu' title='Editar'><i class='fa fa-edit '></i></a> " +
                            ((!materia.enuso)?"<a href='/mallas?action=delasign&id="+materia.id+"' class='btn btn-mini btn-form btn-danger'><i class='fa fa-trash'></i></a> ":"") +
                            {#"<a href='/mallas?action=tituloafin&id="+materia.id+"' title='Títulos a fin' class='btn btn-mini'><i class='fa fa-graduation-cap'></i> "+materia.numtitulo+ " T.Afín</a>" +#}

                            {#((materia.requisitograduacion_valida)?"<a href='/mallas?action=integracioncurricular&id="+materia.id+"' title='Requisito de Unidad de Integración Curricular' class='btn btn-mini btn-warning'><i class='fa fa-list'></i> Requisito Uni.Int.Curri</a>":"") +#}

                            {% if idmallamoduloingles %}
                                "<a href='#' onclick='edithorasaprendizaje("+materia.asignaturamallaid+","+materia.horasaprendizaje+")'  class='btn btn-mini btn-warning'' title='Horas laboratorio'>"+materia.horasaprendizaje+"</a>" +
                            {% endif %}
                        {% endif %}
                        " <a href='/mallas?action=programanalitico&id="+materia.id+"' class='btn btn-mini btn-info'><i class='fa fa-folder-o'></i> "+materia.numeroplananal+" P.Anlt.</a>" +
                        {#                                                        "<a href='/mallas?action=programaanaliticoasignaturamalla&id="+materia.id+"' class='btn btn-mini btn-info'><i class='fa fa-list'></i>Subir P. Anlt.</a> " +#}
                        "<br><a href='/mallas?action=predecesora&id="+materia.id+"' class='btn btn-mini'><i class='fa fa-list'></i> " + materia.predecesoras + " Prerrequis.</a>" +
                        " <a href='/mallas?action=corequisitos&id="+materia.id+"' class='btn btn-mini'><i class='fa fa-list'></i> " + materia.corequisito + " Correquis.</a>" +
                        "</div>" +
                        "</td></tr>");{% endcomment %}
                    if(materia.itinerario>0){
                        if(materia.itinerario==1)
                            tipo_etiqueta="label-success";
                        else if(materia.itinerario==2)
                            tipo_etiqueta="label-warning";
                        else
                            tipo_etiqueta="label-default";
                    }


                    $(this).append("<tr><td style='height: 100px;'>" +
                        {#font-size: 12px; color: grey;#}
                        "<div style='width:170px';>" +
                        {#"<a href='/mallas?action=cambioasignatura&id="+materia.id+"' class='btn btn-mini btn-info bloqueo_pantalla tu' title='Cambiar asignatura'><i class='fa fa-exchange '></i></a> " +#}
                        "<div style= 'font-size:15px; color: blue'>" +
                        " <b>" + materia.nombre_asignatura + "</b> <br/>" +
                        "</div>" +
                        " (" + materia.asignaturamallaid + ") " + materia.identificacion + "-" + materia.asignatura+"<br/>" +
                        "<label class='label label-default tu' title='Total Horas'>"+materia.horas+" Total Hrs. </label>&nbsp;"+
                        "<label class='label label-default tu' title='Total Créditos'>"+materia.creditos+" Cred. </label>&nbsp;"+ "<br/>"+
                        "<label class='label label-warning tu' title='Total Horas Aprendizaje Contacto Docente'>"+materia.horasacdtotal+" Hrs ACD </label>&nbsp;"+
                        "<label class='label label-success tu' title='Total Horas Aprendizaje Prático Experimental'>"+materia.horasapetotal+" Hrs APE </label><br/> "+
                        {#                        {% if malla.carrera.mi_coordinacion2 == 1 or malla.carrera.mi_coordinacion2 == 2 or malla.carrera.mi_coordinacion2 == 3 or malla.carrera.mi_coordinacion2 == 4  or malla.carrera.mi_coordinacion2 == 5 %}#}
                        {#                            {%  if malla.carrera.modalidad == 1 %}#}
                        {#                                ((materia.modalidad)?" <label class='label label-success tu' title='Modalidad Impartición Clase'>Modalidad Virtual</label>":"<label class='label label-success tu' title='Modalidad Impartición Clase'>Modalidad Presencial</label>") +#}
                        {#                            {% endif %}#}
                        {#                        {% endif %}#}
                        " <label class='label label-info tu' title='Total Horas Aprendizaje Autónomo'>"+materia.horasautonomas+" Hrs AA </label>&nbsp;"+((materia.opcional)? "<label class='label label-warning tu' title='Opcional'>Opcional</label>":" ") +

                        ((materia.itinerario>0)?"<br/><label class='label "+tipo_etiqueta+" tu' title='Itinerario'>ITINERARIO " + materia.itinerario + "</label>&nbsp;" : "") +

                        {%  if malla.carrera.modalidad == 3 %}
                            + materia.porccalifi + " % Calif. Virtual.<br/>"+
                        {% endif %}
                        ((materia.afinidaddoctorado)?"<label class='label label-success tu'  title='Afinidad Doctorado'>Afin.INV</label>":"") +

                        ((materia.practicas)?" <label class='label label-warning tu' title='Teórico - Práctico'>TP</label>":"") +
                        ((materia.asignaturapracticas)?" <label class='label label-warning tu' title='Asignatura de Practica pre-profesional'>APPP</label>&nbsp;":"") +
                        ((materia.vigente)?"<i class='fa fa-check' style='font-size:16px;color:green' title='Vigente'></i>":"<i class='fa fa-ban' style='font-size:24px;color:red' title='No está vigente'></i>") +
                        ((materia.rectora | materia.practicas | materia.areaconocimiento)?"<br/>":"") +
                        {% if costo_en_malla %}
                            "$"+ materia.costo  + "Cost." +
                        {% endif %}
                        ((materia.requisitograduacion_valida)?"<a href='/mallas?action=integracioncurricular&id="+materia.id+"' title='Requisito de ingreso a Unidad de Integración Curricular' class='btn btn-mini btn-warning'> Requisitos ingreso U.I.C</a>":"") +

                        {#"<br/>"#}
                        {#+ " <label class='label label-warning'>"+materia.requisitograduacion+"</label>" +#}
                        "<div>" +"<br/>"+
                        {% if puede_modificar_mallas %}
                            "<a href='/mallas?action=editasign&id="+materia.id+"' class='btn btn-mini btn-info tu' title='Editar'><i class='fa fa-edit '></i></a> " +
                            ((!materia.enuso)?"<a href='/mallas?action=delasign&id="+materia.id+"' class='btn btn-mini btn-form btn-danger'><i class='fa fa-trash'></i></a> ":"") +
                            {#"<a href='/mallas?action=tituloafin&id="+materia.id+"' title='Títulos a fin' class='btn btn-mini'><i class='fa fa-graduation-cap'></i> "+materia.numtitulo+ " T.Afín</a>" +#}
                            {#((materia.requisitograduacion_valida)?"<a href='/mallas?action=integracioncurricular&id="+materia.id+"' title='Requisito de Unidad de Integración Curricular' class='btn btn-mini btn-warning'><i class='fa fa-list'></i> Requisito Uni.Int.Curri</a>":"") +#}

                            {% if idmallamoduloingles %}
                                "<a href='#' onclick='edithorasaprendizaje("+materia.asignaturamallaid+","+materia.horasaprendizaje+")'  class='btn btn-mini btn-warning'' title='Horas laboratorio'>"+materia.horasaprendizaje+"</a>" +
                            {% endif %}
                        {% endif %}
                        {% if malla.carrera.coordinacion_carrera.id == 7 %}
                            {#"<a href='/mallas?action=programaanaliticoasignaturamalla&id="+materia.id+"' class='btn btn-mini btn-info'><i class='fa fa-list'></i> Subir P. Anlt.</a> " +#}
                            " <a href='/mallas?action=programanaliticoposgrado&id="+materia.id+"' class='btn btn-mini btn-info'><i class='fa fa-folder-o'></i> "+materia.numeroplananal+" P.Anlt.</a>" +
                        {% else %}
                            " <a href='/mallas?action=programanalitico&id="+materia.id+"' class='btn btn-mini btn-info'><i class='fa fa-folder-o'></i> "+materia.numeroplananal+" P.Anlt.</a>" +((materia.transversal)? " <a href='/mallas?action=listadotransversales&id="+materia.id+"' class='btn btn-mini btn-info tu' title='Asignatura transversal'><i class='fa fa-list'></i> Tra.</a>":" ") +
                        {% endif %}
                        " <a href='/mallas?action=viewcontenidosminimos&id="+materia.id+"' class='btn btn-mini btn-warning tu' title='Contenidos Mínimos'><i class='fa fa-list'></i> "+materia.contminimos+" Cont. Min.</a>" +
                        "<br><a href='/mallas?action=predecesora&id="+materia.id+"' class='btn btn-mini'><i class='fa fa-list'></i> " + materia.predecesoras + " Prerrequis.</a>" +
                        " <a href='/mallas?action=corequisitos&id="+materia.id+"' class='btn btn-mini'><i class='fa fa-list'></i> " + materia.corequisito + " Correquis.</a>" +
                        {% if malla.carrera.mi_coordinacion2 == 7 %}
                            " <a href='/mallas?action=homologacion&id="+materia.id+"' class='btn btn-mini'><i class='fa fa-list'></i> " + materia.homologadas + " Hom.Red.</a>" +
                        {% endif %}
                        {% if perms.sga.puede_cambiar_asignatura_malla %}
                            "<a href='javascript:;' onclick='cambiarnombreasignatura("+materia.asignaturamallaid+")' class='btn btn-mini btn-info' title='Cambiar Asignatura'><i class='fa fa-star'></i></a>" +
                        {% endif %}
                        {#" <a href='/mallas?action=imparticionclase&id="+materia.id+"' class='btn btn-mini btn-info tu ' title='Adicionar'><i class='fa fa-plus '></i></a> " +#}
                        {% if not malla.carrera.mi_coordinacion2 == 9 or not malla.carrera.mi_coordinacion2 == 7  %}
                            {%  if malla.carrera.modalidad == 1 or  malla.carrera.modalidad == 2 or malla.carrera.id == 187 %}


                                {#((materia.tipomateria != 3)?"<a href='javascript:void(0);' onclick='formModal("+materia.asignaturamallaid+")' class='btn btn-mini btn-primary' title='Cambiar modalidad de impartición de clase '><i class='fa fa-compress'></i></a>" : "") +#}


                                {#" <a href='javascript:void(0);' onclick='formModal("+materia.asignaturamallaid+")' class='btn btn-mini btn-primary' title='Cambiar modalidad de impartición de clase '><i class='fa fa-compress'></i></a>" +#}


                                " <a href='javascript:void(0);' onclick='formModal("+materia.asignaturamallaid+")' class='btn btn-mini btn-primary' title='Cambiar modalidad de impartición de clase '><i class='fa fa-compress'></i></a> " +
                                ((materia.modalidad)? " <label class='label label-info tu' title='Modalidad Impartición Clase'>Modalidad Virtual</label>":"<label class='label label-info tu' title='Modalidad Impartición Clase'>Modalidad Presencial</label>") +
                            {% endif %}
                        {% endif %}
                        "</div>" +
                        "</td></tr>");
                    tooltips();
                }

                $('.btn-form').click(function(){
                    bloqueointerface();
                });
            });

            new DragDivScroll( 'contenidomalla', 'toggleaxis, noXBarHide, noMousewheel' );


            $('#cerrarcambioasignatura').click(function () {
                $('#modaladcambiarasignatura').modal('hide');
            });

            $("#guardarcambioasignatura").click(function () {
                let data_asignatura = $('#id_asignatura').data('asignatura');
                if(data_asignatura){
                    data_asignatura.action = 'cambiarasignatura'
                    Swal.fire({
                        title: `NOTIFICACIÓN`,
                        html: `¿Estas  seguro de cambiar la asignatura
                                <span class="badge badge-info">${data_asignatura.asigmnombre}</span>
                                por <span class="badge badge-warning">${data_asignatura.nombre}</span>?<br>
                                <p>Se modificaran los siguientes registros:</p>
                                <ul style="text-align: left">
                                    <li><b>N° Registros de Récord Académico:</b>  <span class="badge badge-primary">${data_asignatura.total_record}</span></li>
                                    <li><b>N° Registros de Histórico Récord Académico: </b>:<span class="badge badge-warning">${data_asignatura.total_hrecord}</span></li>
                                    <li><b>N° Registros de Materias:</b> <span class="badge badge-info tu" >${data_asignatura.total_materia}</span></li>
                                </ul>
                                `,
                        type: 'warning',
                        icon: 'warning',
                        showCancelButton: true,
                        allowOutsideClick: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Aceptar',
                        cancelButtonText: 'No, cancelar'
                    }).then((result) => {
                        if(result.value){
                            bloqueointerface();
                            $.post("{{ request.path }}", data_asignatura)
                                .then(function (data) {
                                    if(data.result){
                                        $.unblockUI();
                                        Swal.fire({
                                            title: `NOTIFICACIÓN`,
                                            text: data.mensaje,
                                            type: 'success',
                                            icon: 'success',
                                            showCancelButton: false,
                                            allowOutsideClick: false,
                                            confirmButtonColor: '#3085d6',
                                            cancelButtonColor: '#d33',
                                            confirmButtonText: 'Aceptar',
                                            cancelButtonText: 'No, cancelar'
                                        }).then((result) => {
                                            if(result.value){
                                                $('#modaladcambiarasignatura').modal('hide');
                                                bloqueointerface();
                                                location.reload();
                                            }
                                        }).catch(error => {
                                            Swal.fire({
                                                toast: false,
                                                position: 'center',
                                                icon: 'error',
                                                type: 'error',
                                                title: 'Notificación',
                                                text: error.message,
                                                showConfirmButton: false,
                                                timer: 6000
                                            });
                                        });
                                    }else{
                                        $.unblockUI();
                                        Swal.fire({
                                            toast: false,
                                            position: 'center',
                                            icon: 'error',
                                            type: 'error',
                                            title: 'Notificación',
                                            text:data.mensaje,
                                            showConfirmButton: false,
                                            timer: 6000
                                        });
                                    }
                                }).fail(function (error) {
                                $.unblockUI();
                                Swal.fire({
                                    toast: false,
                                    position: 'center',
                                    icon: 'error',
                                    type: 'error',
                                    title: 'Notificación',
                                    text:'Error de conexión  con el servidor',
                                    showConfirmButton: false,
                                    timer: 6000
                                });
                            });
                        }
                    }).catch(error => {
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon: 'error',
                            type: 'error',
                            title: 'Notificación',
                            text: error.message,
                            showConfirmButton: false,
                            timer: 6000
                        });
                    });
                }else{
                    $.unblockUI();
                    Swal.fire({
                        toast: false,
                        position: 'center',
                        icon: 'error',
                        type: 'error',
                        title: 'Notificación',
                        text:'No llenado el campo Asignatura es requerido',
                        showConfirmButton: false,
                        timer: 6000});
                }

            });

        });
        function edithorasaprendizaje(codigoasignaturamalla,horas) {
            $("#id_horaslaboratorio").val(horas);
            $("#horaaprendizaje").val(horas);
            $("#idcodigo").val(codigoasignaturamalla);
            $("#modaladdindicadores").modal({backdrop:'static', width: '250px'}).modal('show');
        }

        function cambiarnombreasignatura(idasignaturamalla) {
            data_json = {
                action: "cambiarasignatura",
                id :idasignaturamalla
            }
            bloqueointerface();
            $.get("{{ request.path }}", data_json)
                .then(function (data) {
                    if(data.result){
                        $('#modaladcambiarasignatura .panelbody').html(data.data);
                        $('#modaladcambiarasignatura').modal({backdrop:'static', width: '80%'}).modal('show');
                        $('#modaladcambiarasignatura .modal-header .paneltitle').html(`${data.title}`);
                        $.unblockUI();
                    }else{
                        $.unblockUI();
                        Swal.fire({
                            toast: false,
                            position: 'center',
                            icon: 'error',
                            type: 'error',
                            title: 'Notificación',
                            text:data.mensaje,
                            showConfirmButton: false,
                            timer: 6000
                        });
                    }
                }).fail(function (error) {
                $.unblockUI();
                Swal.fire({
                    toast: false,
                    position: 'center',
                    icon: 'error',
                    type: 'error',
                    title: 'Notificación',
                    text:'Error de conexión  con el servidor',
                    showConfirmButton: false,
                    timer: 6000
                });
            });
        }

        function formModal(id,text, footer = true) {
            $('.panelbodyform').empty();
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': 'cambiarmodalidadasignatura',
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        if (footer === true) {
                            $("#itemspanelform").hide();
                            $('#footermodalform').hide();
                        }
                        $('.panelbodyform').html(data.data);
                        $('#itemspanelform .paneltitleform').html(text);
                        $("#itemspanelform").modal({backdrop: 'static', width: '600px'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }


    </script>
{% endblock %}
{% block atras %}/mallas{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4>
            <h5>Carrera: {{ malla.carrera }}</h5>
            <h5>Fecha: {{ malla.inicio|date:"d-m-Y" }}</h5>
            {% if malla.carrera.mi_coordinacion2 == 1 or malla.carrera.mi_coordinacion2 == 2 or malla.carrera.mi_coordinacion2 == 3 or malla.carrera.mi_coordinacion2 == 4  or malla.carrera.mi_coordinacion2 == 5 %}
                {%  if malla.carrera.modalidad == 1 or  malla.carrera.modalidad == 2 or malla.carrera.id == 187  %}
                    <a class="btn btn-success" href='/mallas?action=reporteasignaturamalla&id={{ malla.id|encrypt  }}' ><i class="fa fa-download"></i> Descargar Reporte</a><br>

                    <table class='table table-bordered' cellpadding="0" cellspacing="0">
                        <thead>
                        <tr>
                            <br>
                            <th >Cantidad Asignaturas Presenciales</th>
                            <td>{{ malla.cantidad_total_materias_presenciales}}</td>
                            <th >Cantidad Asignaturas Virtuales</th>
                            <td >{{ malla.cantidad_total_materias_virtuales}}</td>
                        </tr>
                        <tr >
                            <th ><b>Total Horas Malla (sin horas de prácticas pre profesionales)</b></th>
                            <td colspan="3">{{ malla.suma_horas_validacion_itinerario_sin_practica|floatformat:2 }}</td>
                        </tr>
                        <tr>
                            <th >Total Horas Presenciales</th>
                            <td >{{ malla.suma_horas_materias_presenciales }}</td>
                            <th >Total Horas Virtuales</th>
                            <td>
                                {% if malla.suma_horas_materias_virtuales %}
                                    {{ malla.suma_horas_materias_virtuales}}
                                {% else %}
                                    0
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th >Total Porcentaje Horas Presencial</th>
                            <td >
                                {% if malla.porcentaje_horasp <= 100 %}
                                    {{ malla.porcentaje_horasp}} %
                                {% else %}
                                    100 %
                                {% endif %}
                            </td>
                            <th >Total Porcentaje Horas Virtual</th>
                            <td >
                                {% if malla.porcentaje_horasv <= 100 %}
                                    {{ malla.porcentaje_horasv }} %
                                {% else %}
                                    100 %
                                {% endif %}
                            </td>
                        </tr>
                        </thead>
                    </table>
                    <div class="alert alert-info" style="font-size: 14px">
                        <h5>¡IMPORTANTE!</h5>
                        Si en un nivel hay más de una asignatura de itinerario, todas esas asignaturas (itinerario) deben estar en la misma modalidad de impartición de clase.
                    </div>
                    {% if asignaturamalla.malla.cerrado %}
                        <div class='alert alert-danger'>
                            <h5>¡IMPORTANTE!</h5>
                            Malla se encuentra cerrada
                        </div>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>
            <div style="overflow:auto;" id="contenidomalla">
                <table class='table table-bordered table-striped'>
                    <thead>
                    <tr>
                        <th style="text-align: center;">CAMPO FORMATIVO</th>
                        {% for nivelmalla in nivelesdemallas %}
                            <th style="text-align: center;">{{ nivelmalla }}
                                {% if puede_modificar_mallas %}
                                    &nbsp;<a title="Agregar asignatura" href="/mallas?action=addasign&id={{ malla.id|encrypt }}&nivel={{ nivelmalla.id|encrypt }}" class='btn btn-success btn-mini tu'><i class="fa fa-plus "></i></a>
                                {% endif %}
                            </th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for eje in ejesformativos %}
                        <tr>
                            <td>
                                <div style="min-width: 150px">
                                    {{ eje.nombre }}
                                </div>
                            </td>
                            {% for nivelmalla in nivelesdemallas %}
                                <td>
                                    <table class='table table-bordered cell' nivel='{{ nivelmalla.id|encrypt }}' eje='{{ eje.id|encrypt }}' style="width: 150px">
                                    </table>
                                    {% comment %}<div>
                                        {% if puede_modificar_mallas %}
                                            <a href="/mallas?action=addasign&id={{ malla.id|encrypt }}&nivel={{ nivelmalla.id|encrypt }}&eje={{ eje.id|encrypt }}" class='btn btn-success btn-mini'><i class="fa fa-plus "></i></a>
                                        {% endif %}
                                    </div>{% endcomment %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    <tr></tr>
                    <tr>
                        <td>TOTALES </td>
                        {% for resumen in resumenes %}
                            <td>
                                {#                                <b>{{ resumen.horas }}</b> Horas, <br>#}
                                {#                                <b>{{ resumen.creditos|floatformat:4 }}</b> Creditos#}
                                <b>{{ resumen.horasext }}</b> Horas, <br>
                                <b>{{ resumen.creditosext|floatformat:4 }}</b> Creditos, <br>
                                <b>{{ resumen.cant_mat }}</b> Cant Asignaturas. <br>
                                {% if malla.carrera.mi_coordinacion2 == 1 or malla.carrera.mi_coordinacion2 == 2 or malla.carrera.mi_coordinacion2 == 3 or malla.carrera.mi_coordinacion2 == 4  or malla.carrera.mi_coordinacion2 == 5 %}
                                    {%  if malla.carrera.modalidad == 1 or malla.carrera.modalidad == 2 or malla.carrera.id == 187 %}
                                        <div style="color: blue">
                                            <b>{{ resumen.cant_mat_pres }}</b> Cant Asignaturas Presenciales. <br>
                                            <b>{{ resumen.cant_mat_virt }}</b> Cant Asignaturas Virtuales. <br>
                                            {#                                            <b>{{ resumen.cant_mat_virt }}</b> Porcentaje Asignaturas Virtuales.#}

                                        </div>
                                    {% endif %}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade static" id="modaladdindicadores" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Horas de Aprendizaje Prácticos de Inglés</h3>
        </div>
        <div class="modal-body panelbody">
            <div class="alert alert-info incompletoaddindicadores" style="display: none;">
                <i class="fa fa-info-sign"></i> Complete todos los campos para continuar
            </div>
            <div class="alert alert-danger" id="incompletovaloresaddindicadores" style="display: none;">
                <i class="fa fa-info-sign"></i> Revise los valores, la fecha/hora DESDE no debe ser mayor a la fecha/hora HASTA
            </div>
            <div class="alert alert-danger" id="alertaingresoaddindicadores" style="display: none;"> FECHAS YA FUERON INGRESADAS</div>
            <div class="row-fluid">
                <form id="formulario2" class='form-vertical' action="" method="POST" >
                    <input id="horaaprendizaje" name="horaaprendizaje" type="hidden" value="0">
                    <input id="idcodigo" name="idcodigo" type="hidden" value="0">
                    Horas Laboratorio:<br><input type="text" name="id_horaslaboratorio" id="id_horaslaboratorio" placeholder="Horas laboratorio">
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="guardar_horas">Guardar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-danger" id="cerrarindicadoresadd">Cancelar</a>
        </div>
    </div>
    <div class="modal fade static" id="modaladcambiarasignatura" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Cambiar Asignatura</h3>
        </div>
        <div class="modal-body panelbody">

        </div>
        <div class="modal-footer">
            <a href="javascript:;" class="btn btn-success" id="guardarcambioasignatura">Guardar</a>
            <a href="javascript:;" class="btn btn-cerrar btn-danger" id="cerrarcambioasignatura">Cancelar</a>
        </div>
    </div>
    <div class="modal fade static" id="itemspanelform" style="display: none;">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <h4><i class="fa fa-list"></i> <b class="paneltitleform">EDITAR MODALIDAD DE IMPARTICIÓN DE CLASE</b></h4>
        </div>
        <div class="modal-body">
            <form autocomplete="off" method="post"
                  enctype="multipart/form-data" action="{{ request.path }}">
                {% csrf_token %}
                <div class="row-fluid panelbodyform">
                </div>
            </form>
        </div>
        <div class="modal-footer" id="footermodalform">
            <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i
                    class="fa fa-window-close"></i>
                Cerrar</a>
        </div>
        {#        <div class="modal-footer">#}
        {#                <table class="pull-right">#}
        {#                    <tr>#}
        {#                        <td><a href="javascript:;" class="btn btn-success savecambio">Crear</a></td>#}
        {#                        <td><a href="javascript:;" class="btn btn-default cancelacambio">Cancelar</a></td>#}
        {#                    </tr>#}
        {#                </table>#}
        {#        </div>#}
    </div>

{% endblock %}
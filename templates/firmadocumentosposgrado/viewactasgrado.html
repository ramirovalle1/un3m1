{% extends "base.html" %}
{% load sga_extras %}
{% block heading %}

    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="/static/js/jquery.fancybox.pack.js?v=1.0.0"></script>
    <link rel="stylesheet" href="/static/css/jquery.fancybox.css?v=1.0.0" type="text/css" media="screen"/>

{#    <link href="/static/picons-thin/style.css" rel="stylesheet">#}
    <link href="/static/widget_ppp.css" rel="stylesheet"/>
    <style>
        table.table thead th {
            padding: 0 4px 0 4px;
            border-bottom: 0;
            background-color: #fff;
            vertical-align: middle;
            text-align: center;
        }

        table.table thead td {
            padding: 0 4px 0 4px;
            border-bottom: 0;
            background-color: #fff;
            vertical-align: middle;
            text-align: center;
        }

        table.table tbody td {
            padding: 2px 4px 2px 4px;
            background-color: #fff;
            vertical-align: middle;
        }

        table.table tbody th {
            padding: 0 4px 0 4px;
            border-bottom: 0;
            background-color: #fff;
            vertical-align: middle;
        }

        table.table tbody tr {
            cursor: pointer;
        }
    </style>
    <script>

    </script>
    <script>


        const firmar_acta_grado = (pk) => {
            Swal.fire({
                html: `¿Está seguro de firma el Acta de Grado?`,
                text: "Esta acción notificará a la siguiente persona que debe firmar el informe.",
                type: 'info',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    metodo_firma(pk, 'Método de firma')
                }
            });
        }

        function metodo_firma(id, text) {
            $.get('/firmardocumentosposgrado', {'action': 'verificar_turno_para_firmar', 'id': id}, function (data) {
                $.unblockUI();
                if (data.result) {
                    if (data.puede) {
                        Swal.fire({
                            title: 'Seleccione el tipo de método para firmar el Acta de Grado.',
                            text: "",
                            showCancelButton: true,
                            confirmButtonText: 'Firmar por archivo',
                            cancelButtonText: 'Firmar por token',
                            showCloseButton: true,
                        }).then((result) => {
                            if (result.value) {
                                formModalFirma(id, 'Firmar Acta de Grado por archivo', 'firmar_acta_grado_por_archivo', footer = false)
                            } else if (result.dismiss == 'cancel') {
                                formModalFirma(id, 'Firmar Acta de Grado por token', 'firmar_acta_grado_por_token', footer = false)
                            }
                        })
                    } else {
                        mensajeDanger(data.mensaje);
                    }

                } else {
                    mensajeDanger("Problemas en el informe");
                }
            })
        }

        function formModalFirma(id, text, action, footer = false) {
            bloqueointerface();
            footer && $('#footermodal').show();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true || data.result === 'ok') {
                        if (data.data) {
                            $('#itemspanel2 .panelbody2').html(data.data);
                            $('#itemspanel2 .paneltitle2').html(text.toUpperCase());
                            $("#itemspanel2").modal({
                                backdrop: 'static',
                                width: '90%'
                            }).modal('show').on('hidden.bs.modal', function (e) {
                                $(".panelbody").empty();
                            });
                        } else {
                            location.reload();
                        }
                    } else {
                        mensajeDanger(data.message + ' ' + data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeDanger("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function irArriba() {
            //console.log("arrr")
            $('.ir-arriba').click(function () {
                $('body,html').animate({scrollTop: '0px'}, 1000);
            });
            $(window).scroll(function () {
                if ($(this).scrollTop() > 0) {
                    $('.ir-arriba').slideDown(600);
                } else {
                    $('.ir-arriba').slideUp(600);
                }
            });
            $('.ir-abajo').click(function () {
                $('body,html').animate({scrollTop: '1000px'}, 1000);
            });
        }

        $(document).ready(function () {
            irArriba();
            $(".fancybox").fancybox();
            $(".gallerypdf").fancybox({
                openEffect: 'elastic',
                closeEffect: 'elastic',
                autoSize: true,
                type: 'iframe',
                iframe: {
                    preload: false // fixes issue with iframe and IE
                }
            });
        });

        function imprimir_reportecontratos_error() {
            var term = $("#searchinput").val().trim().toUpperCase();
            {#var idmod = $("#id_modulo").val();#}
            var idmaestria = $("#id_maestria").val();
            var idperiodo = $("#id_tperiodo").val();
            var idestadof = $("#id_estadof").val();
            openwindow('POST', '/firmardocumentosposgrado',
                {
                    action: 'imprimir_contratoserror',
                    s: term,
                    mod: idmod,
                    maestria: idmaestria,
                    tperiodo: idperiodo,
                    estadof: idestadof
                }
                , '_blank');
        }

        function formModal(id, text, action, footer = true) {
            {#debugger;#}
            bloqueointerface()
            $('#footermodal').show();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === "ok") {
                        $('.paneltitle').html(text);
                        $('.panelbody').html(data.html);
                        $('#itemspanel #totalfirmarmasivo').hide();
                        $("#itemspanel").modal({
                            backdrop: 'static',
                            width: '900px'
                        }).modal('show').on('hidden.bs.modal', function (e) {
                            $(".panelbody").empty();
                        });
                    } else {
                        mensajeDanger(data.message);
                    }
                },
                error: function () {
                    $.unblockUI();
                    mensajeDanger("Error de conexión.");
                },
                dataType: "json"
            });
        }

        {#function actagradoposgrado(idinscripcion){#}
        {#    openwindow('POST' ,'/firmardocumentosposgrado', {action:'pdfactagradoposgrado',id:idinscripcion, csrfmiddlewaretoken: '{{ csrf_token }}'}, '_blank');#}
        {# }#}

        {#function actagradoposgrado(idinscripcion) {#}
        {#    bloqueointerface();#}
        {#    $.ajax({#}
        {#        type: "POST",#}
        {#        url: "/firmardocumentosposgrado",#}
        {#        data: {'action': 'get_actagradoposgradocomplexivo', 'id': idinscripcion},#}
        {#        error: function () {#}
        {#            $.unblockUI();#}
        {#            alertaDanger("Error al obtener los datos.");#}
        {#        },#}
        {#        success: function (data) {#}
        {#            $.unblockUI();#}
        {#            if (data.result === "ok") {#}
        {#                window.open(data.url, '_blank');#}
        {#            } else {#}
        {#                alertaDanger(data.mensaje);#}
        {#            }#}
        {#        }#}
        {#    });#}
        {# }#}

        function actagradoposgradocomplexivo(idinscripcion) {
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/firmardocumentosposgrado",
                data: {'action': 'pdfactagradoposgradocomplexivo', 'id': idinscripcion},
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error al obtener los datos.");
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === "ok") {
                        window.open(data.url, '_blank');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                }
            });
        }

        function consultar(accion, nombre) {
            var ids;
            var contador = 0;
            var seleccionados = $(".selectoractas:checked");
            console.log(seleccionados);
            ids = '';
            seleccionados.each(function () {
                if (ids.length > 0) {
                    ids += ",";
                }
                ids += $(this).attr('rid');
                contador += 1;
            });
            console.log(ids);
            if (ids.trim() != '') {
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: `{{ request.path }}`,
                    data: {'action': accion, 'ids': ids},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result === true) {
                            $('.panelbody').html(data.html);
                            $('#itemspanel #totalfirmarmasivo').show();
                            $('#itemspanel #totalfirmarmasivo').html(' Se firmará un total de ' + contador + ' actas.');
                            $('#itemspanel .paneltitle').html(nombre);
                            $("#itemspanel").modal({
                                backdrop: 'static',
                                width: '900px'
                            }).modal('show').on('hidden.bs.modal', function (e) {
                                $(".panelbody").empty();
                            });
                        } else {
                            mensajeDanger(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        mensajeDanger("Error de conexión.");
                    },
                    dataType: "json"
                });
            } else {
                $.unblockUI();
                mensajeWarning("Seleccione actas de grado para ejecutar la acción.");
            }
        }

        $(function (e) {
            $('.fancybox').fancybox();
            busquedaf = function () {
                debugger;
                var term = $("#searchinput").val().trim().toUpperCase();
                {#var mod = $("#id_modulo").val();#}
                var maestria = $("#id_maestria").val();
                var tperiodo = $("#id_tperiodo").val();
                var estadof = $("#id_estadof").val();
                var firmadopor = $("#id_firmado_por").val();


                let href = "/firmardocumentosposgrado?action=firmaactagrado&s=" + term;
                {#if (parseInt(mod)){#}
                {#    href += "&m=" + mod;#}
                {# }#}
                if (parseInt(maestria)) {
                    href += "&maestria=" + maestria;
                }
                if (parseInt(tperiodo)) {
                    href += "&tperiodo=" + tperiodo;
                }
                if (parseInt(estadof)) {
                    href += "&estadof=" + estadof;
                }
                if (firmadopor && firmadopor.length > 0) {
                     var firmadoporString = firmadopor.join(',');
                    href += "&firmadopor=" + firmadoporString;
                }
                location.href = href;
                bloqueointerface();

                //return false;

            };

            $('#btnFirmarSubmit').click(function () {
                console.log('cargofirma');
                var firma = $("#id_firma").val();
                var palabraclave = $("#id_palabraclave").val();
                var formdata = new FormData($("#formfirmarcontrato")[0]);
                if (firma.trim() && palabraclave.trim()) {
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/firmardocumentosposgrado",
                        data: formdata,
                        success: function (data) {
                            if (data.result == 'ok') {
                                $("#itemspanel").modal("hide");
                                location.reload();
                            } else {
                                if (data.result === "errornombre") {
                                    location.reload();
                                } else {
                                    $.unblockUI();
                                    mensajeDanger(data.mensaje);
                                }
                            }
                        },
                        error: function () {
                            $.unblockUI();
                            mensajeDanger("Error de conexión.");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                } else {
                    if (firma.trim() == '') {
                            mensajeWarning('Seleccione su archivo de la firma.');
                        } else {
                            mensajeWarning('Ingrese su contraseña de la firma.');
                        }
                }
            });

            $('#btnFirmarMasivoSubmit').click(function () {
                var firma = $("#id_firma").val();
                var palabraclave = $("#id_palabraclave").val();
                var formdata = new FormData($("#formfirmarcontrato")[0]);
                if (firma.trim() && palabraclave.trim()){
                    bloqueointerface();
                    $.ajax({
                        type: "POST",
                        url: "/firmardocumentosposgrado",
                        data: formdata,
                        success: function(data) {
                            if (data.result == 'ok') {
                                $("#itemspanel").modal("hide");
                                location.reload();
                            }else{
                                $.unblockUI();
                                mensajeDanger(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            mensajeDanger("Error de conexión.");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                } else {
                    if(firma.trim() == ''){
                        mensajeWarning('Seleccione el archivo de la firma.');
                    }else{
                        mensajeWarning('Ingrese la contraseña de la firma.');
                    }

                }
            });

            $("#search").click(function () {
                busquedaf();
            });

            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busquedaf();
                }
            });

            $("#id_modulo, #id_tperiodo, #id_maestria, #id_estadof, #id_firmado_por").select2().on("select2:select", function (e) {
                busquedaf();
            });

            $('#id_firmado_por').change(function () {
             busquedaf();
        });

            {#if ('{{ m }}'.length){#}
            {#    $('#id_modulo').val('{{ m }}').trigger('change');#}
            {# }#}
            if ('{{ maestria }}'.length) {
                $('#id_maestria').val('{{ maestria }}').trigger('change');
            }
            if ('{{ tperiodo }}'.length) {
                $('#id_tperiodo').val('{{ tperiodo }}').trigger('change');
            }
            if ('{{ estadof }}'.length) {
                $('#id_estadof').val('{{ estadof }}').trigger('change');
            }

            $('.refreshbutton').click(function (e) {
                bloqueointerface();
                let href = '';
                {#let modulo = $('#id_modulo').val();#}
                let maestria = $('#id_maestria').val();
                let tperiodo = $('#id_tperiodo').val();
                let estadof = $('#id_estadof').val();
                {#href = parseInt(modulo) ? '&m=' + modulo : '';#}
                href += parseInt(maestria) ? '&maestria=' + maestria : '';
                href += parseInt(tperiodo) ? '&tperiodo=' + tperiodo : '';
                href += parseInt(estadof) ? '&estadof=' + estadof : '';
                console.log(href);
                location.href = "/firmardocumentosposgrado?action=firmaactagrado" + href;
            });

            selectoractas = $(".selectoractas");

            actulizarvalor = function () {
                var seleccionados = $(".selectoractas:checked");
                var suma = 0;
                seleccionados.each(function () {
                    suma += 1;
                });
                $("#totalleads").html(`Actas Seleccionadas: ${suma}`);
            };

            todos = $("#todos");

            todos.click(function () {
                if (todos.prop('checked')) {
                    selectoractas.prop('checked', true);
                } else {
                    selectoractas.prop('checked', false);
                }
                actulizarvalor();
            });

            selectoractas.change(function () {
                actulizarvalor();
            });

            selectoractas.prop("checked", false);

        });
    </script>


{% endblock %}
{% block atras %}/firmardocumentosposgrado{% endblock %}
{% block canvas %}
    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">
                    Actas de grado de graduados
                </h3>
                <h6>Documentos de posgrados</h6>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-12">
                {% if True %}
                <a href="javascript:void(0);"
                   onclick="consultar('firmar_acta_grado_masivo', 'Firma grupal de Actas de Grado')"
                   class="btn btn-success">
                    <span class="fa fa-pencil-square-o "></span>
                    <t class="">Firma masiva</t>
                </a>
                {% endif %}
            </div>
        </div>

        <form method="GET">
            <div class="row">
                {% if banderaacciones %}
                    <div class="col-lg-2 col-md-2 col-12">
                        <p><b id="totalleads">Actas Seleccionadas: 0</b></p>
                    </div>
                {% endif %}
                <div class="col-lg-4 col-md-4 col-12">
                    <div class="input-group mb-2">
                        <select style="width: 100%" id="id_maestria" name="maestria">
                            <option value="0">TODAS MAESTRÍAS</option>
                            {% for maestriap in maestrialist %}
                                <option {% if maestria == maestriap.id %}selected{% endif %}
                                        value="{{ maestriap.id }}">{{ maestriap }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-12">
                    <div class="input-group mb-2">
                        <select style="width: 100%" id="id_tperiodo" name="tperiodo">
                            <option value="0">TODOS PERIODOS</option>
                            {% for p in periodolist %}
                                <option {% if tperiodo == p.id %}selected{% endif %} value="{{ p.id }}">{{ p }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                {#                <div class="col-lg-2 col-md-2 col-12">#}
                {#                    <div class="input-group mb-2">#}
                {#                        <select style="width: 100%" name="m" id="id_modulo" style="width: 100%">#}
                {#                            <option value="0" {% if not m %}selected{% endif %}>TODOS TIPOS</option>#}
                {#                            {% for modulo in modulos %}#}
                {#                                <option value="{{ modulo.0 }}" >{{ modulo.1 }}</option>#}
                {#                            {% endfor %}#}
                {#                        </select>#}
                {#                    </div>#}
                {#                </div>#}

                <div class="col-lg-2 col-md-2 col-12">
                    <div class="input-group mb-2">
                        <select style="width: 100%" name="estadof" id="id_estadof" style="width: 100%">
                            <option value="0" {% if not estadof %}selected{% endif %}>TODOS ESTADOS</option>
                            <option value="1">FIRMADOS</option>
                            <option value="2">PENDIENTES</option>
                        </select>
                    </div>
                </div>


            <div class="row">
                <div class="col-lg-12 col-md-12 col-12">
                    <div class="input-group mb-2">
                        <input class='form-control' style="width: 90%" type='text' id='searchinput' name="s"
                               value='{{ s }}' autocomplete="off" placeholder="Buscar maestrante..."/>
                        <div class="input-group-append">
                            <a class="btn btn-primary" href="javascript:void(0);" onclick="busquedaf()"
                               id="button-addon2"><i
                                    class="fa fa-search"></i></a>
                            {% if s %}
                                <a title="Ver todo" href="javascript:;" class="btn btn-default tr refreshbutton">
                                    <i class="fas fa-sync-alt"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

        </form>
    <div class="row">
        <b>Pendientes por firmar : {{ total_por_firmar }}</b>
    </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="card mb-4">
                    <div class="card-body border-top border-6 rounded-3 border-dark-info">
                        <table class='tabla_responsive table table-bordered'>
                            {#                            <caption>Mostrando {% if not paging.num_pages == page.number %}{{ actas.count }} {% else %}{{ canti }}{% endif %} de {{ actas.count }}</caption>#}
                            <thead>
                            <tr>
                                {% if banderaacciones %}
                                    <td style="background-color: #f5f4f8;text-align: center; width: 25px" width="5%">
                                        <input type="checkbox" id="todos"></td>
                                {% endif %}
                                <td style="background-color: #f5f4f8;" width="35%">Maestrante</td>
                                <td style="background-color: #f5f4f8;" width="30%">Maestría/Periodo</td>
                                <td style="background-color: #f5f4f8;" width="10%">Acta de grado</td>
                                <td style="background-color: #f5f4f8;" width="10%">Estado</td>
                                {% if banderaacciones %}
                                    <td style="background-color: #f5f4f8;" width="10%">Acción</td>
                                {% endif %}
                            </tr>
                            </thead>
                            <tbody>
                            {% for con in actas %}
                                <tr>
                                    {% if banderaacciones %}
                                        <td style="text-align: center;">
                                                {% with resp=con|args:persona|call:"integrante_ya_firmo" %}
                                                    {% if resp.0 %}
                                                    <input type="checkbox" class="selectoractas" rid="{{ con.id }}">
                                                    {% endif %}
                                                {% endwith %}
                                        </td>
                                    {% endif %}
                                    <td style="text-align: left;position: relative;vertical-align: middle;"
                                        data-title='Nombres'>
                                        <div class="media flex-nowrap align-items-center" style="white-space: nowrap;">
                                            <div class="avatar avatar-sm mr-8pt" style="width: 60px;">
                                                {% if con.matricula.inscripcion.persona.foto.foto %}
                                                    <img class="avatar img-circle profile_info_image img-thumbnail"
                                                         src="https://sga.unemi.edu.ec{{ con.matricula.inscripcion.persona.foto.foto.url }}"
                                                         width="50px">
                                                {% else %}
                                                    {% if con.matricula.inscripcion.persona.sexo_id == 1 %}
                                                        <img class="avatar img-circle profile_info_image"
                                                             src="/static/images/iconos/mujer.png">
                                                    {% else %}
                                                        <img class="avatar img-circle profile_info_image"
                                                             src="/static/images/iconos/hombre.png">
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                            <div class="media-body">
                                                <div class="d-flex align-items-center">
                                                    <div class="flex d-flex flex-column"><br>
                                                        {#                                                            {% if persona.usuario.is_superuser %}#}
                                                        <span style="width: 240px"
                                                              class="label label-info"> IDinsc: {{ con.matricula.inscripcion.id }} - IDtt: {{ con.id }}</span>
                                                        {#                                                            {% endif %}#}
                                                        <strong><span class="fa fa-id-badge"></span>
                                                            {% if con.matricula.inscripcion.persona.cedula %}
                                                                {{ con.matricula.inscripcion.persona.cedula }} {% else %}
                                                                {{ con.matricula.inscripcion.persona.pasaporte }} {% endif %}
                                                            |
                                                            <span class="fa fa-user-circle"></span> {{ con.matricula.inscripcion.persona.usuario }}
                                                            <br>
                                                            <span class="fa fa-user"></span> {{ con.matricula.inscripcion.persona }}
                                                        </strong><br>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td style="position: relative;text-align: center; vertical-align: middle"
                                        data-title='Periodo'>
                                        <span class="tu" title="PERIODO: [{{ con.convocatoria_id }}]{{ con.convocatoria.periodo }}">[{{ con.convocatoria_id }}]- {{ con.convocatoria.carrera }}</span>
                                    </td>
                                    <td data-title='Archivo'
                                        style="text-align: center;{% if not ingresoevidencias.archivo %}height:30px{% endif %}">
{#                                        <a class="btn btn-default btn-sm btn-hover"#}
{#                                                    onclick="actagradoposgrado({{ con.id }})"#}
{#                                                    href="javascript:;"#}
{#                                        ><img src="/static/images/pdf.png" width="18" height="18" align="absmiddle">#}
{#                                        </a>#}

                                        <a class="btn btn-default btn-sm btn-hover gallerypdf" data-fancybox-type="iframe" href="{{ con.get_documento_informe.url }}"><img src="/static/images/pdf.png" width="18" height="18" align="absmiddle"></a></a><br>
                                        <span class="label
                                                {% if con.es_examen_complaxivo %}
                                                    label-danger label-mini tu" title="Complexivo
                                                {% else %}
                                                    label-info label-mini tu" title="Proyecto
                                                {% endif %}">
                                                {{ con.mecanismotitulacionposgrado }}
                                            </span>
                                    </td>
                                    <td data-title='Estado' class="text-center">
                                        {% if con.get_firmado_por %}
                                            Firmado por:<br>
                                            {% for integrante in con.get_firmado_por %}
                                                <span class="label label-info tu"#}
                                                      title="Firmado">
                                                    {{ integrante }}
                                                </span>
                                            {% endfor %}
                                        {% else %}
                                            <span class="label label-default tu" title="PENDIENTE">
                                                    GENERADO
                                                </span>
                                        {% endif %}
                                    </td>
                                    {% if banderaacciones %}
                                        <td class="text-center">
                                            {% if not con.contratolegalizado or con.respaldoarchivocontrato %}
                                                {% with resp=con|args:persona|call:"integrante_ya_firmo" %}
                                                    {% if resp.0 %}
                                                         <a class="btn btn-success" href='javascript:;' onclick="firmar_acta_grado({{ con.id }})"><span
                                                        class="fa fa-pencil-square"></span> Firmar</a>
                                                    {% endif %}
                                                {% endwith %}

                                            {% endif %}
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer border-top-0">
                        <div class="col-lg-12">
                            <nav style="margin-bottom: 7px">
                                {% if paging.num_pages > 5 %}
                                    <ul class="pagination justify-content-center mb-0">
                                        {% if paging.primera_pagina %}
                                            <li class="page-item">
                                                <a class="page-link bloqueo_pantalla"
                                                   href="?action=firmaactagrado&page=1{{ url_vars }}">1</a>
                                            </li>
                                            <li class="page-item">
                                                <a href="?action=firmaactagrado&page={{ paging.ellipsis_izquierda }}{{ url_vars }}"
                                                   class="active page-link bloqueo_pantalla">...</a></li>
                                        {% endif %}
                                        {% for pagenumber in paging.paginas %}
                                            <li {% if pagenumber == page.number %}class='active page-item '
                                                {% else %}class='page-item'{% endif %}>
                                                <a href="?action=firmaactagrado&page={{ pagenumber }}{{ url_vars }}"
                                                   class="page-link bloqueo_pantalla">{{ pagenumber }}</a>
                                            </li>
                                        {% endfor %}
                                        {% if paging.ultima_pagina %}
                                            <li class="page-item">
                                                <a href="?action=firmaactagrado&page={{ paging.ellipsis_derecha }}{{ url_vars }}"
                                                   class="active page-link bloqueo_pantalla">...</a></li>
                                            <li class="page-item">
                                                <a href="?action=firmaactagrado&page={{ paging.num_pages }}{{ url_vars }}"
                                                   class="page-link bloqueo_pantalla">{{ paging.num_pages }}</a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                {% else %}
                                    <ul class="pagination justify-content-center mb-0">
                                        {% for pagenumber in paging.page_range %}
                                            <li {% if pagenumber == page.number %}class='active page-item'
                                                {% else %}class="page-item"{% endif %}>
                                                <a class="page-link bloqueo_pantalla"
                                                   href="?action=firmaactagrado&page={{ pagenumber }}{{ url_vars }}">{{ pagenumber }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel2" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-list"></i> <b class="paneltitle2">FORMULARIO MODAL</b></h4>
                    <button type="button" class="close btn-icon btn btn-ghost btn-sm rounded-circle"
                            data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formulariomodal" class="form-horizontal form-modal" autocomplete="off" method="post"
                          enctype="multipart/form-data" action="{{ request.path }}">
                        {% csrf_token %}
                        <div class="row panelbody2"></div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal" style="display:none;">
                    <div style="float: right">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i
                                class="fa fa-window-close"></i> Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="paneltitle"><span class="fa fa-pencil-square-o"></span> Firmar contrato </h3>
                    <div class="" style="padding: 5px 5px">
                        <button style="float: right;" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body">
                    <h4 id="totalfirmarmasivo" class="texto-gris fa fa-info-circle tu" data-bs-toggle="Mensaje"></h4>
                    <form id="formfirmarcontrato" name="formfirmarcontrato" class="form-control">
                        <div class="row panelbody">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="footermodal">
                     <table class="pull-right">
                        <tr>
                            <td><button type="button" class="btn btn-success" id="btnFirmar"><i class="fa fa-check-circle"></i> Firmar</button></td>
                                <input style="display: none;" id="btnFirmarSubmit" class="button is-primary" type="button" value="Firmar">
                                <input style="display: none;" id="btnFirmarMasivoSubmit" class="button is-primary" type="button" value="FirmarMasivo">
                            <td><button type="button" class="btn btn-default" data-bs-dismiss="modal"><i class="fa fa-times"></i> Cancelar</button></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <a style="float: right" class="ir-arriba tl" href="javascript:void(0)" title="Volver arriba">
        <span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i
                class="fa fa-arrow-up fa-stack-1x fa-inverse"></i></span>
    </a>
{% endblock %}

{% load sga_extras %}
<style>
        /*.table > thead > tr > th {
            color: #212529;
            background-color: #e9ecef
        }*/
        .btn-mini {
            padding-top: 3px;
            padding-bottom: 3px;
            padding-left: 3px;
            padding-right: 3px;
            font-size: 10.5px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
        }

        table.dataTable thead th, table.dataTable thead td {
            padding: 2px;
            border-bottom: 0;
            background-color: #fff;
            text-transform: uppercase;
            text-align: center!important;
        }

        table.dataTable tbody th, table.dataTable tbody td {
            padding: 0;
            border-bottom: 0;
            background-color: #fff;
        }
        thead th {
            background-color: #fff;
            position: sticky;
            top: 0; /* Don't forget this, required for the stickiness */
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
        }

        .nav-pills .nav-link.active {
            background-color: #fe990047;
            border-color: #D6EAF8;;
            color: #1C3247;
        }

        .nav-pills .nav-link:hover {
            opacity: .9;
        }
</style>
<link rel="stylesheet" href="/static/fancybox/css/core.css"/>
<script src="/static/fancybox/js/core.js"></script>
<script type="text/javascript">
    function soloNumeros(e) {
            var key = window.Event ? e.which : e.keyCode
            return (key >= 48 && key <= 57)
        }

    function alerta(mensaje, tipo = 'success') {
            Swal.fire({
                toast: true,
                position: 'top-end',
                type: tipo,
                title: mensaje,
                showConfirmButton: false,
                timer: 8000
            })
        }

    $(document).ready(function () {

        $('.btn-donar').click(function (e) {
            var iddp = $(this).attr('iddp');
            e.preventDefault();
            Swal.fire({
              title: '<h4>Ingrese la cantidad que desea donar:</h4>',
              input: 'text',
              inputAttributes: {
                autocapitalize: 'off'
              },
              showCancelButton: true,
              confirmButtonText: 'Guardar',
              showLoaderOnConfirm: true,
              preConfirm: (val) => {
                    val = parseInt(val) > 0 ? parseInt(val) : 0;
                    debugger;
                    let fd = new FormData($('.form-modal')[0]);
                    fd.append('cantidad', val);
                    fd.append('action', 'adddonacion');
                    fd.append('iddp', iddp);
                    if (val){
                        $.ajax({
                        type: "POST",
                        url: "{{ request.path }}",
                        data: fd,
                        success: function(data) {
                            if (data.result == 'ok') {
                                alerta('Datos guardados correctamente.', 'success');
                                var cantidad = $('.cantidad-estimada-'+iddp)
                                var ce = parseInt(cantidad.text());
                                var ca = ce - val
                                var nuevoestimado = ca >= 0 ? ca : 0
                                cantidad.text(nuevoestimado)
                                var porcentaje = (nuevoestimado / parseInt(cantidad.attr('cantidadtotal'))) * 100

                                {#$('.progress-bar-'+iddp).attr('aria-valuenow', 100 - porcentaje);#}
                                $('.progress-bar-'+iddp).attr('aria-valuenow', data.porcentaje_actual).css('width', parseInt(data.porcentaje_actual)+'%');
                                {#$('.progress-bar-'+iddp+' b').text((100-porcentaje)+'%');#}
                                $('.progress-bar-'+iddp+' b').text(data.porcentaje_actual+'%');
                            } else {
                                alerta('Error al guardar.', 'danger');
                            }
                        },
                        error: function() {
                            alerta("Error de conexión.", 'danger');
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                        });
                    }else{
                        setTimeout(function() {alerta('Ingrese una cantidad valida (solo números)', 'info')}, 2000);
                    }
              },
              allowOutsideClick: () => !Swal.isLoading()
            }).then((result) => {
              if (result.isConfirmed) {

              }
            })



        })

        $(".fancybox").fancybox();
        $(".gallerypdf").fancybox({
            openEffect: 'elastic',
            closeEffect: 'elastic',
            autoSize: true,
            type: 'iframe',
            iframe: {
                preload: false // fixes issue with iframe and IE
            }
        });

        {% if not es_donar %}
            $('#dataTable').dataTable({
                columnDefs: [
                    { "width": "25%", "targets": 0 },
                    { "width": "20%", "targets": 1 },
                    { "width": "20%", "targets": 2 },
                    { "width": "20%", "targets": 3 },
                    {% if tiene_datos_donacion and not solicitud.persona == persona %}
                        { "width": "15%", "targets": 4 },
                    {% endif %}
                ]
            });
            {% else %}
            debugger;
            $(".datatableaddproducto").dataTable({
                "columnDefs": [
                    { "width": "30%", "targets": 0 },
                    { "width": "20%", "targets": 1 },
                    { "width": "20%", "targets": 2 },
                    { "width": "20%", "targets": 3 },
                    { "width": "10%", "targets": 4 },
                ]
            });
        {% endif %}

        $('.btnguardardonacion').click(function () {
                let id = $(this).attr('iddp');
                debugger;
                bloqueointerface();
                let formdata = new FormData($('#formtoaddcantidad')[0]);
                formdata.append('cantidad', $('#id_cantidad_'+id).val());
                formdata.append('iddp', id);
                $.ajax({
                    type: "POST",
                    url: "/publicaciondonacion",
                    data: formdata,
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            alerta('Datos guardados correctamente', 'success');
                            /*setTimeout(function () {
                                location.reload();
                            }, 4000);*/
                        } else {
                            alerta('Error en el envío de datos.', 'warning');
                        }

                        $('#closeandopenmodal1').click();
                    },
                    error: function () {
                        $.unblockUI();
                        alerta('Error de conexión', 'error');
                    },
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false
                });
            });


    });

</script>


<div class="row shadow-sm">
    <div class="col-sm-12 col-md-12 col-lg-3">
      <div class="card">
        <div class="card-body">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
              <a class="fs-6 nav-link active" id="id_detalle_producto" data-bs-toggle="pill" href="#tab-detalle-producto" role="tab" aria-controls="tab-detalle-producto" aria-selected="true">
                  <i class="fa fa-shopping-cart nav-icon"></i> DETALLE DE PRODUCTOS
              </a>
              <a class="fs-6 nav-link" id="id_datos_personales" data-bs-toggle="pill" href="#tab-datos-personales" role="tab" aria-controls="tab-datos-personales" aria-selected="false">
                  <i class="fa fa-user nav-icon"></i> DATOS PERSONALES
              </a>
              <a class="fs-6 nav-link" id="id_detalle_publicacion" data-bs-toggle="pill" href="#tab-detalle-publicacion" role="tab" aria-controls="tab-detalle-publicacion" aria-selected="false">
                  <i class="fa fa-info-circle nav-icon"></i> DETALLE DE LA PUBLICACIÓN
              </a>
            </div>
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-12 col-lg-9">
          <div class="card">
              <div class="card-body">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="tab-detalle-producto" role="tabpanel" aria-labelledby="id_detalle_producto">
                            <div class='row'>
                                <div class='col-12'>
                                    <div class="px-2">
                                        <div class="card">
                                            <div class="card-body border-top border-5 rounded-3 border-dark-info">
                                                <div class="table-responsive">
                                                    <table class='table table-responsive-sm dataTable'>
                                                    <thead>
                                                        <tr>
                                                            {% if solicitud.persona == persona %}<th style="text-align: center">Porcentaje de recaudación</th>{% endif %}
                                                            <th style="text-align: center">Producto</th>
                                                            <th style="text-align: center">Cantidad</th>
                                                            <th style="text-align: center">Típo de producto</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for producto in solicitud.get_productos %}
                                                        <tr>
                                                            {% if solicitud.persona == persona %}
                                                                <td  style="vertical-align: middle;text-align: center;padding: 10px">
                                                                    {% with pr=producto.get_porcentaje %}
                                                                            <div class="ms-2"><span>{{ pr|floatformat:"1" }}%</span></div>
                                                                            <div class="d-flex align-items-center">
                                                                                <div class="progress flex-auto" style="height: 6px;">
                                                                                    <div class="progress-bar bg-primary progress-bar-{{ producto.id|encrypt }}" role="progressbar" style="width: {{ pr|floatformat:"0" }}%;"
                                                                                         aria-valuenow="{{ pr|floatformat:"0" }}" aria-valuemin="0" aria-valuemax="100">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            {{ producto.get_cantidadrecaudada }} recaudadas de {{ producto.cantidad }} {{ producto.unidadmedida|lower }}
                                                                    {% endwith %}
                                                                </td>
                                                            {% endif %}
                                                            <td style="vertical-align: middle">
                                                                <div class="row-fluid" style="text-align: center;margin-bottom: 0;">
                                                                    &nbsp;{{ producto.producto }}
                                                                </div>
                                                            </td>
                                                            <td style="text-align: center; vertical-align: middle">
                                                                <span cantidadtotal="{{ producto.cantidad }}" class="cantidad-estimada-{{ producto.id|encrypt }}">
                                                                    {{ producto.cantidad_estimada }}
                                                                </span>
                                                                {% if producto.unidadmedida.abreviatura %}{{ producto.unidadmedida.abreviatura }}{% else %}{{ producto.unidadmedida|lower }}{% endif %}{% if producto.cantidad_estimada > 1 %}(s){% endif %}
                                                            </td>
                                                            <td style="text-align: center; vertical-align: middle">{{ producto.producto.tipoproducto }}</td>
                    {#                                        {% if tiene_datos_donacion and not solicitud.persona == persona %}#}
                    {#                                            <td style="text-align: center;vertical-align: middle;">#}
                    {#                                                <button class="btn btn-mini btn-success btn-donar" iddp="{{ producto.id|encrypt }}"><i class="fa fa-plus-circle"></i></button>#}
                    {#                                            </td>#}
                    {#                                        {% endif %}#}
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tab-datos-personales" role="tabpanel" aria-labelledby="id_datos_personales">
                            <div class="row ps-2">
                                <div class="col-12">
                                    <div class="card my-4 px-2">
                                        <div class="card-body border-top border-5 rounded-3 border-dark-info">
                                            <div class="table-responsive">
                                                <table class='table table-bordered dataTable' cellpadding="0" cellspacing="0">
                                                <tbody>
                                                <tr><td colspan="4"><b>Nombre:</b> {{ solicitud.persona|upper }}</td></tr>
                                                <tr>
                                                    <td style="width: 25%">
                                                        <b>País de residencia:</b>
                                                        {{ solicitud.persona.pais|default_if_none:'NO DEFINIDO' }}
                                                    </td>
                                                    <td style="width: 25%">
                                                        <b>Provincia de residencia:</b>
                                                        {{ solicitud.persona.provincia|default_if_none:'NO DEFINIDO' }}
                                                    </td>
                                                    <td style="width: 25%">
                                                        <b>Cantón de residencia:</b>
                                                        {{ solicitud.persona.canton|default_if_none:'NO DEFINIDO' }}
                                                    </td>
                                                    <td style="width: 25%">
                                                        <b>Parroquia de residencia:</b>
                                                        {{ solicitud.persona.parroquia|default_if_none:'NO DEFINIDO' }}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><b>Calle Principal:</b> {{ solicitud.persona.direccion }} </td>
                                                    <td colspan="2"><b>Calle Secundaria:</b> {{ solicitud.persona.direccion2 }}</td>
                                                </tr>
                                                <tr>
                                                    <td style="width: 25%"><b>Número de casa:</b> {{ solicitud.persona.num_direccion }}
                                                    </td>
                                                    <td style="width: 25%"><b>Referencia:</b> {{ solicitud.persona.referencia }}</td>
                                                    <td style="width: 25%"><b>Teléfono domicilio
                                                        (fijo):</b> {{ solicitud.persona.telefono_conv }}</td>
                                                        <td style="width: 25%"><b>Celular / Operadora:</b> {{ solicitud.persona.telefono }}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="width: 25%" colspan="4"><b>Sector:</b> {{ solicitud.persona.sector }}
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tab-detalle-publicacion" role="tabpanel" aria-labelledby="id_detalle_publicacion">
                            <div class="row ps-2">
                                <div class="col-12">
                                    <div class="card my-4 px-2">
                                        <div class="card-body border-top border-5 rounded-3 border-dark-info">
                                            <div class="table-responsive">
                                                <table class='table-bordered table-responsive-sm dataTable' cellpadding="0" cellspacing="0">
                                                <thead>
                                                <tr>
                                                    <th width="100" style="text-align: center">Tipo</th>
                                                    <th width="200" style="text-align: center">Recepción</th>
                                                    <th width="200" style="text-align: center">Entrega</th>
                                                    <th width="100" style="text-align: center">Prioridad</th>
                                                    <th width="100" style="text-align: center">Poblacion</th>
                                                    {% if solicitud.evidencianecesidad %}
                                                    <th width="100" style="text-align: center">Evidencia</th>
                                                    {% endif %}
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td style="text-align: left; vertical-align: middle">{{ solicitud.tipodonacion }}</td>
                                                    <td style="text-align: center; vertical-align: middle">
                                                        <span class="tu" title="FECHA INICIO"><i class="fa fa-calendar"></i> {{ solicitud.fechainiciorecepcion|date:'d-m-Y' }}</span><br>
                                                        <span class="tu" title="FECHA FÍN"><i class="fa fa-calendar-check"></i> {{ solicitud.fechafinrecepcion|date:'d-m-Y' }}</span>
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle">
                                                        <span class="tu" title="F. INICIO"><i class="fa fa-calendar"></i> {{ solicitud.fechainicioentrega|date:'d-m-Y' }}</span><br>
                                                        <span class="tu" title="F. FÍN"><i class="fa fa-calendar-check"></i> {{ solicitud.fechafinentrega|date:'d-m-Y' }}</span>
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle">
                                                        <label class="label {{ solicitud.color_estadoprioridad }}">{{ solicitud.get_estadoprioridad_display }}</label>
                                                    </td>
                                                    <td style="text-align: center">
                                                        {% for pb in solicitud.poblacion.all %}
                                                            <span class="badge"
                                                                  style="border:1px solid rgba(157, 157, 157, 0.55);border-radius:10px;color:black;font-weight: normal;background-color: #fff">{{ pb.nombre }}</span>
                                                        {% endfor %}
                                                    </td>
                                                    {% if solicitud.evidencianecesidad %}
                                                    <td style="text-align: center; vertical-align: middle">
                                                        <a class="btn btn-default btn-sm btn-hover gallerypdf .iframe"
                                                           data-fancybox-type="iframe" href="{{ solicitud.evidencianecesidad.url }}">
                                                            <img src="https://sga.unemi.edu.ec/static/images/pdf.png" width="18"
                                                                 height="18" align="absmiddle">
                                                        </a>
                                                    </td>
                                                    {% endif %}
                                                </tr>
                                                </tbody>
                                            </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
              </div>
          </div>
      </div>
</div>


{#<div class="row-fluid">#}
{#    <div class="span12">#}
{#    {% if not es_donar %}#}
{#        <div class="tabbable">#}
{#            <ul class="nav nav-tabs nav-detalle-publicacion" id="myTab" role="tablist">#}
{#                <li class="nav-item li-tabs" role="presentation">#}
{#                    <button class="nav-link tabs active" id="id_detalle_producto" data-bs-toggle="tab" data-bs-target="#tab-detalle-producto" type="button" role="tab" aria-controls="tab-detalle-producto" aria-selected="true">Detalle de productos</button>#}
{#                </li>#}
{#                <li class="nav-item li-tabs">#}
{#                    <button class="nav-link tabs" id="id_datos_personales" data-bs-toggle="tab" data-bs-target="#tab-datos-personales" type="button" role="tab" aria-controls="tab-datos-personales" aria-selected="true">Datos personales</button>#}
{#                </li>#}
{#                <li class="nav-item li-tabs">#}
{#                    <button class="nav-link tabs" id="id_detalle_publicacion" data-bs-toggle="tab" data-bs-target="#tab-detalle-publicacion" type="button" role="tab" aria-controls="tab-detalle-publicacion" aria-selected="true">Detalle de la publicación</button>#}
{#                </li>#}
{#            </ul>#}
{#            <div class="tab-content" id="myTabContent">#}
{#                <div class="tab-pane fade show active" id="tab-detalle-producto" role="tabpanel" aria-labelledby="id_detalle_producto">#}
{#                    <div class="container-fluid">#}
{#                        <div class="card">#}
{#                            <div class="card-header">#}
{#                                <div class="span8">#}
{#                                    <b>Productos</b>#}
{#                                </div>#}
{#                                <div class="span4">#}
{#                                {% if persona %}#}
{#                                    {% if not tiene_datos_donacion and not solicitud.persona == persona %}#}
{#                                        <a href="/donaciones" class="btn btn-warning btn-large btn-mini" style="color:#fff;float:right"><i class="fa fa-handshake-o"></i> <b>Donar</b></a>#}
{#                                    {% endif %}#}
{#                                {% endif %}#}
{#                                </div>#}
{#                            </div>#}
{#                        <div class="card-body">#}
{#                            <a class="btn btn-success" style="float:left"><i class="fa fa-plus"></i>&nbsp; Donar</a><br>#}
{#                            <div class="table-responsive">#}
{#                                <table class='table table-bordered tabla_responsive'>#}
{#                                <thead>#}
{#                                    <tr>#}
{#                                        {% if solicitud.persona == persona %}<th style="text-align: center">Porcentaje de recaudación</th>{% endif %}#}
{#                                        <th style="text-align: center">Producto</th>#}
{#                                        <th style="text-align: center">Cantidad</th>#}
{#                                        <th style="text-align: center">Típo de producto</th>#}
{#                                        {% if tiene_datos_donacion and not solicitud.persona == persona %}#}
{#                                            <th style="text-align: center"><i class="fa fa-gears"></i></th>#}
{#                                        {% endif %}#}
{#                                    </tr>#}
{#                                </thead>#}
{#                                <tbody>#}
{#                                {% for producto in solicitud.get_productos %}#}
{#                                    <tr>#}
{#                                        {% if solicitud.persona == persona %}#}
{#                                            <td  style="vertical-align: middle;text-align: center;padding: 10px">#}
{#                                                {% with pr=producto.get_porcentaje %}#}
{#                                                        <div class="ms-2"><span>{{ pr|floatformat:1 }}%</span></div>#}
{#                                                        <div class="d-flex align-items-center">#}
{#                                                            <div class="progress flex-auto" style="height: 6px;">#}
{#                                                                <div class="progress-bar bg-primary progress-bar-{{ producto.id|encrypt }}" role="progressbar" style="width: {{ pr|floatformat:0 }}%;"#}
{#                                                                     aria-valuenow="{{ pr|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100">#}
{#                                                                </div>#}
{#                                                            </div>#}
{#                                                        </div>#}
{#                                                        {{ producto.get_cantidadrecaudada }} recaudadas de {{ producto.cantidad }} {{ producto.unidadmedida|lower }}#}
{#                                                {% endwith %}#}
{#                                            </td>#}
{#                                        {% endif %}#}
{#                                        <td style="vertical-align: middle">#}
{#                                            <div class="row-fluid" style="text-align: center;margin-bottom: 0;">#}
{#                                                &nbsp;{{ producto.producto }}#}
{#                                            </div>#}
{#                                        </td>#}
{#                                        <td style="text-align: center; vertical-align: middle">#}
{#                                            <span cantidadtotal="{{ producto.cantidad }}" class="cantidad-estimada-{{ producto.id|encrypt }}">#}
{#                                                {{ producto.cantidad_estimada }}#}
{#                                            </span>#}
{#                                            {% if producto.unidadmedida.abreviatura %}{{ producto.unidadmedida.abreviatura }}{% else %}{{ producto.unidadmedida|lower }}{% endif %}{% if producto.cantidad_estimada > 1 %}(s){% endif %}#}
{#                                        </td>#}
{#                                        <td style="text-align: center; vertical-align: middle">{{ producto.producto.tipoproducto }}</td>#}
{#                                        {% if tiene_datos_donacion and not solicitud.persona == persona %}#}
{#                                            <td style="text-align: center;vertical-align: middle;">#}
{#                                                <button class="btn btn-mini btn-success btn-donar" iddp="{{ producto.id|encrypt }}"><i class="fa fa-plus-circle"></i></button>#}
{#                                            </td>#}
{#                                        {% endif %}#}
{#                                    </tr>#}
{#                                {% endfor %}#}
{#                                </tbody>#}
{#                            </table>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="tab-pane fade" id="tab-datos-personales" role="tabpanel" aria-labelledby="id_datos_personales">#}
{#                    <div class="card">#}
{#                        <div class="card-header">#}
{#                            <b>Datos de domicilio</b><br>#}
{#                            {{ solicitud.persona|upper }}#}
{#                        </div>#}
{#                        <div class="card-body p-0">#}
{#                            <table class='table table-bordered dataTable' cellpadding="0" cellspacing="0">#}
{#                                <tbody>#}
{#                                <tr>#}
{#                                    <td style="width: 25%">#}
{#                                        <b>País de residencia:</b>#}
{#                                        {{ solicitud.persona.pais|default_if_none:'NO DEFINIDO' }}#}
{#                                    </td>#}
{#                                    <td style="width: 25%">#}
{#                                        <b>Provincia de residencia:</b>#}
{#                                        {{ solicitud.persona.provincia|default_if_none:'NO DEFINIDO' }}#}
{#                                    </td>#}
{#                                    <td style="width: 25%">#}
{#                                        <b>Cantón de residencia:</b>#}
{#                                        {{ solicitud.persona.canton|default_if_none:'NO DEFINIDO' }}#}
{#                                    </td>#}
{#                                    <td style="width: 25%">#}
{#                                        <b>Parroquia de residencia:</b>#}
{#                                        {{ solicitud.persona.parroquia|default_if_none:'NO DEFINIDO' }}#}
{#                                    </td>#}
{#                                </tr>#}
{#                                <tr>#}
{#                                    <td colspan="2"><b>Calle Principal:</b> {{ solicitud.persona.direccion }} </td>#}
{#                                    <td colspan="2"><b>Calle Secundaria:</b> {{ solicitud.persona.direccion2 }}</td>#}
{#                                </tr>#}
{#                                <tr>#}
{#                                    <td style="width: 25%"><b>Número de casa:</b> {{ solicitud.persona.num_direccion }}#}
{#                                    </td>#}
{#                                    <td style="width: 25%"><b>Referencia:</b> {{ solicitud.persona.referencia }}</td>#}
{#                                    <td style="width: 25%"><b>Teléfono domicilio#}
{#                                        (fijo):</b> {{ solicitud.persona.telefono_conv }}</td>#}
{#                                        <td style="width: 25%"><b>Celular / Operadora:</b> {{ solicitud.persona.telefono }}#}
{#                                    </td>#}
{#                                </tr>#}
{#                                <tr>#}
{#                                    <td style="width: 25%" colspan="4"><b>Sector:</b> {{ solicitud.persona.sector }}#}
{#                                    </td>#}
{#                                </tr>#}
{#                                </tbody>#}
{#                            </table>#}
{#                        </div>#}
{#                        <div class="row-fluid">#}
{#                            <div class="span12">#}
{#                                <section><b>{{ solicitud.persona }}</b></section>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="tab-pane" id="tab-detalle-publicacion" role="tabpanel" aria-labelledby="id_detalle_publicacion">#}
{#                    <div class="card">#}
{#                        <div class="card-header" style="margin-bottom: 2px;">#}
{#                            <h4>Objetivo de la solicitud</h4>#}
{#                            <p class="text-muted">{{ solicitud.objetivo }}</p>#}
{#                        </div>#}
{#                        <div class="card-body p-0">#}
{#                            <div class="table-responsive">#}
{#                                <table class='table-bordered table-responsive-sm dataTable' cellpadding="0" cellspacing="0">#}
{#                                <thead>#}
{#                                <tr>#}
{#                                    <th width="100" style="text-align: center">Tipo</th>#}
{#                                    <th width="200" style="text-align: center">Recepción</th>#}
{#                                    <th width="200" style="text-align: center">Entrega</th>#}
{#                                    <th width="100" style="text-align: center">Prioridad</th>#}
{#                                    <th width="100" style="text-align: center">Poblacion</th>#}
{#                                    {% if solicitud.evidencianecesidad %}#}
{#                                    <th width="100" style="text-align: center">Evidencia</th>#}
{#                                    {% endif %}#}
{#                                </tr>#}
{#                                </thead>#}
{#                                <tbody>#}
{#                                <tr>#}
{#                                    <td style="text-align: center; vertical-align: middle">{{ solicitud.tipodonacion }}</td>#}
{#                                    <td style="text-align: center; vertical-align: middle">#}
{#                                        <span class="tu" title="FECHA INICIO"><i class="fa fa-calendar"></i> {{ solicitud.fechainiciorecepcion|date:'d-m-Y' }}</span><br>#}
{#                                        <span class="tu" title="FECHA FÍN"><i class="fa fa-calendar-check"></i> {{ solicitud.fechafinrecepcion|date:'d-m-Y' }}</span>#}
{#                                    </td>#}
{#                                    <td style="text-align: center; vertical-align: middle">#}
{#                                        <span class="tu" title="F. INICIO"><i class="fa fa-calendar"></i> {{ solicitud.fechainicioentrega|date:'d-m-Y' }}</span><br>#}
{#                                        <span class="tu" title="F. FÍN"><i class="fa fa-calendar-check"></i> {{ solicitud.fechafinentrega|date:'d-m-Y' }}</span>#}
{#                                    </td>#}
{#                                    <td style="text-align: center; vertical-align: middle">#}
{#                                        <label class="label {{ solicitud.color_estadoprioridad }}">{{ solicitud.get_estadoprioridad_display }}</label>#}
{#                                    </td>#}
{#                                    <td style="text-align: center">#}
{#                                        {% for pb in solicitud.poblacion.all %}#}
{#                                            <span class="badge"#}
{#                                                  style="border:1px solid rgba(157, 157, 157, 0.55);border-radius:10px;color:black;font-weight: normal;background-color: #fff">{{ pb.nombre }}</span>#}
{#                                        {% endfor %}#}
{#                                    </td>#}
{#                                    {% if solicitud.evidencianecesidad %}#}
{#                                    <td style="text-align: center; vertical-align: middle">#}
{#                                        <a class="btn btn-default btn-sm btn-hover gallerypdf .iframe"#}
{#                                           data-fancybox-type="iframe" href="{{ solicitud.evidencianecesidad.url }}">#}
{#                                            <img src="https://sga.unemi.edu.ec/static/images/pdf.png" width="18"#}
{#                                                 height="18" align="absmiddle">#}
{#                                        </a>#}
{#                                    </td>#}
{#                                    {% endif %}#}
{#                                </tr>#}
{#                                </tbody>#}
{#                            </table>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    {% else %}#}
{#        <!--INICIO CONTRIBUIDOR EXTERNO-->#}
{#        <ul class="nav nav-tabs" id="myTab" role="tablist">#}
{#             <li class="nav-item tab-formulario" role="presentation">#}
{#               <a class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#tab-detalle-producto" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Detalle de productos</a>#}
{#             </li>#}
{#        </ul>#}
{#        <div class="tab-content" id="myTabContent">#}
{#          <div class="tab-pane fade show active" id="home-tab-pane"  role="tabpanel" aria-labelledby="home-tab" tabindex="0"><br>#}
{#            <table class='table table-responsive table-bordered datatableaddproducto' cellpadding="0" cellspacing="0">#}
{#                <thead style="background-color: #f5f4f8">#}
{#                    <tr>#}
{#                        <th width="" style="text-align: center;">Producto</th>#}
{#                        <th width="130" style="text-align: center">Cantidad</th>#}
{#                        <th width="" style="text-align: center">Típo de producto</th>#}
{#                        <th style="text-align: center;"><i class="fa fa-hashtag"></i></th>#}
{#                        <th width="40" style="text-align: center"></th>#}
{#                    </tr>#}
{#                </thead>#}
{#                <tbody>#}
{#                {% for producto in solicitud.get_productos %}#}
{#                    <tr>#}
{#                        <td style="text-align: center; vertical-align: middle">{{ producto.producto|title }}</td>#}
{#                        <td style="text-align: center; vertical-align: middle">{{ producto.cantidad_estimada }} ({{ producto.unidadmedida.abreviatura|default:"u" }})</td>#}
{#                        <td style="text-align: center; vertical-align: middle">{{ producto.producto.tipoproducto|title }}</td>#}
{#                        <td style="text-align: center; vertical-align: middle;">#}
{#                            <input class="form-control" type="number" name="cantidad" id="id_cantidad_{{ producto.id|encrypt }}" placeholder="0" style="width: 100%;">#}
{#                        </td>#}
{#                        <td style="text-align: center; vertical-align: middle">#}
{#                            <button iddp="{{ producto.id|encrypt }}" class="btn btn-success btn-mini btn-sm btnguardardonacion"><i class="fa fa-plus-circle"></i></button>#}
{#                        </td>#}
{#                    </tr>#}
{#                {% endfor %}#}
{#                </tbody>#}
{#            </table>#}
{#          </div>#}
{#            <div class="tab-pane active" id="tab-detalle-producto">#}
{#                    <div class="container-fluid">#}
{#                        <div class="card">#}
{#                        <div class="card-header">#}
{#                            <b>DETALLE DE PRODUCTOS:</b>#}
{#                        </div>#}
{#                        <div class="card-body">#}
{#                            <a class="btn btn-success" style="float:left"><i class="fa fa-plus"></i>&nbsp; Donar</a><br>#}
{#                            <table class='table table-bordered dataTable'>#}
{#                                <thead>#}
{#                                    <tr>#}
{#                                        <th width="100" style="text-align: center">Porcentaje de recaudación</th>#}
{#                                        <th width="100" style="text-align: center">Producto</th>#}
{#                                        <th width="100" style="text-align: center">Cantidad</th>#}
{#                                        <th width="100" style="text-align: center">Típo de producto</th>#}
{#                                        {% if tiene_datos_donacion %}#}
{#                                            <th width="100" style="text-align: center"><i class="fa fa-gears"></i></th>#}
{#                                        {% endif %}#}
{#                                    </tr>#}
{#                                </thead>#}
{#                                <tbody>#}
{#                                {% for producto in solicitud.get_productos %}#}
{#                                    <tr>#}
{#                                        <td  style="vertical-align: middle">#}
{#                                            {% with pr=producto.get_porcentaje %}#}
{#                                                {% if pr %}#}
{#                                                    ffdgdfsgfgdfgf#}
{#                                                    <div class="row-fluid tu" style="text-align: center;margin-bottom: 0;color:#fff" title="Porcentaje de recaudación">#}
{#                                                        <div class="progress" style="height: 14px;">#}
{#                                                          <div class="progress-bar-{{ producto.id|encrypt }}" role="progressbar" aria-valuenow="{{ pr|safe|floatformat:0 }}"#}
{#                                                            aria-valuemin="0" aria-valuemax="100" style="margin-bottom: 5px;width:{{ pr|safe|floatformat:0 }}%;background-color: {% cycle '#0d6efd' '#6610f2' '#6f42c1' '#d63384' '#dc3545' '#0dcaf0' '#1c3247' %};">#}
{#                                                            <b style="font-size: 12px;">{{ pr|safe|floatformat:2 }}%</b>#}
{#                                                          </div>#}
{#                                                        </div>#}
{#                                                    </div>#}
{#                                                {% endif %}#}
{#                                            {% endwith %}#}
{#                                        </td>#}
{#                                        <td style="vertical-align: middle">#}
{#                                            <div class="row-fluid" style="text-align: center;margin-bottom: 0;">#}
{#                                                &nbsp;{{ producto.producto }} xxx#}
{#                                            </div>#}
{#                                        </td>#}
{#                                        <td style="text-align: center; vertical-align: middle"><span cantidadtotal="{{ producto.cantidad }}" class="cantidad-estimada-{{ producto.id|encrypt }}">{{ producto.cantidad_estimada }}</span> {{ producto.unidadmedida.nombre|lower|capfirst }}</td>#}
{#                                        <td style="text-align: center; vertical-align: middle">{{ producto.producto.tipoproducto }}</td>#}
{#                                        <td style="text-align: center;vertical-align: middle;">#}
{#                                                <div class="span10">#}
{#                                                    <input class="form-control" type="text" onKeyPress="soloNumeros(evt)">#}
{#                                                </div>#}
{#                                                <button class="btn btn-mini btn-success btn-donar" iddp="{{ producto.id|encrypt }}"><i class="fa fa-plus"></i></button>#}
{#                                        </td>#}
{#                                    </tr>#}
{#                                {% endfor %}#}
{#                                </tbody>#}
{#                            </table>#}
{#                        </div>#}
{#                    </div>#}
{#                    </div>#}
{#                </div>#}
{#        </div>#}
{##}
{#    {% endif %}#}
{##}
{##}
{##}
{#    </div>#}
{#</div>#}
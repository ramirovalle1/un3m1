{% extends 'af_activofijo/base_activofijo.html' %}
{% load sga_extras %}
{% load humanize %}
{% block extraJs_ext %}
    <script>
        $(function () {
            $("select").select2({minimumResultsForSearch: 20});
            buscarPersona($('#id_persona'), '', 'buscarpersonas', '', true);
            $('.activobaja').click(function () {
                let ida = $(this).attr("ida");
                let id = $(this).attr("idase");
                let valor = $(this).is(':checked')?'y': 'n';
                $(this).prop('checked', !$(this).prop('checked'));
                if(valor == 'y'){
                    formModalBase(`${ida}`, 'Gestionar Baja', 'gestionarbaja', `${valor}`, 'modal-md');
                }else{
                    const mensaje = `<p><b>¿Qué sucederá al desmarcar la opción "Gestionar baja"?</b></p>
                                    <p>
                                        Al desmarcar esta opción, quedará registrado en el historial y la ubicación del activo en la bodega será eliminada.
                                    </p>
                                    <b class="fs-4">¿Está seguro de desmarcar la opción "Gestionar de baja"?</b>`;
                    confirmsweetalertmessage('Quitar activo de proceso gestión de baja', `${mensaje}`, 'quitargestionarbaja', `${ida}`);
                    
                    {#bloqueointerface();#}
                    {#$.ajax({#}
                    {#    type: "POST",#}
                    {#    url: "{{ request.path }}",#}
                    {#    data: {'action': 'iniciabaja', 'id': id, 'val': valor},#}
                    {#    success: function (data) {#}
                    {#        if (data.result === 'ok') {#}
                    {#            $.unblockUI();#}
                    {#            location.reload();#}
                    {#        } else {#}
                    {#            $.unblockUI();#}
                    {#            if (valor === 'y') {#}
                    {#                $("#ch_" + id).prop('checked', false);#}
                    {#            } else {#}
                    {#                $("#ch_" + id).prop('checked', true);#}
                    {#            }#}
                    {#            smoke.alert(data.mensaje);#}
                    {#        }#}
                    {#    },#}
                    {#    error: function () {#}
                    {#        $.unblockUI();#}
                    {#        if (valor === 'y') {#}
                    {#            alert();#}
                    {#            $("#ch_" + id).prop('checked', false);#}
                    {#        } else {#}
                    {#            $("#ch_" + id).prop('checked', true);#}
                    {#        }#}
                    {#        smoke.alert("Error al enviar los datos.");#}
                    {#    },#}
                    {#    dataType: "json"#}
                    {# });#}
                }
            });

            $("#cerrarpanel_cerrar").click(function () {
                $("#cerrarpanel").modal("hide");
            });

            $("#cerrarpanel_depreciar").click(function () {
                empezar_depreciacion();
                $("#fecha_dep").attr({'disabled': 'disabled'});
                $("#cerrarpanel_cerrar, #cerrarpanel_depreciar").hide();
            });

            function terminar() {
                $("#cerrarpanelprogresshint").html("Finalizando Depreciación");
                $("#progressbar").css({'width': '100%'});
                intentos = 0;
                $("#cerrarpanel").modal("hide");
                bloqueointerface();
                location.href = "/af_activofijo";
            }

            function fallo() {
                $.unblockUI();
                $("#cerrarpanel").modal("hide");
                smoke.alert("Fallo al depreciar");
                $("#fecha_dep").removeAttr('disabled');
                $("#cerrarpanel_cerrar, #cerrarpanel_depreciar").show();
            }

            var a = 0;

            function depreciacion(lista, elemento, cantidad) {
                var activo = lista[elemento];
                var cp = (100 / (cantidad + 1)) * elemento + '%';
                var fecha = $("#fecha_dep").val();
                if (elemento > cantidad) {
                    $("#cerrarpanel").modal("hide");
                    bloqueointerface();
                    location.href = "/af_activofijo";
                } else {
                    $("#cerrarpanelprogresshint").html(activo.descripcion);
                    $("#progressbar").css({'width': cp});
                    $.ajax({
                        type: "POST",
                        url: "/af_activofijo",
                        data: {"action": "depreciando", "maid": activo.id, "fecha": fecha},
                        success: function (data) {
                            if (data.result == 'ok') {
                                intentos = 0;
                                depreciacion(lista, elemento + 1, cantidad);
                            } else {
                                intentos += 1;
                                if (intentos >= 100) {
                                    fallo();
                                } else {
                                    depreciacion(lista, elemento, cantidad);
                                }
                            }
                        },
                        error: function () {
                            intentos += 1;
                            if (intentos >= 100) {
                                fallo();
                            } else {
                                depreciacion(lista, elemento, cantidad);
                            }
                        },
                        dataType: "json"
                    });
                }
            }

            empezar_depreciacion = function () {
                var fecha = $("#fecha_dep").val();
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/af_activofijo",
                    data: {'action': 'depreciar', 'fecha': fecha},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            activos = data.activos;
                            cantidad = activos.length;
                            indice = 0;
                            depreciacion(activos, indice, (cantidad - 1));
                        } else {
                            mensajeErrorSwal("", data.mensaje);
                            $("#fecha_dep").removeAttr('disabled');
                            $("#cerrarpanel_cerrar, #cerrarpanel_depreciar").show();
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        mensajeErrorSwal("", "Error de conexión");
                        $("#fecha_dep").removeAttr('disabled');
                        $("#cerrarpanel_cerrar, #cerrarpanel_depreciar").show();
                    },
                    dataType: "json"
                });
            };

            $("#depreciar").click(function () {
                $("#cerrarpanel").modal({keyboard: false, backdrop: 'static'}).modal("show");
            });
            $(".informebaja").click(function () {
                var id = $(this).attr('idr');
                openwindow('POST', '/af_activofijo', {action: 'informebajapdf', 'id': id}, '_blank');
            });


            $("#importa_resp").click(function () {
                smoke.confirm("¿Está seguro que desea actualizar responsables.?", function (e) {
                    if (e) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/af_activofijo",
                            data: {'action': 'actualizamasivo'},
                            success: function (data) {
                                if (data.result == 'ok') {
                                    $.unblockUI();
                                    smoke.alert("Importación exitosa");
                                    location.reload();
                                } else {
                                    $.unblockUI();
                                    smoke.alert(data.mensaje);
                                }
                            },
                            error: function () {
                                $.unblockUI();
                                smoke.alert("Error al enviar los datos.");
                            }
                        })
                    }
                }, {
                    ok: "SI, SEGURO",
                    cancel: "NO,CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            });

            $("#reportefiltros").click(function () {
                var estados_list = $("#estados_list").val();
                var clases_list = $("#tipos_list").val();
                var cuentas_list = $("#agentes_list").val();
                var cuentas_list = $("#agentes_list").val();
                openwindow('POST', '/af_activofijo', {
                    action: 'reportefiltros',
                    est: estados_list,
                    clas: clases_list,
                    cuent: cuentas_list
                }, '_blank');
            });

        });

    </script>
{% endblock %}
{% block subtitle %}
    Administración
{% endblock %}
{% block title_input %}Buscar por codigos de gobierno, interno o descripcion...{% endblock %}
{% block filtros %}
    <div class="mb-1">
        <label for=""><i class="fa fa-traffic-light"></i> Estado:</label>
        <select name="estado" id="estados_list" class="form-control" style="width: 100%">
            <option value="">Buscar por Estados</option>
            {% for tc in estados %}
                <option {% if tc.id == estado %}selected{% endif %}
                        value="{{ tc.id }}">{{ tc.nombre }}</option>
            {% endfor %}
        </select>
    </div>
     <div class="mb-1">
        <label for=""><i class="fa fa-bullseye"></i> Cuenta:</label>
        <select name="cuenta" id="cuentas_list" style="width: 100%" class="form-control">
            <option value="">Buscar por cuenta</option>
            {% for tc in cuentas %}
                <option {% if tc.pk == cuenta %}selected{% endif %}
                        value="{{ tc.pk }}">{{ tc.cuenta }}-{{ tc.descripcion }}</option>
            {% endfor %}
        </select>
    </div>
     <div class="mb-1">
        <label for=""><i class="fa fa-circle-notch"></i> Clase de bien:</label>
         <select name="clase" id="clase_list" style="width: 100%" class="form-control">
            <option value="">Buscar por clase de bien</option>
            {% for tc in clases %}
                <option {% if tc.0 == clase %}selected{% endif %}
                        value="{{ tc.0 }}">{{ tc.1 }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-1">
        <label for=""><i class="fa fa-map-marker"></i> Ubicación del bien:</label>
        <select name="ubicacion" id="ubicacion" style="width: 100%" class="form-control">
            <option value="">Buscar por la ubicación</option>
            {% for ubi in ubicaciones %}
                <option {% if ubi.0  == ubicacion %}selected{% endif %}
                        value="{{ ubi.0 }}">{{ ubi.1 }} - {{ ubi.2 }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-1">
        <label for=""><i class="fa fa-user"></i> Responsable del bien:</label>
        <select name="responsable" id="id_persona" class="form-control">
            <option selected value="{{ responsable.id }}">
                {{ responsable.nombre }}
            </option>
        </select>
    </div>
{% endblock %}
{% block content %}
     {% if perms.sagest.puede_modificar_constataciones or perms.sagest.puede_modificar_activos%}
        <div class='row'>
            <div class="col-lg-12 pb-2">
                <div class="btn-group" role="group">
                    <div class="row">
                        <!-- Boton Constataciones -->
                        {% if perms.sagest.puede_modificar_constataciones %}
                            <div class="col p-0" role="group">
                                <button id="btnGroupDrop2" type="button" class="btn btn-default w-100 dropdown-toggle"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    Constataciones <i class="fa fa-angle-down"></i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop2">
                                    <li><a href="/af_activofijo?action=addconstatacion"
                                           class="dropdown-item bloqueo_pantalla"><i class="fa fa-plus dropdown-item-icon"></i> Nueva</a>
                                    </li>
                                    <li><a href="/af_activofijo?action=histconstatacion"
                                           class="dropdown-item bloqueo_pantalla"><i
                                            class="fa fa-list dropdown-item-icon"></i> Constataciones</a>
                                    </li>
                                    <li><a href="/af_activofijo?action=histconstatacionencontrados"
                                           class="dropdown-item bloqueo_pantalla"><i class="fa fa-list dropdown-item-icon"></i>
                                        Bienes encontrados</a></li>
                                    <li><a href="/af_activofijo?action=historicoactivoconstatacion" class="dropdown-item bloqueo_pantalla"><i class="fa fa-list dropdown-item-icon"></i> Historial Activos</a></li>
                                </ul>
                            </div>
                        {% endif %}

                        <!-- Boton Activos -->
                        {% if perms.sagest.puede_modificar_activos %}
                            <div class="col p-0" role="group">
                                <button id="btnGroupDrop5" type="button" class="btn btn-default w-100 dropdown-toggle"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    Activos <i class="fa fa-angle-down"></i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop5">

                                    {% if perms.sagest.puede_modificar_activos %}
                                        <li><a href="/af_activofijo?action=add"
                                               class="dropdown-item bloqueo_pantalla"><i
                                                class="fa fa-plus dropdown-item-icon"></i> Adicionar</a></li>
                                    {% endif %}

                                    {% if perms.sagest.puede_modificar_importacion %}
                                        <li><a href="/af_activofijo?action=importaciones"
                                               class="dropdown-item bloqueo_pantalla"><i
                                                class="fa fa-cloud-upload dropdown-item-icon"></i>
                                            Importar</a></li>
                                    {% endif %}

                                    <li><a href="/af_activofijo?action=exportaciones"
                                           class="dropdown-item bloqueo_pantalla"><i
                                            class="fa fa-cloud-download dropdown-item-icon"></i> Exportar</a>
                                    </li>
                                    <li class="divider"></li>

                                    {% if perms.sagest.puede_modificar_depreciacion %}
                                        <li><a id="depreciar" href="javascript:;" class="dropdown-item "><i
                                                class="fa fa-money dropdown-item-icon"></i> Depreciar</a></li>
                                    {% endif %}

                                    {#                        <li class="divider"></li>#}
                                    {#                        <li class="dropdown-submenu pull-left" ><a href="javascript:;"><i class="fa fa-search"></i>#}
                                    {#                            Consultas</a>#}
                                    {#                            <ul class="dropdown-menu">#}
                                    {#                                <li><a href="/af_activofijo?action=consultacatalogo" class="dropdown-item bloqueo_pantalla"><i class="fa fa-search"></i> Cat&aacute;logo</a>#}
                                    {#                                </li>#}
                                    {#                                <li><a href="/af_activofijo?action=consultausuario" class="dropdown-item bloqueo_pantalla"><i class="fa fa-search"></i>#}
                                    {#                                    Usuario/Ubica.</a></li>#}
                                    {#                            </ul>#}
                                    {#                        </li>#}


                                </ul>
                            </div>

                            {#                    BOTON DE CONSULTAS PROVISIONAL#}

                            <!-- Boton Reportes -->
                            <div class="col p-0" role="group">
                                <button id="btnGroupDrop6" type="button" class="btn btn-default w-100 dropdown-toggle"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    Reportes <i class="fa fa-angle-down"></i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop6">

                                    <li><a href="/af_activofijo?action=reportebaja" class="dropdown-item"><i
                                            class="fa fa-download dropdown-item-icon bloqueo_pantalla"></i> Proceso de baja
                                    </a></li>

                                    <a href="javascript:void(0)"
                                       class="dropdown-item"
                                       onclick="confirmsweetalertmessage('Descarga de archivo .zip de reportes técnicos', 'El archivo comprimido con todos los reportes técnicos que estén en proceso de baja ' +
                                               'será generado en segundo plano, recibirá una notificación cuando este listo',
                                               'descargarinformestecnicos', '{{ list.id|encrypt }}', '', '{{ request.path }}', false, false, '', 'info')">
                                        <i class="fa fa-refresh dropdown-item-icon"></i>
                                        .zip Informes proceso baja
                                    </a>
                                    
                                    
                                    {#                        <li><a href="javascript:;" id="reportefiltros"><i class="fa fa-file-excel-o"></i> Reporte </a></li>#}

                                    <li>
                                        <a href="javascript:void(0)"
                                           onclick="mensajeConfirmSwal('¿Está seguro de generar el reporte en excel?', 'El archivo excel será generado según los filtros aplicados', false, '', '', '', '{{ request.path }}?reporte=excel&{{ url_vars }}')"
                                           class="dropdown-item"
                                           data-bs-toggle="tooltip"
                                           title="Exportar reporte en excel dependiendo del filtro actual">
                                            <i class="fa fa-file-excel dropdown-item-icon"></i> Exportar reporte
                                        </a>
                                    </li>

                                </ul>
                            </div>
                            <div class="col p-0" role="group">
                             <!-- Boton Bajas -->
                        <button id="btnGroupDrop4" type="button" class="btn btn-default dropdown-toggle"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            Bajas <i class="fa fa-angle-down"></i>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="btnGroupDrop4">
                            {% if perms.sagest.puede_modificar_bajas %}
                                <li><a href="/af_activofijo?action=addbaja" class="dropdown-item bloqueo_pantalla"><i
                                        class="fa fa-plus dropdown-item-icon"></i> Nueva</a></li>
                            {% endif %}
                            <li><a href="/af_activofijo?action=tiposbajas" class="dropdown-item bloqueo_pantalla"><i
                                    class="fa fa-list dropdown-item-icon"></i> Mantenimiento Tipo
                                Baja</a></li>
                            <li><a href="/af_activofijo?action=histbajas" class="dropdown-item bloqueo_pantalla"><i
                                    class="fa fa-list dropdown-item-icon"></i> Realizadas</a></li>
                        </ul>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
        <div class="card mb-4">
            <div class="card-body border-top border-6 rounded-3 border-dark-info">
                <div class="table-responsive">
                    <table class='table table_primary'>
                        <thead class="table-light">
                        <tr>
                            <th class="text-center">Códigos</th>
{#                            <th class="text-center"><i class="fa fa-clipboard"></i> Catálogo</th>#}
                            <th class="">Activo</th>
                            <th class="text-center">Responsable</th>
                            <th class="w-20">Detalle</th>
                            <th class="text-center"></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for c in activos %}
                            <tr>
                                <td data-title='Códigos' class="w-15 text-center align-middle">
                                    <p>
                                        <b>Gob: </b>{{ c.codigogobierno|default_if_none:"" }}
                                    </p>
                                    {% if c.codigointerno %}
                                        <p>
                                            <b>Int: </b>{{ c.codigointerno }}
                                        </p>
                                    {% endif %}
                                    {% if c.es_electronico %}
                                        <p>
                                            <span class="badge bg-primary ">Tecnológico</span>
                                        </p>
                                    {% endif %}
                                    {% if c.statusactivo == 2 %}
                                        <p>
                                        <span class="badge bg-danger tu" title="Baja">Baja</span>
                                        </p>
                                    {% endif %}

                                </td>
                                <td data-title='activo' class="w-30">
                                    <div class="row">
                                        <div class="col">
                                            <div class="d-flex" style="font-size: .80rem">
                                                <div>
                                                     <p>
                                                        <b>Estado del activo: </b>{{ c.estado|title }}
                                                    </p>
                                                    {% if c.condicionestado %}
                                                        <p>
                                                            <b>Condición del activo: </b>{{ c.get_condicionestado_display }}
                                                        </p>
                                                    {% endif %}
                                                    {% if c.enuso is not None %}
                                                        <p>
                                                            <b>En uso: </b>{% if c.enuso %} SI {% else %} NO {% endif %}
                                                        </p>
                                                    {% endif %}
                                                    <p class="lh-35"><b>Catalogo: </b>
                                                        {{ c.catalogo|title2 }}
                                                    </p>
                                                    <p class="lh-35"><b>Descripción: </b>
                                                        {{ c.descripcion|title2 }}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto text-center me-2 v-align-middle justify-content-center">
                                            <a href="javascript:void(0)"
                                               onclick="formModalBase('{{ c.id }}','Detalle de activo','detalle_activo','','modal-xl',false)"
                                                cid="{{ c.id }}"
                                               class=""
                                               data-bs-toggle="tooltip" data-bs-placement="top" title=""
                                               data-bs-original-title="Detalle de activo">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor"
                                                     class="bi bi-info-circle-fill me-2" viewBox="0 0 16 16">
                                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
                                                </svg>
                                            </a>
                                        </div>
                                    </div>
                                </td>
                                <td class="w-15 align-middle text-center" style="font-size: .80rem;">
                                    {% if c.responsable %}
                                        <p>
                                            {{ c.responsable.nombre_completo_minus }}
                                        </p>
                                        <p class="fs-6 " style="line-height: 14px"><b>{{ c.ubicacion|title2 }}</b>

                                        </p>
                                    {% endif %}
                                </td>
                                <td class="w-15 align-middle" data-title='detalle' style="font-size: .80rem;">
                                    <p><b>F.Ingreso: </b>{{ c.fechaingreso|date:'d-m-Y' }}</p>
                                    <p>
                                        <b>Costo: </b> $ {{ c.costo|floatformat:2|intcomma }}
                                    </p>
                                    {% if perms.sagest.puede_gestionar_check_baja %}
                                        {% if not c.statusactivo == 2 %}
                                            <p><b>Gestionar baja: </b>
                                             <input type="checkbox" name="checkbox" class="activobaja" ida="{{ c.id|encrypt }}" idase="{{ c.id }}"
                                                   id="ch_{{ c.id }}"
                                                   {% if c.procesobaja %}checked{% endif %}>
                                            </p>
                                        {% endif %}
                                        {% else %}
                                        {% if c.procesobaja %}
                                        <label class="text-warning"> Proceso de baja</label>
                                            {% endif %}
                                    {% endif %}

                                <p><b>Archivo baja:</b>
                                    {% if c.archivo_informebaja %}
                                         <a target="_blank" href="{{ c.archivo_informebaja.url }}"
                                             data-width="2048" data-height="1365"  class="tb"
                                             data-fancybox="iframe{{ c.pk }}"
                                             data-caption="Archivo de baja: {{ c.codigogobierno }}"
                                             title="Archivo de baja">
                                             <i class="fa fa-file-pdf-o text-danger fs-4"></i></a>
                                        <span class="text-{{ c.documentoinformebaja.color_estado }}">{% if c.documentoinformebaja.estadofirma  %}{{ c.documentoinformebaja.get_estadofirma_display }}{% else %}No actualizado{% endif %}</span>
                                    {% else %}
                                        S/A
                                    {% endif %}
                                </p>
                                </td>
                                <td data-title="Acciones" class="text-center align-middle w-3">
                                    {% if perms.sagest.puede_consulta_activos %}
                                        <div class="dropbottom">
                                            <button class="btn-icon btn btn-ghost btn-sm rounded-circle dropdown-toggle"
                                                    type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                            </button>
                                            <ul class="dropdown-menu" x-placement="right-start">
                                                {% if not c.baja and perms.sagest.puede_modificar_activos %}
                                                    <li><a class="dropdown-item"
                                                            href="/af_activofijo?action=edit&id={{ c.id }}"><i
                                                            class="fa fa-edit dropdown-item-icon"></i> Editar </a></li>
                                                {% endif %}
                                                {% if not c.documento_firmadirector and not c.es_electronico %}
                                                    {% if perms.sagest.puede_gestionar_informeactivo_fijo %}
                                                        <li>
                                                            <a href="javascript:void(0);" onclick="formModalBase('{{ c.id|encrypt }}','Ingresar informe de baja - {{ c.codigogobierno }}','addinformebaja')"
                                                                class="dropdown-item"><i class="fa fa-leaf dropdown-item-icon"></i> {% if not c.existeinformebaja %}Ingreso{% else %} Editar {% endif %} informe baja</a>
                                                        </li>
                                                    {% endif %}
                                                    {% if c.existeinformebaja and c.existeinformebaja.responsable.id == persona.id and perms.sagest.puede_modificar_mantenimientos %}
                                                        {% with puedefirmar=c|args:'AF'|call:'existe_directorresponsablebaja' %}
                                                            {% if puedefirmar %}
                                                                <li>
                                                                    <a href="javascript:void(0);"
                                                                       onclick="formModalBase('{{ c.existeinformebaja.id|encrypt }}','Firmar informe de baja - {{ c.codigogobierno }}','firmarinformebaja','','modal-md')"
                                                                       class="dropdown-item"><i
                                                                            class="fa fa-signature dropdown-item-icon"></i>
                                                                        Firmar informe baja</a>
                                                                </li>
                                                                <li><a href="javascript:;"
                                                                       class="tu informebaja dropdown-item"
                                                                       idr="{{ c.id }}">
                                                                    <i class="fa fa-download dropdown-item-icon"></i>
                                                                    Informe baja </a>
                                                                </li>
                                                                <li>
                                                                    <a class="dropdown-item"
                                                                       href="javascript:void(0);"
                                                                       onclick="formModalBase('{{ c.id }}','SUBIR ARCHIVO DE BAJA', 'addarchivobaja','', 'modal-md')">
                                                                        <i class='fa fa-upload dropdown-item-icon'></i>
                                                                        {% if c.archivobaja %}
                                                                            Editar archivo de baja
                                                                        {% else %}
                                                                            Subir informe de baja firmado{% endif %}
                                                                    </a>
                                                                </li>
                                                            {% endif %}
                                                        {% endwith %}
                                                    {% endif %}
                                                    {% if not c.existeinformebaja and perms.sagest.puede_subirinformebaja_firmado %}
                                                         <li>
                                                            <a class="dropdown-item"
                                                               href="javascript:void(0);"
                                                               onclick="formModalBase('{{ c.id }}','SUBIR ARCHIVO DE BAJA FIRMADO POR TODOS LOS RESPONSABLES', 'addinformebajafirmado','', 'modal-md')">
                                                                <i class='fa fa-upload dropdown-item-icon'></i>
                                                                {% if c.archivobaja %}
                                                                    Editar informe de baja firmado
                                                                {% else %}
                                                                    Subir informe de baja firmado
                                                                {% endif %}
                                                            </a>
                                                         </li>
                                                    {% endif %}
                                                {% endif %}

                                                <li><a  class="dropdown-item"
                                                        href="/af_activofijo?action=historial&id={{ c.id }}"><i
                                                        class="fa fa-list dropdown-item-icon"></i> Historial </a></li>
                                                <li><a  class="dropdown-item"
                                                        href="/af_activofijo?action=constataciones&id={{ c.id }}"><i
                                                        class="fa fa-list dropdown-item-icon"></i> Constataciones </a></li>
                                                {% if perms.sagest.puede_modificar_tarjeta and not c.baja %}
                                                    <li><a  class="dropdown-item"
                                                            href='/af_activofijo?action=addtarjeta&id={{ c.id }}'><i
                                                            class='fa fa-edit dropdown-item-icon'></i> Ingreso Tarjeta Control</a></li>
                                                {% endif %}
                                                {#                                    {% if c.statusactivo == 2 %}#}

                                                {#                                    {% endif %}#}

                                                <li>
                                                    {% if not c.documento_activobaja_at %}
                                                        <a href="javascript:void(0);"
                                                           onclick="formModalBase('{{ c.id|encrypt }}','Verificación Técnica','verificaciontecnica','','modal-lg')"
                                                           class="dropdown-item"><i
                                                                class="bi bi-person-fill-dash dropdown-item-icon"></i>
                                                            Verificación técnica</a>
                                                    {% endif %}
                                                </li>
                                                <li>
                                                    <a href="javascript:void(0);"
                                                       onclick="formModalBase('{{ c.id|encrypt }}','Historial de estados','historialestadosactivo','','modal-xl')"
                                                       class="dropdown-item"><i
                                                            class="fa fa-history dropdown-item-icon"></i> Historial de estados</a>
                                                </li>
                                            </ul>
                                        </div>
                                    {% endif %}
                                </td>

                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="20" STYLE="text-align: center">
                                    NO EXISTEN ACTIVOS REGISTRADOS EN EL SISTEMA
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer border-top-0">
                {% include 'paginacionb4.html' %}
            </div>
        </div>
{% endblock %}
{% block moreblock_ext %}
    <div class="modal fade static" id="cerrarpanel" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="cerrarpanelpaneltitle">Depreciando Activos</h3>
                </div>
                <div class="modal-body" id="cerrarpanelpanelbody">
                    <div style="margin-bottom: 10px">
                        Fecha: <input type="date" id="fecha_dep" class="form-control selectorfecha"
                                      value="{{ fecha|date:'Y-m-d' }}">
                    </div>
                    Progreso de depreciaci&oacute;n:
                    <div class="progress progress-striped active">
                        <div class="progress-bar" role="progressbar" style="width: 0;" id="progressbar"
                             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div id="cerrarpanelprogresshint">
                    </div>
                </div>
                <div class="modal-footer">
                    <div style="float: right">
                        <a href="javascript:;" id="cerrarpanel_depreciar" class="btn btn-danger"> Depreciar</a>
                        <a href="javascript:;" id="cerrarpanel_cerrar" class="btn btn-info"> Cerrar</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


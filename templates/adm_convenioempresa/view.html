{% extends "basebs.html" %}
{% load humanize %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src='/static/js/fontawesomev3.js?v=1.0.0'></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet"/>
    <style>.swal2-popup {
        font-size: 12px !important;
        width: 37em
    }
    </style>
    <script type="text/javascript">
        var desde = '', hasta = '';
        $(document).ready(function () {
            $('.delarch').tooltip();
            $(".primerfilaacoordion").on('show.bs.collapse', function () {
                $(".primerfilaacoordion.in").each(function () {
                    $(this).parent().find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down");
                    $(this).collapse('hide')
                });
                $(this).parent().find(".fa").removeClass("fa-chevron-down").addClass("fa-chevron-up");
            }).on('hide.bs.collapse', function () {
                $(this).parent().find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down");
            });

            $(".segundafilaacoordion").on('show.bs.collapse', function () {
                $(".segundafilaacoordion.in").each(function () {
                    $(this).parent().find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down");
                    $(this).collapse('hide')
                });
                $(this).parent().find(".fa").removeClass("fa-chevron-down").addClass("fa-chevron-up");
            }).on('hide.bs.collapse', function () {
                $(this).parent().find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down");
            });

        });
        buscarPor = "{% if buscar_por %}&buscar_por={{ buscar_por }}{% endif %}";
        filtroSeleccionado = "{% if filtro %}&filtro={{ filtro }}{% endif %}";

        function clickBuscarPor(variable) {
            buscarPor = variable;
            $('#searchinput').attr('placeholder', variable.replace('&buscar_por=', '').replace('_', ' '))
        }

        $(function () {
            $("#id_fechaini, #id_fechafin").addClass("validate[required]").datepicker({format: "yyyy-mm-dd"}).on('changeDate', function (ev) {
                $(this).datepicker('hide');
            })
            $('.btnBuscarPor').click(function () {
                $('.btnBuscarPor').each(function (index) {
                    $(this).html($(this).html().replace(' <i class="fa fa-check" aria-hidden="true"></i>', ''));
                });
                $(this).html($(this).html() + ' <i class="fa fa-check" aria-hidden="true"></i> ');
            });
            busqueda = function () {
                var term = $("#searchinput").val().trim().toUpperCase();
                if (term.length > 0) {
                    location.href = "{{ request.path }}?s=" + term + buscarPor + filtroSeleccionado;
                }
                return false;
            };

            $("#search").click(function () {
                busqueda();
            });

            $('#searchinput').keyup(function (e) {
                if (e.keyCode == 13) {
                    busqueda();
                }
            });
            $(".vercarreras").click(function () {
                var id = $(this).attr('idcon');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "{{ request.path }}",
                    data: {'action': 'vercarreras', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbody").html(data.data);
                            $("#itemspanel").modal({backdrop: 'static', width: '900px'}).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            $("#itemspanel .btn-cerrar").click(function () {

                $("#itemspanel").modal("hide");
                return false;
            });

            $(".tl").tooltip({position: "center up"});

            $(".activaestado").click(function () {

                var idconvenio = $(this).attr("idconv")
                bloqueointerface();
                $.post("{{ request.path }}", {'action': 'cambiaestado', "idconvenio": idconvenio}, function (data) {
                    $.unblockUI();
                    if (data.valor) {
                        $("#idestadoactiva" + idconvenio).html('<i class="fa fa-check" style="color: green"></i>');
                    } else {
                        $("#idestadoactiva" + idconvenio).html('<i class="fa fa-remove" style="color: red"></i>');
                    }

                }, "json");
            });


            $('input[name="fechas"]').daterangepicker({
                showDropdowns: true,
                autoUpdateInput: false,
                opens: "center",
                drops: "up",
                minDate: moment().subtract(5, 'years').startOf('year'),
                maxDate: moment().endOf('year'),
                startDate: moment(),
                endDate: moment(),
                locale: {
                    format: 'YYYY-MM-DD',
                    applyLabel: '<i class="fas fa-check"></i> Selecionar',
                    cancelLabel: '<i class="fa fa-eraser"></i> Limpiar',
                    showButtonPanel: false,
                    customRangeLabel: "Custom",
                    daysOfWeek: [
                        "Dom",
                        "Lun",
                        "Mar",
                        "Mie",
                        "Jue",
                        "Vie",
                        "Sáb"
                    ],
                    monthNames: [
                        "Enero",
                        "Febrero",
                        "Marzo",
                        "Abril",
                        "Mayo",
                        "Junio",
                        "Julio",
                        "Agosto",
                        "Septiembre",
                        "Octubre",
                        "Noviembre",
                        "Diciembre"
                    ],
                    firstDay: 1
                }
            }).on('apply.daterangepicker', function (ev, picker) {
                desde = picker.startDate.format('YYYY-MM-DD');
                hasta = picker.endDate.format('YYYY-MM-DD');
                $(this).val(desde + ' - ' + hasta);
            }).on('cancel.daterangepicker', function (ev, picker) {
                desde = '';
                hasta = '';
                $(this).val('');
            });

            $('#vigencia').change(function () {
                if ($(this).val() !== '0') {
                    $('#fechas_group').fadeOut();
                } else {
                    $('#fechas_group').fadeIn();
                }
            });
        });
    </script>

    <script>
        function formularioModal(id, text, action, footer = true) {
            $('.panelbodyform').empty();
            bloqueointerface();
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        if (footer === true) {
                            $('#footermodalform').hide();
                        }
                        $('.panelbodyform').html(data.data);
                        $('#itemspanelform .paneltitleform').html(text);
                        $("#itemspanelform").modal({backdrop: 'static'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function formModal(id, text, action) {
            bloqueointerface()
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {
                    'action': action,
                    'id': id,
                },
                success: function (data) {
                    $.unblockUI();
                    if (data.result === true) {
                        $('.panelbody2').html(data.data);
                        $('#itemspanel2 .paneltitle').html(text);
                        $("#itemspanel2").modal({backdrop: 'static', width: '900'}).modal('show');
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        $(function () {

            $(".practicas").change(async function () {
                {#var idconvenio = $(this).prop('checked');#}
                var idconvenio = $(this).val();
                bloqueointerface();
                $.post("{{ request.path }}", {'action': 'practicas', "idconvenio": idconvenio}, function (data) {
                    $.unblockUI();
                    if (data.valor) {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: 'success',
                            title: 'Habilitado para Prácticas Profesionales',
                            showConfirmButton: false,
                            timer: 6000
                        })
                    } else {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: 'warning',
                            title: 'Inhabilitado para Prácticas Profesionales',
                            showConfirmButton: false,
                            timer: 6000
                        })
                    }

                }, "json");
            });
            $(".pasantias").change(async function () {
                {#var idconvenio = $(this).prop('checked');#}
                var idconvenio = $(this).val();
                bloqueointerface();
                $.post("{{ request.path }}", {'action': 'pasantias', "idconvenio": idconvenio}, function (data) {
                    $.unblockUI();
                    if (data.valor) {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: 'success',
                            title: 'Habilitado para Pasantías Profesionales',
                            showConfirmButton: false,
                            timer: 6000
                        })
                    } else {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            type: 'warning',
                            title: 'Inhabilitado para Pasantías Profesionales',
                            showConfirmButton: false,
                            timer: 6000
                        })
                    }

                }, "json");
            });

        });

        $(function () {
            $("select").select2({width: '100%'});
            $.fn.select2.defaults.set('language', 'es');
            $(".select2hidden").each(function () {
                var id = $(this).attr("id");
                $("#" + id + "_select2").html('<option>' + $(this).attr("descripcion") + '</option>').trigger('change');
            });
        });

    </script>
    <script>
        function abrir_actividades_por_responsable() {
            $('#modal_reportes_actividades_por_responsable').modal({backdrop: 'static', width: '500px'}).modal('show');
        }

        function abrir_lista_convenio() {
            $('#modal_reportes_lista_convenio').modal({backdrop: 'static', width: '500px'}).modal('show');
        }

        $("#modal_reportes_actividades_por_responsable").ready(function () {
            $.ajax({
                type: "GET",
                url: `{{ request.path }}`,
                data: {'action': 'cargar_responsable'},
                success: function (data) {
                    if (data.result == 'ok') {
                        for (elemento in data.lista) {

                            $("#id_responsable").append($('<option>', {
                                value: data.lista[elemento].id,
                                text: data.lista[elemento].nombre
                            }));
                        }
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    smoke.alert("Error de conexion.");
                },
                dataType: "json"
            });
        });


        $(function () {

            $("#modal_reportes_lista_convenio").on('show', function () {
                $('#vigencia').select2('val', '0');
                $('#vigencia_group').show();
                $('#fechas_group').show();
            });
            $("#modal_reportes_lista_convenio").on('hidden', function () {
                $("#id_fechaini, #id_fechafin").val("");
            });

            $('#download_report_lista_convenio').click(function () {

                let url = '{{ request.path }}?action=excelconvenios';
                var desde = $("#id_fechaini").val();
                var hasta = $("#id_fechafin").val();
                let vigencia = $('#vigencia').val();


                if (vigencia > '0') {
                    url += '&vigencia=' + vigencia
                } else {

                    if (desde !== '' && hasta !== '') {
                        url += '&desde=' + desde + '&hasta=' + hasta
                    }

                    if (desde !== '' && hasta == '') {
                        url += '&desde=' + desde
                        {#+ '&hasta=' + fecha_actual#}
                    }
                }
                window.location.href = url
                $('#modal_reportes_lista_convenio').modal('hide');
            });
            $('#download_report_por_responsable').click(function () {
                let url = '{{ request.path }}?action=reporteactividadesres';
                let responsable = $('#id_responsable').val();
                if (responsable != 0) {
                    url += '&responsable=' + responsable
                    window.location.href = url
                    $('#modal_reportes_actividades_por_responsable').modal('hide');
                } else {
                    smoke.alert("Seleccione un responsable.")
                }

            });
        });
    </script>



    <script>
        function ver_detalle_objetivo(id) {
            bloqueointerface();
            $.ajax({
                type: "POST",
                url: "/adm_convenioempresa",
                data: {'action': 'detalle_objetivo', 'id': id},
                success: function (data) {
                    $.unblockUI();
                    if (data.result == 'ok') {

                        $("#detallemodal_body").html(data.data);

                        $("#detalleobjetivoModal").modal({"backdrop": "static", "width": "1000px"}).modal("show");
                    } else {
                        smoke.alert(data.mensaje);
                    }
                },
                error: function () {
                    $.unblockUI();
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
            return false;

        };

        function cerrarModalObjetivo() {
            $("#detalleobjetivoModal").modal("hide");
        }


    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/i18n/es.js"></script>
    <script src="/static/adicionalesjs/formquestion.js?0.24"></script>

{% endblock %}

{% block atras %}/{% endblock %}

{% block canvas %}



    <div class="modal fade static" id="itemspanelform" style="display: none;">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <h4><i class="fa fa-list"></i> <b class="paneltitleform">FORMULARIO MODAL</b></h4>
        </div>

        <div class="modal-body">
            <form autocomplete="off" method="post"
                  enctype="multipart/form-data" action="{{ request.path }}">
                {% csrf_token %}
                <div class="row-fluid panelbodyform">
                </div>
            </form>
        </div>
        <div class="modal-footer" id="footermodalform">
            <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i
                    class="fa fa-window-close"></i>
                Cerrar</a>
        </div>
    </div>

    <div class="modal fade static" id="itemspanel2" style="display: none;">
        <div class="modal-header">
            <h4><i class="fa fa-list"></i> <b class="paneltitle">FORMULARIO MODAL</b></h4>
        </div>
        <div class="modal-body">
            <form id="form2" class="form-horizontal form-modal" autocomplete="off" method="post"
                  enctype="multipart/form-data" action="{{ request.path }}">
                {% csrf_token %}
                <div class="row-fluid panelbody2">
                </div>
            </form>
        </div>
    </div>


    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4>
        </div>
    </div>

    {#    {% if tutoriasdehoy != 0 %}#}
    {#        <div class="alert alert-warning" role="alert" style="font-size: 14px;">#}
    {#            <img class="blinkimg" src="/static/images/iconos/notificacion.png"#}
    {#                 width="30px;"> <b>Recordatorio:</b> Tiene <b>{{ tutoriasdehoy }}</b> tutorías#}
    {#            agendadas para el dia de hoy.#}
    {#        </div>#}
    {#    {% endif %}#}


    <div class='row-fluid'>
        {% if not perfilprincipal.es_estudiante %}
            <div class="span12">
                {% if perms.sga.puede_modificar_convenios %}
                    <a class="btn  btn-success bloqueo_pantalla" href="{{ request.path }}?action=addconvenio"><i
                            class="fa fa-plus"></i> Adicionar</a>
                    <div class="btn-group">
                        <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="javascript:;">
                            <i class="fa fa-cogs" aria-hidden="true"></i> Configuración <span class="caret"></span></a>
                        <ul class="dropdown-menu pull-left">
                            <li>
                                <a href="{{ request.path }}?action=tipoconvenio"><i class="fa fa-book-reader"></i>
                                    Tipo Convenio</a>
                            </li>
                            <li>
                                <a href="{{ request.path }}?action=tipoempresa"><i class="fa fa-address-card"></i>
                                    Tipo Empresa</a>
                            </li>
                            <li>
                                <a href="{{ request.path }}?action=tipoarchivo"><i class="fa fa-file"></i> Tipo
                                    Archivo</a>
                            </li>
                            <li>
                                <a href="{{ request.path }}?action=empresa"><i class="fa fa-building"></i>
                                    Empresas</a>
                            </li>
                            <li>
                                <a href="{{ request.path }}?action=notificacion"><i class="fa fa-bell"></i>
                                    Notificaciones</a>
                            </li>
{#                            <li>#}
{#                                <a href="javascript:void(0)" onclick="formModal('','Importar convenios', 'importarconvenios')"><i class="fa fa-upload"></i>#}
{#                                    Importar convenios</a>#}
{#                            </li>#}
                        </ul>
                    </div>

                    {#                    <a href="javascript:;" id="masivo" class='btn btn-warning'><i class="fa fa-send"></i> Notificar </a>#}
                    <a onclick="formModal('0','NOTIFICAR MANUAL','notificar')"
                       class="btn  btn-warning" title="Notificar"
                       href="javascript:void(0);"><span class="fa fa-plus"></span> Notificar
                    </a>

                    {#                    <a class="btn btn-default" href="{{ request.path }}?action=solicitudes"><i class="fa fa-plus"></i> Solicitudes</a>#}
                {% endif %}
                {#                <div class="btn-group">#}
                {#                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="javascript:;"> Reportes <span class="caret"></span></a>#}

                <a class="btn btn-default" id="reportes2" target="_blank" href="{{ request.path }}?action=word"><i
                        class="fa fa-hand-paper-o"></i> Generar Informe</a>
                {#                    <ul class="dropdown-menu pull-left" >#}
                {#                        <li><a target="_blank" href="{{ request.path }}?action=excelconvenios"><i class="fa fa-file-excel-o"></i> Lista de convenios</a></li>#}
                {#                        <li><a target="_blank" href="{{ request.path }}?action=excelconvenioempresa"><i class="fa fa-file-excel-o"></i> Empresas en convenio</a></li>#}
                {#                    </ul>#}

                </ul>
                {#                </div>#}

                <div class="btn-group">
                    <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="javascript:;">
                        <i class="fa fa-file-excel-o" aria-hidden="true"></i> Generar Reportes <span
                            class="caret"></span></a>
                    <ul class="dropdown-menu pull-left">
                        <li>
                            <a id="listadoConvenio" onclick="abrir_lista_convenio();">
                                Listado de convenios</a>
                        </li>
                        <li>
                            <a href="{{ request.path }}?action=excelconvenioempresa"> Empresas en convenio </a>
                        </li>
                        <li>
                            <a id="actividad_por_responsable_id" onclick="abrir_actividades_por_responsable();">Actividades
                                por responsable</a>
                        </li>
                    </ul>
                </div>

            </div>
        {% endif %}
    </div>

    <div class='row-fluid'>
        <div class="span12">
            <form method="GET" action="{{ request.path }}">
                <table id="tablaBusqueda" class="table table-hover tablaBusquedaSearch">
                    <tbody>
                    <tr>
                        <td style="width: 250px">
                            <i class="fa fa-tag"></i> Estados: <br>
                            <select name="estado" id="estado" class="form-control" style="width: 100%">
                                <option value="">TODOS</option>
                                <option value="1" {% if estado == 1 %}selected{% endif %}>VIGENTES</option>
                                <option value="2" {% if estado == 2 %}selected{% endif %}>NO VIGENTES</option>
                            </select>
                        </td>
                        <td style="width: 250px">
                            <i class="fa fa-tag"></i> Tipo: <br>
                            <select name="tipo" id="tipo" class="form-control" style="width: 100%">
                                <option value="">TODOS</option>
                                <option value="1" {% if tipo == 1 %}selected{% endif %}>PARA PRÁCTICAS</option>
                                <option value="2" {% if tipo == 2 %}selected{% endif %}>PARA PASANTÍAS</option>
                                <option value="3" {% if tipo == 3 %}selected{% endif %}>PRÁCTICAS/PASANTÍAS</option>
                            </select>
                        </td>
                        <td>
                            <i class="fa fa-calendar tu" title="Desde"></i> Desde:<br>
                            <input class='form-control' type='date' id='desde' value='{{ desde }}' autocomplete="off"
                                   style="width: 100%"
                                   name="desde"/>

                        </td>
                        <td>
                            <i class="fa fa-calendar tu" title="Hasta"></i> Hasta:<br>
                            <input class='form-control' type='date' id='hasta' value='{{ hasta }}' autocomplete="off"
                                   style="width: 100%"
                                   name="hasta"/>

                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <i class="fa fa-search tu" title="Criterio"></i> Criterio:<br>
                            <input class='search' type='text' id='search' value='{{ search }}'
                                   autocomplete="off" name="search" style="width: 80%"
                                   placeholder="Nombres Empresa, Tipo Convenio"/>
                            <button class="btn btn-primary" type="submit" id="button-addon2"><i
                                    class="fa fa-search"></i></button>
                            {% if url_vars or ids %}
                                <a href="{{ request.path }}" id='allresults' class='btn btn-warning'><span
                                        class="fa fa-refresh "></span>
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label><h5><b>Total registros:</b> {{ total }}</h5></label>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </div>
    <div id="no-more-tables"><!-- inicio no more tables-->
        <div class='row-fluid'>
            <div class='span12'>
                <table class='table table-striped table-bordered'>
                    <thead>
                    <tr>
                        {#                    {% if not perfilprincipal.es_estudiante %}#}
                        {#                        <th style="width:30px" >Aplica<br>Solicitud</th>#}
                        {#                    {% endif %}#}
                        <th style="text-align: center; width: 8%">Cod. Convenio</th>
                        <th style="width:200px ;text-align: center">Empresa</th>
                        <th style="width:200px;text-align: center">Tipo convenio</th>
                        <th style="width:100px;text-align: center">Inicio / Fin</th>
                        <th style="width:150px;text-align: center">Responsables interno / externo</th>
                        <th style="width:70px;text-align: center">Objetivo / archivos</th>
                        {% if not perfilprincipal.es_estudiante %}
                            {% if perms.sga.puede_modificar_convenios %}
                                <th style="width:50px;text-align: center">Acciones</th>
                            {% endif %}
                        {% endif %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for convenio in convenioempresas %}
                        <tr>
                            {#                        {% if not perfilprincipal.es_estudiante %}#}
                            {#                            <td style="text-align: center">#}
                            {#                                <a href="javascript:;" class="activaestado" id="idestadoactiva{{ convenio.id }}" idconv="{{ convenio.id }}">#}
                            {#                                    {% if convenio.solicitud %}#}
                            {#                                        <i class="fa fa-check" style="color: green"></i>#}
                            {#                                    {% else %}#}
                            {#                                        <i class="fa fa-remove" style="color: red"></i>#}
                            {#                                    {% endif %}#}
                            {#                                </a>#}
                            {#                            </td>#}
                            {#                        {% endif %}#}
                            <td style="vertical-align:middle;text-align: center"> {{ forloop.counter }} <br>
                                <label class="label label-inverse">Cod. {{ convenio.pk }}</label></td>
                            <td data-title='Empresa' style="text-align: center">
                                {{ convenio.empresaempleadora.nombre|upper }}
                                {#                            {% if perms.sga.puede_modificar_convenios %}#}
                                <br>
                                <label class="label label-inverse">Cod. {{ convenio.empresaempleadora.pk }}</label>
                                <a class="label label-{% if convenio.vigente == "VIGENTE" %}success{% else %}danger{% endif %} label-mini">{{ convenio.vigente }}</a>
                                {% if convenio.tienecarreras %}
                                    <br>
                                    <a class="label label-warning label-mini vercarreras" idcon="{{ convenio.id }}"><i
                                            class="fa fa-book"></i>
                                        PROGRAMAS - CARRERAS</a>
                                {% endif %}
                                {% if not perfilprincipal.es_estudiante %}<br>
                                    {% if perms.sga.puede_modificar_convenios %}

                                        <label class="label label-info"><i class="fa fa-clock-o"></i> DÍAS PARA
                                            GENERACIÓN
                                            DE REPORTE: {{ convenio.dias_notificacion }}</label>
                                        <br>

                                    {% endif %}
                                    <label class="label label-info">F.
                                        Creación: {{ convenio.fecha_creacion|date:"Y-m-d" }}
                                        {{ convenio.fecha_creacion|date:"G:i" }}</label>

                                {% endif %}
                                {#                            {% endif %}#}
                            </td>
                            <td data-title='Tipo convenio' style="text-align: center">
                                {{ convenio.tipoconvenio }}
                                {% if perms.sga.puede_modificar_convenios %}
                                    {% if not perfilprincipal.es_estudiante %}<br>
                                        <b>¿Aplica Prácticas?:</b>
                                        <input type="checkbox" class="practicas" value="{{ convenio.id }}"
                                               {% if convenio.para_practicas %}checked{% endif %}><br>
                                        <b>¿Aplica Pasantías?:</b>
                                        <input type="checkbox" class="pasantias" value="{{ convenio.id }}"
                                               {% if convenio.para_pasantias %}checked{% endif %}>
                                    {% endif %}
                                {% else %}
                                    {% if convenio.para_practicas %}<br>
                                        <label class="label label-info"><i class="fa fa-check-circle"></i> DISPONIBLE
                                            PARA
                                            PRÁCTICAS</label>{% endif %}
                                    {% if convenio.para_practicas %}<br>
                                        <label class="label label-success"><i class="fa fa-check-circle"></i> DISPONIBLE
                                            PARA PASANTÍAS</label>{% endif %}
                                {% endif %}
                            </td>
                            <td data-title='Inicio / Fin'
                                style="text-align: center">
                                {{ convenio.fechainicio|date:'d-m-Y' }}<br/>{{ convenio.fechafinalizacion|date:'d-m-Y' }}
                            </td>
                            <td data-title='Responsables interno / externo' style="text-align: center">
                                {% for de in convenio.responsables_internos %}
                                    <div class="accordion-group">
                                        <div class="accordion-heading" style="background-color:#f0f0f0">
                                            <a style="color: black" class="accordion-toggle" data-toggle="collapse"
                                               data-parent="#accordion1"
                                               href="#collapseDep{{ forloop.counter }}{{ convenio.pk }}">
                                                <span class="fa fa-chevron-down"></span>
                                                <b>Cargo:</b> {{ de.cargo|default_if_none:'Cargo no disponible' |title2}}
                                            </a>
                                        </div>
                                        <div id="collapseDep{{ forloop.counter }}{{ convenio.pk }}"
                                             class="accordion-body collapse primerfilaacoordion in">
                                            <div class="accordion-inner">
                                                <b><i class="fa fa-user"></i> Resp. Interno</b> {{ de.persona.nombre_completo_minus }}
                                            </div>
                                        </div>
                                    </div>
                                {% empty %}
                                      <label class="label label-warning"> SIN RESPONSABLE INTERNO</label> <br>
                                {% endfor %}
                                <b>Externo: </b>
                                <p style="margin: 0px">
                                    <b>Cargo:</b> {{  convenio.cargoresponsableexterno|default_if_none:'Sin cargo'|title2 }}<br>
                                    {{ convenio.responsableexterno|title2 }}
                                </p>
                            </td>
                            <td data-title='Objetivo / archivos' style="text-align: center">
                                {% if convenio.archivosconvenio %}
                                    <div class="accordion-group">
                                        <div class="accordion-heading" style="background-color:#f0f0f0">
                                            <a style="color: black" class="accordion-toggle" data-toggle="collapse"
                                               data-parent="#accordion2" href="#collapseTwo{{ forloop.counter }}">
                                                <span class="fa fa-chevron-down"></span> Archivos de convenio
                                            </a>
                                        </div>
                                        <div id="collapseTwo{{ forloop.counter }}"
                                             class="accordion-body collapse segundafilaacoordion in">
                                            <div class="accordion-inner">
                                                <ol>
                                                    {% for archivo in convenio.archivosconvenio %}
                                                        {% if archivo.archivo %}
                                                            <li style="text-align: left">
                                                                <b>{{ archivo.tipoarchivoconvenio.nombre }}:</b><br>
                                                                <a href="{{ archivo.archivo.url }}"
                                                                   data-toggle="tooltip" title="Descargar archivo"
                                                                   target="_blank"
                                                                   class="btn btn-success btn-mini">
                                                                    <i class="fa fa-download"></i>
                                                                </a>
                                                                <a data-fancybox="image"
                                                                   href="{{ archivo.archivo.url }}"
                                                                   class="btn btn-primary btn-mini">
                                                                    <i class="fa fa-file-pdf"></i> VER ARCHIVO DE
                                                                    CONVENIO
                                                                </a>
                                                                {% if not perfilprincipal.es_estudiante %}
                                                                    {% if perms.sga.puede_modificar_convenios %}
                                                                        <a title="Eliminar archivo"
                                                                           data-placement='left'
                                                                           onclick="eliminarajax('{{ archivo.id }}', '{{ archivo.tipoarchivoconvenio.nombre }}', 'delarchivoconv')"
                                                                           class="btn btn-mini btn-danger"><i
                                                                                class="fa fa-trash"></i>
                                                                        </a><br><br>
                                                                    {% endif %}
                                                                {% endif %}

                                                            </li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if convenio.objetivo %}

                                    <a id="detalle_objetivo" onclick="ver_detalle_objetivo({{ convenio.id }});"
                                       class="btn btn-primary btn-mini btn-block " style="width: 80%"
                                       href='javascript:;'> <span class="fa fa-comment"></span> Objetivo del
                                        convenio</a>
                                {% endif %}

                            </td>
                            {% if not perfilprincipal.es_estudiante %}
                                {% if perms.sga.puede_modificar_convenios %}
                                    <td width="50" style="text-align: center" data-title='Acciones'>
                                        <div class="btn-group" style="text-align: center">
                                            <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown"
                                               href="javascript:;">Acciones<span
                                                    class="caret"></span></a>
                                            <ul class="dropdown-menu pull-right" style="text-align: left">
                                                {% if not perfilprincipal.es_estudiante %}
                                                    {% if perms.sga.puede_modificar_convenios %}
                                                        <li>
                                                            <a href="{{ request.path }}?action=editconvenio&id={{ convenio.id }}"
                                                               class="bloqueo_pantalla"><i class="fa fa-edit"></i>
                                                                Editar</a>
                                                        </li>
                                                        <li><a class="eliminacionmodal" href="javascript:;"
                                                               nhref="{{ request.path }}?action=delconvenio&id={{ convenio.id }}"><i
                                                                class="fa fa-remove"></i> Eliminar</a></li>
                                                        <li>
                                                            <a href="{{ request.path }}?action=carrerasconvenios&id={{ convenio.id }}"
                                                               class="bloqueo_pantalla"><i class="fa fa-list"></i>
                                                                Detalle
                                                                carreras</a>
                                                        </li>
                                                        <li>
                                                            <a href="{{ request.path }}?action=actividades&id={{ convenio.id }}"
                                                               class="bloqueo_pantalla"><i
                                                                    class="fa fa-folder-open"></i>
                                                                Actividades</a>
                                                        </li>
                                                        {% if convenio.tiene_responsable %}
                                                            <li>
                                                                <a onclick="formModal('{{ convenio.id }}','NOTIFICAR INDIVIDUAL','notificarind')"
                                                                   title="Notificar"
                                                                   href="javascript:void(0);"><i class="fa fa-bell"></i>
                                                                    Notificar
                                                                </a>
                                                            </li>
                                                        {% endif %}
                                                        <li>

                                                            <a href="{{ request.path }}?action=reporteactividades&id={{ convenio.id }}"
                                                               target="_blank"><i class="fa fa-file-excel-o"></i>
                                                                Reporte de Actividades</a>
                                                        </li>
                                                    {% endif %}
                                                {% endif %}
                                                {#                                    <li><a href="{{ request.path }}?action=archivoconvenio&id={{ convenio.id }}" class="bloqueo_pantalla"><i class="fa fa-list"></i> Archivos</a></li>#}
                                            </ul>
                                        </div>
                                    </td>
                                {% endif %}
                            {% endif %}
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" style="text-align: center">NO EXISTEN CONVENIOS REGISTRADOS</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% include 'paginacion.html' %}

    <div class="modal fade static" id="itemspanel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle"><i class="fa fa-book"></i> Programas</h3>
        </div>
        <div class="modal-body panelbody">
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-danger"><i class="fa fa-times"></i> Cerrar</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="modal fade static" id="modal_reportes_lista_convenio">
        <div class="modal-header">
            <h3 class="paneltitle">Reporte Convenios institucionales</h3>
        </div>
        <div class="modal-body panelbody_reportes_lista_convenio">
            <div class="row-fluid">
                <div class="span12">

                    <div class="form-group" id="vigencia_group">
                        <label for="vigencia">Vigencia:</label>
                        <select class="form-control" name="vigencia" id="vigencia">
                            <option value="0">TODOS</option>
                            <option value="1">VIGENTES</option>
                            <option value="2">NO VIGENTES</option>
                        </select>
                    </div>
                    <div class="form-group mt-3" id="fechas_group">
                        <div class="span6">
                            <label for="id_fechaini">Fecha inicio:</label>
                            <input class="form-control " type="text" name="id_fechaini" id="id_fechaini"
                                   placeholder="Fecha Inicio"></div>
                        <div class="span6">
                            <label for="id_fechafin">Fecha Fin:</label>
                            <input class="form-control" type="text" name="id_fechafin" id="id_fechafin"
                                   placeholder="Fecha Fin">
                        </div>


                    </div>


                </div>
            </div>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a class="btn btn-success" id="download_report_lista_convenio"><i class="fa fa-download"></i>
                        Descargar Reporte</a>
                    </td>
                    <td><a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>


    <div class="modal fade static" id="modal_reportes_actividades_por_responsable">
        <div class="modal-header">
            <h3 class="paneltitle">Reporte actividades por Responsable</h3>
        </div>
        <div class="modal-body panelbody_reportes_actividades_por_responsable">
            <div class="row-fluid">
                <div class="span12">
                    <div class="form-group" id="responsables_group">
                        <label for="">Responsable:</label>
                        <div class="input-group input-daterange">
                            <select class="form-control" id="id_responsable" name="Responsable">
                                <option value="0">--------</option>

                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a class="btn btn-success" id="download_report_por_responsable"><i class="fa fa-download"></i>
                        Descargar Reporte</a></td>
                    <td><a class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>

        </div>
    </div>


    <div class="modal fade static" id="detalleobjetivoModal" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Objetivo</h3>
        </div>
        <div class="modal-body" id="detallemodal_body"></div>
        <div class="modal-footer">
            <div style="float: right">
                <a href="javascript:;" onclick="cerrarModalObjetivo();" detalleobjetivomodal_aceptar" class="btn
                btn-info btn-aceptar"> Cerrar</a>
            </div>
        </div>
    </div>

{% endblock %}

